// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
// See https://www.arcgis.com/home/copyright.txt for further details.
//>>built
/*
 *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
**************************************************************************** Calcite Web - Calcite Design Components in CSS, JS and HTML
 @version v1.2.5
 @license Apache-2.0
 @copyright 2018 Esri
 @link https://github.com/Esri/calcite-web
*/
require({cache:{"dijit/form/VerticalRule":function(){define(["dojo/_base/declare","./HorizontalRule"],function(m,n){return m("dijit.form.VerticalRule",n,{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerV"\x3e\x3c/div\x3e',_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkV" style\x3d"top:',_isHorizontal:!1})})},"dijit/form/VerticalRuleLabels":function(){define(["dojo/_base/declare","./HorizontalRuleLabels"],function(m,n){return m("dijit.form.VerticalRuleLabels",
n,{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerV dijitRuleLabelsContainer dijitRuleLabelsContainerV"\x3e\x3c/div\x3e',_positionPrefix:'\x3cdiv class\x3d"dijitRuleLabelContainer dijitRuleLabelContainerV" style\x3d"top:',_labelPrefix:'"\x3e\x3cspan class\x3d"dijitRuleLabel dijitRuleLabelV"\x3e',_calcPosition:function(v){return 100-v},_isHorizontal:!1})})},"esri/dijit/editing/Editor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/DeferredList dojo/dom-class dojo/dom-construct dojo/string dijit/_Widget dijit/_Templated ../../domUtils ../../graphicsUtils ../../geometry/Polyline ../../geometry/Polygon ../../graphic ../../undoManager ../../tasks/query ../../layers/FeatureLayer ../../layers/FeatureTemplate ../../toolbars/draw ../../toolbars/edit ../AttributeInspector ./Util ./Add ./Update ./Delete ./Cut ./Union ./toolbars/Drawing ./SelectionHelper ./TemplatePicker ../../kernel ../../config dojo/i18n!../../nls/jsapi dojo/text!./templates/Editor.html dijit/ProgressBar dojo/NodeList-dom".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x,t,w,z,B,A,y,E,G,F,D,L,O,S,Z,I,N,K,Q,da,U){var aa=m([k,g],{declaredClass:"esri.dijit.editing.Editor",widgetsInTemplate:!0,templateString:U,onLoad:function(){},constructor:function(J,T){J=J||{};this._settings=J.settings;this._eConnects=[]},startup:function(){this.inherited(arguments);this._setDefaultOptions();this._settings.map.setInfoWindowOnClick(!1);var J=this._settings.layerInfos;this.featureReductionEnabledLayers=[];v.forEach(J,function(Y){Y=Y.featureLayer;
Y.isFeatureReductionEnabled()&&(Y.disableFeatureReduction(),this.featureReductionEnabledLayers.push(Y))},this);if(v.every(J,function(Y){return Y.featureLayer.loaded}))this._initLayers(),this._connectEvents(),this._createWidgets(),this.onLoad(),this.loaded=!0;else{var T=J.length;v.forEach(J,function(Y){Y=Y.featureLayer;if(Y.loaded)T--;else var W=b.connect(Y,"onLoad",this,function(R){b.disconnect(W);W=null;T--;T||(this._initLayers(),this._connectEvents(),this._createWidgets(),this.onLoad(),this.loaded=
!0)})},this)}this._reset();this._enableMapClickHandler()},stopEditing:function(J){this._updateCurrentFeature(n.hitch(this,function(){this._clearSelection(!1);J&&J()}))},destroy:function(){this._settings.map.setInfoWindowOnClick(!0);this.drawingToolbar&&this.drawingToolbar.destroy();this.attributeInspector&&this.attributeInspector.destroy();this.templatePicker&&this.templatePicker.destroy();this._selectionHelper&&this._selectionHelper.destroy();this._drawToolbar&&this._drawToolbar.deactivate();this._reset();
this._disableMapClickHandler();v.forEach(this._eConnects,b.disconnect);b.disconnect(this._dtConnect);b.disconnect(this._templatePickerOnSelectionChangeEvent);this._layer=this._currentGraphic=this._activeType=this._activeTemplate=this._drawingTool=this._drawToolbar=this.editToolbar=this.drawingToolbar=this.attributeInspector=this.templatePicker=this.undoManager=null;this._settings.map.infoWindow&&this._settings.map.infoWindow.clearFeatures&&this._settings.map.infoWindow.clearFeatures();v.forEach(this.featureReductionEnabledLayers,
function(J){J.enableFeatureReduction()});this.inherited(arguments)},_setDefaultOptions:function(){this._drawToolbar=this._settings.drawToolbar||new A(this._settings.map);this._settings.drawToolbar=this._drawToolbar;this.editToolbar=this._settings.editToolbar||new y(this._settings.map,{textSymbolEditorHolder:this.domNode});this._settings.editToolbar=this.editToolbar;this._settings.toolbarVisible=this._settings.toolbarVisible||!1;this._settings.toolbarOptions=n.mixin({reshapeVisible:!1,cutVisible:!1,
mergeVisible:!1},this._settings.toolbarOptions);this._settings.createOptions=n.mixin({polylineDrawTools:[aa.CREATE_TOOL_POLYLINE],polygonDrawTools:[aa.CREATE_TOOL_POLYGON],editAttributesImmediately:!0},this._settings.createOptions);this._settings.singleSelectionTolerance=this._settings.singleSelectionTolerance||3;this._settings.maxUndoRedoOperations=this._settings.maxUndoRedoOperations||10;this._settings.editor=this;this._usePopup=this._settings.usePopup=this._settings.map.infoWindow._setPagerCallbacks?
!0:!1;this._datePackage=this._settings.datePackage;var J=Q.defaults;this._settings.geometryService=this._settings.geometryService||J.geometryService;J.geometryService=J.geometryService||this._settings.geometryService},_initLayers:function(){this._settings.layers=[];this._settings.userIds={};this._settings.createOnlyLayer={};v.forEach(this._settings.layerInfos,function(J){if(J.featureLayer&&J.featureLayer.loaded){this._settings.layers.push(J.featureLayer);var T=J.featureLayer.id;J.featureLayer.credential&&
(this._settings.userIds[T]=J.featureLayer.credential.userId);J.userId&&(this._settings.userIds[T]=J.userId);var Y=J.featureLayer.getEditCapabilities();this._settings.createOnlyLayer[T]=Y.canCreate&&!Y.canUpdate?!0:!1;this._isTextSymbolPointLayer(J.featureLayer)&&(J.disableAttributeUpdate=!0)}},this)},_reset:function(){this._hideAttributeInspector();this.editToolbar.deactivate();this._editVertices=!0;this._drawingTool=this._activeTemplate=this._activeType=this._currentGraphic=this._layer=null;this._attributeChanged=
!1},_saveFeatureOnClient:function(J){var T=this.templatePicker.getSelected();var Y=T.template?T.featureLayer.renderer.getSymbol(T.template.prototype):T.symbolInfo.symbol;this._tempGraphic=new x(J,Y,null,null);this._tempGraphic.setAttributes(n.mixin({},T.template.prototype.attributes));Y=this._settings.map;Y.graphics.add(this._tempGraphic);J=this._findCenterPoint(J);this._createAttributeInspector();Y.infoWindow.setTitle(T.featureLayer?T.featureLayer.name:da.widgets.attributeInspector.NLS_title);this.attributeInspector.showFeature(this._tempGraphic,
T.featureLayer);this._showInfoWindow(J,Y.getInfoWindowAnchor(J));if(this._settings.createOnlyLayer[T.featureLayer.id]||this._settings.invalidTemplate)this._infoWindowHideEvent=b.connect(Y.infoWindow,"onHide",this,"_infoWindowHide");b.disconnect(this._templatePickerOnSelectionChangeEvent);this.templatePicker.clearSelection();this._drawToolbar.deactivate();this._enableMapClickHandler();this.drawingToolbar&&this.drawingToolbar.deactivate();this._templatePickerOnSelectionChangeEvent=b.connect(this.templatePicker,
"onSelectionChange",n.hitch(this,"_onCreateFeature"))},_saveAttributesOnClient:function(J,T,Y){this._tempGraphic.attributes[T]="number"===typeof Y&&isNaN(Y)?null:Y},_infoWindowHide:function(){this._createFeature(this._tempGraphic.geometry,this._tempGraphic.attributes);b.disconnect(this._infoWindowHideEvent)},_createFeature:function(J,T){this._editClickPoint=this._findCenterPoint(J);J.rings?this._simplify(J,n.hitch(this,function(Y){this._drawingTool!==B.TOOL_AUTO_COMPLETE_POLYGON?this._applyEdits([{layer:this._layer,
adds:[this._createGraphic(Y,T)]}],n.hitch(this,function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer)})):this._autoComplete(Y,n.hitch(this,function(W){W&&W.length&&this._applyEdits([{layer:this._layer,adds:v.map(W,n.hitch(this,function(R){return this._createGraphic(R,T)}))}],function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer)})}))})):this._applyEdits([{layer:this._layer,
adds:[this._createGraphic(J,T)]}],n.hitch(this,function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer);this._layer&&this._layer.renderer&&"heatmap"===this._layer.renderer.type&&this._layer.refresh()}))},_chainAttachment:function(J,T){this.attributeInspector&&this.attributeInspector._attachmentEditor&&this.attributeInspector._attachmentEditor._tempUpload&&this.attributeInspector._attachmentEditor._chainAttachment(J,T)},_updateCurrentFeature:function(J){var T=
this._isModified();T?this._updateFeature(T,J):J&&J(!1)},_updateFeature:function(J,T,Y){var W=J.geometry,R=J.getLayer();R.hasZ&&!R.enableZDefaults||R.hasM&&!R.allowUpdateWithoutMValues||Y&&!this._isModified()?(Y=new x,Y.setAttributes(J.attributes),this._applyEdits([{layer:J.getLayer(),updates:[Y]}],T)):W.rings?this._simplify(W,n.hitch(this,function(X){this._applyEdits([{layer:J.getLayer(),updates:[n.mixin(J,{geometry:X})]}],T)})):this._applyEdits([{layer:J.getLayer(),updates:[J]}],T)},_deleteFeature:function(J,
T){if(this._settings.invalidTemplate&&J===this._tempGraphic)this._settings.map.graphics.remove(this._tempGraphic),this._hideAttributeInspector();else{var Y=[];J?Y.push({layer:J.getLayer(),deletes:[J]}):(Y=v.map(v.filter(this._settings.layers,function(W){return 0<W.getSelectedFeatures().length}),function(W){return{layer:W,deletes:W.getSelectedFeatures()}}))&&Y.length||!this._currentGraphic||Y.push({layer:this._layer,deletes:[this._currentGraphic]});this._applyEdits(Y,T)}},_stopEditing:function(J,T,
Y,W){e.hide(this.progressBar.domNode);this._settings.createOnlyLayer[J.id]||this._undoRedoAdd();if(!0===J._isSelOnly||1===J.mode||6===J.mode){if(T&&T.length){this.templatePicker.clearSelection();var R=new w;R.objectIds=[T[0].objectId];this._settings.createOnlyLayer[J.id]||this._settings.invalidTemplate?this._settings.map.graphics.remove(this._tempGraphic):this._selectFeatures([J],R,n.hitch(this,"_onEditFeature"))}}else(R=this._selectionHelper.findMapService(this._settings.map,J))&&R.refresh(),T&&
T.length&&(this.templatePicker.clearSelection(),this._settings.createOnlyLayer[J.id]||this._settings.invalidTemplate?this._settings.map.graphics.remove(this._tempGraphic):G.findFeatures(T,J,n.hitch(this,"_onEditFeature")));W&&W.length&&(this._clearSelection(!0),this._undoRedo&&(R=this._selectionHelper.findMapService(J,this._settings.map))&&R.refresh());this._undoRedo&&Y&&Y.length&&((R=this._selectionHelper.findMapService(J,this._settings.map))&&R.refresh(),this.attributeInspector.refresh(),this._undoRedo=
!1);this.drawingToolbar&&this.drawingToolbar._updateUI();this._undoRedo=!1;this._settings.invalidTemplate=!1},_undoRedoAdd:function(){this._settings._isApplyEditsCall=!1;if(this._settings.undoManager){var J=this._edits&&this._edits.length?this._edits[0]:null;if(J){var T=J.adds||[],Y=J.updates||[],W=J.deletes||[],R=J.preUpdates||[];J={featureLayer:J.layer};"CUT"===this._activeTool?T.length&&Y.length&&R.length&&this.undoManager.add(new O(n.mixin(J,{preUpdatedGraphics:R,addedGraphics:T,postUpdatedGraphics:Y}))):
"UNION"===this._activeTool?W.length&&Y.length&&R.length&&this.undoManager.add(new S(n.mixin(J,{preUpdatedGraphics:R,deletedGraphics:W,postUpdatedGraphics:Y}))):T.length?this.undoManager.add(new F(n.mixin(J,{addedGraphics:T}))):W.length?this.undoManager.add(new L(n.mixin(J,{deletedGraphics:W}))):Y.length&&(this._rollbackGraphic||R.length)&&this.undoManager.add(new D(n.mixin(J,{preUpdatedGraphics:R.length?R:[this._rollbackGraphic],postUpdatedGraphics:Y})));this._rollbackGraphic=this._edits=null}}},
_activateDrawToolbar:function(J){this._layer=J.featureLayer;this._activeType=J.type;this._drawingTool=(this._activeTemplate=J.template)?this._activeTemplate.drawingTool:null;this._drawTool=this._toDrawTool(this._drawingTool,J.featureLayer);b.disconnect(this._dtConnect);var T=this._layer.fields;this._settings.invalidTemplate=!1;if(this._activeTemplate&&this._activeTemplate.prototype){var Y=n.mixin({},this._activeTemplate.prototype.attributes);T=T.filter(function(W){return!1===W.nullable&&!0===W.editable});
this._settings.invalidTemplate=T.some(function(W){W=Y[W.name];return null===W||void 0===W})}this._dtConnect=this._settings.createOnlyLayer[J.featureLayer.id]||this._settings.invalidTemplate?b.connect(this._drawToolbar,"onDrawEnd",this,"_saveFeatureOnClient"):b.connect(this._drawToolbar,"onDrawEnd",this,"_createFeature");this.editToolbar.deactivate();this._disableMapClickHandler();this.drawingToolbar?this.drawingToolbar.activateEditing(this._drawTool,this._layer):this._drawToolbar.activate(this._drawTool)},
_activateEditToolbar:function(J,T){var Y=J.getLayer(),W=Y?Y.geometryType:null,R=this._isTextSymbolPoint(J),X=y.MOVE;"esriGeometryPoint"!==W&&!0===this._isNotesFeature(J)?(X=X|y.ROTATE|y.SCALE,this._editVertices=!1):"esriGeometryPoint"!==W&&!0===this._editVertices?(X=X|y.ROTATE|y.SCALE,this._editVertices=!1):R?(X=X|y.ROTATE|y.SCALE|y.EDIT_TEXT,this._editVertices=!1):(X|=y.EDIT_VERTICES,this._editVertices=!0);this._attributeChanged=this._isModified();this._rollbackGraphic=new x(J.toJson());W=Y.getEditCapabilities({feature:J,
userId:this._settings.userIds[Y.id]});var ia=v.filter(this._settings.layerInfos,function(ka){return ka.featureLayer.layerId===Y.layerId})[0];W.canUpdate&&!ia.disableGeometryUpdate&&W.canUpdateGeometry&&(this.editToolbar.activate(X,J),R&&(this.editToolbar._textEditor._addTextBox(J),this.editToolbar._textSymbolEditor&&this.editToolbar._textSymbolEditor.hide()));this._settings.map.infoWindow.isShowing||this._updateAttributeDisabled(J)||(R=T&&T.screenPoint||this._findCenterPoint(J),this._showInfoWindow(R,
this._settings.map.getInfoWindowAnchor(R)))},_createGraphic:function(J,T){var Y=new x(J,this._activeType&&this._activeType.symbol||this._layer.defaultSymbol,T);this._activeTemplate||T?Y.attributes=T||n.mixin({},this._activeTemplate.prototype.attributes):(Y.attributes=Y.attributes||[],v.forEach(this._layer.fields,function(W){Y.attributes[W.name]=null},this));return Y},_connectEvents:function(){var J=this._settings.layers;v.forEach(J,function(T){this._connect(T,"onEditsComplete",n.hitch(this,"_stopEditing",
T))},this);v.forEach(J,function(T){this._connect(T,"onBeforeApplyEdits",n.hitch(this,function(){e.show(this.progressBar.domNode);this._settings._isApplyEditsCall=!0}))},this);this._connect(this.editToolbar,"onGraphicClick",n.hitch(this,"_activateEditToolbar"));this._connect(this.editToolbar,"onGraphicFirstMove",n.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onVertexFirstMove",n.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onScaleStart",n.hitch(this,
"_hideAttributeInspector"));this._connect(this.editToolbar,"onRotateStart",n.hitch(this,"_hideAttributeInspector"))},_connect:function(J,T,Y){this._eConnects.push(b.connect(J,T,Y))},_createWidgets:function(){this._selectionHelper=new I(this._settings);this._createTemplatePicker();this._createAttributeInspector();this._createDrawingToolbar();this._createUndoRedoManager()},_createTemplatePicker:function(){if(this._settings.templatePicker)this.templatePicker=this._settings.templatePicker,e.hide(this.templatePickerDiv);
else{var J=v.filter(this._settings.layers,function(T){return T.getEditCapabilities().canCreate});this.templatePicker=new N({"class":"esriTemplatePicker",featureLayers:J,showTooltip:!0,maxLabelLength:this._settings.typesCharacterLimit,columns:"auto",rows:"auto"},this.templatePickerDiv);this.templatePicker.startup();this._settings.templatePicker=this.templatePicker}this._templatePickerOnSelectionChangeEvent=b.connect(this.templatePicker,"onSelectionChange",n.hitch(this,"_onCreateFeature"))},_createAttributeInspector:function(){var J=
this._settings.map;this._settings.attributeInspector?(this._customAttributeInspector=!0,this.attributeInspector=this._settings.attributeInspector):(this._customAttributeInspector=!1,this.attributeInspector=new E({layerInfos:this._settings.layerInfos,hideNavButtons:this._usePopup,datePackage:this._datePackage},h.create("div")),this.attributeInspector.startup(),J.infoWindow.setContent(this.attributeInspector.domNode),J.infoWindow.setTitle(da.widgets.attributeInspector.NLS_title),J.infoWindow.resize(350,
375),p.query(".esriAttributeInspector .atiLayerName").style({display:"none"}));this._connect(this.attributeInspector,"onDelete",n.hitch(this,"_deleteFeature"));this._connect(this.attributeInspector,"onNext",n.hitch(this,function(T){this._updateCurrentFeature(n.hitch(this,function(){this._attributeChanged=!1;this._onEditFeature(T)}))}));this._usePopup&&J.infoWindow._setPagerCallbacks(this.attributeInspector,n.hitch(this.attributeInspector,"previous"),n.hitch(this.attributeInspector,"next"));this._connect(this.attributeInspector,
"onAttributeChange",n.hitch(this,function(T,Y,W){if(this._settings.createOnlyLayer[this._layer.id]||this._settings.invalidTemplate)this._saveAttributesOnClient(T,Y,W);else{var R=T.getLayer();(R=v.filter(R.fields,function(X){return X.name===Y})[0])&&""===W&&(W=null);this._rollbackGraphic=new x(n.clone(T.toJson()));this.attributeInspector._rollbackInfo={field:R,graphic:this._rollbackGraphic};this._currentGraphic.attributes[Y]="number"===typeof W&&isNaN(W)?null:W;this._currentGraphic.setAttributes(this._currentGraphic.attributes);
this._updateFeature(this._currentGraphic,null,!0);this._attributeChanged=!1}}))},_createDrawingToolbar:function(){!0===this._settings.toolbarVisible&&(this.drawingToolbar=new Z({"class":"esriDrawingToolbar",drawToolbar:this._drawToolbar,editToolbar:this.editToolbar,settings:this._settings,onDelete:n.hitch(this,"_deleteFeature"),onApplyEdits:n.hitch(this,"_applyEdits"),onShowAttributeInspector:n.hitch(this,"_onEditFeature")},this.drawingToolbarDiv))},_createUndoRedoManager:function(){if(this._settings.enableUndoRedo||
this._settings.undoManager)this._settings.enableUndoRedo=!0,this.undoManager=this._settings.undoManager,this.undoManager||(this.undoManager=this._settings.undoManager=new t({maxOperations:this._settings.maxUndoRedoOperations})),this._connect(this.undoManager,"onUndoComplete",n.hitch(this,this._updateUndoRedoOperations)),this._connect(this.undoManager,"onRedoComplete",n.hitch(this,this._updateUndoRedoOperations)),this._connect(document,"onkeypress",n.hitch(this,function(J){if(J.metaKey||J.ctrlKey)"z"===
J.charOrCode&&this._undo(),"y"===J.charOrCode&&this._redo()}))},_updateUndoRedoOperations:function(J){if(J&&J.addedIds){var T;for(T=0;T<this.undoManager.length;T++){var Y=this.undoManager.get(T);Y&&J.layer===Y._featureLayer&&Y.updateObjectIds(J.oldIds,J.addedIds)}}J&&"Update Features"===J.operation.label&&this.attributeInspector.refresh()},_enableMapClickHandler:function(){this._mapClickHandler=b.connect(this._settings.map,"onClick",n.hitch(this,function(J){this._drawToolbar._geometryType||("SELECT"===
this._activeTool?this._activeTool="":this._updateCurrentFeature(n.hitch(this,function(){this._reset();this._updateSelection(J)})))}))},_disableMapClickHandler:function(){b.disconnect(this._mapClickHandler)},_onCreateFeature:function(){var J=this.templatePicker.getSelected();J?this._updateCurrentFeature(n.hitch(this,function(){this._currentGraphic&&this._clearSelection(!1);this._reset();this._activateDrawToolbar(J)})):(this._reset(),b.disconnect(this._dtConnect),this._drawToolbar.deactivate(),this._enableMapClickHandler(),
this.drawingToolbar&&this.drawingToolbar.deactivate())},_isTextSymbolPoint:function(J){if("point"===J.geometry.type||"multipoint"===J.geometry.type){var T=J.getLayer(),Y=T.renderer;J=J.symbol||T._getSymbol(J);!J&&(Y.hasVisualVariables("sizeInfo",!1)||Y.hasVisualVariables("colorInfo",!1)||Y.hasVisualVariables("opacityInfo",!1))&&Y.addBreak&&Y.infos&&1===Y.infos.length&&(J=Y.infos[0].symbol||Y.defaultSymbol);if(J&&"textsymbol"===J.type)return!0}return!1},_isTextSymbolPointLayer:function(J){return"esriGeometryPoint"===
J.geometryType&&J.renderer&&J.renderer._symbols&&J.renderer._symbols[0]&&J.renderer._symbols[0].symbol&&"textsymbol"===J.renderer._symbols[0].symbol.type?!0:!1},_updateAttributeDisabled:function(J){J=J.getLayer();if(!J)return!1;var T,Y=!1;for(T=0;T<this._settings.layerInfos.length;T++){var W=this._settings.layerInfos[T];if(W.featureLayer==J){Y=W.disableAttributeUpdate;break}}return Y},_onEditFeature:function(J,T){if(J=(n.isArray(J)?J[0]:J)||null){this._layer=J.getLayer();if(!this._customAttributeInspector&&
!this._updateAttributeDisabled(J)){T=T||this._editClickPoint||this._findCenterPoint(J);if(1<this._currentFeatureCount){var Y=this._popupFeatures.indexOf(J);Y=l.substitute(da.widgets.popup.NLS_pagingInfo,{index:Y+1,total:this._currentFeatureCount})}else Y=this._layer?this._layer.name:da.widgets.attributeInspector.NLS_title;this._settings.map.infoWindow.setTitle(Y);if(this.drawingToolbar||!this._settings.map.infoWindow.isShowing)this.attributeInspector.refresh(),this._showInfoWindow(T,this._settings.map.getInfoWindowAnchor(T));
this._editClickPoint=null}J!==this._currentGraphic&&(this._editVertices=!0,this._currentGraphic=J,J.getDojoShape()&&J.getDojoShape().moveToFront(),Y=this._layer.hasM,this._layer.hasZ&&!this._layer.enableZDefaults||Y&&!this._layer.allowUpdateWithoutMValues||this._activateEditToolbar(J))}},_applyEdits:function(J,T){J=J||[];if(!(0>=J.length)){this._edits=this._oEdits=J;var Y=[];v.forEach(J,function(W){W.layer&&Y.push(W.layer.applyEdits(W.adds,W.updates,W.deletes))});0<Y.length&&(this._deferredsList=
(new a(Y)).addCallback(n.hitch(this,function(){e.hide(this.progressBar.domNode);T&&T();var W=this._settings.map;W&&W.infoWindow.reposition&&W.infoWindow.isShowing&&W.infoWindow.reposition()})))}},_undo:function(){this._settings.undoManager&&!this._settings._isApplyEditsCall&&(this.editToolbar.deactivate(),this._undoRedo=!0,this._settings.undoManager.undo())},_redo:function(){this._settings.undoManager&&!this._settings._isApplyEditsCall&&(this.editToolbar.deactivate(),this._undoRedo=!0,this._settings.undoManager.redo())},
_simplify:function(J,T){r.prototype.isSelfIntersecting(J)?this._settings.geometryService.simplify([J],function(Y){var W=Y&&Y.length?Y[0]:W;T&&T(W)}):T&&T(J)},_autoComplete:function(J,T){var Y=this._getLayers("esriGeometryPolygon"),W=new w;W.geometry=J;W.returnGeometry=!0;this._selectFeatures(Y,W,n.hitch(this,function(R){!R||0>=R.length?T&&T([J]):this._settings.geometryService.autoComplete(q.getGeometries(R),this._toPolylines([W.geometry]),function(X){T&&T(X)})}))},_getLayers:function(J){return v.filter(this._settings.layers,
function(T){return T.geometryType===J})},_selectFeatures:function(J,T,Y,W){this._selectionHelper.selectFeatures(J,T,W||z.SELECTION_NEW,Y)},_updateSelection:function(J){var T=J.mapPoint,Y=J.graphic,W=this._settings.layerInfos,R;this._selectionHelper.selectFeaturesByGeometry(this._settings.layers,T,z.SELECTION_NEW,n.hitch(this,function(X){var ia=v.some(X,n.hitch(this,function(ca){return ca==Y}));if(Y&&!ia)if(ia=Y.getLayer(),this._isValidLayer(ia)){var ka=new w;ka.objectIds=[Y.attributes[ia.objectIdField]];
this._selectionHelper.selectFeatures([ia],ka,z.SELECTION_ADD,n.hitch(this,function(ca){ca&&ca.length&&(ca=ca.concat(X),R=G.sortFeaturesById(W,ca),this._updatePopupButtons(R),this._onEditFeature(R,T))}))}else X&&X.length?(R=G.sortFeaturesById(W,X),this._updatePopupButtons(R),this._onEditFeature(R,T)):this._clearSelection();else X&&X.length?(R=G.sortFeaturesById(W,X),this._updatePopupButtons(R),this._onEditFeature(R,T)):this._clearSelection()}));Y&&this._isTextSymbolPoint(Y)&&this._isValidLayer(Y.getLayer())&&
this.editToolbar.activate(0|y.MOVE|y.ROTATE|y.SCALE|y.EDIT_TEXT,Y)},_updatePopupButtons:function(J){if(this._usePopup&&J){var T=J.length;v.forEach([this._settings.map.infoWindow._prevFeatureButton,this._settings.map.infoWindow._nextFeatureButton],n.hitch(this,function(W){1<T?c.remove(W,"hidden"):c.add(W,"hidden")}));var Y=1<T?"block":"none";p.query(".esriAttributeInspector .atiLayerName").style({display:Y});this._currentFeatureCount=T;this._popupFeatures=J}else this._currentFeatureCount=this._popupFeatures=
null},_clearSelection:function(J){this._currentFeatureCount=0;this._popupFeatures=null;this._selectionHelper.clearSelection(J||!1);this._reset()},_findCenterPoint:function(J){J=J.geometry||J;switch(J.type){case "point":var T=J;break;case "polyline":T=J.getPoint(0,Math.ceil(J.paths[0].length/2));break;case "polygon":T=J.rings.length-1,T=J.getPoint(T,J.rings[T].length-1)}return this._settings.map.toScreen(T)},_hideAttributeInspector:function(){!this._customAttributeInspector&&this._settings.map.infoWindow&&
this._settings.map.infoWindow.hide()},_toPolylines:function(J){return v.map(J,function(T){var Y=new u(T.spatialReference);v.forEach(T.rings,function(W){Y.addPath(W)});return Y})},_isNotesFeature:function(J){var T=J.getLayer(),Y=T?T.types||null:null;if(!Y)return!1;var W=J.attributes[T.typeIdField],R;v.some(Y,function(X){return X.id===W?(R=X.templates,!0):!1});return R?(J=R[0]||null)?this._isShapeTool(J.drawingTool)?!0:!1:!1:!1},_isValidLayer:function(J){var T,Y=this._settings.layerInfos;for(T=0;T<
Y.length;T++){var W=Y[T];if(J.id==(W.featureLayer?W.featureLayer.id:W.layerId))return!0}return!1},_isShapeTool:function(J){switch(J){case B.TOOL_ARROW:return A.ARROW;case B.TOOL_LEFT_ARROW:return A.LEFT_ARROW;case B.TOOL_RIGHT_ARROW:return A.RIGHT_ARROW;case B.TOOL_UP_ARROW:return A.UP_ARROW;case B.TOOL_DOWN_ARROW:return A.DOWN_ARROW;case B.TOOL_CIRCLE:return A.CIRCLE;case B.TOOL_ELLIPSE:return A.ELLIPSE;case B.TOOL_TRIANGLE:return A.TRIANGLE;case B.TOOL_RECTANGLE:return A.RECTANGLE;default:return null}},
_toDrawTool:function(J,T){var Y=T.geometryType;switch(J){case B.TOOL_POINT:return A.POINT;case B.TOOL_ARROW:return A.ARROW;case B.TOOL_LEFT_ARROW:return A.LEFT_ARROW;case B.TOOL_RIGHT_ARROW:return A.RIGHT_ARROW;case B.TOOL_UP_ARROW:return A.UP_ARROW;case B.TOOL_DOWN_ARROW:return A.DOWN_ARROW;case B.TOOL_CIRCLE:return A.CIRCLE;case B.TOOL_ELLIPSE:return A.ELLIPSE;case B.TOOL_TRIANGLE:return A.TRIANGLE;case B.TOOL_RECTANGLE:return A.RECTANGLE;case B.TOOL_LINE:return A.POLYLINE;case B.TOOL_POLYGON:return A.POLYGON;
case B.TOOL_FREEHAND:return"esriGeometryPolyline"===Y?A.FREEHAND_POLYLINE:A.FREEHAND_POLYGON;default:var W=A.POINT;"esriGeometryPolyline"===Y?(W=A.POLYLINE,this._settings.createOptions.polylineDrawTools[0]===aa.CREATE_TOOL_FREEHAND_POLYLINE&&(W=A.FREEHAND_POLYLINE)):"esriGeometryPolygon"===Y&&(W=A.POLYGON,this._settings.createOptions.polygonDrawTools[0]===aa.CREATE_TOOL_FREEHAND_POLYGON&&(W=A.FREEHAND_POLYGON));return W}},_isModified:function(){var J=this.editToolbar.getCurrentState();return(J.isModified||
this._attributeChanged)&&J.graphic?J.graphic:null},_showInfoWindow:function(J,T){this._customAttributeInspector||this._settings.map.infoWindow.show(J,T)}});n.mixin(aa,{CREATE_TOOL_POLYLINE:"polyline",CREATE_TOOL_FREEHAND_POLYLINE:"freehandpolyline",CREATE_TOOL_POLYGON:"polygon",CREATE_TOOL_FREEHAND_POLYGON:"freehandpolygon",CREATE_TOOL_AUTOCOMPLETE:"autocomplete",CREATE_TOOL_RECTANGLE:"rectangle",CREATE_TOOL_TRIANGLE:"triangle",CREATE_TOOL_CIRCLE:"circle",CREATE_TOOL_ELLIPSE:"ellipse",CREATE_TOOL_ARROW:"arrow",
CREATE_TOOL_UP_ARROW:"uparrow",CREATE_TOOL_DOWN_ARROW:"downarrow",CREATE_TOOL_RIGHT_ARROW:"rightarrow",CREATE_TOOL_LEFT_ARROW:"leftarrow"});n.setObject("dijit.editing.Editor",aa,K);return aa})},"esri/undoManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/when ./kernel ./Evented ./OperationBase".split(" "),function(m,n,v,b,p,f){m=m([f],{declaredClass:"esri.UndoManager",maxOperations:10,canUndo:!1,canRedo:!1,position:0,length:0,onUndo:function(){},onRedo:function(){},onUndoComplete:function(){},
onRedoComplete:function(){},onAdd:function(){},onChange:function(){},constructor:function(d){d=d||{};d.maxOperations&&(this.maxOperations=d.maxOperations);this._historyStack=[]},add:function(d){if(0<this.maxOperations)for(;this._historyStack.length>=this.maxOperations;)this._historyStack.shift();this._historyStack.splice(this.position,0,d);this.position++;this.clearRedo();this.onAdd();this._checkAvailability()},undo:function(){if(0===this.position)return null;var d=this.peekUndo();this.position--;
d?(d=d.performUndo(),this.onUndo(),this._checkAvailability(),b(d).then(n.hitch(this,this.onUndoComplete))):(this.onUndo(),this._checkAvailability())},redo:function(){if(this.position===this._historyStack.length)return null;var d=this.peekRedo();this.position++;d?(d=d.performRedo(),this.onRedo(),this._checkAvailability(),b(d).then(n.hitch(this,this.onRedoComplete))):(this.onRedo(),this._checkAvailability())},_checkAvailability:function(){this.length=this._historyStack.length;0===this.length?this.canUndo=
this.canRedo=!1:0===this.position?(this.canRedo=!0,this.canUndo=!1):this.position===this.length?(this.canUndo=!0,this.canRedo=!1):this.canRedo=this.canUndo=!0;this.onChange()},clearUndo:function(){this._historyStack.splice(0,this.position);this.position=0;this._checkAvailability()},clearRedo:function(){this._historyStack.splice(this.position,this._historyStack.length-this.position);this.position=this._historyStack.length;this._checkAvailability()},peekUndo:function(){if(0<this._historyStack.length&&
0<this.position)return this.get(this.position-1)},peekRedo:function(){if(0<this._historyStack.length&&this.position<this._historyStack.length)return this.get(this.position)},get:function(d){return this._historyStack[d]},remove:function(d){0<this._historyStack.length&&(this._historyStack.splice(d,1),0<this.position&&d<this.position&&this.position--,this._checkAvailability())},destroy:function(){this._historyStack=null}});return p.UndoManager=m})},"esri/OperationBase":function(){define(["dojo/_base/declare",
"dojo/has","./kernel"],function(m,n,v){m=m(null,{declaredClass:"esri.OperationBase",type:"not implemented",label:"not implemented",constructor:function(b){b=b||{};b.label&&(this.label=b.label)},performUndo:function(){},performRedo:function(){}});return v.OperationBase=m})},"esri/toolbars/edit":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/has dojo/dom-construct dojo/dom-style ../kernel ../lang ../sniff ./_toolbar ./_Box ./_GraphicMover ./_VertexEditor ./TextEditor ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../graphic".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x,t,w,z){var B=n(g,{declaredClass:"esri.toolbars.Edit",constructor:function(A,y){this._map=A;this._tool=0;if(this._map.loaded)this._scratchGL=A.graphics;else var E=b.connect(this._map,"onLoad",this,function(){b.disconnect(E);E=null;this._scratchGL=this._map.graphics});var G=d("esri-mobile");this._defaultOptions=v.mixin({vertexSymbol:new x(x.STYLE_CIRCLE,G?20:12,new t(t.STYLE_SOLID,new f([0,0,0,.5]),1),new f([128,128,128])),ghostVertexSymbol:new x(x.STYLE_CIRCLE,
G?18:10,new t(t.STYLE_SOLID,new f([0,0,0,.5]),1),new f([255,255,255,.75])),ghostLineSymbol:new t(t.STYLE_DOT,new f([128,128,128]),2),allowDeleteVertices:!0,allowAddVertices:!0,rotateHandleOffset:G?24:16,boxLineSymbol:new t(t.STYLE_DASH,new f([64,64,64]),1),boxHandleSymbol:new x(x.STYLE_SQUARE,G?16:9,new t(t.STYLE_SOLID,new f([0,0,0,.5]),1),new f([255,255,255,.75])),textAnchorSymbol:new x(x.STYLE_CIRCLE,10,null,new f([255,0,0]))},y||{})},activate:function(A,y,E){this.deactivate();this._graphic=y;this._options=
v.mixin(v.mixin({},this._defaultOptions),E||{});var G=B.MOVE;E=B.EDIT_VERTICES;var F=B.SCALE,D=B.ROTATE,L=B.EDIT_TEXT,O=!1,S=!1,Z=!1,I=this._map,N=I.spatialReference,K=y.geometry.spatialReference;this._geo=!(!N||!K||N.equals(K)||!N.isWebMercator()||4326!==K.wkid);this._isTextPoint=this._prepareTextSymbolEditing(y,A);(A&G)===G&&(O=this._enableMove(y));G=(A&F)===F;D=(A&D)===D;if(G||D)Z=this._enableBoxEditing(y,G,D);(A&E)===E&&(S=this._enableVertexEditing(y));(A&L)===L&&this._enableTextEditing(y);if(!(O||
S||Z))throw Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");if(this._tool=A)this._mapPanEndHandle=b.connect(I,"onPanEnd",this,this._mapPanEndHandler),this._mapExtChgHandle=b.connect(I,"onExtentChange",this,this._mapExtentChangeHandler),this.onActivate(this._tool,y);I.snappingManager&&(O||S)&&I.snappingManager._startSelectionLayerQuery()},deactivate:function(){this._isTextPoint=null;var A=this._tool,y=this._graphic;if(A){var E=
!!this._modified;this._clear();b.disconnect(this._mapPanEndHandle);b.disconnect(this._mapExtChgHandle);this._graphic=this._geo=this._mapPanEndHandle=this._mapExtChgHandle=null;this.onDeactivate(A,y,{isModified:E});this._map.snappingManager&&this._map.snappingManager._stopSelectionLayerQuery()}},refresh:function(){this._refreshMoveables(!0)},getCurrentState:function(){return{tool:this._tool,graphic:this._graphic,isModified:!!this._modified}},onActivate:function(A,y){},onDeactivate:function(A,y,E){},
onGraphicMoveStart:function(A){},onGraphicFirstMove:function(A){this._modified=!0},onGraphicMove:function(A,y){},onGraphicMoveStop:function(A,y){},onGraphicClick:function(A,y){},onVertexMoveStart:function(A,y){},onVertexFirstMove:function(A,y){this._modified=!0},onVertexMove:function(A,y,E){},onVertexMoveStop:function(A,y,E){},onVertexAdd:function(A,y){this._modified=!0},onVertexClick:function(A,y){},onVertexMouseOver:function(A,y){},onVertexMouseOut:function(A,y){},onVertexDelete:function(A,y){this._modified=
!0},onTextEditStart:function(A,y){},onTextEditEnd:function(A){},onScaleStart:function(A){},onScaleFirstMove:function(A){this._modified=!0},onScale:function(A,y){},onScaleStop:function(A,y){},onRotateStart:function(A){},onRotateFirstMove:function(A){this._modified=!0},onRotate:function(A,y){},onRotateStop:function(A,y){},_eventMap:{activate:["tool","graphic"],deactivate:["tool","graphic","info"],"graphic-move-start":["graphic"],"graphic-first-move":["graphic"],"graphic-move":["graphic","transform"],
"graphic-move-stop":["graphic","transform"],"graphic-click":["graphic","info"],"vertex-move-start":["graphic","vertexinfo"],"vertex-first-move":["graphic","vertexinfo"],"vertex-move":["graphic","vertexinfo","transform"],"vertex-move-stop":["graphic","vertexinfo","transform"],"vertex-add":["graphic","vertexinfo"],"vertex-click":["graphic","vertexinfo"],"vertex-mouse-over":["graphic","vertexinfo"],"vertex-mouse-out":["graphic","vertexinfo"],"vertex-delete":["graphic","vertexinfo"],"scale-start":["graphic"],
"scale-first-move":["graphic"],scale:["graphic","info"],"scale-stop":["graphic","info"],"rotate-start":["graphic"],"rotate-first-move":["graphic"],rotate:["graphic","info"],"rotate-stop":["graphic","info"]},_prepareTextSymbolEditing:function(A,y){if("point"===A.geometry.type||"multipoint"===A.geometry.type){var E=A.getLayer(),G=E.renderer;E=A.symbol||E._getSymbol(A);!E&&(G.hasVisualVariables("sizeInfo",!1)||G.hasVisualVariables("colorInfo",!1)||G.hasVisualVariables("opacityInfo",!1))&&G.addBreak&&
G.infos&&1===G.infos.length&&(E=G.infos[0].symbol||G.defaultSymbol);if(E&&"textsymbol"===E.type){if((y&B.SCALE)===B.SCALE||(y&B.ROTATE)===B.ROTATE||(y&B.EDIT_TEXT)===B.EDIT_TEXT){A.setSymbol(new w(E.toJson()));var F=this;this._textSymbolEditor?(this._textSymbolEditor.createForm(A),this._textSymbolEditor.show()):this._options&&this._options.textSymbolEditor?(this._textSymbolEditor=this._options.textSymbolEditor,this._textSymbolEditor.on("symbol-change",function(){F._boxEditor&&F._boxEditor.refresh()})):
m(["../dijit/SymbolEditor"],function(D){if(!F._textSymbolEditor){var L=F._options.textSymbolEditorHolder?a.create("div",null,F._options.textSymbolEditorHolder):a.create("div",null,F._map.root);F._textSymbolEditor=new D({graphic:A},L);D=F._textSymbolEditor.domNode.parentNode.id;c.set(F._textSymbolEditor.domNode,{position:"map_root"===D?"absolute":"relative",left:"map_root"===D?F._map.width/2-100+"px":"5px",top:"20px","z-index":50});F._textSymbolEditor.startup();F._textSymbolEditor.createForm(A);F._textSymbolEditor.show();
F._textSymbolEditor.on("symbol-change",function(){F._boxEditor&&F._boxEditor.refresh()})}})}if((y&B.MOVE)===B.MOVE||(y&B.ROTATE)===B.ROTATE||(y&B.SCALE)===B.SCALE)this._textAnchor=new z(A.geometry,this._options.textAnchorSymbol),this._scratchGL.add(this._textAnchor);return!0}}return!1},_enableMove:function(A){var y=this._map;switch(A.geometry.type){case "point":case "polyline":case "polygon":return this._graphicMover=new q(A,y,this,this._textAnchor),!0}return!1},_enableVertexEditing:function(A){var y=
this._map;switch(A.geometry.type){case "multipoint":case "polyline":case "polygon":return this._vertexEditor=u.create(A,y,this),!0}return!1},_enableBoxEditing:function(A,y,E){var G=this._map,F=A.geometry.type;return"polyline"===F||"polygon"===F||this._isTextPoint?(this._boxEditor=new e(A,G,this,y,E,this._options.uniformScaling,this._isTextPoint),!0):!1},_enableTextEditing:function(A){return this._isTextPoint?(this._textEditor=new r(A,this._map,this),b.connect(this._textEditor,"onEditStart",v.hitch(this,
function(){this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._map.disableKeyboardNavigation();this._disableMove();this._disableBoxEditing()})),!0):!1},_disableMove:function(){var A=this._graphicMover;A&&(A.destroy(),this._graphicMover=null)},_disableVertexEditing:function(){var A=this._vertexEditor;A&&(A.destroy(),this._vertexEditor=null)},_disableBoxEditing:function(){var A=this._boxEditor;A&&(A.destroy(),this._boxEditor=null)},_disableTextEditing:function(){this._textEditor&&
(this._textEditor.destroy(),this._textEditor=null);this._map.enableKeyboardNavigation()},_disableSymbolEditing:function(){this._textSymbolEditor&&this._textSymbolEditor.hide()},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._disableTextEditing();this._disableSymbolEditing();this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._tool=0;this._modified=!1},_mapPanEndHandler:function(){this._refreshMoveables()},
_mapExtentChangeHandler:function(A,y,E){E&&this._refreshMoveables()},_refreshMoveables:function(A){var y=p.filter([this._graphicMover,this._vertexEditor,this._boxEditor],l.isDefined);p.forEach(y,function(E){E.refresh(A)})},_beginOperation:function(A){p.forEach(this._getAffectedTools(A),function(y){y.suspend()})},_endOperation:function(A){p.forEach(this._getAffectedTools(A),function(y){y.resume()})},_getAffectedTools:function(A){var y=[];switch(A){case "MOVE":y=[this._vertexEditor,this._boxEditor];
break;case "VERTICES":y=[this._boxEditor];break;case "BOX":y=[this._vertexEditor]}return y=p.filter(y,l.isDefined)}});v.mixin(B,{MOVE:1,EDIT_VERTICES:2,SCALE:4,ROTATE:8,EDIT_TEXT:16});v.setObject("toolbars.Edit",B,h);return B})},"esri/toolbars/_Box":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../lang ../geometry/Point ../geometry/Polyline ../symbols/SimpleMarkerSymbol ../geometry/webMercatorUtils ../geometry/jsonUtils ../graphic".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r){m=m(null,{declaredClass:"esri.toolbars._Box",constructor:function(x,t,w,z,B,A,y){this._graphic=x;this._map=t;this._toolbar=w;this._scale=z;this._rotate=B;this._defaultEventArgs={};this._scaleEvent="Scale";this._rotateEvent="Rotate";this._uniformScaling=A;x=w._options;this._markerSymbol=x.boxHandleSymbol;this._lineSymbol=x.boxLineSymbol;this._moveStartHandler=n.hitch(this,this._moveStartHandler);this._firstMoveHandler=n.hitch(this,this._firstMoveHandler);
this._moveStopHandler=n.hitch(this,this._moveStopHandler);this._moveHandler=n.hitch(this,this._moveHandler);this._isTextPoint=y;this._init()},destroy:function(){this._cleanUp();this._graphic=this._map=this._toolbar=this._markerSymbol=this._lineSymbol=null},refresh:function(){this._draw()},suspend:function(){v.forEach(this._getAllGraphics(),function(x){x.hide()})},resume:function(){v.forEach(this._getAllGraphics(),function(x){x.show()});this._draw()},_init:function(){this._draw()},_cleanUp:function(){this._connects&&
v.forEach(this._connects,b.disconnect);var x=this._toolbar._scratchGL;this._anchors&&v.forEach(this._anchors,function(t){x.remove(t.graphic);(t=t.moveable)&&t.destroy()});this._box&&x.remove(this._box);this._box=this._anchors=this._connects=null},_draw:function(){if(this._graphic.getDojoShape()){var x=this._map,t=this._toolbar._scratchGL,w=this._getBoxCoords(),z=new g(x.spatialReference),B=n.clone(v.filter(w,function(A,y){return 8!==y&&0===y%2}));B[0]&&B.push([B[0][0],B[0][1]]);z.addPath(B);this._rotate&&
z.addPath([w[1],w[8]]);this._box?this._box.setGeometry(z):(this._box=new r(z,this._lineSymbol),t.add(this._box));this._anchors?v.forEach(this._anchors,function(A,y){this._scale||(y=8);var E=new k(w[y],x.spatialReference);A.graphic.setGeometry(E);E=A.moveable;var G=A.graphic.getDojoShape();G&&(E?G!==E.shape&&(E.destroy(),A.moveable=this._getMoveable(A.graphic,y)):A.moveable=this._getMoveable(A.graphic,y))},this):(this._anchors=[],this._connects=[],v.forEach(w,function(A,y){if(this._scale||!(8>y)){A=
new k(A,x.spatialReference);var E=new r(A,this._markerSymbol);this._isTextPoint&&1===y%2&&E.hide();t.add(E);this._anchors.push({graphic:E,moveable:this._getMoveable(E,y)})}},this))}else this._cleanUp()},_getBoxCoords:function(x){var t=this._map,w=[],z,B,A;if(this._isTextPoint){var y=this._graphic.getNode().getBoundingClientRect();var E=t.__container.getBoundingClientRect();y=[{x:y.left-E.left,y:y.top-E.top},{x:y.right-E.left,y:y.top-E.top},{x:y.right-E.left,y:y.bottom-E.top},{x:y.left-E.left,y:y.bottom-
E.top}]}else y=this._getTransformedBoundingBox(this._graphic);v.forEach(y,function(G,F,D){z=G;(B=D[F+1])||(B=D[0]);A={x:(z.x+B.x)/2,y:(z.y+B.y)/2};x||(z=t.toMap(z),A=t.toMap(A));w.push([z.x,z.y]);w.push([A.x,A.y])});this._rotate&&(y=n.clone(w[1]),y=x?{x:y[0],y:y[1]}:t.toScreen({x:y[0],y:y[1],spatialReference:t.spatialReference}),y.y-=this._toolbar._options.rotateHandleOffset,x||(y=t.toMap(y)),w.push([y.x,y.y]));return w},_getTransformedBoundingBox:function(x){var t=this._map,w=x.geometry.getExtent(),
z=x.geometry.spatialReference;x=new k(w.xmin,w.ymax,z);w=new k(w.xmax,w.ymin,z);x=t.toScreen(x);w=t.toScreen(w);return[{x:x.x,y:x.y},{x:w.x,y:x.y},{x:w.x,y:w.y},{x:x.x,y:w.y}]},_getAllGraphics:function(){var x=[this._box];this._anchors&&v.forEach(this._anchors,function(t){x.push(t.graphic)});return x=v.filter(x,l.isDefined)},_getMoveable:function(x,t){var w=x.getDojoShape();if(w){var z=new a(w);z._index=t;this._connects.push(b.connect(z,"onMoveStart",this._moveStartHandler));this._connects.push(b.connect(z,
"onFirstMove",this._firstMoveHandler));this._connects.push(b.connect(z,"onMoveStop",this._moveStopHandler));z.onMove=this._moveHandler;(w=w.getEventSource())&&d.set(w,"cursor",this._toolbar._cursors["box"+t]);return z}},_moveStartHandler:function(x){this._toolbar["on"+(8===x.host._index?this._rotateEvent:this._scaleEvent)+"Start"](this._graphic)},_firstMoveHandler:function(x){this._toolbar._deactivateScrollWheel();var t=x.host._index,w=this._wrapOffset=x.host.shape._wrapOffsets[0]||0,z=this._graphic.getLayer().getNavigationTransform();
x=v.map(this._getBoxCoords(!0),function(A){return{x:A[0]+w,y:A[1]}});var B=this._isTextPoint?this._map.toScreen(this._graphic.geometry):{x:x[1].x,y:x[3].y};this._centerCoord=c.multiplyPoint(c.invert(z),B);if(8===t)B=c.multiplyPoint(c.invert(z),x[1]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,B)),this._startLine=[this._centerCoord,B],this._moveLine=n.clone(this._startLine);else if(B=c.multiplyPoint(c.invert(z),x[t]),z=c.multiplyPoint(c.invert(z),x[(t+4)%8]),this._isTextPoint&&
(this._centerCoord=this._deNormalizePoint(this._centerCoord,B)),this._firstMoverToAnchor=Math.sqrt((B.x-this._centerCoord.x)*(B.x-this._centerCoord.x)+(B.y-this._centerCoord.y)*(B.y-this._centerCoord.y)),this._startBox=z,this._startBox.width=x[4].x-x[0].x,this._startBox.height=x[4].y-x[0].y,this._moveBox=n.clone(this._startBox),this._xfactor=B.x>z.x?1:-1,this._yfactor=B.y>z.y?1:-1,1===t||5===t)this._xfactor=0;else if(3===t||7===t)this._yfactor=0;this._toolbar._beginOperation("BOX");this._toolbar["on"+
(8===t?this._rotateEvent:this._scaleEvent)+"FirstMove"](this._graphic)},_moveHandler:function(x,t){var w=x.host._index,z=this._defaultEventArgs,B;z.angle=0;z.scaleX=1;z.scaleY=1;if(8===w){var A=this._startLine;var y=this._moveLine;var E=y[1];E.x+=t.dx;E.y+=t.dy;E=this._getAngle(A,y);this._isTextPoint&&(E+=this._graphic.symbol.angle);y=c.rotategAt(E,A[0]);this._graphic.getDojoShape().setTransform(y);z.transform=y;z.angle=E;z.around=A[0]}else{A=this._startBox;y=this._moveBox;y.width+=t.dx*this._xfactor;
y.height+=t.dy*this._yfactor;this._uniformScaling||this._isTextPoint?(A=y.x+this._xfactor*y.width,y=y.y+this._yfactor*y.height,A=Math.sqrt((A-this._centerCoord.x)*(A-this._centerCoord.x)+(y-this._centerCoord.y)*(y-this._centerCoord.y)),this._scaleRatio=E=B=A/this._firstMoverToAnchor,A=this._centerCoord):(E=y.width/A.width,B=y.height/A.height,A={x:A.x,y:A.y});if(isNaN(E)||Infinity===E||-Infinity===E)E=1;if(isNaN(B)||Infinity===B||-Infinity===B)B=1;y=c.scaleAt(E,B,A);if(this._isTextPoint){var G=c.rotategAt(this._graphic.symbol.angle,
A);this._graphic.getDojoShape().setTransform([G,y])}else this._graphic.getDojoShape().setTransform(y);z.transform=y;z.scaleX=E;z.scaleY=B;z.around=A}this._toolbar["on"+(8===w?this._rotateEvent:this._scaleEvent)](this._graphic,z)},_moveStopHandler:function(x){this._toolbar._activateScrollWheel();var t=this._graphic,w=this._toolbar,z=w._geo?q.geographicToWebMercator(t.geometry):t.geometry,B=z.spatialReference,A=t.getDojoShape(),y=A.getTransform(),E=t.getLayer().getNavigationTransform();this._isTextPoint?
(t=this._graphic.symbol,8===x.host._index?t.angle+=this._getAngle(this._startLine,this._moveLine):t.font.setSize(Math.round(t.font.size*this._scaleRatio*100)/100),this._graphic.setSymbol(t)):(z=z.toJson(),this._updateSegments(z.paths||z.rings,y,E,B),A.setTransform(null),z=u.fromJson(z),t.setGeometry(w._geo?q.webMercatorToGeographic(z,!0):z));this._draw();this._startLine=this._moveLine=this._startBox=this._moveBox=this._xfactor=this._yfactor=null;w._endOperation("BOX");this._defaultEventArgs.transform=
y;w["on"+(8===x.host._index?this._rotateEvent:this._scaleEvent)+"Stop"](this._graphic,this._defaultEventArgs)},_updateSegments:function(x,t,w,z){var B=this._map,A=this._wrapOffset||0;v.forEach(x,function(y){v.forEach(y,function(E){this._updatePoint(E,z,A,c,B,w,t)},this)},this)},_updatePoint:function(x,t,w,z,B,A,y){t=B.toScreen({x:x[0],y:x[1],spatialReference:t},!0);t.x+=w;t=z.multiplyPoint([A,y,z.invert(A)],t);t.x-=w;w=B.toMap(t);x[0]=w.x;x[1]=w.y},_getAngle:function(x,t){return 180*Math.atan2(t[0].y-
t[1].y,t[0].x-t[1].x)/Math.PI-180*Math.atan2(x[0].y-x[1].y,x[0].x-x[1].x)/Math.PI},_deNormalizePoint:function(x,t){var w=this._map._getFrameWidth();if(-1===w)return x;for(var z={x:x.x,y:x.y};Math.abs(z.x-t.x)>=w;)z.x=z.x<t.x?z.x+w:z.x-w;var B=Math.abs(z.x-t.x);Math.abs(z.x-t.x+w)<B?z.x+=w:Math.abs(z.x-t.x-w)<B&&(z.x-=w);return z}});n.setObject("toolbars._Box",m,h);return m})},"dojox/gfx/Moveable":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/_base/event dojo/topic dojo/touch dojo/dom-class dojo/_base/window ./Mover dojo/mouse".split(" "),
function(m,n,v,b,p,f,d,a,c,h){return n("dojox.gfx.Moveable",null,{constructor:function(l,k){this.shape=l;this.delay=k&&0<k.delay?k.delay:0;this.mover=k&&k.mover?k.mover:c;this.leftButtonOnly=k&&k.leftButtonOnly;this.events=[this.shape.on(f.press,m.hitch(this,"onMouseDown"))]},destroy:function(){v.forEach(this.events,function(l){l.remove()});this.events=this.shape=null},onMouseDown:function(l){this.delay?(this.events.push(this.shape.on(f.move,m.hitch(this,"onMouseMove")),this.shape.on(f.release,m.hitch(this,
"onMouseUp"))),this._lastX=l.clientX,this._lastY=l.clientY):this.leftButtonOnly&&!h.isLeft(l)||new this.mover(this.shape,l,this);b.stop(l)},onMouseMove:function(l){var k=l.clientY;if(Math.abs(l.clientX-this._lastX)>this.delay||Math.abs(k-this._lastY)>this.delay)this.onMouseUp(l),new this.mover(this.shape,l,this);b.stop(l)},onMouseUp:function(l){this.events.pop().remove()},onMoveStart:function(l){p.publish("/gfx/move/start",l);d.add(a.body(),"dojoMove")},onMoveStop:function(l){p.publish("/gfx/move/stop",
l);d.remove(a.body(),"dojoMove")},onFirstMove:function(l){},onMove:function(l,k,g){this.onMoving(l,k,g);this.shape.applyLeftTransform(k);this.onMoved(l,k)},onMoving:function(l,k){},onMoved:function(l,k){}})})},"dojox/gfx/Mover":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/on dojo/touch dojo/_base/event".split(" "),function(m,n,v,b,p,f){return v("dojox.gfx.Mover",null,{constructor:function(d,a,c){this.shape=d;this.lastX=a.clientX;this.lastY=a.clientY;d=this.host=c;a=
document;c=b(a,p.move,m.hitch(this,"onFirstMove"));this.events=[b(a,p.move,m.hitch(this,"onMouseMove")),b(a,p.release,m.hitch(this,"destroy")),b(a,"dragstart",m.hitch(f,"stop")),b(a,"selectstart",m.hitch(f,"stop")),c];if(d&&d.onMoveStart)d.onMoveStart(this)},onMouseMove:function(d){var a=d.clientX,c=d.clientY;this.host.onMove(this,{dx:a-this.lastX,dy:c-this.lastY},d);this.lastX=a;this.lastY=c;f.stop(d)},onFirstMove:function(){this.host.onFirstMove(this);this.events.pop().remove()},destroy:function(){n.forEach(this.events,
function(a){a.remove()});var d=this.host;if(d&&d.onMoveStop)d.onMoveStop(this);this.events=this.shape=null}})})},"esri/toolbars/_GraphicMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),function(m,n,v,b,p,f,d,a,c,h,l,k,g,e){var q=m(null,{declaredClass:"esri.toolbars._GraphicMover",
constructor:function(u,r,x,t){this.graphic=u;this.map=r;this.toolbar=x;this.tempPt=t;this._enableGraphicMover();this._moved=!1},refresh:function(u){var r=this.graphic.getDojoShape();!r||!u&&r._hostGraphic||(this._disableGraphicMover(),this._enableGraphicMover())},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var u=this.graphic,r=u.getDojoShape();r&&(r._hostGraphic=u,this._moveable=new f(r,{mover:q.Mover}),this._moveStartHandle=
v.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=v.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler),this._movingHandle=v.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=v.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(u=r.getEventSource())&&p.set(u,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var u=this._moveable;if(u){v.disconnect(this._moveStartHandle);v.disconnect(this._firstMoveHandle);
v.disconnect(this._movingHandle);v.disconnect(this._moveStopHandle);var r=u.shape;r&&(r._hostGraphic=null,(r=r.getEventSource())&&p.set(r,"cursor","inherit"));u.destroy()}this._moveable=null},_moveStartHandler:function(){var u=this.graphic,r=this.map;this._startTx=u.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&r.snappingManager&&r.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(u)},_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},
_movingHandler:function(u,r,x){u=u.shape.getTransform();r=this.map;var t;l("esri-pointer")?t=r.navigationManager.pointerEvents._processTouchEvent(x,x):x&&"pointermove"===x.type&&(t=h.prototype._processTouchEvent.call({map:r},x,x));t&&r.snappingManager&&r.snappingManager._onSnappingMouseMoveHandler(t);this.tempPt&&this.tempPt.getDojoShape().setTransform(u);this.toolbar.onGraphicMove(this.graphic,u)},_moveStopHandler:function(u){var r=this.graphic,x=this.toolbar,t=this.map,w=x._geo?k.geographicToWebMercator(r.geometry):
r.geometry,z=w.type,B=r.getDojoShape(),A=B.getTransform();if(b.toJson(A)!==b.toJson(this._startTx)){this._moved=!0;switch(z){case "point":z=[A,a.invert(this._startTx)];if(t.snappingManager)var y=t.snappingManager._snappingPoint;w=y||t.toMap(a.multiplyPoint(z,t.toScreen(w,!0)));t.snappingManager&&t.snappingManager._killOffSnapping();break;case "polyline":w=this._updatePolyGeometry(w,w.paths,A);break;case "polygon":w=this._updatePolyGeometry(w,w.rings,A)}B.setTransform(null);r.setGeometry(x._geo?k.webMercatorToGeographic(w,
!0):w);this.tempPt&&this.tempPt.setGeometry(new e(r.geometry.toJson()))}else this._moved=!1;x._endOperation("MOVE");x.onGraphicMoveStop(r,A);this._moved||(u=u.__e,t=this.map.position,u=new g(u.pageX-t.x,u.pageY-t.y),x.onGraphicClick(r,{screenPoint:u,mapPoint:this.map.toMap(u)}))},_updatePolyGeometry:function(u,r,x){var t=this.map,w=u.getPoint(0,0);t=t.toMap(t.toScreen(w).offset(x.dx,x.dy));x=t.x-w.x;w=t.y-w.y;var z;for(t=0;t<r.length;t++){var B=r[t];for(z=0;z<B.length;z++){var A=u.getPoint(t,z);u.setPoint(t,
z,A.offset(x,w))}}return u}});q.Mover=m(d,{declaredClass:"esri.toolbars._Mover",constructor:function(u,r,x){this.__e=r}});n.setObject("toolbars._GraphicMover",q,c);n.setObject("toolbars._Mover",q.Mover,c);return q})},"esri/toolbars/_VertexEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dijit/Menu dijit/MenuItem ../kernel ./_VertexMover ../geometry/Point ../geometry/jsonUtils dojo/i18n!../nls/jsapi".split(" "),function(m,n,v,b,p,f,d,a,c,h,
l,k){var g=m(null,{declaredClass:"esri.toolbars._GraphicVertexEditor",constructor:function(e,q,u){this.graphic=e;this.map=q;this.toolbar=u;e=u._options;this._symbol1=e.vertexSymbol;this._symbol2=e.ghostVertexSymbol;q=e.ghostLineSymbol;this._lineStroke={style:q.style,width:q.width,color:q.color};this._canDel=e.allowDeleteVertices;this._canAdd=e.allowAddVertices;this._addControllers()},destroy:function(){this._removeControllers()},refresh:function(e){e?(this._removeControllers(),this._addControllers()):
(this._refresh(this._vertexMovers),this._refresh(this._mpVertexMovers))},suspend:function(){this._suspended||this._removeControllers();this._suspended=!0},resume:function(){this._suspended&&this._addControllers();this._suspended=!1},_addControllers:function(){this._firstMoveHandle=v.connect(c,"onFirstMove",this,this._firstMoveHandler);this._moveStopHandle=v.connect(c,"onMoveStop",this,this._moveStopHandler);this._vertexMovers=this._add(this._getSegments(this.graphic.geometry),this._symbol1);this._canAdd&&
(this._mpVertexMovers=this._add(this._getMidpointSegments(this.graphic.geometry),this._symbol2,!0));var e=this._getGraphicsLayer();this._mouseOverHandle=v.connect(e,"onMouseOver",this,this._mouseOverHandler);this._mouseOutHandle=v.connect(e,"onMouseOut",this,this._mouseOutHandler);this._canDel&&(this._ctxMenu=new f({style:"font-size: 12px; margin-left: 5px; margin-top: 5px;"}),e=this._ctxDelete=new d({label:k.toolbars.edit.deleteLabel,iconClass:"vertexDeleteIcon",style:"outline: none;"}),this._deleteHandle=
v.connect(e,"onClick",this,this._deleteHandler),this._ctxMenu.addChild(e),this._ctxMenu.startup())},_removeControllers:function(){v.disconnect(this._firstMoveHandle);v.disconnect(this._moveStopHandle);v.disconnect(this._mouseOverHandle);v.disconnect(this._mouseOutHandle);v.disconnect(this._deleteHandle);this._ctxMenu&&(this._ctxDelete=null,this._unbindCtxNode(),this._ctxMenu.destroyRecursive());this._remove(this._vertexMovers);this._remove(this._mpVertexMovers);this._vertexMovers=this._mpVertexMovers=
null},_add:function(e,q,u){var r,x,t=this.graphic,w=[];for(r=0;r<e.length;r++){var z=e[r],B=[];for(x=0;x<z.length;x++)B.push(new c(z[x],q,t,r,x,z.length,this,u));w.push(B)}return w},_remove:function(e){e&&b.forEach(e,function(q){b.forEach(q,function(u){u.destroy()})})},_refresh:function(e){e&&b.forEach(e,function(q){b.forEach(q,function(u){u.refresh()})})},_isNew:function(e){return-1===b.indexOf(this._vertexMovers[e.segIndex],e)?!0:!1},_getGraphicsLayer:function(){return this.toolbar._scratchGL},
_deleteHandler:function(e){e=this._selectedMover;this._updateRelatedGraphic(e,e.relatedGraphic,e.graphic.geometry,e.segIndex,e.ptIndex,e.segLength,!1,!0);this._canAdd&&this._deleteMidpoints(e);this._deleteVertex(e);this.toolbar._endOperation("VERTICES")},_mouseOverHandler:function(e){e=e.graphic;var q=this._findMover(e);q&&(this.toolbar.onVertexMouseOver(this.graphic,q._getInfo()),q._placeholder||(this._selectedMover=q,this._canDel&&this._bindCtxNode(e.getDojoShape().getNode())))},_mouseOutHandler:function(e){if(e=
this._findMover(e.graphic))this.toolbar.onVertexMouseOut(this.graphic,e._getInfo())},_bindCtxNode:function(e){this._unbindCtxNode();this._ctxDelete.set("disabled",this._selectedMover.segLength<=this.minLength?!0:!1);this._ctxMenu.bindDomNode(e);this._bindNode=e},_unbindCtxNode:function(){var e=this._bindNode;e&&this._ctxMenu.unBindDomNode(e)},_findMover:function(e){var q=[];var u=this._mpVertexMovers;b.forEach(this._vertexMovers,function(x){q=q.concat(x)});u&&b.forEach(u,function(x){q=q.concat(x)});
for(u=0;u<q.length;u++){var r=q[u];if(r.graphic===e)return r}},_firstMoveHandler:function(e){!this._isNew(e)&&this._canAdd&&this._hideRelatedMidpoints(e);this.toolbar._beginOperation("VERTICES")},_moveStopHandler:function(e,q){var u=this._isNew(e);q&&(q.dx||q.dy)?(this._updateRelatedGraphic(e,e.relatedGraphic,e.graphic.geometry,e.segIndex,e.ptIndex,e.segLength,u),this._canAdd&&(u?this._addMidpoints(e):(this._repositionRelatedMidpoints(e),this._showRelatedMidpoints(e))),this.toolbar._endOperation("VERTICES")):
!u&&this._canAdd&&this._showRelatedMidpoints(e)},_showRelatedMidpoints:function(e){var q=this._getAdjacentMidpoints(e.ptIndex,e.segLength),u=this._mpVertexMovers[e.segIndex];for(e=0;e<q.length;e++){var r=u[q[e]];r.graphic.show();r.refresh()}},_hideRelatedMidpoints:function(e){var q=this._getAdjacentMidpoints(e.ptIndex,e.segLength),u=this._mpVertexMovers[e.segIndex];for(e=0;e<q.length;e++)u[q[e]].graphic.hide()},_repositionRelatedMidpoints:function(e){var q,u=this._getAdjacentMidpoints(e.ptIndex,e.segLength),
r=this._mpVertexMovers[e.segIndex];for(q=0;q<u.length;q++){var x=this._getAdjacentVertices(u[q],e.segLength),t=e.relatedGraphic.geometry.getPoint(e.segIndex,x[0]);x=e.relatedGraphic.geometry.getPoint(e.segIndex,x[1]);t=new h({x:(t.x+x.x)/2,y:(t.y+x.y)/2,spatialReference:t.spatialReference.toJson()});r[u[q]].graphic.setGeometry(t)}},_addMidpoints:function(e){var q=e.segIndex,u=e.ptIndex,r=e.segLength,x=u+1,t,w=r+1;this._mpVertexMovers[q].splice(u,1);var z=this._vertexMovers[q];for(t=0;t<x;t++)z[t].segLength+=
1;for(t=x;t<z.length;t++)z[t].ptIndex+=1,z[t].segLength+=1;e.ptIndex=x;e.segLength=z.length+1;z.splice(x,0,e);e.graphic.setSymbol(this._symbol1);z=this._mpVertexMovers[q];for(t=0;t<u;t++)z[t].segLength+=1;for(t=u;t<r-1;t++)z[t].ptIndex+=1,z[t].segLength+=1;x=this._getAdjacentVertices(u,w);q=this._getAdjacentVertices(u+1,w);r=e.relatedGraphic.geometry.getPoint(e.segIndex,x[0]);t=e.relatedGraphic.geometry.getPoint(e.segIndex,x[1]);x=new h({x:(r.x+t.x)/2,y:(r.y+t.y)/2,spatialReference:r.spatialReference.toJson()});
r=e.relatedGraphic.geometry.getPoint(e.segIndex,q[0]);t=e.relatedGraphic.geometry.getPoint(e.segIndex,q[1]);q=new h({x:(r.x+t.x)/2,y:(r.y+t.y)/2,spatialReference:r.spatialReference.toJson()});r=new c(x,this._symbol2,this.graphic,e.segIndex,u,w,this,!0);e=new c(q,this._symbol2,this.graphic,e.segIndex,u+1,w,this,!0);z.splice(u,0,r,e)},_deleteVertex:function(e){var q,u=e.ptIndex,r=this._vertexMovers[e.segIndex];for(q=0;q<u;q++)--r[q].segLength;for(q=u+1;q<r.length;q++){var x=r[q];--x.ptIndex;--x.segLength}r.splice(u,
1);q=e._getInfo();e.destroy();this.toolbar.onVertexDelete(this.graphic,q)}});n.mixin(g,{create:function(e,q,u){switch(e.geometry.type){case "multipoint":return new g.MultipointVertexEditor(e,q,u);case "polyline":return new g.PolylineVertexEditor(e,q,u);case "polygon":return new g.PolygonVertexEditor(e,q,u)}}});g.MultipointVertexEditor=m(g,{declaredClass:"esri.toolbars._MultipointVertexEditor",minLength:1,constructor:function(){this._moveStartHandle=v.connect(c,"onMoveStart",this,this._moveStartHandler);
v.disconnect(this._firstMoveHandle)},destroy:function(){this.inherited(arguments);v.disconnect(this._moveStartHandle)},_getSegments:function(e){var q=e.points,u=[],r=e.spatialReference;for(e=0;e<q.length;e++){var x=q[e];u.push(new h({x:x[0],y:x[1],spatialReference:r.toJson()}))}return[u]},_getMidpointSegments:function(e){return[]},_getControlPoints:function(e,q,u,r,x){return[]},_getGraphicsLayer:function(){return this.graphic._graphicsLayer},_mouseOverHandler:function(e){var q=e.graphic;if(e=this._findMover(e))this.toolbar.onVertexMouseOver(q,
e._getInfo()),this._selectedMover=e,this._canDel&&this._bindCtxNode(e.graphic.getDojoShape().getNode())},_mouseOutHandler:function(e){var q=e.graphic;if(e=this._findMover(e))this.toolbar.onVertexMouseOut(q,e._getInfo())},_findMover:function(e){var q=[].concat(this._vertexMovers[0]),u=e.target;for(e=0;e<q.length;e++){var r=q[e];if(r.graphic.getDojoShape().getNode()===u)return r}},_moveStartHandler:function(e){var q=e.ptIndex,u=e.segLength-1,r=e.relatedGraphic.geometry.points;e=r.splice(q,1);r.push(e[0]);
r=this._vertexMovers[0];for(e=u;e>q;e--)--r[e].ptIndex;e=r.splice(q,1);r.push(e[0]);e[0].ptIndex=u},_moveStopHandler:function(e){this._updateRelatedGraphic(e,e.relatedGraphic,e.graphic.geometry,e.segIndex,e.ptIndex,e.segLength);this.toolbar._endOperation("VERTICES")},_updateRelatedGraphic:function(e,q,u,r,x,t,w,z){e=q.geometry;z?e.removePoint(x):e.setPoint(x,u);q.setGeometry(e)},_deleteMidpoints:function(e){}});g.PolylineVertexEditor=m(g,{declaredClass:"esri.toolbars._PolylineVertexEditor",minLength:2,
_getSegments:function(e){var q,u,r=e.paths,x=[];for(q=0;q<r.length;q++){var t=r[q],w=[];for(u=0;u<t.length;u++)w.push(e.getPoint(q,u));x.push(w)}return x},_getMidpointSegments:function(e){var q,u,r=e.paths,x=[],t=e.spatialReference;for(q=0;q<r.length;q++){var w=r[q],z=[];for(u=0;u<w.length-1;u++){var B=e.getPoint(q,u),A=e.getPoint(q,u+1);B=new h({x:(B.x+A.x)/2,y:(B.y+A.y)/2,spatialReference:t.toJson()});z.push(B)}x.push(z)}return x},_getControlPoints:function(e,q,u,r,x){var t=this.map,w,z;this._isNew(e)?
(e=r,r+=1,0<=e&&(w=t.toScreen(q.getPoint(u,e))),r<=x&&(z=t.toScreen(q.getPoint(u,r)))):(e=r-1,r+=1,0<=e&&(w=t.toScreen(q.getPoint(u,e))),r<x&&(z=t.toScreen(q.getPoint(u,r))));return[w,z]},_getAdjacentMidpoints:function(e,q){var u=[],r=e-1;0<=r&&u.push(r);e<q-1&&u.push(e);return u},_getAdjacentVertices:function(e,q){return[e,e+1]},_deleteMidpoints:function(e){var q=this._mpVertexMovers[e.segIndex],u=q.length-1,r=this._getAdjacentMidpoints(e.ptIndex,e.segLength).sort(),x,t=r[0];for(x=0;x<t;x++)--q[x].segLength;
for(x=t+1;x<q.length;x++){var w=q[x];--w.ptIndex;--w.segLength}if(1===r.length)q.splice(t,1)[0].destroy();else for(w=this._getAdjacentVertices(t,u),x=e.relatedGraphic.geometry.getPoint(e.segIndex,w[0]),w=e.relatedGraphic.geometry.getPoint(e.segIndex,w[1]),x=new h({x:(x.x+w.x)/2,y:(x.y+w.y)/2,spatialReference:x.spatialReference.toJson()}),e=new c(x,this._symbol2,this.graphic,e.segIndex,t,u,this,!0),q=q.splice(t,r.length,e),x=0;x<q.length;x++)q[x].destroy()},_updateRelatedGraphic:function(e,q,u,r,x,
t,w,z){e=q.geometry;w?e.insertPoint(r,x+1,l.fromJson(u.toJson())):z?e.removePoint(r,x):e.setPoint(r,x,l.fromJson(u.toJson()));q.setGeometry(e)}});g.PolygonVertexEditor=m(g,{declaredClass:"esri.toolbars._PolygonVertexEditor",minLength:3,_getSegments:function(e){var q,u,r=e.rings,x=[];for(q=0;q<r.length;q++){var t=r[q],w=[];for(u=0;u<t.length-1;u++)w.push(e.getPoint(q,u));x.push(w)}return x},_getMidpointSegments:function(e){var q,u,r=e.rings,x=[],t=e.spatialReference;for(q=0;q<r.length;q++){var w=r[q],
z=[];for(u=0;u<w.length-1;u++){var B=e.getPoint(q,u),A=e.getPoint(q,u+1);B=new h({x:(B.x+A.x)/2,y:(B.y+A.y)/2,spatialReference:t.toJson()});z.push(B)}x.push(z)}return x},_getControlPoints:function(e,q,u,r,x){var t=this.map;this._isNew(e)?e=r:(e=r-1,e=0>e?(x+e)%x:e);r=(r+1)%x;x=t.toScreen(q.getPoint(u,e));q=t.toScreen(q.getPoint(u,r));return[x,q]},_getAdjacentMidpoints:function(e,q){var u=e-1;return[0>u?(q+u)%q:u,e]},_getAdjacentVertices:function(e,q){return[e,(e+1)%q]},_deleteMidpoints:function(e){var q=
e.ptIndex,u=this._mpVertexMovers[e.segIndex],r=u.length-1,x=this._getAdjacentMidpoints(q,e.segLength).sort();var t=x[0];var w=x[x.length-1];if(0===q){var z=this._getAdjacentVertices(r-1,r);q=e.relatedGraphic.geometry.getPoint(e.segIndex,z[0]);z=e.relatedGraphic.geometry.getPoint(e.segIndex,z[1]);q=new h({x:(q.x+z.x)/2,y:(q.y+z.y)/2,spatialReference:q.spatialReference.toJson()});e=new c(q,this._symbol2,this.graphic,e.segIndex,r-1,r,this,!0);u.splice(w,1,e)[0].destroy();u.splice(t,1)[0].destroy();for(x=
0;x<u.length-1;x++)t=u[x],--t.ptIndex,--t.segLength}else{z=this._getAdjacentVertices(t,r);q=e.relatedGraphic.geometry.getPoint(e.segIndex,z[0]);z=e.relatedGraphic.geometry.getPoint(e.segIndex,z[1]);q=new h({x:(q.x+z.x)/2,y:(q.y+z.y)/2,spatialReference:q.spatialReference.toJson()});e=new c(q,this._symbol2,this.graphic,e.segIndex,t,r,this,!0);w=u.splice(t,x.length,e);for(x=0;x<w.length;x++)w[x].destroy();for(x=0;x<t;x++)--u[x].segLength;for(x=t+1;x<u.length;x++)t=u[x],--t.ptIndex,--t.segLength}},_updateRelatedGraphic:function(e,
q,u,r,x,t,w,z){e=q.geometry;w?e.insertPoint(r,x+1,l.fromJson(u.toJson())):z?(e.removePoint(r,x),0===x&&e.setPoint(r,t-1,l.fromJson(e.getPoint(r,0).toJson()))):(e.setPoint(r,x,l.fromJson(u.toJson())),0===x&&e.setPoint(r,t,l.fromJson(u.toJson())));q.setGeometry(e)}});n.setObject("toolbars._GraphicVertexEditor",g,a);n.setObject("toolbars._MultipointVertexEditor",g.MultipointVertexEditor,a);n.setObject("toolbars._PolylineVertexEditor",g.PolylineVertexEditor,a);n.setObject("toolbars._PolygonVertexEditor",
g.PolygonVertexEditor,a);return g})},"esri/toolbars/_VertexMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/sniff dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/Point ../graphic ../geometry/webMercatorUtils".split(" "),function(m,n,v,b,p,f,d,a,c,h,l,k,g){m=m(null,{declaredClass:"esri.toolbars.VertexMover",constructor:function(e,q,u,r,x,t,w,z){this.point=e;this.symbol=q;this.relatedGraphic=u;this.segIndex=r;this.ptIndex=
x;this.segLength=t;this.editor=w;this.map=w.map;this._scratchGL=w.toolbar._scratchGL;this._placeholder=z||!1;this._type=u.geometry.type;this._init();this._enable()},refresh:function(e){if(e||this._needRefresh())this._disable(),this._enable()},destroy:function(){this._disable();this.graphic&&this._scratchGL.remove(this.graphic);this.point=this.symbol=this.graphic=this.relatedGraphic=this.segIndex=this.ptIndex=this.segLength=this.editor=this.map=this._scratchGL=null},_init:function(){var e=new l(this.point.toJson());
e=new k(e,this.symbol);switch(this._type){case "multipoint":e._shape=this.relatedGraphic.getDojoShape().children[this.ptIndex];break;case "polyline":case "polygon":this._scratchGL.add(e)}this.graphic=e},_enable:function(){var e=this.graphic.getDojoShape();e&&(e._hasMover=!0,this._moveable=this._getMoveable(e),(e=e.getEventSource())&&p.set(e,"cursor",this.editor.toolbar._cursors[this._placeholder?"move-gv":"move-v"]))},_disable:function(){var e=this._moveable;if(e){v.disconnect(this._startHandle);
v.disconnect(this._firstHandle);v.disconnect(this._movingHandle);v.disconnect(this._stopHandle);var q=e.shape;q&&(q=q.getEventSource())&&p.set(q,"cursor","inherit");e.destroy();this._moveable=null}},_needRefresh:function(){var e=this.graphic.getDojoShape(),q=!1;if(e)switch(this._type){case "multipoint":var u=this.relatedGraphic.getDojoShape();u&&(u=u.children[this.ptIndex],e!==u&&(this.graphic._shape=u,q=!0));break;case "polyline":case "polygon":q=!e._hasMover}return q},_getMoveable:function(e){e=
new f(e,b("mac")&&b("ff")&&!h("esri-touch")&&{leftButtonOnly:!0});this._startHandle=v.connect(e,"onMoveStart",this,this._moveStartHandler);this._firstHandle=v.connect(e,"onFirstMove",this,this._firstMoveHandler);this._movingHandle=v.connect(e,"onMoving",this,this._movingHandler);this._stopHandle=v.connect(e,"onMoveStop",this,this._moveStopHandler);return e},_getPtIndex:function(){return this.ptIndex+(this._placeholder?1:0)},_getInfo:function(){return{graphic:this.graphic,isGhost:this._placeholder,
segmentIndex:this.segIndex,pointIndex:this._getPtIndex()}},_moveStartHandler:function(e){var q=this.map;q.snappingManager&&q.snappingManager._setUpSnapping();this.editor.toolbar._deactivateScrollWheel();this._startTx=this.graphic.getDojoShape().getTransform();e.shape.moveToFront();this.constructor.onMoveStart(this);this.editor.toolbar.onVertexMoveStart(this.relatedGraphic,this._getInfo())},_firstMoveHandler:function(e){var q=e.shape,u=this._getControlEdges(),r=this._scratchGL._div,x,t=[],w=e.host.shape._wrapOffsets[0]||
0;for(x=0;x<u.length;x++){var z=u[x];z.x1+=w;z.x2+=w;t.push([r.createLine({x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2}).setStroke(this.editor._lineStroke),z.x1,z.y1,z.x2,z.y2])}q._lines=t;e.shape.moveToFront();this.constructor.onFirstMove(this);this.editor.toolbar.onVertexFirstMove(this.relatedGraphic,this._getInfo())},_movingHandler:function(e,q,u){q=this.map;var r;h("esri-pointer")?r=q.navigationManager.pointerEvents._processTouchEvent(u,u):u&&"pointermove"===u.type&&(r=c.prototype._processTouchEvent.call({map:q},
u,u));r&&q.snappingManager&&q.snappingManager._onSnappingMouseMoveHandler(r);u=e.shape;e=u.getTransform();u=u._lines;for(r=0;r<u.length;r++)q=u[r],q[0].setShape({x1:q[1]+e.dx,y1:q[2]+e.dy,x2:q[3],y2:q[4]});this.editor.toolbar.onVertexMove(this.relatedGraphic,this._getInfo(),e)},_moveStopHandler:function(e){e=e.shape;var q=this.editor.toolbar,u=e.getTransform(),r=this.map,x=this.graphic,t=q._geo?g.geographicToWebMercator(x.geometry):x.geometry;q._activateScrollWheel();var w,z=e._lines;if(z){for(w=
0;w<z.length;w++)z[w][0].removeShape();e._lines=null}w=!1;z=!0;var B=this._getInfo();u&&(u.dx||u.dy)?this._placeholder&&(this._placeholder=!1,w=!0):z=!1;if(r.snappingManager)var A=r.snappingManager._snappingPoint;var y=[u,d.invert(this._startTx)];A=A||r.toMap(d.multiplyPoint(y,r.toScreen(t,!0)));r.snappingManager&&r.snappingManager._killOffSnapping();e.setTransform(null);x.setGeometry(q._geo?g.webMercatorToGeographic(A,!0):A);this.constructor.onMoveStop(this,u);q.onVertexMoveStop(this.relatedGraphic,
B,u);if(!z)q.onVertexClick(this.relatedGraphic,B);if(w)q.onVertexAdd(this.relatedGraphic,this._getInfo())},_getControlEdges:function(){var e=this.map,q=this.relatedGraphic.geometry,u=this.segIndex,r=this.ptIndex,x=this.segLength,t=this._scratchGL.getNavigationTransform(),w=t.dx;t=t.dy;var z=e.toScreen(this.graphic.geometry);e=z.x-w;z=z.y-t;var B=[];q=this.editor._getControlPoints(this,q,u,r,x);q[0]&&B.push({x1:e,y1:z,x2:q[0].x-w,y2:q[0].y-t});q[1]&&B.push({x1:e,y1:z,x2:q[1].x-w,y2:q[1].y-t});return B}});
n.setObject("toolbars.VertexMover",m,a);n.mixin(m,{onMoveStart:function(){},onFirstMove:function(){},onMoveStop:function(){}});return m})},"esri/toolbars/TextEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),function(m,n,v,b,p,f,d,a,c,h){m=m(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(l,k,g){this._graphic=l;this._map=k;this._toolbar=g;this._enable(this._graphic)},
destroy:function(){this._disable()},onEditStart:function(){},onEditEnd:function(){},_enable:function(l){this._editBox?(v.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null):(this._map.navigationManager.setImmediateClick(!0),this._addEditBoxHandler=v.connect(l.getLayer(),"onDblClick",this,function(k){this._map.navigationManager.setImmediateClick(!1);k.graphic==l&&(b.stop(k),v.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null,this._addTextBox(l))}))},_disable:function(){this._applyEdit();
this._addEditBoxHandler&&(v.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null);this._removeTextBox();this.onEditEnd(this._graphic);this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(l,k){if(!this._editBox){if(!l.symbol.text){l.symbol.text="Tempt text";l.setSymbol(l.symbol);var g=""}var e=this._createInputTextStyle(l,this._map);""!==g&&(g=k||l.symbol.text);this._editBox=f.create("input",{type:"text",value:g});a.set(this._editBox,e);d.add(this._editBox,"esriTextEditorInput");
this._map.container.appendChild(this._editBox);this._editBox.focus();this._editBoxKeyHandler=v.connect(this._editBox,"onkeyup",n.hitch(this,function(u){u.keyCode!=c.ENTER&&u.keyCode!==c.TAB||this._disable()}));this._editBoxBlurHandler=v.connect(this._editBox,"onblur",n.hitch(this,function(u){this._disable()}));l.symbol.text="";l.setSymbol(l.symbol);l.hide();var q=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=this._map.on("zoom-start",n.hitch(this,function(){this._disable()})));this._moveBoxHandler=
this._map.on("pan",function(u){a.set(q,{left:this._editBoxLeft+u.delta.x+"px",top:this._editBoxTop+u.delta.y+"px"})});this._moveBoxStartHandler=this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(a.get(q,"left"));this._editBoxTop=parseFloat(a.get(q,"top"))});this.onEditStart(l,this._editBox);this._toolbar.onTextEditStart(l,this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(v.disconnect(this._editBoxBlurHandler),this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),
this._editBox=null);this._disableBoxHandler&&(this._disableBoxHandler.remove(),this._disableBoxHandler=null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&(v.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(l,k){var g=l.getDojoShape().getTransformedBoundingBox(),e=l.getLayer();e=e.hasLocalNavigationTransform()?
{dx:0,dy:0}:e.getNavigationTransform();var q=l.symbol.font;return{"font-family":q.family,"font-size":q.size+"px","font-style":q.style,"font-variant":q.variant,"font-weight":q.weight,left:g[0].x+e.dx+"px",top:g[0].y+e.dy+"px",width:Math.abs(g[0].x-g[1].x)/Math.cos(l.symbol.angle/180*Math.PI)+"px"}},_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var l=this._graphic.symbol;l.text=this._editBox.value;this._graphic.setSymbol(l)}else this._graphic.getLayer().remove(this._graphic)}});
n.setObject("toolbars.TextEditor",m,h);return m})},"esri/dijit/editing/Add":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ./EditOperationBase".split(" "),function(m,n,v,b,p,f){n=n(f,{declaredClass:"esri.dijit.editing.Add",type:"edit",label:"Add Features",constructor:function(d){d=d||{};d.featureLayer&&(this._featureLayer=d.featureLayer,d.addedGraphics&&(this._addedGraphics=d.addedGraphics))},updateObjectIds:function(d,a){this.updateIds(this._featureLayer,
this._addedGraphics,d,a)},performUndo:function(){return this._featureLayer.applyEdits(null,null,this._addedGraphics).then(v.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var d=m.map(this._addedGraphics,function(a){return a.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._addedGraphics,null,null).then(v.hitch(this,function(a,c,h){a=m.map(a,function(l){return l.objectId});return{oldIds:d,addedIds:a,layer:this._featureLayer,
operation:this}}))}});v.setObject("dijit.editing.Add",n,p);return n})},"esri/dijit/editing/EditOperationBase":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/has","../../kernel","../../OperationBase"],function(m,n,v,b,p){n=n(p,{declaredClass:"esri.EditOperationBase",updateIds:function(f,d,a,c){m.forEach(d,function(h,l){var k=h[f.objectIdField];m.forEach(a,function(g,e){k===g&&(h[f.objectIdField]=c[e])})})}});return b.EditOperationBase=n})},"esri/dijit/editing/Update":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),
function(m,n,v,b,p,f,d){m=n(d,{declaredClass:"esri.dijit.editing.Update",type:"edit",label:"Update Features",constructor:function(a){var c;a=a||{};if(a.featureLayer&&(this._featureLayer=a.featureLayer,a.preUpdatedGraphics)){this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];for(c=0;c<a.preUpdatedGraphics.length;c++)this._preUpdatedGraphicsGeometries.push(a.preUpdatedGraphics[c].geometry.toJson()),this._preUpdatedGraphicsAttributes.push(a.preUpdatedGraphics[c].attributes);
if(a.postUpdatedGraphics)for(this._postUpdatedGraphics=a.postUpdatedGraphics,this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],c=0;c<a.postUpdatedGraphics.length;c++)a.postUpdatedGraphics[c].geometry?this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[c].geometry.toJson()):this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[c].geometry),this._postUpdatedGraphicsAttributes.push(v.clone(a.postUpdatedGraphics[c].attributes))}},updateObjectIds:function(a,
c){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,a,c);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,a,c)},performUndo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._preUpdatedGraphicsGeometries[a]?this._postUpdatedGraphics[a].setGeometry(f.fromJson(this._preUpdatedGraphicsGeometries[a])):this._postUpdatedGraphics[a].setGeometry(this._preUpdatedGraphicsGeometries[a]),this._postUpdatedGraphics[a].setAttributes(this._preUpdatedGraphicsAttributes[a]);
return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,null).then(v.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphicsGeometries[a]?this._postUpdatedGraphics[a].setGeometry(f.fromJson(this._postUpdatedGraphicsGeometries[a])):this._postUpdatedGraphics[a].setGeometry(this._postUpdatedGraphicsGeometries[a]),this._postUpdatedGraphics[a].setAttributes(this._postUpdatedGraphicsAttributes[a]);
return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,null).then(v.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))}});v.setObject("dijit.editing.Update",m,p);return m})},"esri/dijit/editing/Delete":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ./EditOperationBase".split(" "),function(m,n,v,b,p,f){n=n(f,{declaredClass:"esri.dijit.editing.Delete",type:"edit",label:"Delete Features",constructor:function(d){d=d||{};
d.featureLayer&&(this._featureLayer=d.featureLayer,d.deletedGraphics&&(this._deletedGraphics=d.deletedGraphics))},updateObjectIds:function(d,a){this.updateIds(this._featureLayer,this._deletedGraphics,d,a)},performUndo:function(){var d=m.map(this._deletedGraphics,function(a){return a.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._deletedGraphics,null,null).then(v.hitch(this,function(a,c,h){a=m.map(a,function(l){return l.objectId});return{oldIds:d,addedIds:a,
layer:this._featureLayer,operation:this}}))},performRedo:function(){return this._featureLayer.applyEdits(null,null,this._deletedGraphics).then(v.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))}});v.setObject("dijit.editing.Delete",n,p);return n})},"esri/dijit/editing/Cut":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),function(m,n,v,b,p,f,d){n=n(d,{declaredClass:"esri.dijit.editing.Cut",
type:"edit",label:"Cut Features",constructor:function(a){var c;a=a||{};if(a.featureLayer&&(this._featureLayer=a.featureLayer,a.addedGraphics&&(this._addedGraphics=a.addedGraphics,a.preUpdatedGraphics))){this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];for(c=0;c<a.preUpdatedGraphics.length;c++)this._preUpdatedGraphicsGeometries.push(a.preUpdatedGraphics[c].geometry.toJson()),this._preUpdatedGraphicsAttributes.push(a.preUpdatedGraphics[c].attributes);if(a.postUpdatedGraphics)for(this._postUpdatedGraphics=
a.postUpdatedGraphics,this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],c=0;c<a.postUpdatedGraphics.length;c++)this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[c].geometry.toJson()),this._postUpdatedGraphicsAttributes.push(v.clone(a.postUpdatedGraphics[c].attributes))}},updateObjectIds:function(a,c){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,a,c);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,a,c);this.updateIds(this._featureLayer,
this._addedGraphics,a,c)},performUndo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(f.fromJson(this._preUpdatedGraphicsGeometries[a])),this._postUpdatedGraphics[a].setAttributes(this._preUpdatedGraphicsAttributes[a]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,this._addedGraphics).then(v.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(f.fromJson(this._postUpdatedGraphicsGeometries[a])),
this._postUpdatedGraphics[a].setAttributes(this._postUpdatedGraphicsAttributes[a]);var c=m.map(this._addedGraphics,function(h){return h.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._addedGraphics,this._postUpdatedGraphics,null).then(v.hitch(this,function(h,l,k){h=m.map(h,function(g){return g.objectId});return{oldIds:c,addedIds:h,layer:this._featureLayer,operation:this}}))}});v.setObject("dijit.editing.Cut",n,p);return n})},"esri/dijit/editing/Union":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),
function(m,n,v,b,p,f,d){n=n(d,{declaredClass:"esri.dijit.editing.Union",type:"edit",label:"Union Features",constructor:function(a){a=a||{};this._featureLayer=a.featureLayer;this._deletedGraphics=a.deletedGraphics;this._preUpdatedGraphics=a.preUpdatedGraphics;this._postUpdatedGraphics=a.postUpdatedGraphics;this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];this._postUpdatedGraphicsGeometries=[];this._postUpdatedGraphicsAttributes=[];var c;for(c=0;c<a.preUpdatedGraphics.length;c++)this._preUpdatedGraphicsGeometries.push(a.preUpdatedGraphics[c].geometry.toJson()),
this._preUpdatedGraphicsAttributes.push(a.preUpdatedGraphics[c].attributes);for(c=0;c<a.postUpdatedGraphics.length;c++)this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[c].geometry.toJson()),this._postUpdatedGraphicsAttributes.push(v.clone(a.postUpdatedGraphics[c].attributes))},updateObjectIds:function(a,c){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,a,c);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,a,c);this.updateIds(this._featureLayer,
this._deletedGraphics,a,c)},performUndo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(f.fromJson(this._preUpdatedGraphicsGeometries[a])),this._postUpdatedGraphics[a].setAttributes(this._preUpdatedGraphicsAttributes[a]);var c=m.map(this._deletedGraphics,function(h){return h.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._deletedGraphics,this._postUpdatedGraphics,null).then(v.hitch(this,function(h,
l,k){h=m.map(h,function(g){return g.objectId});return{oldIds:c,addedIds:h,layer:this._featureLayer,operation:this}}))},performRedo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(f.fromJson(this._postUpdatedGraphicsGeometries[a])),this._postUpdatedGraphics[a].setAttributes(this._postUpdatedGraphicsAttributes[a]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,this._deletedGraphics).then(v.hitch(this,function(){return{layer:this._featureLayer,
operation:this}}))}});v.setObject("dijit.editing.Union",n,p);return n})},"esri/dijit/editing/toolbars/Drawing":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dijit/_CssStateMixin ../Util ./ToolbarBase ../tools/ButtonToolBase ../tools/Cut ../tools/Union ../tools/Reshape ../tools/Editing ../tools/EditingTools ../tools/Selection ../tools/SelectionTools ../../../kernel".split(" "),function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r){m=m([a,f],{declaredClass:"esri.dijit.editing.toolbars.Drawing",
onShowAttributeInspector:function(){},_activateTool:function(x,t){this._settings.editor._activeTool=x;"EDITING"!==x&&this._settings.templatePicker.clearSelection();"ATTRIBUTES"!==x&&this._settings.editor._hideAttributeInspector();"CLEAR"!==x&&this.inherited(arguments)},_initializeToolbar:function(){v.forEach(this._settings.layers,function(x){this._tbConnects.push(b.connect(x,"onSelectionComplete",this,"_updateUI"))},this)},activateEditing:function(x,t){this._tools.EDITING._activateTool(x,t.geometryType);
this._activeTool=this._tools.EDITING;this._activeTool.setChecked(!0)},_updateUI:function(){this._settings.undoManager&&(this._tools.UNDO.set("disabled",!1===this._settings.undoManager.canUndo),this._tools.REDO.set("disabled",!1===this._settings.undoManager.canRedo));this._selectedFeatures=d.getSelection(this._settings.layers);var x=this._selectedFeatures.length;this._tools.DELETE&&this._tools.DELETE.set("disabled",0>=x);this._tools.CLEAR&&this._tools.CLEAR.set("disabled",0>=x);this._tools.ATTRIBUTES&&
this._tools.ATTRIBUTES.set("disabled",0>=x);this._tools.UNION&&this._tools.UNION.set("disabled",2>x)},_toolFinished:function(x){if("ATTRIBUTES"===x&&this._selectedFeatures&&this._selectedFeatures.length)this.onShowAttributeInspector(this._selectedFeatures[0]);if("SELECT"===x||"CUT"===x||"RESHAPING"===x||"EDITING"===x)this._activeTool.deactivate(),this._activeTool.setChecked(!1),this._activeTool=null;if("DELETE"===x)this.onDelete();this._settings.editor._activeTool=null;this._updateUI()},_createTools:function(){this._tools.SELECT=
new q({settings:this._settings,onClick:n.hitch(this,"_activateTool","SELECT",!0),onFinished:n.hitch(this,"_toolFinished","SELECT")});this.addChild(this._tools.SELECT);this._tools.CLEAR=new c(n.mixin(u.selectClear,{settings:this._settings,onClick:n.hitch(this._settings.editor,"_clearSelection",!1)}));this.addChild(this._tools.CLEAR);this._createSeparator();this._tools.ATTRIBUTES=new c(n.mixin(e.attributes,{settings:this._settings,onClick:n.hitch(this,"_toolFinished","ATTRIBUTES")}));this.addChild(this._tools.ATTRIBUTES);
this._createSeparator();this._tools.EDITING=new g({settings:this._settings,onClick:n.hitch(this,"_activateTool","EDITING",!0),onApplyEdits:n.hitch(this,"onApplyEdits"),onFinished:n.hitch(this,"_toolFinished","EDITING")});this.addChild(this._tools.EDITING);this._tools.DELETE=new c(n.mixin(e.del,{settings:this._settings,onClick:n.hitch(this,"_toolFinished","DELETE")}));this.addChild(this._tools.DELETE);this._settings.toolbarOptions&&((this._settings.toolbarOptions.cutVisible||this._settings.toolbarOptions.mergeVisible||
this._settings.toolbarOptions.reshapeVisible)&&this._createSeparator(),this._settings.toolbarOptions.cutVisible&&(this._tools.CUT=new h({settings:this._settings,onFinished:n.hitch(this,"_toolFinished","CUT"),onClick:n.hitch(this,"_activateTool","CUT",!0),onApplyEdits:n.hitch(this,"onApplyEdits")}),this.addChild(this._tools.CUT)),this._settings.toolbarOptions.mergeVisible&&(this._tools.UNION=new l({settings:this._settings,onFinished:n.hitch(this,"_toolFinished","UNION"),onApplyEdits:n.hitch(this,"onApplyEdits")}),
this.addChild(this._tools.UNION)),this._settings.toolbarOptions.reshapeVisible&&(this._tools.RESHAPING=new k({settings:this._settings,onClick:n.hitch(this,"_activateTool","RESHAPING",!0),onFinished:n.hitch(this,"_toolFinished","RESHAPING"),onApplyEdits:n.hitch(this,"onApplyEdits")}),this.addChild(this._tools.RESHAPING)));this._settings.enableUndoRedo&&(this._createSeparator(),this._tools.UNDO=new c(n.mixin(e.undo,{settings:this._settings,disabled:!0,onClick:n.hitch(this,function(){this._tools.UNDO.set("disabled",
!0);this._tools.REDO.set("disabled",!0);this._settings.editor._undo()})})),this.addChild(this._tools.UNDO),this._tools.REDO=new c(n.mixin(e.redo,{settings:this._settings,disabled:!0,onClick:n.hitch(this,function(){this._tools.UNDO.set("disabled",!0);this._tools.REDO.set("disabled",!0);this._settings.editor._redo()})})),this.addChild(this._tools.REDO))}});n.setObject("dijit.editing.toolbars.Drawing",m,r);return m})},"esri/dijit/editing/toolbars/ToolbarBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dijit/Toolbar dijit/ToolbarSeparator ../../../kernel ../../../lang".split(" "),
function(m,n,v,b,p,f,d,a,c){m=m([f],{declaredClass:"esri.dijit.editing.toolbars.ToolbarBase",_enabled:!0,graphicsAdded:function(){},drawEnd:function(){},onApplyEdits:function(){},onDelete:function(){},constructor:function(h,l){h&&h.settings&&(this._tools=[],this._tbConnects=[],this._initialize(h.settings))},postCreate:function(){this._createTools();this.deactivate()},destroy:function(){var h,l=this._tools;for(h in l)l.hasOwnProperty(h)&&c.isDefined(this._tools[h])&&this._tools[h].destroy();v.forEach(this._tbConnects,
b.disconnect);this.inherited(arguments)},activate:function(h){this._enabled=!0},deactivate:function(){var h;this._enabled=!1;this._geometryType=this._layer=null;var l=this._tools;for(h in l)l.hasOwnProperty(h)&&(this._tools[h].deactivate(),this._tools[h].setChecked(!1))},isEnabled:function(){return this._enabled},setActiveSymbol:function(h){this._activeSymbol=h},_getSymbol:function(){},_createTools:function(){},_initialize:function(h){this._settings=h;this._toolbar=h.drawToolbar;this._editToolbar=
h.editToolbar;this._initializeToolbar()},_activateTool:function(h,l){this._activeTool&&this._activeTool.deactivate();!0===l&&this._activeTool==this._tools[h]?(this._activeTool.setChecked(!1),this._activeTool=null):(this._activeTool=this._tools[h],this._activeTool.setChecked(!0),this._activeTool.activate(null))},_createSeparator:function(){this.addChild(new d)}});n.setObject("dijit.editing.toolbars.ToolbarBase",m,a);return m})},"esri/dijit/editing/tools/ButtonToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/form/Button ./ToolBase ../../../kernel".split(" "),
function(m,n,v,b,p,f){m=m([b,p],{declaredClass:"esri.dijit.editing.tools.ButtonToolBase",postCreate:function(){this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){b.prototype.destroy.apply(this,arguments);p.prototype.destroy.apply(this,arguments)}});n.setObject("dijit.editing.tools.ButtonToolBase",m,f);return m})},"esri/dijit/editing/tools/ToolBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../../../kernel","dojo/i18n!../../../nls/jsapi"],
function(m,n,v,b,p){m=m(null,{declaredClass:"esri.dijit.editing.tools.ToolBase",_enabled:!0,showLabel:!1,constructor:function(f,d){f=f||{};n.mixin(this,f);this.label=this._label?p.widgets.editor.tools[this._label]:"";this._settings=f.settings;this._toolbar=f.settings.drawToolbar;this._editToolbar=f.settings.editToolbar;this._initializeTool()},onFinished:function(){},onDrawEnd:function(){},onApplyEdits:function(){},postCreate:function(){this.deactivate();this.inherited(arguments)},destroy:function(){},
activate:function(f){this._toolbar&&this._toolbar.deactivate();this._editToolbar&&this._editToolbar.deactivate();this._enabled&&(this._checked=!0,this._layer=f,this._toolbar&&this._drawType&&this._toolbar.activate(this._drawType))},deactivate:function(){this._toolbar&&this._toolbar.deactivate();this._editToolbar&&this._editToolbar.deactivate();this.setChecked(!1);this._updateUI()},setEnabled:function(f){this._enabled=f;this._updateUI()},setChecked:function(f){this._checked=f},enable:function(f){this._updateUI()},
isEnabled:function(){return this._enabled},getToolName:function(){return this._toolName},_initializeTool:function(){},_updateUI:function(){this.disabled=!this._enabled;this.attr("iconClass",this._enabled?this._enabledIcon:this._disabledIcon)}});n.setObject("dijit.editing.tools.ToolBase",m,b);return m})},"esri/dijit/editing/tools/Cut":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dojo/DeferredList ../../../graphicsUtils ../../../graphic ../../../tasks/query ../../../layers/FeatureLayer ../../../toolbars/draw ../Cut ./ToggleToolBase ../../../kernel".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e){m=m([g],{declaredClass:"esri.dijit.editing.tools.Cut",id:"btnFeatureCut",_enabledIcon:"toolbarIcon cutIcon",_disabledIcon:"toolbarIcon cutIcon",_drawType:l.POLYLINE,_enabled:!0,_label:"NLS_cutLbl",_cutConnects:[],activate:function(){this._cutConnects.push(b.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd"));this.inherited(arguments)},deactivate:function(){this.inherited(arguments);v.forEach(this._cutConnects,b.disconnect);this._cutConnects=[];this._edits=[]},
_onDrawEnd:function(q){var u=this._cutLayers=v.filter(this._settings.layers,function(x){return"esriGeometryPolygon"===x.geometryType||"esriGeometryPolyline"===x.geometryType&&x.visible&&x._isMapAtVisibleScale()});this._cutConnects=this._cutConnects.concat(v.map(u,n.hitch(this,function(x){return b.connect(x,"onEditsComplete",n.hitch(this,function(t,w,z){if(this._settings.undoRedoManager){var B=this._settings.undoRedoManager;v.forEach(this._edits,n.hitch(this,function(A){B.add(new k({featureLayer:A.layer,
addedGraphics:A.adds,preUpdatedGraphics:A.preUpdates,postUpdatedGraphics:A.updates}))}),this)}this.onFinished()}))})));var r=new c;r.geometry=q;v.forEach(u,function(x,t){this._settings.editor._selectionHelper.selectFeatures([x],r,h.SELECTION_NEW,n.hitch(this,"_cutFeatures",x,r))},this)},_cutFeatures:function(q,u,r){if(r&&r.length){this._edits=[];var x=[];x.push(this._settings.geometryService.cut(d.getGeometries(r),u.geometry,n.hitch(this,"_cutHandler",q,r)));(new f(x)).addCallback(n.hitch(this,function(){this.onApplyEdits(this._edits)}))}},
_cutHandler:function(q,u,r){var x=[],t=[],w=v.map(u,function(A){return new a(n.clone(A.toJson()))}),z,B;v.forEach(r.cutIndexes,function(A,y){z!=A?(z=A,t.push(u[A].setGeometry(r.geometries[y]))):(B=new a(r.geometries[y],null,n.mixin({},u[A].attributes),null),B.attributes[u[0].getLayer().objectIdField]=null,x.push(B))},this);this._edits.push({layer:q,adds:x,updates:t,preUpdates:w})}});n.setObject("dijit.editing.tools.Cut",m,e);return m})},"esri/dijit/editing/tools/ToggleToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/form/ToggleButton ./ToolBase ../../../kernel".split(" "),
function(m,n,v,b,p,f){m=m([b,p],{declaredClass:"esri.dijit.editing.tools.ToggleToolBase",postCreate:function(){this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){b.prototype.destroy.apply(this,arguments);p.prototype.destroy.apply(this,arguments)},setChecked:function(d){b.prototype.setChecked.apply(this,arguments)}});n.setObject("dijit.editing.tools.ToggleToolBase",m,f);return m})},"esri/dijit/editing/tools/Union":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../../graphicsUtils ../../../graphic ../../../toolbars/draw ../Union ./ButtonToolBase ../../../kernel".split(" "),
function(m,n,v,b,p,f,d,a,c,h){m=m([c],{declaredClass:"esri.dijit.editing.tools.Union",id:"btnFeatureUnion",_enabledIcon:"toolbarIcon unionIcon",_disabledIcon:"toolbarIcon unionIcon",_drawType:d.POLYLINE,_enabled:!0,_label:"NLS_unionLbl",_onClick:function(l){this._settings.editor._activeTool="UNION";l=v.filter(this._settings.layers,function(e){return"esriGeometryPolygon"===e.geometryType&&e.visible&&e._isMapAtVisibleScale()});var k=[],g=0;v.forEach(l,function(e,q){var u=e.getSelectedFeatures();2<=
u.length&&(g++,this._settings.geometryService.union(p.getGeometries(u),n.hitch(this,function(r){var x=u.shift(),t=[],w=[];t.push(new f(x.toJson()));w.push(x.setGeometry(r));k.push({layer:e,updates:w,deletes:u,preUpdates:t});g--;if(0>=g)this.onApplyEdits(k,n.hitch(this,function(){if(this._settings.undoRedoManager){var z=this._settings.undoRedoManager;v.forEach(this._edits,n.hitch(this,function(B){z.add(new a({featureLayer:B.layer,deletedGraphics:B.deletes,preUpdatedGraphics:B.preUpdates,postUpdatedGraphics:B.updates}))}),
this)}this._settings.editor._selectionHelper.clearSelection(!1);this.onFinished()}))})))},this)}});n.setObject("dijit.editing.tools.Union",m,h);return m})},"esri/dijit/editing/tools/Reshape":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has ../../../graphic ../../../layers/FeatureLayer ../../../tasks/query ../../../toolbars/draw ./ToggleToolBase ../../../kernel".split(" "),function(m,n,v,b,p,f,d,a,c,h,l){m=m([h],{declaredClass:"esri.dijit.editing.tools.Reshape",
id:"btnFeatureReshape",_enabledIcon:"toolbarIcon reshapeIcon",_disabledIcon:"toolbarIcon reshapeIcon",_drawType:c.POLYLINE,_enabled:!0,_label:"NLS_reshapeLbl",activate:function(){b.disconnect(this._rConnect);this._rConnect=b.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd");this.inherited(arguments)},deactivate:function(){this.inherited(arguments);b.disconnect(this._rConnect);delete this._rConnect},_onDrawEnd:function(k){var g=this._settings.layers,e=new a;e.geometry=k;k=this._reshapeLayers=v.filter(g,
function(q){return"esriGeometryPolygon"===q.geometryType||"esriGeometryPolyline"});this._settings.editor._selectionHelper.selectFeatures(k,e,d.SELECTION_NEW,n.hitch(this,"_reshape",e))},_reshape:function(k,g){if(1===g.length){var e=[],q=[],u=[],r=g[0],x=r.getLayer();this._settings.geometryService.reshape(r.geometry,k.geometry,n.hitch(this,function(t){"polyline"===t.type&&t.paths&&0===t.paths.length?(this._settings.editor._selectionHelper.clearSelection(!1),this.onFinished()):"polygon"===t.type&&t.rings&&
0===t.rings.length?(this._settings.editor._selectionHelper.clearSelection(!1),this.onFinished()):(u.push(new f(r.toJson())),q.push(r.setGeometry(t)),e.push({layer:x,updates:q,preUpdates:u}),this.onApplyEdits(e,n.hitch(this,function(){this._settings.editor._selectionHelper.clearSelection(!1);this.onFinished()})))}))}}});n.setObject("dijit.editing.tools.Reshape",m,l);return m})},"esri/dijit/editing/tools/Editing":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../../layers/FeatureTemplate ./Edit ./EditingTools ./DropDownToolBase ../../../kernel ../../../lang".split(" "),
function(m,n,v,b,p,f,d,a,c,h){m=m([a],{declaredClass:"esri.dijit.editing.tools.Editing",_enabled:!1,deactivate:function(){this._enabled&&(this._enabled=!1,this.inherited(arguments),this._settings.templatePicker.clearSelection())},onItemClicked:function(l,k){this.inherited(arguments);this._activeTool===this._tools.AUTOCOMPLETE&&(this._settings.editor._drawingTool=p.TOOL_AUTO_COMPLETE_POLYGON)},_activateTool:function(l,k){var g;this.enable(k);for(g in this._tools)this._tools.hasOwnProperty(g)&&(this.dropDown.removeChild(this._tools[g]),
!0===this._tools[g]._enabled&&this.dropDown.addChild(this._tools[g]));if(this._geometryType!==k||!1===this._activeTool._enabled)this._activeTool=this._tools[l.toUpperCase()];this._geometryType=k;this._activeTool.activate();this._activeTool.setChecked(!0);this._updateUI()},_initializeTool:function(l){this.inherited(arguments);this._initializeTools()},_initializeTools:function(){var l=this._settings.layers,k=this._settings.editor,g=!1,e=!1,q=!1,u=this._toolTypes=[],r;v.forEach(l,function(x){r=x.geometryType;
g=g||"esriGeometryPoint"===r;e=e||"esriGeometryPolyline"===r;q=q||"esriGeometryPolygon"===r;u=u.concat(v.map(this._getTemplatesFromLayer(x),n.hitch(this,function(t){return k._toDrawTool(t.drawingTool,x)})))},this);l=this._settings.createOptions;g&&this._toolTypes.push("point");e&&(this._toolTypes=this._toolTypes.concat(l.polylineDrawTools));q&&(this._toolTypes=this._toolTypes.concat(l.polygonDrawTools));this._toolTypes=this._toUnique(this._toolTypes.concat(u))},_toUnique:function(l){var k={};return v.filter(l,
function(g){return k[g]?!1:k[g]=!0})},_getTemplatesFromLayer:function(l){var k=l.templates||[];v.forEach(l.types,function(g){k=k.concat(g.templates)});return v.filter(k,h.isDefined)},_createTools:function(){v.forEach(this._toolTypes,this._createTool,this);this.inherited(arguments)},_createTool:function(l){var k=n.mixin(d[l],{settings:this._settings,onClick:n.hitch(this,"onItemClicked",d[l].id)});this._tools[l.toUpperCase()]=new f(k)}});n.setObject("dijit.editing.tools.Editing",m,c);return m})},"esri/dijit/editing/tools/Edit":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","./MenuItemBase","../../../kernel"],function(m,n,v,b,p){m=m([b],{declaredClass:"esri.dijit.editing.tools.Edit",enable:function(f){this._enabled=f===this._geomType;this.inherited(arguments)}});n.setObject("dijit.editing.tools.Edit",m,p);return m})},"esri/dijit/editing/tools/MenuItemBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/MenuItem ./ToolBase ../../../kernel".split(" "),function(m,n,v,b,p,f){m=m([b,p],{declaredClass:"esri.dijit.editing.tools.MenuItemBase",
destroy:function(){b.prototype.destroy.apply(this,arguments);p.prototype.destroy.apply(this,arguments)}});n.setObject("dijit.editing.tools.MenuItemBase",m,f);return m})},"esri/dijit/editing/tools/EditingTools":function(){define(["dojo/_base/lang","dojo/has","../../../toolbars/draw","../../../kernel"],function(m,n,v,b){n={point:{id:"esriPointTool",_enabledIcon:"toolbarIcon pointIcon",_disabledIcon:"toolbarIcon pointIconDisabled",_drawType:v.POINT,_geomType:"esriGeometryPoint",_label:"NLS_pointLbl"},
polyline:{id:"toolDrawFreehandPolyline",_enabledIcon:"toolbarIcon polylineIcon",_disabledIcon:"toolbarIcon polylineIconDisabled",_drawType:v.POLYLINE,_geomType:"esriGeometryPolyline",_label:"NLS_polylineLbl"},freehandpolyline:{id:"toolDrawPolyline",_enabledIcon:"toolbarIcon freehandPolylineIcon",_disabledIcon:"toolbarIcon freehandPolylineIcon",_drawType:v.FREEHAND_POLYLINE,_geomType:"esriGeometryPolyline",_label:"NLS_freehandPolylineLbl"},polygon:{id:"toolDrawPolygon",_enabledIcon:"toolbarIcon polygonIcon",
_disabledIcon:"toolbarIcon polygonIconDisabled",_drawType:v.POLYGON,_geomType:"esriGeometryPolygon",_label:"NLS_polygonLbl"},freehandpolygon:{id:"toolDrawFreehandPolygon",_enabledIcon:"toolbarIcon freehandPolygonIcon",_disabledIcon:"toolbarIcon freehandPolygonIconDisabled",_drawType:v.FREEHAND_POLYGON,_label:"NLS_freehandPolygonLbl",_geomType:"esriGeometryPolygon"},autocomplete:{id:"btnFeatureAutoComplete",_enabledIcon:"toolbarIcon autoCompleteIcon",_disabledIcon:"toolbarIcon autoCompleteIcon",_drawType:v.POLYGON,
_label:"NLS_autoCompleteLbl",_geomType:"esriGeometryPolygon"},rectangle:{id:"toolDrawRect",_enabledIcon:"toolbarIcon rectangleIcon",_disabledIcon:"toolbarIcon rectangleIcon",_drawType:v.RECTANGLE,_geomType:"esriGeometryPolygon",_label:"NLS_rectangleLbl"},arrow:{id:"toolDrawArrow",_enabledIcon:"toolbarIcon arrowIcon",_disabledIcon:"toolbarIcon arrowIcon",_drawType:v.ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowLbl"},uparrow:{id:"toolDrawArrowUp",_enabledIcon:"toolbarIcon arrowUpIcon",_disabledIcon:"toolbarIcon arrowUpIcon",
_drawType:v.UP_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowUpLbl"},downarrow:{id:"toolDrawDownArrow",_enabledIcon:"toolbarIcon arrowDownIcon",_disabledIcon:"toolbarIcon arrowDownIcon",_drawType:v.DOWN_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowDownLbl"},leftarrow:{id:"toolDrawLeftArrow",_enabledIcon:"toolbarIcon arrowLeftIcon",_disabledIcon:"toolbarIcon arrowLeftIcon",_drawType:v.LEFT_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowLeftLbl"},rightarrow:{id:"toolDrawRightArrow",
_enabledIcon:"toolbarIcon arrowIcon",_disabledIcon:"toolbarIcon arrowIcon",_drawType:v.RIGHT_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowRightLbl"},circle:{id:"toolDrawCircle",_enabledIcon:"toolbarIcon circleIcon",_disabledIcon:"toolbarIcon circleIcon",_drawType:v.CIRCLE,_geomType:"esriGeometryPolygon",_label:"NLS_circleLbl"},ellipse:{id:"toolDrawEllipse",_enabledIcon:"toolbarIcon ellipseIcon",_disabledIcon:"toolbarIcon ellipseIcon",_drawType:v.ELLIPSE,_geomType:"esriGeometryPolygon",_label:"NLS_ellipseLbl"},
triangle:{id:"toolDrawTriangle",_enabledIcon:"toolbarIcon triangleIcon",_disabledIcon:"toolbarIcon triangleIcon",_drawType:v.TRIANGLE,_geomType:"esriGeometryPolygon",_label:"NLS_triangleLbl"},attributes:{id:"btnAttributes",_enabledIcon:"toolbarIcon attributesIcon",_disabledIcon:"toolbarIcon attributesIcon",_enabled:!1,_label:"NLS_attributesLbl"},del:{id:"btnDelete2",_enabledIcon:"toolbarIcon deleteFeatureIcon",_disabledIcon:"toolbarIcon deleteFeatureIcon",_enabled:!1,_label:"NLS_deleteLbl"},undo:{id:"btnUndo",
_enabledIcon:"dijitEditorIcon dijitEditorIconUndo",_disabledIcon:"dijitEditorIcon dijitEditorIconUndo",_enabled:!1,_label:"NLS_undoLbl"},redo:{id:"btnRedo",_enabledIcon:"dijitEditorIcon dijitEditorIconRedo",_disabledIcon:"dijitEditorIcon dijitEditorIconRedo",_enabled:!1,_label:"NLS_redoLbl"}};m.setObject("dijit.editing.tools.EditingTools",n,b);return n})},"esri/dijit/editing/tools/DropDownToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-style dijit/registry dijit/Menu dijit/form/ComboButton ./ToolBase ../../../kernel ../../../lang".split(" "),
function(m,n,v,b,p,f,d,a,c,h){m=m([d,a],{declaredClass:"esri.dijit.editing.tools.DropDownToolBase",_enabled:!1,_checked:!1,postCreate:function(){this._tools=[];this._createTools();this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){var l,k=this._tools;for(l in k)k.hasOwnProperty(l)&&h.isDefined(k[l])&&k[l].destroy();this.inherited(arguments)},_createTools:function(){var l,k=new f;this.dropDown=k;for(l in this._tools)this._tools.hasOwnProperty(l)&&k.addChild(this._tools[l]);
this._activeTool=k.getChildren()[0];this._updateUI()},activate:function(l){this.inherited(arguments);this._activeTool?this._activeTool.activate():this._activateDefaultTool()},deactivate:function(){this.inherited(arguments);this._activeTool&&this._activeTool.deactivate()},enable:function(l){for(var k in this._tools)this._tools.hasOwnProperty(k)&&this._tools[k].enable(l);this.setEnabled(!0);this.inherited(arguments)},setChecked:function(l){this._checked=l;this._updateUI()},_onDrawEnd:function(l){},
onLayerChange:function(l,k,g){this._activeTool=null;this._activeType=k;this._activeTemplate=g;this._activeLayer=l},onItemClicked:function(l,k){this._activeTool&&this._activeTool.deactivate();this._activeTool=p.byId(l);!1===this._checked?this._onClick():(this._updateUI(),this._activeTool&&(this._activeTool.activate(),this._activeTool.setChecked(!0)))},_onClick:function(l){!1!==this._enabled&&(this._checked=!this._checked,this.inherited(arguments))},_updateUI:function(){this.attr("disabled",!this._enabled);
b.set(this.focusNode,{outline:"none"});b.set(this.titleNode,{padding:"0px",border:"none"});this._checked?b.set(this.titleNode,{backgroundColor:"#D4DFF2",border:"1px solid #316AC5"}):b.set(this.titleNode,{backgroundColor:"",border:""});this._activeTool&&(this.attr("iconClass",this._checked?this._activeTool._enabledIcon:this._activeTool._disabledIcon),this.attr("label",this._activeTool.label))}});n.setObject("dijit.editing.tools.DropDownToolBase",m,c);return m})},"esri/dijit/editing/tools/Selection":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has ../../../symbols/SimpleMarkerSymbol ../../../symbols/SimpleLineSymbol ../../../symbols/SimpleFillSymbol ./Edit ./SelectionTools ./DropDownToolBase ../../../kernel".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g){m=m([k],{declaredClass:"esri.dijit.editing.tools.Selection",_enabled:!0,activate:function(){this.inherited(arguments);this._sConnect=b.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd")},deactivate:function(){this.inherited(arguments);b.disconnect(this._sConnect);delete this._sConnect},_initializeTool:function(){this._createSymbols();this._initializeLayers();this._toolTypes=["select","selectadd","selectremove"]},_onDrawEnd:function(e){this.inherited(arguments);
this._settings.editor._hideAttributeInspector();var q=this._settings.layers;this._selectMethod=this._activeTool._selectMethod;this._settings.editor._selectionHelper.selectFeaturesByGeometry(q,e,this._selectMethod,n.hitch(this,"onFinished"))},_createSymbols:function(){this._pointSelectionSymbol=new d(d.STYLE_CIRCLE,10,new a(a.STYLE_SOLID,new p([0,0,0]),1),new p([255,0,0,.5]));this._polylineSelectionSymbol=new a(a.STYLE_SOLID,new p([0,200,255]),2);this._polygonSelectionSymbol=new c(c.STYLE_SOLID,new a(a.STYLE_SOLID,
new p([0,0,0]),1),new p([0,200,255,.5]))},_initializeLayers:function(){v.forEach(this._settings.layers,this._setSelectionSymbol,this)},_setSelectionSymbol:function(e){var q=null;switch(e.geometryType){case "esriGeometryPoint":q=this._pointSelectionSymbol;break;case "esriGeometryPolyline":q=this._polylineSelectionSymbol;break;case "esriGeometryPolygon":q=this._polygonSelectionSymbol}e.setSelectionSymbol(e._selectionSymbol||q)},_createTools:function(){v.forEach(this._toolTypes,this._createTool,this);
this.inherited(arguments)},_createTool:function(e){var q=n.mixin(l[e],{settings:this._settings,onClick:n.hitch(this,"onItemClicked",l[e].id)});this._tools[e.toUpperCase()]=new h(q)}});n.setObject("dijit.editing.tools.Selection",m,g);return m})},"esri/dijit/editing/tools/SelectionTools":function(){define(["dojo/_base/lang","dojo/has","../../../layers/FeatureLayer","../../../toolbars/draw","../../../kernel"],function(m,n,v,b,p){n={select:{id:"btnNewSelection",_enabledIcon:"toolbarIcon newSelectionIcon",
_disabledIcon:"toolbarIcon newSelectionIcon",_drawType:b.EXTENT,_selectMethod:v.SELECTION_NEW,_label:"NLS_selectionNewLbl"},selectadd:{id:"btnAddToSelection",_enabledIcon:"toolbarIcon addToSelectionIcon",_disabledIcon:"toolbarIcon addToSelectionIcon",_drawType:b.EXTENT,_selectMethod:v.SELECTION_ADD,_label:"NLS_selectionAddLbl"},selectremove:{id:"btnSubtractFromSelection",_enabledIcon:"toolbarIcon removeFromSelectionIcon",_disabledIcon:"toolbarIcon removeFromSelectionIcon",_drawType:b.EXTENT,_selectMethod:v.SELECTION_SUBTRACT,
_label:"NLS_selectionRemoveLbl"},selectClear:{id:"btnClearSelection",_enabledIcon:"toolbarIcon clearSelectionIcon",_disabledIcon:"toolbarIcon clearSelectionIcon",_enabled:!1,_label:"NLS_selectionClearLbl"}};m.setObject("dijit.editing.tools.SelectionTools",n,p);return n})},"esri/dijit/editing/SelectionHelper":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dojo/DeferredList ../../geometry/Extent ../../geometry/Point ../../geometry/ScreenPoint ../../layers/FeatureLayer ../../tasks/query ../../kernel".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k){m=m(null,{declaredClass:"esri.dijit.editing.SelectionHelper",constructor:function(g){this._settings=g||{};this._sConnects=[];this._mapServiceCount=0;this._map=this._settings.map;this._tolerance=this._settings.singleSelectionTolerance;this._initMapServiceInfos(this._settings.layers)},destroy:function(){for(var g in this._sConnects)this._sConnects.hasOwnProperty(g)&&v.disconnect(this._sConnects[g])},selectFeatures:function(g,e,q,u){q===h.SELECTION_NEW&&(this._resetMapServiceInfos(),
this.getSelection(g));var r=[];b.forEach(g,function(x){if(!0===x.visible&&!0===x._isMapAtVisibleScale()){var t=q;x._isSelOnly&&t===h.SELECTION_NEW&&(t=h.SELECTION_ADD);r.push(x.selectFeatures(e,t))}});(new f(r)).addCallback(n.hitch(this,function(x){var t=[];b.forEach(x,function(w,z){b.forEach(w[1],function(B){(B=g[z]._mode._getFeature(B.attributes[g[z].objectIdField])||null)&&t.push(B)},this)},this);this._mapServiceCount?((x=q===h.SELECTION_SUBTRACT)?(this._resetMapServiceInfos(),this._createLayerDefs(this._getLayerInfosFromSelection(g))):
this._createLayerDefs(this._getLayerInfosFromFeatures(t)),this._updateLayerDefs(this._mapServiceInfos,!1,!(t&&t.length||x),n.hitch(this,u,t))):u(t)}))},selectFeaturesByGeometry:function(g,e,q,u){var r=e;-1!==e.declaredClass.indexOf("Extent")&&e.xmax===e.xmin&&e.ymax===e.ymin&&(r=new a(e.xmax,e.ymax,e.spatialReference));r=-1!==r.declaredClass.indexOf("Point")?this._extentFromPoint(r):r;e=new l;e.geometry=r;this.selectFeatures(g,e,q,u)},clearSelection:function(g){b.forEach(this._nonSelOnlyLayers,function(q){q.clearSelection&&
q.clearSelection()});if(this._mapServiceCount){this._resetMapServiceInfos();var e=this._getLayerInfosFromSelection(this._settings.layers);b.some(e,function(q){return q.oids&&q.oids.length})&&(this._createLayerDefs(e),this._updateLayerDefs(this._mapServiceInfos,!0,g||!1))}},findMapService:function(g){var e=this._map,q=e.layerIds;g=g&&g._url&&g._url.path?g._url.path.toLowerCase():"";var u;for(u in q)if(q.hasOwnProperty(u)){var r=e.getLayer(q[u]);var x=r._url?r._url.path?r._url.path.toLowerCase().replace("mapserver",
"featureserver"):r._url.toLowerCase().replace("mapserver","featureserver"):"";if(g.substr(0,x.length)===x&&"esri.layers.ArcGISDynamicMapServiceLayer"===r.declaredClass)return r}},getSelection:function(g){var e=[];b.forEach(g,function(q){q._isSelOnly&&e.push(this._createLayerInfo(q))},this);b.forEach(e,function(q){var u=this._createMapServiceInfo(this.findMapService(q.layer));u&&(u.layerInfos[q.layer.layerId]=q)},this)},_initMapServiceInfos:function(g){this._nonSelOnlyLayers=[];this._mapServiceInfos=
[];b.forEach(g,function(e){var q=this.findMapService(e);q?(this._mapServiceCount++,this._createMapServiceInfo(q),q&&q.setDisableClientCaching(!0)):this._nonSelOnlyLayers.push(e)},this)},_createMapServiceInfo:function(g){if(!g)return null;var e=this._mapServiceInfos,q=e[g.id];q||(q=e[g.id]={mapService:g,layerInfos:[],layerDefs:n.mixin([],g.layerDefinitions||[]),origLayerDefs:n.mixin([],g.layerDefinitions||[])});return q},_resetMapServiceInfo:function(g){b.forEach(g.layerInfos,this._resetLayerInfo);
g.layerDefs=n.mixin([],g.origLayerDefs||[])},_resetMapServiceInfos:function(){var g=this._mapServiceInfos,e;for(e in g)g.hasOwnProperty(e)&&this._resetMapServiceInfo(g[e])},_createLayerInfo:function(g,e){var q=g.objectIdField,u=e?[]:g.getSelectedFeatures();return{layer:g,selectedFeatures:u||[],oids:b.map(u,function(r){return r.attributes[q]})}},_resetLayerInfo:function(g){g&&(g.selectedFeatures=[],g.oids=[])},_updateLayerDefs:function(g,e,q,u){for(var r in g)if(g.hasOwnProperty(r)){var x=g[r],t=x.mapService,
w=x.layerDefs=e?n.mixin([],x.origLayerDefs||[]):x.layerDefs;w?(q?u&&u():this._sConnects[t.id]=v.connect(t,"onUpdateEnd",n.hitch(this,"_onMapServiceUpdate",x,e,u)),t.setLayerDefinitions(w,q||!1)):u&&u()}},_onMapServiceUpdate:function(g,e,q){v.disconnect(this._sConnects[g.mapService.id]);b.forEach(g.layerInfos,function(u){if(e)u&&u.layer.clearSelection();else{var r=new l;r.objectIds=u?u.oids:[];r.objectIds.length&&u.layer.selectFeatures(r,h.SELECTION_SUBTRACT)}},this);e&&this._resetMapServiceInfo(g);
q&&q()},_createLayerDefs:function(g){b.forEach(g,function(e){var q=e.layer,u=this._createMapServiceInfo(this.findMapService(e.layer));if(u){u=u.layerDefs;var r=q.layerId,x='("'+q.objectIdField+'" NOT IN (',t=e.oids;t&&t.length&&(b.forEach(e.oids,function(w,z){t=!0;z&&(x+=",");x+="'"+w+"'"}),x+="))",u[r]=u.length&&u[r]&&u[r].length?u[r]+(" AND"+x):x)}},this)},_getLayerInfosFromFeatures:function(g){var e=[];b.forEach(g,function(u){var r=u.getLayer();r&&r._isSelOnly&&(e[r.id]||(e[r.id]=this._createLayerInfo(r,
!0)),e[r.id].selectedFeatures.push(u),e[r.id].oids.push(u.attributes[r.objectIdField]))},this);g=[];for(var q in e)e.hasOwnProperty(q)&&g.push(e[q]);return g},_getLayerInfosFromSelection:function(g){var e=[];b.forEach(g,function(q){q._isSelOnly&&e.push(this._createLayerInfo(q,!1))},this);return e},_extentFromPoint:function(g){var e=this._tolerance,q=this._map,u=q.toScreen(g);g=new c(u.x-e,u.y+e);e=new c(u.x+e,u.y-e);g=q.toMap(g);e=q.toMap(e);return new d(g.x,g.y,e.x,e.y,q.spatialReference)}});n.setObject("dijit.editing.SelectionHelper",
m,k);return m})},"esri/dijit/InfoWindow":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-style dijit/_Widget dijit/_Templated dijit/_Container ../kernel ../domUtils ../InfoWindowBase ./_EventedWidget dojo/text!./templates/InfoWindow.html".split(" "),function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x,t){var w=m([x,k,g,e,r],{declaredClass:"esri.dijit.InfoWindow",isContainer:!0,
templateString:t,anchor:"upperright",fixedAnchor:null,coords:null,isShowing:!0,isContentShowing:!0,isTitleBarShowing:!0,width:250,height:150,title:"Info Window",setMap:function(z){this.inherited(arguments);h.place(this.domNode,z.root)},startup:function(){if(!this._started){this.inherited(arguments);this._ANCHORS=[w.ANCHOR_UPPERRIGHT,w.ANCHOR_LOWERRIGHT,w.ANCHOR_LOWERLEFT,w.ANCHOR_UPPERLEFT];if(7>f("ie")){var z="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled\x3d'true', sizingMethod\x3d'crop', src\x3d'"+
l.getComputedStyle(this._sprite).backgroundImage.replace(/url\("/i,"").replace(/"\)/,"")+"')",B=h.create("div",null,b.body());l.set(B,{width:"1px",height:"1px",display:"none",backgroundImage:"none",filter:z});var A=setTimeout(function(){h.destroy(B);clearTimeout(A);A=B=null},100);p.query(".sprite",this.domNode).forEach(function(y){y.style.backgroundImage="none";y.style.filter=z})}this.resize(this.width,this.height);this.hide()}},destroy:function(){this._destroyed||(this.__unregisterMapListeners(),
this.destroyDijits(this._title),this.destroyDijits(this._content),this._title.innerHTML=this._content.innerHTML="",this.inherited(arguments))},resize:function(z,B){if(z&&B){var A=l.set;A(this._topleft,{height:B+"px",marginLeft:z+"px"});A(this._topright,{width:z+"px",height:B+"px"});A(this._user,"width",z-8+"px");A(this._hide,"marginLeft",z-22+"px");A(this._title,"width",z-25+"px");A(this._content,"height",B-37+"px");A(this._bottomleft,{marginLeft:z+"px",marginTop:B+"px"});A(this._bottomright,{width:z-
5+"px",marginTop:B+"px"});this.width=z;this.height=B;this.coords&&this._adjustPosition(this.coords,this.anchor);this.onResize(z,B)}},_adjustPosition:function(z,B){var A=l.set;A(this._infowindow,{left:Math.round(z.x)+"px",top:Math.round(z.y)+"px"});B===w.ANCHOR_UPPERLEFT?A(this._window,{left:null,right:this.width+18+"px",top:null,bottom:this.height+50+"px"}):B===w.ANCHOR_UPPERRIGHT?A(this._window,{left:"6px",right:null,top:null,bottom:this.height+50+"px"}):B===w.ANCHOR_LOWERRIGHT?A(this._window,{left:"6px",
right:null,top:"43px",bottom:null}):B===w.ANCHOR_LOWERLEFT&&A(this._window,{left:null,right:this.width+18+"px",top:"43px",bottom:null})},_getAnchor:function(z){var B=this.map;return B&&z?(z.y<B.height/2?"lower":"upper")+(z.x<B.width/2?"right":"left"):"upperright"},show:function(z,B,A){if(z){z.spatialReference?(this.mapCoords=z,z=this.coords=this.map.toScreen(z,!0)):(this.mapCoords=null,this.coords=z);var y=this.map._getFrameWidth();if(-1!==y&&(z.x%=y,0>z.x&&(z.x+=y),this.map.width>y))for(var E=(this.map.width-
y)/2;z.x<E;)z.x+=y;B&&-1!==v.indexOf(this._ANCHORS,B)||(B=this._getAnchor(z));c.remove(this._pointer,this.anchor);B=this.anchor=this.fixedAnchor||B;this._adjustPosition(z,B);c.add(this._pointer,B);u.show(this.domNode);this.isShowing=!0;if(!A)this.onShow()}},hide:function(z,B){u.hide(this.domNode);this.isShowing=!1;if(!B)this.onHide()},showTitleBar:function(){u.show(this._titlebar);u.show(this._border);this.isTitleBarShowing=!0},hideTitleBar:function(){u.hide(this._titlebar);u.hide(this._border);this.isTitleBarShowing=
!1},showContent:function(){u.show(this._content);u.show(this._border);this.isContentShowing=!0},hideContent:function(){u.hide(this._content);u.hide(this._border);this.isContentShowing=!1},move:function(z,B){B?z=this.coords.offset(z.x,z.y):(this.coords=z,this.mapCoords&&(this.mapCoords=this.map.toMap(z)));l.set(this._infowindow,{left:Math.round(z.x)+"px",top:Math.round(z.y)+"px"})},setFixedAnchor:function(z){z&&-1===v.indexOf(this._ANCHORS,z)||(this.fixedAnchor=z,this.isShowing&&this.show(this.mapCoords||
this.coords,z),this.onAnchorChange(z))},setTitle:function(z){this.destroyDijits(this._title);this.__setValue("_title",z);return this},setContent:function(z){this.destroyDijits(this._content);this.__setValue("_content",z);return this},onShow:function(){this.__registerMapListeners();this.startupDijits(this._title);this.startupDijits(this._content)},onHide:function(){this.__unregisterMapListeners()},onResize:function(){},onAnchorChange:function(){}});n.mixin(w,{ANCHOR_UPPERRIGHT:"upperright",ANCHOR_LOWERRIGHT:"lowerright",
ANCHOR_LOWERLEFT:"lowerleft",ANCHOR_UPPERLEFT:"upperleft"});n.setObject("dijit.InfoWindow",w,q);return w})},"esri/dijit/OverviewMap":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/html dojo/has dojo/dom-class dojo/dom-style dojo/dnd/Moveable dijit/_Widget dijit/_Templated ../map ../geometry/Point ../geometry/ScreenPoint ../layers/TiledMapServiceLayer ../layers/DynamicMapServiceLayer ../layers/VectorTileLayer ../layers/ArcGISTiledMapServiceLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/ArcGISImageServiceLayer ../layers/RasterXLayer ../layers/OpenStreetMapLayer ../virtualearth/VETiledLayer ../kernel ../config ../domUtils dojo/text!./templates/OverviewMap.html dojo/i18n!../nls/jsapi".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x,t,w,z,B,A,y,E,G,F){m=m([c,h],{declaredClass:"esri.dijit.OverviewMap",widgetsInTemplate:!0,templateString:G,constructor:function(D,L){n.mixin(this,F.widgets.overviewMap);D=D||{};if(D.map){var O={};L&&(this._detached=!0,O=b.coords(L,!0));this.map=D.map;this.baseLayer=D.baseLayer;this.width=D.width||O.w||this.map.width/4;this.height=D.height||O.h||this.map.height/4;this.attachTo=D.attachTo||"top-right";this.expandFactor=D.expandFactor||2;this.color=D.color||
"#000000";this.opacity=D.opacity||.5;this.maximizeButton=!!D.maximizeButton;this.visible=!!D.visible;if(this.map.loaded)this._initialSetup();else var S=v.connect(this.map,"onLoad",this,function(){v.disconnect(S);S=null;this._initialSetup()});this._detached&&(this.visible=!0);this._maximized=!1}},startup:function(){this.inherited(arguments);(!this.domNode.parentNode||9>p("ie")&&"DIV"!==this.domNode.parentNode.nodeName)&&this.map.container.appendChild(this.domNode);this._detached?(d.set(this._body,
"display","block"),d.set(this._controllerDiv,"display","none"),d.set(this._maximizerDiv,"display","none"),this.map.loaded?this._initialize():v.connect(this.map,"onLoad",this,this._initialize)):("bottom"===this.attachTo.split("-")[0]&&this.domNode.insertBefore(this._maximizerDiv,this._controllerDiv),this.maximizeButton||f.add(this._maximizerDiv,"ovwDisabledButton"),f.add(this.domNode,{"top-left":"ovwTL","top-right":"ovwTR","bottom-left":"ovwBL","bottom-right":"ovwBR"}[this.attachTo]),f.add(this._controllerDiv,
"ovwShow"),f.add(this._maximizerDiv,"ovwMaximize"),this.visible&&this.map.loaded&&(this.visible=!1,this.show()));d.set(this._focusDiv,"opacity",this.opacity)},destroy:function(){this._deactivate();this.overviewMap&&this.overviewMap.destroy();this.overviewMap=this.baseLayer=null;this.inherited(arguments)},resize:function(D){!D||0>=D.w||0>=D.h||this._resize(D.w,D.h)},show:function(){if(!this.visible){var D=this._controllerDiv;D.title=this.NLS_hide;f.remove(D,"ovwShow");f.add(D,"ovwHide");E.show(this._body);
E.show(this._maximizerDiv);this._initialize();this.visible=!0}},hide:function(){if(this.visible){var D=this._controllerDiv;D.title=this.NLS_show;f.remove(D,"ovwHide");f.add(D,"ovwShow");this._maximized&&this._maximizeHandler();E.hide(this._body);E.hide(this._maximizerDiv);this._deactivate();this.visible=!1}},_initialSetup:function(){if(this._mainMapLayer=this.map.getLayer(this.map.layerIds[0])){var D=this.baseLayer||this._mainMapLayer,L=this.map.spatialReference,O=D.spatialReference;if(O.wkid===L.wkid||
O.wkt===L.wkt){L=D.declaredClass;if(D instanceof e)if(-1!==L.indexOf("VETiledLayer"))this.baseLayer=new B({resourceInfo:D.getResourceInfo(),culture:D.culture,mapStyle:D.mapStyle,bingMapsKey:D.bingMapsKey});else if(-1!==L.indexOf("OpenStreetMapLayer"))this.baseLayer=new z({tileServers:D.tileServers});else if(-1!==L.indexOf("WebTiledLayer")){L=D.initialExtent;O=D.fullExtent;var S=D.tileInfo;this.baseLayer=new D.constructor(D.urlTemplate,{initialExtent:L&&new L.constructor(L.toJson()),fullExtent:O&&
new O.constructor(O.toJson()),tileInfo:S&&new S.constructor(S.toJson()),tileServers:D.tileServers&&D.tileServers.slice(0)})}else this.baseLayer=new r(D.url,{resourceInfo:D.getResourceInfo()});else if(D instanceof q)-1!==L.indexOf("ArcGISImageServiceLayer")?this.baseLayer=new t(D.url):(this.baseLayer=new x(D.url),this.baseLayer.setImageFormat("png24"));else if(D instanceof w)this.baseLayer=new w(D.url);else if(D instanceof u)this.baseLayer=new r("https://services.arcgisonline.com/arcgis/rest/services/World_Street_Map/MapServer",
{});else return;!this._detached&&this.visible&&this._controllerDiv&&(D=function(){this.visible=!1;this.show()},this.baseLayer.loaded?D.call(this):v.connect(this.baseLayer,"onLoad",this,D))}}},_visibilityHandler:function(){this.visible?this.hide():this.show()},_maximizeHandler:function(){var D=this._maximizerDiv;this._maximized?(D.title=this.NLS_maximize,f.remove(D,"ovwRestore"),f.add(D,"ovwMaximize"),this._resize(this.width,this.height)):(D.title=this.NLS_restore,f.remove(D,"ovwMaximize"),f.add(D,
"ovwRestore"),this._resize(this.map.width,this.map.height));this._maximized=!this._maximized},_resize:function(D,L){d.set(this._body,{width:D+"px",height:L+"px"});var O=y.defaults.map.panDuration,S=this.overviewMap;y.defaults.map.panDuration=0;S&&(S.resize(!0),S.centerAt(this._focusExtent.getCenter()));y.defaults.map.panDuration=O},_initialize:function(){if(this.overviewMap)this._activate();else{var D;var L=9>p("ie")?this._body.firstChild:this._body.firstElementChild;this.overviewMap=D=new l(L,{slider:!1,
showAttribution:!1,logo:!1,lods:this._overviewLods,wrapAround180:this.map.wrapAround180});v.connect(D,"onLoad",this,function(){this._map_resize_override=n.hitch(D,this._map_resize_override);D.disableMapNavigation();this._activate()});D.addLayer(this.baseLayer)}},_activate:function(){var D=this.map,L=this.overviewMap;this._moveableHandle=new a(this._focusDiv);this._soeConnect=v.connect(D,"onExtentChange",this,this._syncOverviewMap);this._ufoConnect=v.connect(D,"onPan",this,this._updateFocus);this._oecConnect=
v.connect(L,"onExtentChange",this,this._ovwExtentChangeHandler);this._opaConnect=v.connect(L,"onPan",this,this._ovwPanHandler);this._ozsConnect=v.connect(L,"onZoomStart",this,function(){E.hide(this._focusDiv)});this._ozeConnect=v.connect(L,"onZoomEnd",this,function(){E.show(this._focusDiv)});this._omsConnect=v.connect(this._moveableHandle,"onMoveStop",this,this._moveStopHandler);this._syncOverviewMap(D.extent,null,null,null)},_deactivate:function(){v.disconnect(this._soeConnect);v.disconnect(this._ufoConnect);
v.disconnect(this._oecConnect);v.disconnect(this._opaConnect);v.disconnect(this._ozsConnect);v.disconnect(this._ozeConnect);v.disconnect(this._omsConnect);this._moveableHandle&&(this._moveableHandle.destroy(),this._moveableHandle=null)},_syncOverviewMap:function(D,L,O,S){this._suspendPanHandling?this._suspendPanHandling=!1:(this._focusExtent=D,this.overviewMap.setExtent(D.expand(this.expandFactor),!0))},_updateFocus:function(D){this._suspendPanHandling||(this._focusExtent=D,this._drawFocusDiv(D))},
_drawFocusDiv:function(D,L){var O=this.overviewMap,S=O.toScreen(new k(D.xmin,D.ymax,O.spatialReference)),Z=O.toScreen(new k(D.xmax,D.ymin,O.spatialReference));O=Z.x-S.x;Z=Z.y-S.y;var I=!0;O>this.overviewMap.width&&Z>this.overviewMap.height&&(I=!1);d.set(this._focusDiv,{left:S.x+(L?L.x:0)+"px",top:S.y+(L?L.y:0)+"px",width:O+"px",height:Z+"px",display:I?"block":"none"})},_moveStopHandler:function(D){var L=this._moveableHandle.node.style;D=this._focusExtent;var O=this.overviewMap;L=O.toMap(new g(parseInt(L.left,
10),parseInt(L.top,10)));var S=new k(D.xmin,D.ymax,O.spatialReference);this._focusExtent=D.offset(L.x-S.x,L.y-S.y);this._maximized?this._maximizeHandler():O.centerAt(this._focusExtent.getCenter());this._suspendPanHandling=!0;this.map.setExtent(this._focusExtent)},_ovwExtentChangeHandler:function(){this._drawFocusDiv(this._focusExtent)},_ovwPanHandler:function(D,L){this._drawFocusDiv(this._focusExtent,L)}});n.setObject("dijit.OverviewMap",m,A);return m})},"esri/layers/VectorTileLayer":function(){(function(){var m=
function(){try{var v=window.WebGLRenderingContext}catch(c){v=!1}try{for(var b=document.createElement("canvas"),p=["webgl","experimental-webgl","webkit-3d","moz-webgl"],f=null,d=0;d<p.length;++d){try{f=b.getContext(p[d])}catch(c){}if(f)break}var a=f}catch(c){a=!1}return v&&a?!0:!1}(),n=["dojo/_base/lang","dojo/has","dojo/Deferred","../sniff","./layer"];m&&n.push("./VectorTileLayerImpl");define(n,function(v,b,p,f,d,a){b=a?a:d.createSubclass({declaredClass:"esri.layers.VectorTileLayer",constructor:function(){var c=
new p;c.reject(Error("esri.layers.VectorTileLayer is not supported"));c.promise.otherwise(v.hitch(this,function(h){this._errorHandler(h)}))}});b.ACCESS_TOKEN=null;b.supported=function(){return m};v.setObject("layers.VectorTileLayer",b,f);return b})})()},"esri/layers/rasterLib/raster/rasterFactory":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/sniff dojo/when ../../../kernel ../../../Evented ../../../request ../../../deferredUtils ../../../urlUtils ./ImageServiceRaster ./TileServiceRaster ./TileRaster ./FunctionRaster".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r){m={customDrivers:[],create:function(x){if(x){if(x.url){var t=g.urlToObject(x.url);var w=t.path;var z=t.query}t=x.serviceInfo;var B=x.rasterFxArgs||{},A=new b,y=v.hitch(this,function(D){this._trycustomDrivers(v.mixin({url:w},x),0,A)});if(w)if(-1===w.toLowerCase().indexOf("imageserver")&&-1===w.toLowerCase().indexOf("mapserver")){var E=new u(v.mixin({},x,{url:w}));x.rasterFx&&(E=new r({rasterFx:x.rasterFx,rasterFxArgs:v.mixin({},B,{raster:E})}));var G=E}else{G=
new b;t=t||this._getServiceInfo(w,z);var F=v.hitch(this,function(D){D.bandCount?E=D.capabilities&&-1<D.capabilities.toLowerCase().indexOf("tileonly")?new q(v.mixin({},{serviceInfo:D},z,x,{url:w})):new e(v.mixin({},{serviceInfo:D},z,x,{url:w})):D.tileInfo&&(E=new q(v.mixin({},{serviceInfo:D},z,this._options,{url:w})));x.rasterFx&&(E=new r({rasterFx:x.rasterFx,rasterFxArgs:v.mixin({},B,{raster:E})}));G.resolve(E)});a(t,F,y)}else G=E=new r({rasterFx:x.rasterFx,rasterFxArgs:v.mixin({},B,{raster:E})});
a(G,v.hitch(this,function(D){D?D.open().then(v.hitch(this,function(L){A.resolve(D)}),y):y(Error("There is no raster to open"))}),y);return A.promise}},register:function(x){this.customDrivers=this.customDrivers||[];0<this.customDrivers.filter(function(t){return t.sourceType===x.prototype.sourceType}).length||this.customDrivers.push(x)},_trycustomDrivers:function(x,t,w){w=w||new b;var z=this.customDrivers[t];if(z){var B=new z(x);B.open().then(v.hitch(this,function(A){w.resolve(B)}),v.hitch(this,function(A){this._trycustomDrivers(x,
t+1,w)}))}else w.reject("cannot load layer "+(x&&x.url||""));return w.promise},_getServiceInfo:function(x,t){t=t||{};var w=t.bandIds,z=t.renderingRule,B=new b(k._dfdCanceller),A={f:"json"};w&&(A.bandIds=w);z&&(A.renderingRule=z.toJson?JSON.stringify(z.toJson()):JSON.stringify(z));B._pendingDfd=l({url:x,content:A,handleAs:"json",callbackParamName:"callback"});B._pendingDfd.then(function(y){B.callback(y)},function(y){B.errback(y)});return B.promise}};v.setObject("layers.rasterLib.raster.rasterFactory",
m,c);return m})},"esri/layers/rasterLib/raster/ImageServiceRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../WKIDUnitConversion ../../../deferredUtils ../../../urlUtils ../../MosaicRule ../../ImageServiceParameters ../../PixelBlock ./RasterInfo ./BasicRaster ../../rasterFormats/rasterCodec ../tile/RasterTileInfo".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x,t,w,z,B,A,y,E,G){m=n([y],{declaredClass:"esri.layers.rasterLib.raster.ImageServiceRaster",sourceType:"ImageService",constructor:function(F){F&&(this._imageServiceParams=F.imageServiceParameters,this._commonReqParams=F._commonReqParams,this._imageServiceParams||(this._imageServiceParams={interpolation:F.interpolation,pixelType:F.pixelType,format:F.format||"lerc",compressionQuality:F.compressionQuality,bandIds:F.bandIds,noDataInterpretation:F.noDataInterpretation,
adjustAspectRatio:F.adjustAspectRatio,mosaicRule:F.mosaicRule,renderingRule:F.interpolation}))},open:function(){var F=new b;if(this.serviceInfo&&this.rasterInfo)return this.loaded=!0,this._findCredential(),this.setFetchParameters(this._imageServiceParams),F.resolve(this),F.promise;var D=this.serviceInfo||this._generateServiceInfo(this._imageServiceParams&&this._imageServiceParams.renderingRule),L=v.hitch(this,function(S){this._fixServiceInfo(S);this.serviceInfo=S;this._findCredential();var Z=this._parseRasterInfo(S),
I={};S.defaultMosaicMethod?(I.method=S.defaultMosaicMethod,I.operation=S.mosaicOperator,I.sortField=S.sortField,I.sortValue=S.sortValue):I.method=w.METHOD_NONE;this.serviceInfo.defaultMosaicRule=new w(I);this.serviceInfo.defaultMosaicRule.ascending=!0;S=this._getColormap(this);I=this._getHistograms(this);var N=this._getRasterAttributeTable(this),K=this._getKeyProperties(this),Q=this._getMultidimensionalInfo(),da=this._getSlices();(new c([S,I,N,K,Q,da])).then(v.hitch(this,function(U){U[0][0]&&(Z.colormap=
U[0][1]);U[1][0]&&(Z.histograms=U[1][1]);U[2][0]&&(Z.vat=U[2][1]);U[3][0]&&(Z.keyProperties=U[3][1]);U[4][0]&&(Z.multidimensionalInfo=U[4][1]);this._slices=U[5][0]?U[5][1]:null;Z.keyProperties&&Z.keyProperties.DataType&&(this.dataType=Z.keyProperties.DataType);this.loaded=!0;this.rasterInfo=Z;this.setFetchParameters(this._imageServiceParams);F.resolve(this)}))}),O=v.hitch(this,function(S){this.loaded=!0;F.reject(S)});h(D,L,O);return F.promise},setFetchParameters:function(F,D){if(D)this.imageServiceParams=
F;else{var L=this.imageServiceParams;L&&F?Object.keys(F).forEach(function(O){L[O]=F[O]}):this.imageServiceParams=F}this._constructGetImageParams();this._getRasterIdentifier(!0)},read:function(F){if(F.pixelBlock||F.texture){var D=new b;D.resolve(F);return D.promise}if(!1===F.virtual&&this.tileInfo&&!this.tileInfo.virtual)return this.readTile(F);if(this._slices){var L=this._getSliceId();if(null==L)return D=new b,D.resolve(F),D.promise}var O=F.extent,S=O.spatialReference.wkid||d.toJson(O.spatialReference.toJson(!1)),
Z=F.timeExtent?F.timeExtent.toJson().join(","):null;D=this.url+"/exportImage";var I={};this._slices&&(I.sliceid=L);this.disableClientCaching&&(I._ts=(new Date).getTime());L=v.mixin({},this._commonReqParams,{bbox:O.xmin+","+O.ymin+","+O.xmax+","+O.ymax,imageSR:S,bboxSR:S,size:F.width+","+F.height,time:Z},I);return this._requestPixels({url:D,payload:L,decodeParams:{width:F.width,height:F.height,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:!1},tileOptions:F})},readTile:function(F){var D=
this.tileBoundary&&this.tileBoundary[F.level];if(D&&(D.minRow>F.row||D.maxRow<F.row||D.minCol>F.col||D.maxCol<F.col)){var L=new b;L.resolve(F);return L.promise}if(this._slices&&(L=this._getSliceId(),null==L))return L=new b,L.resolve(F),L.promise;D=this.url+"/tile/"+F.level+"/"+F.row+"/"+F.col;var O={width:this.tileInfo.cols,height:this.tileInfo.rows,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:"elevation"===F.tileType.toLowerCase()?!0:!1};L=this._slices?"sliceid\x3d"+L+"\x26":"";
L=this.disableClientCaching?"_ts\x3d "+(new Date).getTime():L.replace(/&$/,"");return this._requestPixels({url:D+(0<L.length?"?"+L:""),payload:{},decodeParams:O,tileOptions:F})},toJson:function(){return{url:this.url,tileInfo:this.tileInfo,rasterInfo:this.rasterInfo,serviceInfo:this.serviceInfo,sourceType:this.sourceType,_commonReqParams:this._commonReqParams,_rasterId:this._rasterId}},_getSliceId:function(){var F=v.clone(this._imageServiceParams.multidimensionalDefinition),D=v.clone(this._imageServiceParams.time);
if(null==this._slices||null==D&&(null==F||0===F.length))return 0;var L=F||this.defaultMultidimensionalDefinition,O=L[0].variableName;L=this._getAllDimensionDefinition(L,O).definition;F=null;if(null==L||0===L.length)return null;if(D&&this.serviceInfo.timeInfo){if(null==D[1]||D[1]===D[0])var S=D[0];else{var Z=this.serviceInfo.timeInfo.startTimeField;S=this.rasterInfo.multidimensionalInfo.variables.find(function(K){return K.name===O}).dimensions.find(function(K){return K.name===Z}).values.filter(function(K){return Array.isArray(K)?
Math.max(K[0],D[0])<Math.min(K[1],D[1]):K>=D[0]&&K<=D[1]}).sort(function(K,Q){K=Array.isArray(K)?K[1]:K;Q=Array.isArray(Q)?K[1]:Q;return Math.abs(D[1]-K)-Math.abs(D[1]-Q)})[0]||[D[1]]}L.some(function(K){if(K.dimensionName===Z)return K.values[0]=S,!0;if(!K.dimensionName)return K.dimensionName=Z,K.isSlice=!0,K.values=[S],!0})||L.push({variableName:O,dimensionName:Z,isSlice:!0,values:[S]})}for(var I=0;I<this._slices.length;I++){var N=this._slices[I].multidimensionalDefinition;if(N.length===L.length&&
!N.some(function(K){var Q=L.filter(function(U){return K.variableName===U.variableName&&U.dimensionName===K.dimensionName})[0];if(!Q)return!0;var da=Array.isArray(K.values[0])?K.values[0][0]:K.values[0];Q=Array.isArray(Q.values[0])?Q.values[0][0]:Q.values[0];return da!==Q})){F=I;break}}return F},_getAllDimensionDefinition:function(F,D){var L=F.map(function(S){return S.dimensionName}),O=!1;this.rasterInfo.multidimensionalInfo.variables.forEach(function(S){S.name!==D||S.dimensions.length===F.length&&
L[0]||(S.dimensions.forEach(function(Z){0>L.indexOf(Z.name)&&(L[0]?F.push({variableName:D,dimensionName:Z.name,values:[Z.values[0]]}):(F[0].dimensionName=Z.name,F[0].values=[Z.values[0]],Z[0]=Z.name))}),O=!0)},this);return{defChanged:O,definition:F}},_generateServiceInfo:function(F){var D=this.url,L=new b(x._dfdCanceller);L._pendingDfd=g({url:D,content:{f:"json",renderingRule:F?d.toJson(F.toJson()):null},handleAs:"json",callbackParamName:"callback"});L._pendingDfd.then(function(O){L.callback(O)},
function(O){L.errback(O)});return L},_fixServiceInfo:function(F){var D=F.spatialReference.wkid;F.tileInfo&&0===F.extent.xmin&&360===F.extent.xmax&&D&&null==r[D]&&(F.tileInfo.applyGCS360Transform=!0)},_parseRasterInfo:function(F){var D=new A;D.bandCount=F.bandCount;D.extent=new e(F.fullExtent);D.spatialReference=F.spatialReference;D.pixelType=F.pixelType;D.width=Math.floor((F.fullExtent.xmax-F.fullExtent.xmin)/F.pixelSizeX+.5);D.height=Math.floor((F.fullExtent.ymax-F.fullExtent.ymin)/F.pixelSizeY+
.5);D.cellSize=new q({x:F.pixelSizeX,y:F.pixelSizeY,spatialReference:F.spatialReference});var L;if(F.minValues&&0<F.minValues.length&&F.maxValues&&F.stdvValues&&F.meanValues){var O=[];for(L=0;L<F.minValues.length;L++)O.push({min:F.minValues[L],max:F.maxValues[L],mean:F.meanValues[L],stddev:F.stdvValues[L]});F.bandCount!==O.length&&(O=null)}this.dataType=F.serviceDataType?F.serviceDataType.replace("esriImageServiceDataType",""):"Generic";D.statistics=O;F.objectIdField&&F.fields&&(D.catalogInfo={objectIdField:F.objectIdField,
fields:F.fields});D.timeInfo=F.timeInfo;if(F.tileInfo){this.tileInfo=new G(F.tileInfo);this.tileInfo.tileType=F.cacheType||"Map";D.tileInfo=this.tileInfo;var S=D.extent,Z=this.tileInfo.origin,I=this.tileInfo.cols,N=this.tileInfo.rows;this.tileBoundary=this.tileInfo.lods.map(function(K){return{minCol:Math.floor((S.xmin-Z.x+.1*K.resolution)/I/K.resolution),maxCol:Math.floor((S.xmax-Z.x-.1*K.resolution)/I/K.resolution),minRow:Math.floor((Z.y-S.ymax+.1*K.resolution)/N/K.resolution),maxRow:Math.floor((Z.y-
S.ymin-.1*K.resolution)/N/K.resolution)}})}return D},_getColormap:function(F){F=this.url+"/colormap";var D=new b(x._dfdCanceller),L={f:"json"},O=this.serviceInfo.hasColormap||this.rasterInfo&&this.rasterInfo.hasColormap;10<this.serviceInfo.currentVersion&&O?(D._pendingDfd=g({url:F,content:L,handleAs:"json",callbackParamName:"callback"}),D._pendingDfd.then(function(S){D.callback(S.colormap)},function(S){D.errback(S)})):D.callback(null);return D},_getHistograms:function(F){var D=this.url+"/histograms",
L=new b(x._dfdCanceller),O={f:"json"},S=this.serviceInfo.hasHistograms||this.rasterInfo&&this.rasterInfo.hasHistograms;F&&F.renderingRule&&(O.renderingRule=d.toJson(F.renderingRule.toJson()),S=!0);10<this.serviceInfo.currentVersion&&S?(L._pendingDfd=g({url:D,content:O,handleAs:"json",callbackParamName:"callback"}),L._pendingDfd.then(function(Z){L.callback(Z.histograms)},function(Z){L.errback(Z)})):L.callback(null);return L},_getRasterAttributeTable:function(F){var D=this.url+"/rasterAttributeTable",
L=new b(x._dfdCanceller),O={f:"json"},S=this.serviceInfo.hasRasterAttributeTable;F&&F.renderingRule&&(O.renderingRule=d.toJson(F.renderingRule.toJson()),S=!0);10<this.serviceInfo.currentVersion&&S?(L._pendingDfd=g({url:D,content:O,handleAs:"json",callbackParamName:"callback"}),L._pendingDfd.then(function(Z){L.callback(Z)},function(Z){L.errback(Z)})):L.callback(null);return L},_getKeyProperties:function(F){var D=this.url+"/keyProperties",L=new b(x._dfdCanceller),O={f:"json"};F&&F.renderingRule&&(O.renderingRule=
d.toJson(F.renderingRule.toJson()));10<this.serviceInfo.currentVersion?(L._pendingDfd=g({url:D,content:O,handleAs:"json",callbackParamName:"callback"}),L._pendingDfd.then(function(S){L.callback(S)},function(S){L.errback(S)})):L.callback(null);return L},_getMultidimensionalInfo:function(){var F=this.url+"/multidimensionalInfo",D=new b(x._dfdCanceller);10.3<=this.serviceInfo.currentVersion&&this.serviceInfo.hasMultidimensions?(D._pendingDfd=g({url:F,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),
D._pendingDfd.then(v.hitch(this,function(L){D.callback(L.multidimensionalInfo)}),function(L){D.errback(L)})):D.callback(null);return D},_getSlices:function(){var F=this.url+"/slices",D=new b(x._dfdCanceller);this.serviceInfo.hasMultidimensions?(D._pendingDfd=g({url:F,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),D._pendingDfd.then(v.hitch(this,function(L){D.callback(L.slices)}),function(L){D.errback(L)})):D.callback(null);return D},_initializationFailed:function(){},_constructGetImageParams:function(){var F=
this.imageServiceParams||{},D=v.mixin({},this._query,{f:"image",interpolation:F.interpolation,pixelType:F.pixelType,format:F.format||"lerc",compressionQuality:F.compressionQuality,bandIds:F.bandIds?F.bandIds.join(","):null,noData:null!=F.noData?F.noData.join(","):null,noDataInterpretation:F.noDataInterpretation,adjustAspectRatio:null==F.adjustAspectRatio?null:F.adjustAspectRatio,mosaicRule:F.mosaicRule?d.toJson(F.mosaicRule.toJson()):null,renderingRule:F.renderingRule?d.toJson(F.renderingRule.toJson()):
null,token:this.credential&&this.credential.token||null});"lerc"===D.format.toLowerCase()?(D.compressionTolerance=F.compressionTolerance,10.5<=this.serviceInfo.currentVersion&&(D.lercVersion=F.lercVersion||2)):"tiff"===D.format.toLowerCase()?D.compression=F.compression:-1<["jpg","jpeg","jpg","jpgpng"].indexOf(D.format.toLowerCase())&&(D.compression=F.compression);this._commonReqParams=D},_getRasterIdentifier:function(F){if(this._rasterId)return this._rasterId;F=this.url.replace("http:","").replace("https:",
"");var D=[],L=this.imageServiceParams||{};D.push(F);D.push(L.interpolation);D.push(L.pixelType);D.push(L.compressionQuality);D.push(L.bandIds?L.bandIds.join(","):"");D.push(L.mosaicRule?d.toJson(L.mosaicRule.toJson()):"");D.push(L.renderingRule?d.toJson(L.renderingRule.toJson()):"");F=D.join("|");return this._rasterId=this._computeSignature(F)},_wrapExtent:function(F){var D=F.spatialReference._getInfo();if(D){var L=D.valid[0];D=D.valid[1];if(F.xmin<L-this.resolution.x||F.xmax>D+this.resolution.y){var O=
new e((F.xmin-L)%(D-L),F.ymin,(F.xmax-D)%(D-L),F.ymax,F.spatialReference);O.xmax<O.xmin&&(O=null)}}return O||F}});v.setObject("layers.rasterLib.raster.ImageServiceRaster",m,l);return m})},"esri/layers/rasterLib/raster/RasterInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","../../../geometry/Extent","../../../SpatialReference","../tile/RasterTileInfo"],function(m,n,v,b,p){return m(null,{declaredClass:"esri.layers.rasterLib.raster.RasterInfo",bandCount:null,pixelType:null,extent:null,
spatialReference:null,width:null,height:null,colormap:null,attributeTable:null,multiDimensionalInfo:null,statistics:null,histograms:null,catalogInfo:null,keyProperties:null,cellSize:null,format:null,compression:null,compressionQuality:null,packetSize:null,geodataXform:null,constructor:function(f){n.mixin(this,f);this.extent=this.extent?this.extent.toJson?this.extent:new v(this.extent):null;this.spatialReference=this.spatialReference?this.spatialReference.toJson?this.spatialReference:new b(this.spatialReference):
null;this.tileInfo=this.tileInfo?this.tileInfo.toJson?this.tileInfo:new p(this.tileInfo):null},toJson:function(){return{bandCount:this.bandCount,pixelType:this.pixelType,extent:this.extent&&this.extent.toJson?this.extent.toJson():this.extent,spatialReference:this.spatialReference&&this.spatialReference.toJson?this.spatialReference.toJson():this.spatialReference,width:this.width,height:this.height,colormap:this.colormap?n.clone(this.colormap):null,attributeTable:this.attributeTable?n.clone(this.attributeTable):
null,multiDimensionalInfo:this.multiDimensionalInfo?n.clone(this.multiDimensionalInfo):null,statistics:this.statistics?n.clone(this.statistics):null,histograms:this.histograms?n.clone(this.histograms):null,catalogInfo:this.catalogInfo?n.clone(this.catalogInfo):null,keyProperties:this.keyProperties?n.clone(this.keyProperties):null,cellSize:this.cellSize&&this.cellSize.toJson?this.cellSize.toJson():this.cellSize,tileInfo:this.tileInfo&&this.tileInfo.toJson?this.tileInfo.toJson():this.tileInfo,format:this.format,
compression:this.compression,compressionQuality:this.compressionQuality,packetSize:this.packetSize,geodataXform:this.geodataXform?n.clone(this.geodataXform):null}},clone:function(){return new this.constructor(this.toJson())}})})},"esri/layers/rasterLib/tile/RasterTileInfo":function(){define("dojo/_base/declare dojo/_base/lang ../../../geometry/Extent ../../../SpatialReference ../../../geometry/Point ../../../lang ../../TileInfo".split(" "),function(m,n,v,b,p,f,d){return m([d],{declaredClass:"esri.layers.rasterLib.tile.RasterTileInfo",
rows:512,cols:512,compressionQuality:95,lercError:.01,spatialReference:null,origin:null,virtual:!0,tileType:"Raster",constructor:function(a,c){if(a||c){var h=c&&c.refTileInfo;a?this.virtual=!1:(this.virtual=!0,n.mixin(this,{rows:c.rows||this.rows,cols:c.cols||this.cols,compressionQuality:c.compressionQuality||95,lercError:c.compressionTolerance||.01,spatialReference:c.spatialReference,origin:c.origin}),this.width=this.cols,this.height=this.rows,this.origin||(h?this.origin=h.origin:c.spatialReference.isWebMercator()||
c.extent&&360<=Math.max(Math.abs(c.extent.xmin),Math.abs(c.extent.xmax))?this.origin={x:-2.0037508342787E7,y:2.0037508342787E7}:-1<[4326,4269].indexOf(c.spatialReference.wkid)||360>Math.max(Math.abs(c.extent.xmin),Math.abs(c.extent.xmax))?this.origin={x:-180,y:90}:this.origin={x:c.extent.xmin,y:c.extent.ymax}))}},toJson:function(){var a=d.prototype.toJson.apply(this);a.tileType=this.tileType;a.virtual=this.virtual;a.lercError=this.lercError;return a},clone:function(){return new this.prototype(this.toJson())}})})},
"esri/layers/rasterLib/raster/BasicRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../MosaicRule ../../ImageServiceParameters ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterHandler ./rasterProjectionHelper ./RasterInfo".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x,t,w,z,B,A,y,E){return n([k],{url:null,dataType:null,rasterInfo:null,tileInfo:null,serviceInfo:null,loaded:null,constructor:function(G){if(G){var F=G.url;F&&(F=x.urlToObject(F),this.url=F.path,this._query=F.query);this.dataType=G.dataType;this.serviceInfo=G.serviceInfo;this.rasterInfo=G.rasterInfo;this.tileInfo=G.tileInfo;this.serviceInfo=G.serviceInfo}},open:function(){},read:function(G){},identify:function(G){var F=new b,D=this.rasterInfo.extent;if(y.requirePE(D.spatialReference,
G.spatialReference))y.load().then(v.hitch(this,function(){L=y.project(G,D.spatialReference);F.resolve(L)}),function(){F.reject(Error("cannot project into this spatial reference"))});else{var L=y.project(G,D.spatialReference);F.resolve(L)}return F.then(v.hitch(this,function(O){var S=this.tileInfo,Z=S.origin,I=S.lods[S.lods.length-1],N=(O.x-Z.x)/S.cols/I.resolution;O=(Z.y-O.y)/S.rows/I.resolution;var K=Math.round((O-Math.floor(O))*S.rows)*S.cols+Math.round((N-Math.floor(N))*S.cols);Z=new e(Z.x+I.resolution*
S.cols*N,Z.y-I.resolution*S.rows*(O+1),Z.x+I.resolution*S.cols*(N+1),Z.y-I.resolution*S.rows*O,D.spatialReference);var Q=this.getMemberRasters?this.getMemberRasters()[0]:this;return Q.read({level:I.level,row:Math.floor(O),col:Math.floor(N),extent:Z,width:S.cols,height:S.rows,virtual:Q.tileInfo.virtual,tileType:Q.tileInfo.tileType}).then(function(da){return(da=da&&da.pixelBlock)&&da.pixels&&0<da.pixels.length&&(!da.mask||da.mask[K])?{pixelValue:da.pixels.map(function(U){return U[K]})}:{pixelValue:null}})}))},
getProjectedFullExtent:function(G,F){var D=new b;if(this.projectedFullExtent&&!F)return D.resolve(this.projectedFullExtent),D.promise;var L=this.rasterInfo.extent;if(y.requirePE(this.rasterInfo.extent.spatialReference,G))y.load().then(v.hitch(this,function(){O=y.project(L,G);this.projectedFullExtent=O=new e(O.toJson());D.resolve(O)}),function(){D.reject(Error("cannot project into this spatial reference"))});else{var O=y.project(L,G);this.projectedFullExtent=O=new e(O.toJson());D.resolve(O)}return D.promise},
setFetchParameters:function(G,F){},_setRasterHandler:function(G){this._rasterHandler=G;this.getMemberRasters&&this.getMemberRasters().forEach(v.hitch(this,function(F){F._rasterHandler=G}))},_findCredential:function(){this.url&&((this._credential=l.id&&l.id.findCredential(this.url))&&this._credential.ssl||this.serviceInfo&&this.serviceInfo._ssl)&&(this.url=this.url.replace(/^http:/i,"https:"))},_initWorker:function(){this._rasterHandler=new A;this._rasterHandler.start().then(function(){this._rasterHandlerInitialized=
!0}.bind(this))},_requestPixels:function(G){var F=G.url,D=G.payload,L=G.decodeParams,O=G.tileOptions,S=new b(r._dfdCanceller);this._rasterHandler||this._initWorker();var Z=this._rasterHandler,I={};F={url:F,handleAs:"arraybuffer",content:D};G.headers&&(F.headers=G.headers);S._pendingDfd=g(F).then(v.hitch(this,function(N){(Z&&this._rasterHandlerInitialized?Z.decode({encodedData:N,decodeParams:L}):B.decode(N,L)).then(function(K){I.pixelBlock=new z(K);I.extent=O.extent;I.level=O.level;I.row=O.row;I.col=
O.col;I.width=O.width;I.height=O.height;r._resDfd(S,[I])},function(K){r._resDfd(S,[K],!0)})}),function(N){r._resDfd(S,[N],!0)});return S},_computeSignature:function(G){if("string"===typeof G){for(var F=new Uint8Array(G.length),D=0;D<G.length;D++)F[D]=G.charCodeAt(D);G=F}D=F=65535;for(var L=G.length,O=Math.floor(L/2),S=0;O;){var Z=359<=O?359:O;O-=Z;do F+=G[S++]<<8,D+=F+=G[S++];while(--Z);F=(F&65535)+(F>>>16);D=(D&65535)+(D>>>16)}L&1&&(D+=F+=G[S]<<8);return((D&65535)+(D>>>16)<<16|(F&65535)+(F>>>16))>>>
0}})})},"esri/layers/rasterFormats/rasterCodec":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred ../PixelBlock ./LercCodec ./Lerc2Codec ./JpgPlus ./Png ./Raw ./TiffDecoder".split(" "),function(m,n,v,b,p,f,d,a,c,h,l){return{validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),supportedFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_isPlatformLittleEndian:function(){var k=new ArrayBuffer(4),g=new Uint8Array(k);(new Uint32Array(k))[0]=
1;return 1===g[0]}(),decode:function(k,g){if(void 0===g||null===g)throw"missing decode options";var e;g.format&&(e=g.format.toUpperCase());"BSQ"!==e&&"BIP"!==e&&(e=this._getFormat(k));var q=g.decodeFunc;if(void 0===q||null===q)q=this._getFormatDecoderDfd(e);return q(k,g)},_getFormatDecoderDfd:function(k){var g=null;switch(k){case "LERC":g=this._decodeLerc;break;case "LERC2":g=this._decodeLerc2;break;case "JPEG":g=this._decodeJpeg;break;case "PNG":g=this._decodePng;break;case "BSQ":g=this._decodeBsq;
break;case "BIP":g=this._decodeBip;break;case "TIFF":g=this._decodeTiff;break;default:g=function(e,q){throw"The raster format is not supported";}}g=v.hitch(this,g);return function(e,q){var u=new b;q.isPoint&&q.width&&(q.width++,q.height++);var r=g(e,q);q.isPoint&&q.width&&(this._interpolatePointGrid(r),q.width--,q.height--);u.resolve(r);return u}.bind(this)},_getFormat:function(k){k=new Uint8Array(k,0,10);var g="";if(255===k[0]&&216===k[1])g="JPEG";else if(137===k[0]&&80===k[1]&&78===k[2]&&71===k[3])g=
"PNG";else if(67===k[0]&&110===k[1]&&116===k[2]&&90===k[3]&&73===k[4]&&109===k[5]&&97===k[6]&&103===k[7]&&101===k[8]&&32===k[9])g="LERC";else if(76===k[0]&&101===k[1]&&114===k[2]&&99===k[3]&&50===k[4]&&32===k[5])g="LERC2";else if(-1<String.fromCharCode.apply(null,k).toLowerCase().indexOf("error"))g="ERROR";else if(73===k[0]&&73===k[1]&&42===k[2]&&0===k[3]||77===k[0]&&77===k[1]&&0===k[2]&&42===k[3])g="TIFF";return g},_validateDecodeParams:function(k){if(!k.height||Math.floor(k.height)!==k.height)throw"Height not provided.";
if(!k.width||Math.floor(k.width)!==k.width)throw"Width not provided.";},_decodeJpeg:function(k,g){if(!a)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(g);var e=(new a).decode(k);if(!this._verifyResult(e,g))throw"The decoded image dimensions are incorrect.";e=new p({width:e.width,height:e.height,pixels:e.pixels,pixelType:"U8",mask:e.mask,statistics:null});e.calculateStatistics();return e},_decodePng:function(k,g){if(!c)throw"The png decoder module is not loaded.";this._validateDecodeParams(g);
var e=new Uint8Array(k),q=new c(e);e=new Uint8Array(g.width*g.height*4);q.copyToImageData(e,q.decodePixels());var u=q=0;u=new Uint8Array(g.width*g.height);for(q=0;q<g.width*g.height;q++)u[q]=e[4*q+3];var r=new p({width:g.width,height:g.height,pixels:[],pixelType:"U8",mask:u,statistics:[]});for(q=0;3>q;q++){var x=new Uint8Array(g.width*g.height);for(u=0;u<g.width*g.height;u++)x[u]=e[4*u+q];r.addData({pixels:x})}r.calculateStatistics();return r},_decodeBsq:function(k,g){if(!h)throw"The bsq decoder module is not loaded.";
this._validateDecodeParams(g);var e=g.noDataValue;g.pixelType=this._getpixelTypeAndNoData(g.pixelType);e=h.decodeBSQ(k,{bandCount:g.planes,width:g.width,height:g.height,pixelType:g.pixelType,noDataValue:e});e=new p({width:g.width,height:g.height,pixels:e.pixels,pixelType:g.pixelType,mask:e.maskData,statistics:null});e.calculateStatistics();return e},_decodeBip:function(k,g){this._validateDecodeParams(g);var e=g.noDataValue;g.pixelType=this._getpixelTypeAndNoData(g.pixelType);e=h.decodeBIP(k,{bandCount:g.planes,
width:g.width,height:g.height,pixelType:g.pixelType,noDataValue:e});e=new p({width:g.width,height:g.height,pixels:e.pixels,pixelType:g.pixelType,mask:e.maskData,statistics:null});e.calculateStatistics();return e},_decodeTiff:function(k,g){this._validateDecodeParams(g);g.pixelType=this._getpixelTypeAndNoData(g.pixelType);var e=l.decode(k);e=new p({width:e.width,height:e.height,pixels:e.pixels,pixelType:e.pixelType,mask:e.maskData,statistics:null});e.calculateStatistics();return e},_decodeLerc:function(k,
g){if(!this._isPlatformLittleEndian)throw"lerc decoder is not supported on big endian platform";this._validateDecodeParams(g);var e=g.noDataValue;g.pixelType=this._getpixelTypeAndNoData(g.pixelType);for(var q=0,u,r=0,x,t=k.byteLength-10;r<t;){var w=f.decode(k,{inputOffset:r,encodedMaskData:u,returnMask:0===q?!0:!1,returnEncodedMask:0===q?!0:!1,returnFileInfo:!0,pixelType:g.pixelType,noDataValue:e});r=w.fileInfo.eofOffset;0===q&&(u=w.encodedMaskData,x=new p({width:g.width,height:g.height,pixels:[],
pixelType:g.pixelType,mask:w.maskData,statistics:[]}));q++;if(!this._verifyResult(w,g))throw"The decoded image dimensions are incorrect";x.addData({pixels:w.pixelData,statistics:{minValue:w.minValue,maxValue:w.maxValue,noDataValue:w.noDataValue}})}return x},_decodeLerc2:function(k,g){if(!this._isPlatformLittleEndian)throw"lerc2 decoder is not supported on big endian platform";this._validateDecodeParams(g);g.pixelType=this._getpixelTypeAndNoData(g.pixelType);for(var e=0,q,u,r,x=0,t,w=k.byteLength-
10,z=[],B,A=0;x<w;){u=d.decode(k,{inputOffset:x,maskData:q,returnFileInfo:!0});x=u.fileInfo.eofOffset;q=u.maskData;0===e&&(r=u.fileInfo.numValidPixel,t=new p({width:g.width,height:g.height,pixels:[],dimCount:u.dimCount||1,pixelType:u.fileInfo.pixelType,mask:q,statistics:[]}));u.fileInfo.mask&&0<u.fileInfo.mask.numBytes&&A++;q&&z.push(q);e++;if(!this._verifyResult(u,g))throw"The decoded image dimensions are incorrect";t.addData({pixels:u.pixelData,statistics:{minValue:u.minValue,maxValue:u.maxValue,
noDataValue:u.noDataValue,dimStats:u.dimStats}})}if(1<A){u=t.width*t.height;t.bandMasks=z;q=new Uint8Array(u);q.set(z[0]);for(r=1;r<z.length;r++)for(B=z[r],e=0;e<u;e++)q[e]&=B[e];for(e=r=0;e<u;e++)r+=B[e];t.mask=q}t.validPixelCount=r;return t},_interpolatePointGrid:function(k,g){var e=k.pixels;if(e&&0!==e.length){var q=e.length,u=k.width,r=k.mask,x=u-1,t=k.height-1,w=[],z,B,A;if(0===(null==g?1:g)){for(z=0;z<q;z++){var y=e[z];var E=new y.constructor(x*t);for(B=0;B<t;B++){var G=B*u;for(A=0;A<x;A++)E[B*
x+A]=y[G+A]}w.push(E)}if(r){var F=new Uint8Array(x*t);for(B=0;B<t;B++)for(G=B*u,A=0;A<x;A++)F[B*x+A]=r[G+A]}}else{for(z=0;z<q;z++){y=e[z];E=new y.constructor(x*t);for(B=0;B<t;B++)for(G=B*u,A=0;A<x;A++)E[B*x+A]=(y[G+A]+y[G+A+1]+y[G+u+A]+y[G+u+A+1])/4;w.push(E)}if(r)for(F=new Uint8Array(x*t),B=0;B<t;B++)for(G=B*u,A=0;A<x;A++)F[B*x+A]=Math.min.apply(null,[r[G+A],r[G+A+1],r[G+u+A],r[G+u+A+1]])}k.width=x;k.height=t;k.mask=F;k.pixels=w;return k}},_getpixelTypeAndNoData:function(k){return"U1"===k||"U2"===
k||"U4"===k||"U8"===k?"U8":k},_verifyResult:function(k,g){return k.height!==g.height||k.width!==g.width?!1:!0}}})},"esri/layers/rasterFormats/JpgPlus":function(){define(["dojo/_base/declare","./Zlib","./Jpg"],function(m,n,v){return m(null,{constructor:function(){},decode:function(b){var p=new Uint8Array(b);b=new v;b.parse(p);var f=b.numComponents,d=b.getData(b.width,b.height,!0),a=b.width*b.height,c=b.eof,h=0,l=0,k=0;if(c<p.length-1){l=(new n(p.subarray(c))).getBytes();var g=new Uint8Array(a);for(h=
p=0;h<l.length;h++)for(k=7;0<=k;k--)g[p++]=l[h]>>k&1}p=[];if(1===f)p=[d,d,d];else{for(h=0;3>h;h++)f=new Uint8Array(a),p.push(f);for(l=k=0;l<a;l++)for(h=0;3>h;h++)p[h][l]=d[k++]}return{width:b.width,height:b.height,pixels:p,mask:g}}})})},"esri/layers/rasterFormats/Zlib":function(){define([],function(){var m=function(){function n(){this.bufferLength=this.pos=0;this.eof=!1;this.buffer=null}n.prototype={ensureBuffer:function(v){var b=this.buffer,p=b?b.byteLength:0;if(v<p)return b;for(var f=512;f<v;)f<<=
1;v=new Uint8Array(f);for(f=0;f<p;++f)v[f]=b[f];return this.buffer=v},getByte:function(){for(var v=this.pos;this.bufferLength<=v;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(v){var b=this.pos;if(v){this.ensureBuffer(b+v);for(v=b+v;!this.eof&&this.bufferLength<v;)this.readBlock();var p=this.bufferLength;v>p&&(v=p)}else{for(;!this.eof;)this.readBlock();v=this.bufferLength}this.pos=v;return this.buffer.subarray(b,v)},lookChar:function(){for(var v=this.pos;this.bufferLength<=
v;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var v=this.pos;this.bufferLength<=v;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(v,b,p){for(var f=v+b;this.bufferLength<=f&&!this.eof;)this.readBlock();return new Stream(this.buffer,v,b,p)},skip:function(v){v||(v=1);this.pos+=v},reset:function(){this.pos=0}};return n}();return function(){function n(c){throw Error(c);
}function v(c){var h=0,l=c[h++],k=c[h++];-1!=l&&-1!=k||n("Invalid header in flate stream");8!=(l&15)&&n("Unknown compression method in flate stream");0!=((l<<8)+k)%31&&n("Bad FCHECK in flate stream");k&32&&n("FDICT bit set in flate stream");this.bytes=c;this.bytesPos=h;this.codeBuf=this.codeSize=0;m.call(this)}if(!self||!self.Uint32Array)return null;var b=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),p=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,
131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),f=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),d=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,
459020,524392,524328,59E4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,
459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,
459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,
459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,
459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,
459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,
459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],a=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,
327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];v.prototype=Object.create(m.prototype);v.prototype.getBits=function(c){for(var h=this.codeSize,l=this.codeBuf,k=this.bytes,g=this.bytesPos,e;h<c;)"undefined"==typeof(e=k[g++])&&n("Bad encoding in flate stream"),l|=e<<h,h+=8;this.codeBuf=l>>c;this.codeSize=h-=c;this.bytesPos=g;return l&(1<<c)-1};v.prototype.getCode=function(c){var h=c[0],l=c[1];c=this.codeSize;for(var k=
this.codeBuf,g=this.bytes,e=this.bytesPos;c<l;){var q;"undefined"==typeof(q=g[e++])&&n("Bad encoding in flate stream");k|=q<<c;c+=8}l=h[k&(1<<l)-1];h=l>>16;l&=65535;(0==c||c<h||0==h)&&n("Bad encoding in flate stream");this.codeBuf=k>>h;this.codeSize=c-h;this.bytesPos=e;return l};v.prototype.generateHuffmanTable=function(c){for(var h=c.length,l=0,k=0;k<h;++k)c[k]>l&&(l=c[k]);for(var g=1<<l,e=new Uint32Array(g),q=1,u=0,r=2;q<=l;++q,u<<=1,r<<=1)for(var x=0;x<h;++x)if(c[x]==q){var t=0,w=u;for(k=0;k<q;++k)t=
t<<1|w&1,w>>=1;for(k=t;k<g;k+=r)e[k]=q<<16|x;++u}return[e,l]};v.prototype.readBlock=function(){function c(t,w,z,B,A){for(t=t.getBits(z)+B;0<t--;)w[u++]=A}var h=this.getBits(3);h&1&&(this.eof=!0);h>>=1;if(0==h){var l=this.bytes,k=this.bytesPos,g;"undefined"==typeof(g=l[k++])&&n("Bad block header in flate stream");var e=g;"undefined"==typeof(g=l[k++])&&n("Bad block header in flate stream");e|=g<<8;"undefined"==typeof(g=l[k++])&&n("Bad block header in flate stream");h=g;"undefined"==typeof(g=l[k++])&&
n("Bad block header in flate stream");(h|g<<8)!=(~e&65535)&&n("Bad uncompressed block length in flate stream");this.codeSize=this.codeBuf=0;g=this.bufferLength;h=this.ensureBuffer(g+e);this.bufferLength=e=g+e;for(var q=g;q<e;++q){if("undefined"==typeof(g=l[k++])){this.eof=!0;break}h[q]=g}this.bytesPos=k}else{if(1==h)k=d,g=a;else if(2==h){h=this.getBits(5)+257;g=this.getBits(5)+1;l=this.getBits(4)+4;k=Array(b.length);for(var u=0;u<l;)k[b[u++]]=this.getBits(3);k=this.generateHuffmanTable(k);u=l=0;g=
h+g;for(e=Array(g);u<g;)q=this.getCode(k),16==q?c(this,e,2,3,l):17==q?c(this,e,3,3,l=0):18==q?c(this,e,7,11,l=0):e[u++]=l=q;k=this.generateHuffmanTable(e.slice(0,h));g=this.generateHuffmanTable(e.slice(h,g))}else n("Unknown block type in flate stream");e=(h=this.buffer)?h.length:0;for(q=this.bufferLength;;){var r=this.getCode(k);if(256>r)q+1>=e&&(h=this.ensureBuffer(q+1),e=h.length),h[q++]=r;else{if(256==r){this.bufferLength=q;break}r-=257;r=p[r];var x=r>>16;0<x&&(x=this.getBits(x));l=(r&65535)+x;
r=this.getCode(g);r=f[r];x=r>>16;0<x&&(x=this.getBits(x));r=(r&65535)+x;q+l>=e&&(h=this.ensureBuffer(q+l),e=h.length);for(x=0;x<l;++x,++q)h[q]=h[q-r]}}}};return v}()})},"esri/layers/rasterFormats/Jpg":function(){define([],function(){var m=function(){function n(v){this.message="JPEG error: "+v}n.prototype=Error();n.prototype.name="JpegError";return n.constructor=n}();return function(){function n(){this.decodeTransform=null;this.colorTransform=-1}function v(a,c){for(var h=0,l=[],k,g,e=16;0<e&&!a[e-
1];)e--;l.push({children:[],index:0});var q=l[0],u;for(k=0;k<e;k++){for(g=0;g<a[k];g++){q=l.pop();for(q.children[q.index]=c[h];0<q.index;)q=l.pop();q.index++;for(l.push(q);l.length<=k;)l.push(u={children:[],index:0}),q.children[q.index]=u.children,q=u;h++}k+1<e&&(l.push(u={children:[],index:0}),q.children[q.index]=u.children,q=u)}return l[0].children}function b(a,c,h,l,k,g,e,q,u){function r(){if(0<L)return L--,D>>L&1;D=a[c++];if(255===D){var W=a[c++];if(W)throw new m("unexpected marker "+(D<<8|W).toString(16));
}L=7;return D>>>7}function x(W){for(;;){W=W[r()];if("number"===typeof W)return W;if("object"!==typeof W)throw new m("invalid huffman sequence");}}function t(W){for(var R=0;0<W;)R=R<<1|r(),W--;return R}function w(W){if(1===W)return 1===r()?1:-1;var R=t(W);return R>=1<<W-1?R:R+(-1<<W)+1}function z(W,R){var X=x(W.huffmanTableDC);X=0===X?0:w(X);W.blockData[R]=W.pred+=X;for(X=1;64>X;){var ia=x(W.huffmanTableAC),ka=ia&15;ia>>=4;if(0===ka){if(15>ia)break;X+=16}else X+=ia,W.blockData[R+d[X]]=w(ka),X++}}function B(W,
R){var X=x(W.huffmanTableDC);X=0===X?0:w(X)<<u;W.blockData[R]=W.pred+=X}function A(W,R){W.blockData[R]|=r()<<u}function y(W,R){if(0<O)O--;else for(var X=g;X<=e;){var ia=x(W.huffmanTableAC),ka=ia&15;ia>>=4;if(0===ka){if(15>ia){O=t(ia)+(1<<ia)-1;break}X+=16}else X+=ia,W.blockData[R+d[X]]=w(ka)*(1<<u),X++}}function E(W,R){for(var X=g,ia=0,ka;X<=e;){ka=d[X];switch(S){case 0:ia=x(W.huffmanTableAC);ka=ia&15;ia>>=4;if(0===ka)15>ia?(O=t(ia)+(1<<ia),S=4):(ia=16,S=1);else{if(1!==ka)throw new m("invalid ACn encoding");
Z=w(ka);S=ia?2:3}continue;case 1:case 2:W.blockData[R+ka]?W.blockData[R+ka]+=r()<<u:(ia--,0===ia&&(S=2===S?3:0));break;case 3:W.blockData[R+ka]?W.blockData[R+ka]+=r()<<u:(W.blockData[R+ka]=Z<<u,S=0);break;case 4:W.blockData[R+ka]&&(W.blockData[R+ka]+=r()<<u)}X++}4===S&&(O--,0===O&&(S=0))}var G=h.mcusPerLine,F=c,D=0,L=0,O=0,S=0,Z,I=l.length,N,K,Q,da;q=h.progressive?0===g?0===q?B:A:0===q?y:E:z;var U=0;h=1===I?l[0].blocksPerLine*l[0].blocksPerColumn:G*h.mcusPerColumn;for(var aa,J;U<h;){var T=k?Math.min(h-
U,k):h;for(N=0;N<I;N++)l[N].pred=0;O=0;if(1===I){var Y=l[0];for(da=0;da<T;da++)q(Y,64*((Y.blocksPerLine+1)*(U/Y.blocksPerLine|0)+U%Y.blocksPerLine)),U++}else for(da=0;da<T;da++){for(N=0;N<I;N++)for(Y=l[N],aa=Y.h,J=Y.v,K=0;K<J;K++)for(Q=0;Q<aa;Q++)q(Y,64*((Y.blocksPerLine+1)*((U/G|0)*Y.v+K)+(U%G*Y.h+Q)));U++}L=0;(Y=f(a,c))&&Y.invalid&&(c=Y.offset);Y=Y&&Y.marker;if(!Y||65280>=Y)throw new m("marker was not found");if(65488<=Y&&65495>=Y)c+=2;else break}(Y=f(a,c))&&Y.invalid&&(c=Y.offset);return c-F}function p(a,
c){for(var h=c.blocksPerLine,l=c.blocksPerColumn,k=new Int16Array(64),g=0;g<l;g++)for(var e=0;e<h;e++){var q=void 0,u=void 0,r=void 0,x=void 0,t=void 0,w=void 0,z=void 0,B=void 0,A=t=w=x=u=q=void 0,y=void 0,E=void 0,G=void 0,F=64*((c.blocksPerLine+1)*g+e),D=k,L=c.quantizationTable,O=c.blockData;if(!L)throw new m("missing required Quantization Table.");for(var S=0;64>S;S+=8)q=O[F+S],B=O[F+S+1],z=O[F+S+2],w=O[F+S+3],t=O[F+S+4],x=O[F+S+5],r=O[F+S+6],u=O[F+S+7],q*=L[S],0===(B|z|w|t|x|r|u)?(q=5793*q+512>>
10,D[S]=q,D[S+1]=q,D[S+2]=q,D[S+3]=q,D[S+4]=q,D[S+5]=q,D[S+6]=q,D[S+7]=q):(B*=L[S+1],z*=L[S+2],w*=L[S+3],t*=L[S+4],x*=L[S+5],r*=L[S+6],u*=L[S+7],G=5793*q+128>>8,E=5793*t+128>>8,y=z,A=r,t=2896*(B-u)+128>>8,u=2896*(B+u)+128>>8,w<<=4,x<<=4,G=G+E+1>>1,E=G-E,q=3784*y+1567*A+128>>8,y=1567*y-3784*A+128>>8,A=q,t=t+x+1>>1,x=t-x,u=u+w+1>>1,w=u-w,G=G+A+1>>1,A=G-A,E=E+y+1>>1,y=E-y,q=2276*t+3406*u+2048>>12,t=3406*t-2276*u+2048>>12,u=q,q=799*w+4017*x+2048>>12,w=4017*w-799*x+2048>>12,x=q,D[S]=G+u,D[S+7]=G-u,D[S+
1]=E+x,D[S+6]=E-x,D[S+2]=y+w,D[S+5]=y-w,D[S+3]=A+t,D[S+4]=A-t);for(L=0;8>L;++L)q=D[L],B=D[L+8],z=D[L+16],w=D[L+24],t=D[L+32],x=D[L+40],r=D[L+48],u=D[L+56],0===(B|z|w|t|x|r|u)?(q=5793*q+8192>>14,q=-2040>q?0:2024<=q?255:q+2056>>4,O[F+L]=q,O[F+L+8]=q,O[F+L+16]=q,O[F+L+24]=q,O[F+L+32]=q,O[F+L+40]=q,O[F+L+48]=q,O[F+L+56]=q):(G=5793*q+2048>>12,E=5793*t+2048>>12,y=z,A=r,t=2896*(B-u)+2048>>12,u=2896*(B+u)+2048>>12,G=(G+E+1>>1)+4112,E=G-E,q=3784*y+1567*A+2048>>12,y=1567*y-3784*A+2048>>12,A=q,t=t+x+1>>1,x=
t-x,u=u+w+1>>1,w=u-w,G=G+A+1>>1,A=G-A,E=E+y+1>>1,y=E-y,q=2276*t+3406*u+2048>>12,t=3406*t-2276*u+2048>>12,u=q,q=799*w+4017*x+2048>>12,w=4017*w-799*x+2048>>12,x=q,q=G+u,u=G-u,B=E+x,r=E-x,z=y+w,x=y-w,w=A+t,t=A-t,q=16>q?0:4080<=q?255:q>>4,B=16>B?0:4080<=B?255:B>>4,z=16>z?0:4080<=z?255:z>>4,w=16>w?0:4080<=w?255:w>>4,t=16>t?0:4080<=t?255:t>>4,x=16>x?0:4080<=x?255:x>>4,r=16>r?0:4080<=r?255:r>>4,u=16>u?0:4080<=u?255:u>>4,O[F+L]=q,O[F+L+8]=B,O[F+L+16]=z,O[F+L+24]=w,O[F+L+32]=t,O[F+L+40]=x,O[F+L+48]=r,O[F+
L+56]=u)}return c.blockData}function f(a,c,h){var l=a.length-1;h=h<c?h:c;if(c>=l)return null;var k=a[c]<<8|a[c+1];if(65472<=k&&65534>=k)return{invalid:null,marker:k,offset:c};for(c=a[h]<<8|a[h+1];!(65472<=c&&65534>=c);){if(++h>=l)return null;c=a[h]<<8|a[h+1]}return{invalid:k.toString(16),marker:c,offset:h}}if(!self||!self.Uint8ClampedArray)return null;var d=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,
37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);n.prototype={parse:function(a){function c(){var D=a[k]<<8|a[k+1];k+=2;return D}function h(){var D=c();D=k+D-2;var L=f(a,D,k);L&&L.invalid&&(D=L.offset);D=a.subarray(k,D);k+=D.length;return D}function l(D){for(var L=Math.ceil(D.samplesPerLine/8/D.maxH),O=Math.ceil(D.scanLines/8/D.maxV),S=0;S<D.components.length;S++){F=D.components[S];var Z=Math.ceil(Math.ceil(D.samplesPerLine/8)*F.h/D.maxH),I=Math.ceil(Math.ceil(D.scanLines/8)*F.v/D.maxV);
F.blockData=new Int16Array(64*O*F.v*(L*F.h+1));F.blocksPerLine=Z;F.blocksPerColumn=I}D.mcusPerLine=L;D.mcusPerColumn=O}var k=0,g=null,e=null,q=[],u=[],r=[],x=c();if(65496!==x)throw new m("SOI not found");for(x=c();65497!==x;){switch(x){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var t=h();65504===x&&74===t[0]&&70===t[1]&&73===t[2]&&70===t[3]&&0===t[4]&&(g=
{version:{major:t[5],minor:t[6]},densityUnits:t[7],xDensity:t[8]<<8|t[9],yDensity:t[10]<<8|t[11],thumbWidth:t[12],thumbHeight:t[13],thumbData:t.subarray(14,14+3*t[12]*t[13])});65518===x&&65===t[0]&&100===t[1]&&111===t[2]&&98===t[3]&&101===t[4]&&(e={version:t[5]<<8|t[6],flags0:t[7]<<8|t[8],flags1:t[9]<<8|t[10],transformCode:t[11]});break;case 65499:x=c()+k-2;for(var w;k<x;){var z=a[k++],B=new Uint16Array(64);if(0===z>>4)for(t=0;64>t;t++)w=d[t],B[w]=a[k++];else if(1===z>>4)for(t=0;64>t;t++)w=d[t],B[w]=
c();else throw new m("DQT - invalid table spec");q[z&15]=B}break;case 65472:case 65473:case 65474:if(A)throw new m("Only single frame JPEGs supported");c();var A={};A.extended=65473===x;A.progressive=65474===x;A.precision=a[k++];A.scanLines=c();A.samplesPerLine=c();A.components=[];A.componentIds={};t=a[k++];for(x=B=z=0;x<t;x++){w=a[k];var y=a[k+1]>>4;var E=a[k+1]&15;z<y&&(z=y);B<E&&(B=E);y=A.components.push({h:y,v:E,quantizationId:a[k+2],quantizationTable:null});A.componentIds[w]=y-1;k+=3}A.maxH=
z;A.maxV=B;l(A);break;case 65476:w=c();for(x=2;x<w;){z=a[k++];B=new Uint8Array(16);for(t=y=0;16>t;t++,k++)y+=B[t]=a[k];E=new Uint8Array(y);for(t=0;t<y;t++,k++)E[t]=a[k];x+=17+y;(0===z>>4?r:u)[z&15]=v(B,E)}break;case 65501:c();var G=c();break;case 65498:c();w=a[k++];t=[];for(x=0;x<w;x++){z=A.componentIds[a[k++]];var F=A.components[z];z=a[k++];F.huffmanTableDC=r[z>>4];F.huffmanTableAC=u[z&15];t.push(F)}x=a[k++];w=a[k++];z=a[k++];x=b(a,k,A,t,G,x,w,z>>4,z&15);k+=x;break;case 65535:255!==a[k]&&k--;break;
default:if(255===a[k-3]&&192<=a[k-2]&&254>=a[k-2])k-=3;else throw new m("unknown marker "+x.toString(16));}x=c()}this.width=A.samplesPerLine;this.height=A.scanLines;this.jfif=g;this.eof=k;this.adobe=e;this.components=[];for(x=0;x<A.components.length;x++){F=A.components[x];if(g=q[F.quantizationId])F.quantizationTable=g;this.components.push({output:p(A,F),scaleX:F.h/A.maxH,scaleY:F.v/A.maxV,blocksPerLine:F.blocksPerLine,blocksPerColumn:F.blocksPerColumn})}this.numComponents=this.components.length},
_getLinearizedBlockData:function(a,c){var h=this.width/a,l=this.height/c,k,g,e=0,q=this.components.length,u=a*c*q,r=new Uint8ClampedArray(u),x=new Uint32Array(a);for(g=0;g<q;g++){var t=this.components[g];var w=t.scaleX*h;var z=t.scaleY*l;e=g;var B=t.output;var A=t.blocksPerLine+1<<3;for(k=0;k<a;k++)t=0|k*w,x[k]=(t&4294967288)<<3|t&7;for(w=0;w<c;w++)for(t=0|w*z,t=A*(t&4294967288)|(t&7)<<3,k=0;k<a;k++)r[e]=B[t+x[k]],e+=q}if(l=this.decodeTransform)for(g=0;g<u;)for(h=t=0;t<q;t++,g++,h+=2)r[g]=(r[g]*l[h]>>
8)+l[h+1];return r},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:3===this.numComponents?0===this.colorTransform?!1:!0:1===this.colorTransform?!0:!1},_convertYccToRgb:function(a){for(var c,h,l,k=0,g=a.length;k<g;k+=3)c=a[k],h=a[k+1],l=a[k+2],a[k]=c-179.456+1.402*l,a[k+1]=c+135.459-.344*h-.714*l,a[k+2]=c-226.816+1.772*h;return a},_convertYcckToRgb:function(a){for(var c,h,l,k,g=0,e=0,q=a.length;e<q;e+=4)c=a[e],h=a[e+1],l=a[e+2],k=a[e+3],a[g++]=-122.67195406894+h*(-6.60635669420364E-5*
h+4.37130475926232E-4*l-5.4080610064599E-5*c+4.8449797120281E-4*k-.154362151871126)+l*(-9.57964378445773E-4*l+8.17076911346625E-4*c-.00477271405408747*k+1.53380253221734)+c*(9.61250184130688E-4*c-.00266257332283933*k+.48357088451265)+k*(-3.36197177618394E-4*k+.484791561490776),a[g++]=107.268039397724+h*(2.19927104525741E-5*h-6.40992018297945E-4*l+6.59397001245577E-4*c+4.26105652938837E-4*k-.176491792462875)+l*(-7.78269941513683E-4*l+.00130872261408275*c+7.70482631801132E-4*k-.151051492775562)+c*(.00126935368114843*
c-.00265090189010898*k+.25802910206845)+k*(-3.18913117588328E-4*k-.213742400323665),a[g++]=-20.810012546947+h*(-5.70115196973677E-4*h-2.63409051004589E-5*l+.0020741088115012*c-.00288260236853442*k+.814272968359295)+l*(-1.53496057440975E-5*l-1.32689043961446E-4*c+5.60833691242812E-4*k-.195152027534049)+c*(.00174418132927582*c-.00255243321439347*k+.116935020465145)+k*(-3.43531996510555E-4*k+.24165260232407);return a},_convertYcckToCmyk:function(a){for(var c,h,l,k=0,g=a.length;k<g;k+=4)c=a[k],h=a[k+
1],l=a[k+2],a[k]=434.456-c-1.402*l,a[k+1]=119.541-c+.344*h+.714*l,a[k+2]=481.816-c-1.772*h;return a},_convertCmykToRgb:function(a){for(var c,h,l,k,g=0,e=1/255,q=0,u=a.length;q<u;q+=4)c=a[q]*e,h=a[q+1]*e,l=a[q+2]*e,k=a[q+3]*e,a[g++]=255+c*(-4.387332384609988*c+54.48615194189176*h+18.82290502165302*l+212.25662451639585*k-285.2331026137004)+h*(1.7149763477362134*h-5.6096736904047315*l-17.873870861415444*k-5.497006427196366)+l*(-2.5217340131683033*l-21.248923337353073*k+17.5119270841813)-k*(21.86122147463605*
k+189.48180835922747),a[g++]=255+c*(8.841041422036149*c+60.118027045597366*h+6.871425592049007*l+31.159100130055922*k-79.2970844816548)+h*(-15.310361306967817*h+17.575251261109482*l+131.35250912493976*k-190.9453302588951)+l*(4.444339102852739*l+9.8632861493405*k-24.86741582555878)-k*(20.737325471181034*k+187.80453709719578),a[g++]=255+c*(.8842522430003296*c+8.078677503112928*h+30.89978309703729*l-.23883238689178934*k-14.183576799673286)+h*(10.49593273432072*h+63.02378494754052*l+50.606957656360734*
k-112.23884253719248)+l*(.03296041114873217*l+115.60384449646641*k-193.58209356861505)-k*(22.33816807309886*k+180.12613974708367);return a},getData:function(a,c,h){if(4<this.numComponents)throw new m("Unsupported color mode");a=this._getLinearizedBlockData(a,c);if(1===this.numComponents&&h){h=a.length;c=new Uint8ClampedArray(3*h);for(var l=0,k=0;k<h;k++){var g=a[k];c[l++]=g;c[l++]=g;c[l++]=g}return c}if(3===this.numComponents&&this._isColorConversionNeeded())return this._convertYccToRgb(a);if(4===
this.numComponents){if(this._isColorConversionNeeded())return h?this._convertYcckToRgb(a):this._convertYcckToCmyk(a);if(h)return this._convertCmykToRgb(a)}return a}};return n}()})},"esri/layers/rasterFormats/Png":function(){define(["./Zlib"],function(m){return function(){function n(b){var p,f;this.data=b;this.pos=8;this.palette=[];this.imgData=[];this.transparency={};this.animation=null;this.text={};for(f=null;;){var d=this.readUInt32();var a=b=void 0;b=[];for(a=0;4>a;++a)b.push(String.fromCharCode(this.data[this.pos++]));
b=b.join("");switch(b){case "IHDR":this.width=this.readUInt32();this.height=this.readUInt32();this.bits=this.data[this.pos++];this.colorType=this.data[this.pos++];this.compressionMethod=this.data[this.pos++];this.filterMethod=this.data[this.pos++];this.interlaceMethod=this.data[this.pos++];break;case "acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||Infinity,frames:[]};break;case "PLTE":this.palette=this.read(d);break;case "fcTL":f&&this.animation.frames.push(f);this.pos+=
4;f={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};b=this.readUInt16();d=this.readUInt16()||100;f.delay=1E3*b/d;f.disposeOp=this.data[this.pos++];f.blendOp=this.data[this.pos++];f.data=[];break;case "IDAT":case "fdAT":"fdAT"===b&&(this.pos+=4,d-=4);b=(null!=f?f.data:void 0)||this.imgData;for(a=0;0<=d?a<d:a>d;0<=d?++a:--a)b.push(this.data[this.pos++]);break;case "tRNS":this.transparency={};switch(this.colorType){case 3:this.transparency.indexed=
this.read(d);d=255-this.transparency.indexed.length;if(0<d)for(b=0;0<=d?b<d:b>d;0<=d?++b:--b)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(d)[0];break;case 2:this.transparency.rgb=this.read(d)}break;case "tEXt":a=this.read(d);d=a.indexOf(0);b=String.fromCharCode.apply(String,a.slice(0,d));this.text[b]=String.fromCharCode.apply(String,a.slice(d+1));break;case "IEND":f&&this.animation.frames.push(f);a:{switch(this.colorType){case 0:case 3:case 4:f=1;break a;
case 2:case 6:f=3;break a}f=void 0}this.colors=f;this.hasAlphaChannel=4===(p=this.colorType)||6===p;p=this.colors+(this.hasAlphaChannel?1:0);this.pixelBitlength=this.bits*p;a:{switch(this.colors){case 1:p="DeviceGray";break a;case 3:p="DeviceRGB";break a}p=void 0}this.colorSpace=p;this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=d}this.pos+=4;if(this.pos>this.data.length)throw Error("Incomplete or corrupt PNG file");}}n.load=function(b,p,f){"function"===typeof p&&(f=p);var d=new XMLHttpRequest;
d.open("GET",b,!0);d.responseType="arraybuffer";d.onload=function(){var a=new Uint8Array(d.response||d.mozResponseArrayBuffer);a=new n(a);"function"===typeof(null!=p?p.getContext:void 0)&&a.render(p);return"function"===typeof f?f(a):void 0};return d.send(null)};n.prototype.read=function(b){var p;var f=[];for(p=0;0<=b?p<b:p>b;0<=b?++p:--p)f.push(this.data[this.pos++]);return f};n.prototype.readUInt32=function(){var b=this.data[this.pos++]<<24;var p=this.data[this.pos++]<<16;var f=this.data[this.pos++]<<
8;var d=this.data[this.pos++];return b|p|f|d};n.prototype.readUInt16=function(){var b=this.data[this.pos++]<<8;var p=this.data[this.pos++];return b|p};n.prototype.decodePixels=function(b){var p,f,d,a,c,h,l,k;null==b&&(b=this.imgData);if(0===b.length)return new Uint8Array(0);b=new m(b);b=b.getBytes();var g=this.pixelBitlength/8;var e=g*this.width;var q=new Uint8Array(e*this.height);var u=b.length;for(f=a=c=0;a<u;){switch(b[a++]){case 0:for(d=p=0;p<e;d=p+=1)q[f++]=b[a++];break;case 1:for(d=h=0;h<e;d=
h+=1){p=b[a++];var r=d<g?0:q[f-g];q[f++]=(p+r)%256}break;case 2:for(d=r=0;r<e;d=r+=1){p=b[a++];var x=(d-d%g)/g;h=c&&q[(c-1)*e+x*g+d%g];q[f++]=(h+p)%256}break;case 3:for(d=k=0;k<e;d=k+=1)p=b[a++],x=(d-d%g)/g,r=d<g?0:q[f-g],h=c&&q[(c-1)*e+x*g+d%g],q[f++]=(p+Math.floor((r+h)/2))%256;break;case 4:for(d=k=0;k<e;d=k+=1){p=b[a++];x=(d-d%g)/g;r=d<g?0:q[f-g];0===c?h=l=0:(h=q[(c-1)*e+x*g+d%g],l=x&&q[(c-1)*e+(x-1)*g+d%g]);var t=r+h-l;d=Math.abs(t-r);x=Math.abs(t-h);t=Math.abs(t-l);r=d<=x&&d<=t?r:x<=t?h:l;q[f++]=
(p+r)%256}break;default:throw Error("Invalid filter algorithm: "+b[a-1]);}c++}return q};n.prototype.decodePalette=function(){var b,p,f,d,a;var c=this.palette;var h=this.transparency.indexed||[];var l=new Uint8Array((h.length||0)+c.length);var k=f=b=p=0;for(d=c.length;f<d;k=f+=3)l[p++]=c[k],l[p++]=c[k+1],l[p++]=c[k+2],l[p++]=null!=(a=h[b++])?a:255;return l};n.prototype.copyToImageData=function(b,p){var f,d;var a=this.colors;var c=null;var h=this.hasAlphaChannel;this.palette.length&&(c=null!=(f=this._decodedPalette)?
f:this._decodedPalette=this.decodePalette(),a=4,h=!0);f=b.data||b;var l=f.length;var k=c||p;var g=d=0;if(1===a)for(;g<l;)a=c?4*p[g/4]:d,d=k[a++],f[g++]=d,f[g++]=d,f[g++]=d,f[g++]=h?k[a++]:this.transparency.grayscale&&this.transparency.grayscale===d?0:255,d=a;else for(;g<l;)a=c?4*p[g/4]:d,f[g++]=k[a++],f[g++]=k[a++],f[g++]=k[a++],f[g++]=h?k[a++]:this.transparency.rgb&&this.transparency.rgb[1]===k[a-3]&&this.transparency.rgb[3]===k[a-2]&&this.transparency.rgb[5]===k[a-1]?0:255,d=a};n.prototype.decode=
function(){var b=new Uint8Array(this.width*this.height*4);this.copyToImageData(b,this.decodePixels());return b};var v=function(b){(void 0).clearRect(0,0,b.width,b.height);(void 0).putImageData(b,0,0);b=new Image;b.src=(void 0).toDataURL();return b};n.prototype.decodeFrames=function(b){var p,f;if(this.animation){var d=this.animation.frames;var a=[];var c=p=0;for(f=d.length;p<f;c=++p){c=d[c];var h=b.createImageData(c.width,c.height);var l=this.decodePixels(new Uint8Array(c.data));this.copyToImageData(h,
l);c.imageData=h;a.push(c.image=v(h))}return a}};n.prototype.renderFrame=function(b,p){var f=this.animation.frames;var d=f[p];f=f[p-1];0===p&&b.clearRect(0,0,this.width,this.height);1===(null!=f?f.disposeOp:void 0)?b.clearRect(f.xOffset,f.yOffset,f.width,f.height):2===(null!=f?f.disposeOp:void 0)&&b.putImageData(f.imageData,f.xOffset,f.yOffset);0===d.blendOp&&b.clearRect(d.xOffset,d.yOffset,d.width,d.height);return b.drawImage(d.image,d.xOffset,d.yOffset)};n.prototype.animate=function(b){var p,f=
this;var d=0;var a=this.animation;var c=a.numFrames;var h=a.frames;var l=a.numPlays;return(p=function(){var k=d++%c;var g=h[k];f.renderFrame(b,k);if(1<c&&d/c<l)return f.animation._timeout=setTimeout(p,g.delay)})()};n.prototype.stopAnimation=function(){var b;return clearTimeout(null!=(b=this.animation)?b._timeout:void 0)};n.prototype.render=function(b){b._png&&b._png.stopAnimation();b._png=this;b.width=this.width;b.height=this.height;b=b.getContext("2d");if(this.animation)return this.decodeFrames(b),
this.animate(b);var p=b.createImageData(this.width,this.height);this.copyToImageData(p,this.decodePixels());return b.putImageData(p,0,0)};return n}()})},"esri/layers/rasterFormats/Raw":function(){define([],function(){return{decodeBIP:function(m,n){var v=n.pixelType,b=n.bandCount,p=[],f=n.width*n.height,d=this.getBandCount(m,n);b=b||d;var a=m.byteLength-m.byteLength%(f*this._getPixelLength(v)),c=new v(m,0,f*d),h,l,k;for(h=0;h<b;h++){var g=new v(f);for(l=0;l<f;l++)g[l]=c[l*d+h];p.push(g)}a<m.byteLength-
1&&(k=this._decodeMask(m.slice(a),n));return{pixels:p,maskData:k}},decodeBSQ:function(m,n){var v=n.pixelType,b=n.bandCount;if(void 0===b||null===b)b=this.getBandCount(m,n);var p=[],f=n.width*n.height,d=f*b,a=m.byteLength-m.byteLength%(f*this._getPixelLength(v));v=new v(m,0,d);var c;for(d=0;d<b;d++)p.push(v.subarray(d*f,(d+1)*f));a<m.byteLength-1&&(c=this._decodeMask(m.slice(a),n));return{pixels:p,maskData:c}},getBandCount:function(m,n){return Math.floor(m.byteLength/(n.width*n.height*this._getPixelLength(n.pixelType)))},
_getPixelLength:function(m){var n=1;switch(m){case Uint8Array:case Int8Array:case Uint8ClampedArray:n=1;break;case Uint16Array:case Int16Array:n=2;break;case Uint32Array:case Int32Array:case Float32Array:n=4;break;case Float64Array:n=8}return n},_decodeMask:function(m,n){var v=n.width*n.height;if(8*m.byteLength<v)return null;var b=new Uint8Array(m,0,Math.ceil(v/8)),p=new Uint8Array(n.width*n.height),f=0,d=0,a=0,c=0;for(a=0;a<b.length-1;a++)for(d=b[a],c=7;0<=c;c--)p[f++]=d>>c&1;for(c=7;f<v-1;)d=b[b.length-
1],p[f++]=d>>c&1,c--;return p}}})},"esri/layers/rasterFormats/TiffDecoder":function(){define(["./Jpg","./Zlib"],function(m,n){var v=function(){var d=new ArrayBuffer(4),a=new Uint8Array(d);d=new Uint32Array(d);a[0]=1;a[1]=2;a[2]=3;a[3]=4;return 67305985===d[0]},b=function(){var d=[];d[254]="NEWSUBFILETYPE";d[255]="SUBFILETYPE";d[256]="IMAGEWIDTH";d[257]="IMAGELENGTH";d[258]="BITSPERSAMPLE";d[259]="COMPRESSION";d[262]="PHOTOMETRICINTERPRETATION";d[263]="THRESHHOLDING";d[264]="CELLWIDTH";d[265]="CELLLENGTH";
d[266]="FILLORDER";d[269]="DOCUMENTNAME";d[270]="IMAGEDESCRIPTION";d[271]="MAKE";d[272]="MODEL";d[273]="STRIPOFFSETS";d[274]="ORIENTATION";d[277]="SAMPLESPERPIXEL";d[278]="ROWSPERSTRIP";d[279]="STRIPBYTECOUNTS";d[280]="MINSAMPLEVALUE";d[281]="MAXSAMPLEVALUE";d[282]="XRESOLUTION";d[283]="YRESOLUTION";d[284]="PLANARCONFIGURATION";d[285]="PAGENAME";d[286]="XPOSITION";d[287]="YPOSITION";d[288]="FREEOFFSETS";d[289]="FREEBYTECOUNTS";d[290]="GRAYRESPONSEUNIT";d[291]="GRAYRESPONSECURVE";d[292]="T4OPTIONS";
d[293]="T6OPTIONS";d[296]="RESOLUTIONUNIT";d[297]="PAGENUMBER";d[300]="COLORRESPONSEUNIT";d[301]="TRANSFERFUNCTION";d[305]="SOFTWARE";d[306]="DATETIME";d[315]="ARTIST";d[316]="HOSTCOMPUTER";d[317]="PREDICTOR";d[318]="WHITEPOINT";d[319]="PRIMARYCHROMATICITIES";d[320]="COLORMAP";d[321]="HALFTONEHINTS";d[322]="TILEWIDTH";d[323]="TILELENGTH";d[324]="TILEOFFSETS";d[325]="TILEBYTECOUNTS";d[326]="BADFAXLINES";d[327]="CLEANFAXDATA";d[328]="CONSECUTIVEBADFAXLINES";d[330]="SUBIFD";d[332]="INKSET";d[333]="INKNAMES";
d[334]="NUMBEROFINKS";d[336]="DOTRANGE";d[337]="TARGETPRINTER";d[338]="EXTRASAMPLES";d[339]="SAMPLEFORMAT";d[340]="SMINSAMPLEVALUE";d[341]="SMAXSAMPLEVALUE";d[342]="TRANSFERRANGE";d[347]="JPEGTABLES";d[512]="JPEGPROC";d[513]="JPEGIFOFFSET";d[514]="JPEGIFBYTECOUNT";d[515]="JPEGRESTARTINTERVAL";d[517]="JPEGLOSSLESSPREDICTORS";d[518]="JPEGPOINTTRANSFORM";d[519]="JPEGQTABLES";d[520]="JPEGDCTABLES";d[521]="JPEGACTABLES";d[529]="YCBCRCOEFFICIENTS";d[530]="YCBCRSUBSAMPLING";d[531]="YCBCRPOSITIONING";d[532]=
"REFERENCEBLACKWHITE";d[33550]="GEOPIXELSCALE";d[33922]="GEOTIEPOINTS";d[33432]="COPYRIGHT";d[42112]="GDAL_METADATA";d[42113]="GDAL_NODATA";d[50844]="RPCCOEFFICIENT";d[34735]="GEOKEYDIRECTORY";d[34736]="GEODOUBLEPARAMS";d[34737]="GEOASCIIPARAMS";return d}(),p=[0,1,1,2,4,8,1,1,2,4,8,4,8],f=function(d,a){var c="UNKNOWN";3===d?c="F32":1===d?8>=a?c="U8":16>=a?c="U16":32>=a&&(c="U32"):2===d&&(8>=a?c="S8":16>=a?c="S16":32>=a&&(c="S32"));return c};return{decode:function(d){var a=new DataView(d,0,8),c=a.getUint16(0,
!1);if(18761===c)var h=!0;else if(19789===c)h=!1;else throw"unexpected endianess byte";if(42!==a.getUint16(2,h))throw"unexpected tiff identifier";var l=a.getUint32(4,h);var k=h;var g,e;var q=l;for(var u=[];q;){var r=(new DataView(d,q,2)).getUint16(0,k);var x=q+2;q=(new DataView(d,x+12*r,4)).getUint32(0,k);var t={};for(g=0;g<r;g++){var w=new DataView(d,x,12);var z=w.getUint16(0,k);var B=w.getUint16(2,k);var A=w.getUint32(4,k);var y=w.getUint32(8,k);x+=12;if(!(7===B||12<B)){var E=e={fieldTag:z,fieldType:B,
fieldValueCount:A,fieldValueOffset:y},G=void 0,F=void 0,D=d,L=k,O=[],S=e.fieldType,Z=e.fieldValueCount,I=e.fieldValueOffset,N=I,K=p[S],Q=8*K,da=Z*K,U=Z*p[S]*8;if(32>=U)if(L||(I>>>=32-U),1===Z)O=[I];else for(G=0;G<Z;G++)O.push(I<<Q*G>>>32-Q);else for(N=I;N<I+da;N+=K){switch(S){case 1:F=(new DataView(D,N,1)).getUint8(0);break;case 2:F=(new DataView(D,N,1)).getUint8(0);break;case 3:F=(new DataView(D,N,2)).getUint16(0,L);break;case 4:F=(new DataView(D,N,4)).getUint32(0,L);break;case 5:F=(new DataView(D,
N,4)).getUint32(0,L)/(new DataView(D,N+4,4)).getUint32(0,L);break;case 6:F=(new DataView(D,N,1)).getInt8(0);break;case 8:F=(new DataView(D,N,2)).getInt16(0,L);break;case 9:F=(new DataView(D,N,4)).getInt32(0,L);break;case 10:F=(new DataView(D,N,4)).getInt32(0,L)/(new DataView(D,N+4,4)).getInt32(0,L);break;case 11:F=(new DataView(D,N,4)).getFloat32(0,L);break;case 12:F=(new DataView(D,N,8)).getFloat64(0,L);break;case 7:F=null;break;default:F=null}O.push(F)}if(2===S){var aa="",J=O;O=[];for(G=0;G<J.length;G++)0===
J[G]&&""!==aa?(O.push(aa),aa=""):aa+=String.fromCharCode(J[G]);""===aa&&0!==O.length||O.push(aa)}E.fieldValues=O;var T=t,Y=b[z];void 0===Y&&(Y="unknown"+z);T[Y]={type:B,values:e.fieldValues}}}u.push(t)}if(0===u.length)throw"no valid image file directory";var W,R=u[0],X=void 0===R.GDAL_NODATA||null===R.GDAL_NODATA?null:parseFloat(R.GDAL_NODATA.values[0]);if(R.TILEOFFSETS){var ia=v()===k,ka=R.TILEOFFSETS?R.TILEOFFSETS.values:void 0;if(void 0===ka)var ca=void 0;else{var la=R.TILEBYTECOUNTS.values,oa=
R.TILEWIDTH.values[0],wa=R.TILELENGTH.values[0],za=R.IMAGEWIDTH.values[0],Fa=R.IMAGELENGTH.values[0],Ba=za*Fa,Ca=R.BITSPERSAMPLE.values[0],va=R.SAMPLESPERPIXEL.values[0],Va=R.SAMPLEFORMAT?R.SAMPLEFORMAT.values[0]:1,Sa=f(Va,Ca);if(1!==(R.PLANARCONFIGURATION?R.PLANARCONFIGURATION.values[0]:1))throw"can only handle PLANARCONFIGURATION\x3d1";var Ra=R.COMPRESSION?R.COMPRESSION.values[0]:1;if(1!==Ra&&6!==Ra&&8!==Ra&&32946!==Ra)throw"this compression is not supported at this moment";if(3<Va)ca=void 0;else{if(3===
Va){var Ta=new Float32Array(Ba*va);var Wa=Float32Array}else 1===Va?8>=Ca?(Ta=new Uint8Array(Ba*va),Wa=Uint8Array):16>=Ca?(Ta=new Uint16Array(Ba*va),Wa=Uint16Array):32>=Ca&&(Ta=new Uint32Array(Ba*va),Wa=Uint32Array):2===Va&&(8>=Ca?(Ta=new Int8Array(Ba*va),Wa=Int8Array):16>=Ca?(Ta=new Int16Array(Ba*va),Wa=Int16Array):32>=Ca&&(Ta=new Int32Array(Ba*va),Wa=Int32Array));var La,$a,ya,Xa,bb,cb=Math.ceil(za/oa);if(0===Ca%8)for(La=0;La<ka.length;La++){var ab=Math.floor(La/cb)*wa;var Ua=La%cb*oa;var db=(ab*
za+Ua)*va;if("U8"===Sa||"S8"===Sa||ia)if(8===Ra||32946===Ra){var C=new Uint8Array(d,ka[La],la[La]);var H=new n(C);var M=H.getBytes();var V=new ArrayBuffer(M.length);C=new Uint8Array(V);C.set(M)}else if(6===Ra){C=new Uint8Array(d,ka[La],la[La]);var P=new m;P.parse(C);var ba=P.getData(P.width,P.height);V=new ArrayBuffer(ba.length);C=new Uint8Array(V);C.set(ba)}else 1===Ra&&(V=d.slice(ka[La],ka[La]+la[La]));else{if(8===Ra||32946===Ra){C=new Uint8Array(d,ka[La],la[La]);H=new n(C);C=H.getBytes();V=new ArrayBuffer(C.length);
var ea=new Uint8Array(V)}else 1===Ra&&(V=new ArrayBuffer(la[La]),C=new Uint8Array(d,ka[La],la[La]),ea=new Uint8Array(V));switch(Sa){case "U16":case "S16":for(ya=0;ya<C.length;ya+=2)ea[ya]=C[ya+1],ea[ya+1]=C[ya];break;case "U32":case "S32":case "F32":for(ya=0;ya<C.length;ya+=4)ea[ya]=C[ya+3],ea[ya+1]=C[ya+2],ea[ya+2]=C[ya+1],ea[ya+3]=C[ya]}}var ha=new Wa(V);var fa=0;var ja=db;var ma=Math.min(oa,za-Ua);var na=Math.min(wa,Fa-ab);for(Xa=0;Xa<na;Xa++)for(ja=db+Xa*za*va,fa=Xa*oa*va,bb=0;bb<ma*va;bb++,ja++,
fa++)Ta[ja]=ha[fa]}var qa={width:za,height:Fa,pixelType:Sa};if(1===va)qa.pixels=[Ta];else for(qa.pixels=[],La=0;La<va;La++){var xa=new Wa(Ba);for($a=0;$a<Ba;$a++)xa[$a]=Ta[$a*va+La];qa.pixels.push(xa)}ca=qa}}}else if(R.STRIPOFFSETS){var ta=v()===k,ua=R.STRIPOFFSETS?R.STRIPOFFSETS.values:void 0;if(void 0===ua)ca=void 0;else{var Da=R.STRIPBYTECOUNTS.values,Ma=R.ROWSPERSTRIP.values,Ha=R.IMAGEWIDTH.values[0],Ia=R.IMAGELENGTH.values[0],Aa=Ha*Ia,ra=R.BITSPERSAMPLE.values[0],sa=R.SAMPLESPERPIXEL.values[0],
Ka=R.SAMPLEFORMAT?R.SAMPLEFORMAT.values[0]:1,Pa=f(Ka,ra);if(1!==(R.PLANARCONFIGURATION?R.PLANARCONFIGURATION.values[0]:1))throw"can only handle PLANARCONFIGURATION\x3d1";var Qa=R.COMPRESSION?R.COMPRESSION.values[0]:1;if(1!==Qa&&6!==Qa&&8!==Qa&&32946!==Qa)throw"compressed tiff is not supported at this moment";if(3<Ka)ca=void 0;else{if(3===Ka){var Ya=new Float32Array(Aa*sa);var Za=Float32Array}else 1===Ka?8>=ra?(Ya=new Uint8Array(Aa*sa),Za=Uint8Array):16>=ra?(Ya=new Uint16Array(Aa*sa),Za=Uint16Array):
32>=ra&&(Ya=new Uint32Array(Aa*sa),Za=Uint32Array):2===Ka&&(8>=ra?(Ya=new Int8Array(Aa*sa),Za=Int8Array):16>=ra?(Ya=new Int16Array(Aa*sa),Za=Int16Array):32>=ra&&(Ya=new Int32Array(Ha*Ia*sa),Za=Int32Array));var Na,eb,Oa;if(0===ra%8)for(Na=0;Na<ua.length;Na++){var ib=Na*Ma*Ha*sa;if("U8"===Pa||"S8"===Pa||ta)if(8===Qa||32946===Qa){var pa=new Uint8Array(d,ua[Na],Da[Na]);var Ea=new n(pa);var Ja=Ea.getBytes();var Ga=new ArrayBuffer(Ja.length);pa=new Uint8Array(Ga);pa.set(Ja)}else if(6===Qa){pa=new Uint8Array(d,
ua[Na],Da[Na]);var fb=new m;fb.parse(pa);var jb=fb.getData(fb.width,fb.height);Ga=new ArrayBuffer(jb.length);pa=new Uint8Array(Ga);pa.set(jb)}else 1===Qa&&(Ga=d.slice(ua[Na],ua[Na]+Da[Na]));else{if(6===Qa||8===Qa||32946===Qa){pa=new Uint8Array(d,ua[Na],Da[Na]);Ea=new n(pa);pa=Ea.getBytes();Ga=new ArrayBuffer(pa.length);var gb=new Uint8Array(Ga)}else 1===Qa&&(Ga=new ArrayBuffer(Da[Na]),pa=new Uint8Array(d,ua[Na],Da[Na]),gb=new Uint8Array(Ga));switch(Pa){case "U16":case "S16":for(Oa=0;Oa<pa.length;Oa+=
2)gb[Oa]=pa[Oa+1],gb[Oa+1]=pa[Oa];break;case "U32":case "S32":case "F32":for(Oa=0;Oa<pa.length;Oa+=4)gb[Oa]=pa[Oa+3],gb[Oa+1]=pa[Oa+2],gb[Oa+2]=pa[Oa+1],gb[Oa+3]=pa[Oa]}}var lb=new Za(Ga);Ya.set(lb,ib)}var hb={width:Ha,height:Ia,pixelType:Pa};if(1===sa)hb.pixels=[Ya];else for(hb.pixels=[],Na=0;Na<sa;Na++){var kb=new Za(Aa);for(eb=0;eb<Aa;eb++)kb[eb]=Ya[eb*sa+Na];hb.pixels.push(kb)}ca=hb}}}if(null!==X){ca.maskData=new Uint8Array(ca.width*ca.height);if(1E24<Math.abs(X))for(W=0;W<ca.width*ca.height;W++)ca.maskData[W]=
1E-6>Math.abs((ca.pixels[0][W]-X)/X)?0:1;else for(W=0;W<ca.width*ca.height;W++)ca.maskData[W]=ca.pixels[0][W]===X?0:1;ca.noDataValue=X}return ca}}})},"esri/layers/rasterLib/tile/RasterHandler":function(){define("require exports module dojo/Deferred dojo/promise/all ../../PixelBlock ../../vectorTiles/core/workers ../../vectorTiles/core/promiseUtils ../../vectorTiles/core/requireUtils ../../vectorTiles/request ../../rasterLib/function/rasterFunctionHelper ../../rasterLib/renderer/rasterRendererHelper".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k){function g(e){var q=new b;p(e).then(function(u){q.resolve()});return q.promise}return function(){function e(q){this.customModules=q&&q.customModules}e.prototype.destroy=function(){this.stop();this.customModules=this.rasterLayer=null};e.prototype.start=function(){this.stop();var q=new b,u=0,r=this.customModules?this.customModules.length+1:1,x=c.getAbsMid("esri/layers/rasterLib/tile/RasterWorker",m,v),t=d.open(x,{client:this}).then(function(w){this._connection=w;u++;
u===r&&(this._connected=!0,q.resolve())}.bind(this));this._openDL=[t];this.customModules&&this.customModules.forEach(function(w){t=d.open(w,{client:this}).then(function(z){u++;u===r&&(this._connected=!0,q.resolve())});this._openDL.push(t)}.bind(this));return this._connectionPromise=q.promise};e.prototype.stop=function(){this._openDL?this._openDL.forEach(function(q){q.isFulfilled()||q.cancel()}.bind(this)):this._connectionPromise&&!this._connectionPromise.isFulfilled()&&this._connectionPromise.cancel();
this._connection&&(this._connection.close(),this._connection=null)};e.prototype.decode=function(q){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));var u={id:null};return this._connection.invoke("decode",q,[],u).then(function(r){r.targetWorker=u;return r})};e.prototype.process=function(q){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));var u={id:null};q.layerId=this.rasterLayer.layerId;var r=new b;
this._connection.invoke("process",q,[],u).then(function(x){x.targetWorker=u;x.src?Object.keys(x.src).forEach(function(t){x.src[t].pixelBlock=new f(x.src[t].pixelBlock)}):x.src=null;x.pixelBlock&&(x.pixelBlock=new f(x.pixelBlock));r.resolve(x)});return r.promise};e.prototype.render=function(q){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));var u={id:null};q.layerId=this.rasterLayer.layerId;return this._connection.invoke("render",q,[],u).then(function(r){r.targetWorker=
u;r.pixelBlock=r.pixelBlock?new f(r.pixelBlock):null;return r})};e.prototype.setLayer=function(q){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));this.rasterLayer=q;q=this._connection.broadcast("setLayer",q,[],{id:null});return g(q)};e.prototype.setRasterFunction=function(q){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));q=this._connection.broadcast("setRasterFunction",q,[],{id:null});return g(q)};
e.prototype.setRasterRenderer=function(q){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));q=this._connection.broadcast("setRasterRenderer",q,[],{id:null});return g(q)};return e}()})},"esri/layers/vectorTiles/core/workers":function(){define(["require","exports","./workers/workers"],function(m,n,v){Object.defineProperty(n,"__esModule",{value:!0});for(var b in v)n.hasOwnProperty(b)||(n[b]=v[b])})},"esri/layers/vectorTiles/core/workers/workers":function(){define("require exports dojo/sniff dojo/promise/all ../Logger ../promiseUtils ./Connection ./RemoteClient ./WorkerOwner".split(" "),
function(m,n,v,b,p,f,d,a,c){function h(){if(u)return u;for(var r=l+k,x=[],t=function(z){var B=c.create(z).then(function(A){return q[z]=A});x.push(B)},w=0;w<r;w++)t(w);return u=b(x).then(function(){})}Object.defineProperty(n,"__esModule",{value:!0});n.Connection=d;n.RemoteClient=a;(d=navigator.hardwareConcurrency)||(d=v("safari")&&v("mac")||v("trident")?8:2);var l=v("esri-workers-debug")?1:Math.max(1,Math.ceil(d/2)),k=v("esri-workers-debug")?1:Math.max(1,Math.floor(d/2)),g=p.getLogger("esri.core.workers"),
e=0,q=[];n.initialize=function(){h()};n.open=function(r,x,t){void 0===x&&(x={});if(Array.isArray(r))return new n.Connection(r.map(function(B){return new n.RemoteClient(B,x.client)}));if("string"!==typeof r){g.warn("workers-open:signature-deprecated","DEPRECATED: workers.open() changed signature.");var w=r;r=x;x={client:w,strategy:t?"dedicated":"distributed"}}var z=x.strategy||"distributed";return"local"===z?f.create(function(B){m([r],function(A){B(n.RemoteClient.connect(A))})}).then(function(B){return new n.Connection([new n.RemoteClient(B,
x.client)])}):h().then(function(){if("dedicated"===z){var B=l+e++;e%=k;return q[B].open(r).then(function(A){return new n.Connection([new n.RemoteClient(A,x.client)])})}return f.all(q.map(function(A){return A.open(r)})).then(function(A){return new n.Connection(A.map(function(y){return new n.RemoteClient(y,x.client)}))})})};n.terminate=function(){for(var r=0;r<q.length;r++)q[r]&&q[r].terminate();q.length=0};var u})},"esri/layers/vectorTiles/core/Logger":function(){define(["require","exports","dojo/has"],
function(m,n,v){var b={info:0,warn:1,error:2};m=function(){function p(f){void 0===f&&(f={});this.module=f.module||"";this.writer=f.writer||null;this.level=f.level||null;null!=f.enabled&&(this.enabled=!!f.enabled);p._loggers[this.module]=this;f=this.module.lastIndexOf(".");-1!==f&&(this.parent=p.getLogger(this.module.slice(0,f)))}p.prototype.log=function(f){for(var d=[],a=1;a<arguments.length;a++)d[a-1]=arguments[a];this._isEnabled()&&this._matchLevel(f)&&(a=this._inheritedWriter())&&a.apply(void 0,
[f,this.module].concat(d))};p.prototype.error=function(){for(var f=[],d=0;d<arguments.length;d++)f[d]=arguments[d];this.log.apply(this,["error"].concat(f))};p.prototype.warn=function(){for(var f=[],d=0;d<arguments.length;d++)f[d]=arguments[d];this.log.apply(this,["warn"].concat(f))};p.prototype.info=function(){for(var f=[],d=0;d<arguments.length;d++)f[d]=arguments[d];this.log.apply(this,["info"].concat(f))};p.prototype.getLogger=function(f){return p.getLogger(this.module+"."+f)};p.getLogger=function(f){var d=
p._loggers[f];d||(d=new p({module:f}));return d};p.prototype._parentWithMember=function(f,d){for(var a=this;a&&null==a[f];)a=a.parent;return a?a[f]:d};p.prototype._inheritedWriter=function(){return this._parentWithMember("writer",this._consoleWriter)};p.prototype._consoleWriter=function(f,d){for(var a=[],c=2;c<arguments.length;c++)a[c-2]=arguments[c];console[f].apply(console,["["+d+"]"].concat(a))};p.prototype._matchLevel=function(f){return b[this._parentWithMember("level","error")]<=b[f]};p.prototype._isEnabled=
function(){return this._parentWithMember("enabled",!0)};p._loggers={};return p}();m.getLogger("esri").level="warn";return m})},"esri/layers/vectorTiles/core/promiseUtils":function(){define("require exports dojo/Deferred dojo/when dojo/promise/all ./Error".split(" "),function(m,n,v,b,p,f){function d(a){if(a){if("function"!==typeof a.forEach){var c=Object.keys(a),h=c.map(function(e){return a[e]});return d(h).then(function(e){var q={};c.forEach(function(u,r){return q[u]=e[r]});return q})}var l=new v,
k=[],g=a.length;0===g&&l.resolve(k);a.forEach(function(e){var q={promise:e};k.push(q);e.then(function(u){q.value=u})["catch"](function(u){q.error=u}).then(function(){--g;0===g&&l.resolve(k)})});return l.promise}}Object.defineProperty(n,"__esModule",{value:!0});n.all=function(a){return p(a)};n.filter=function(a,c){var h=a.slice();return p(a.map(function(l,k){return c(l,k)})).then(function(l){return h.filter(function(k,g){return l[g]})})};n.eachAlways=d;n.create=function(a,c){var h=new v(c);a(function(l){void 0===
l&&(l=null);return b(l).then(h.resolve)},h.reject);return h.promise};n.reject=function(a){var c=new v;c.reject(a);return c.promise};n.resolve=function(a){void 0===a&&(a=null);var c=new v;c.resolve(a);return c.promise};n.after=function(a,c){void 0===c&&(c=null);var h=0,l=new v(function(){h&&(clearTimeout(h),h=0)});h=setTimeout(function(){l.resolve(c)},a);return l.promise};n.timeout=function(a,c,h){var l=0,k=new v(a.cancel);a.then(function(g){k.isFulfilled()||(k.resolve(g),l&&(clearTimeout(l),l=0))});
a["catch"](function(g){k.isFulfilled()||(k.reject(g),l&&(clearTimeout(l),l=0))});l=setTimeout(function(){var g=h||new f("promiseUtils:timeout","The wrapped promise did not resolve within "+c+" ms");k.reject(g)},c);return k.promise};n.wrapCallback=function(a){var c=!1,h=new v(function(){return c=!0});a(function(l){c||h.resolve(l)});return h.promise};n.isThenable=function(a){return a&&"function"===typeof a.then};n.when=function(a){return b(a)}})},"esri/layers/vectorTiles/core/Error":function(){define(["require",
"exports","./tsSupport/extendsHelper","./lang","./Message"],function(m,n,v,b,p){m=function(f){function d(a,c,h){var l=f.call(this,a,c,h)||this;return l instanceof d?l:new d(a,c,h)}v(d,f);d.prototype.toJSON=function(){return{name:this.name,message:this.message,details:b.clone(this.details),dojoType:this.dojoType}};d.fromJSON=function(a){var c=new d(a.name,a.message,a.details);null!=a.dojoType&&(c.dojoType=a.dojoType);return c};return d}(p);m.prototype.type="error";return m})},"esri/layers/vectorTiles/core/tsSupport/extendsHelper":function(){define([],
function(){return function(){var m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,v){n.__proto__=v}||function(n,v){for(var b in v)v.hasOwnProperty(b)&&(n[b]=v[b])};return function(n,v){function b(){this.constructor=n}m(n,v);n.prototype=null===v?Object.create(v):(b.prototype=v.prototype,new b)}}()})},"esri/layers/vectorTiles/core/lang":function(){define("dojo/_base/kernel dojo/_base/lang dojo/date dojo/number dojo/date/locale dojo/i18n!../nls/common".split(" "),function(m,n,v,b,
p,f){function d(e){return void 0!==e&&null!==e}function a(e){return d(e)?e:""}function c(e,q,u){var r=u.match(/([^\(]+)(\([^\)]+\))?/i),x=n.trim(r[1]);u=q[e];r=JSON.parse((r[2]?n.trim(r[2]):"{}").replace(/^\(/,"{").replace(/\)$/,"}").replace(/([{,])\s*([0-9a-zA-Z_]+)\s*:/gi,'$1"$2":').replace(/"\s*:\s*'/gi,'":"').replace(/'\s*(,|\})/gi,'"$1'));var t=r.utcOffset;if(-1===k.indexOf(x))x=n.getObject(x),n.isFunction(x)&&(u=x(u,e,q,r));else if("number"===typeof u||"string"===typeof u&&u&&!isNaN(Number(u)))switch(u=
Number(u),x){case "NumberFormat":e=n.mixin({},r);q=parseFloat(e.places);if(isNaN(q)||0>q)e.places=Infinity;return b.format(u,e);case "DateString":u=new Date(u);if(r.local||r.systemLocale)return r.systemLocale?u.toLocaleDateString()+(r.hideTime?"":" "+u.toLocaleTimeString()):u.toDateString()+(r.hideTime?"":" "+u.toTimeString());u=u.toUTCString();r.hideTime&&(u=u.replace(/\s+\d\d:\d\d:\d\d\s+(utc|gmt)/i,""));return u;case "DateFormat":return u=new Date(u),d(t)&&(u=v.add(u,"minute",u.getTimezoneOffset()-
t)),p.format(u,r)}return a(u)}function h(e,q){var u;if(q)for(u in e)e.hasOwnProperty(u)&&(void 0===e[u]?delete e[u]:e[u]instanceof Object&&h(e[u],!0));else for(u in e)e.hasOwnProperty(u)&&void 0===e[u]&&delete e[u];return e}function l(e){if(!e||"object"!=typeof e||n.isFunction(e))return e;if(e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Float32Array||
e instanceof Float64Array||e instanceof Date)return new e.constructor(e);if(e instanceof ArrayBuffer)return e.slice(0,e.byteLength);if("function"===typeof e.clone)e=e.clone();else if("function"===typeof e.map&&"function"===typeof e.forEach)e=e.map(l);else if("function"===typeof e.notifyChange&&"function"===typeof e.watch)e=e.clone();else{var q={},u,r={};for(u in e){var x=e[u];var t=!(u in r)||r[u]!==x;if(!(u in q)||q[u]!==x&&t)q[u]=l?l(x):x}e=q}return e}var k=["NumberFormat","DateString","DateFormat"],
g=/<\/?[^>]+>/g;return{equals:function(e,q){return e===q||"number"===typeof e&&isNaN(e)&&"number"===typeof q&&isNaN(q)||n.isFunction((e||{}).getTime)&&n.isFunction((q||{}).getTime)&&e.getTime()==q.getTime()||n.isFunction((e||{}).equals)&&e.equals(q)||n.isFunction((q||{}).equals)&&q.equals(e)||!1},mixin:n.mixin,valueOf:function(e,q){for(var u in e)if(e[u]==q)return u;return null},stripTags:function(e){if(e){var q=typeof e;if("string"===q)e=e.replace(g,"");else if("object"===q)for(var u in e)(q=e[u])&&
"string"===typeof q&&(q=q.replace(g,"")),e[u]=q}return e},substitute:function(e,q,u){if(d(u))if(n.isObject(u)){var r=u.first;var x=u.dateFormat;var t=u.numberFormat}else r=u;if(q&&"{*}"!==q)return n.replace(q,n.hitch({obj:e},function(z,B){var A=B.split(":");return 1<A.length?(B=A[0],A.shift(),c(B,this.obj,A.join(":"))):x&&-1!==(x.properties||[]).indexOf(B)?c(B,this.obj,x.formatter||"DateString"):t&&-1!==(t.properties||[]).indexOf(B)?c(B,this.obj,t.formatter||"NumberFormat"):a(this.obj[B])}));q=[];
var w;q.push('\x3ctable class\x3d"esri-widget__table" summary\x3d"'+f.fieldsSummary+'"\x3e\x3ctbody\x3e');for(w in e)if(u=e[w],x&&-1!==(x.properties||[]).indexOf(w)?u=c(w,e,x.formatter||"DateString"):t&&-1!==(t.properties||[]).indexOf(w)&&(u=c(w,e,t.formatter||"NumberFormat")),q.push("\x3ctr\x3e\x3cth\x3e"+w+"\x3c/th\x3e\x3ctd\x3e"+a(u)+"\x3c/td\x3e\x3c/tr\x3e"),r)break;q.push("\x3c/tbody\x3e\x3c/table\x3e");return q.join("")},filter:function(e,q,u){q=[n.isString(e)?e.split(""):e,u||m.global,n.isString(q)?
new Function("item","index","array",q):q];u={};var r;e=q[0];for(r in e)q[2].call(q[r],e[r],r,e)&&(u[r]=e[r]);return u},startsWith:function(e,q,u){u=u||0;return e.indexOf(q,u)===u},endsWith:function(e,q,u){if("number"!==typeof u||!isFinite(u)||Math.floor(u)!==u||u>e.length)u=e.length;u-=q.length;e=e.indexOf(q,u);return-1!==e&&e===u},isDefined:d,fixJson:h,clone:l}})},"esri/layers/vectorTiles/core/Message":function(){define(["require","exports","dojo/string"],function(m,n,v){return function(){function b(p,
f,d){this instanceof b&&(this.name=p,this.message=f&&v.substitute(f,d,function(a){return null==a?"":a})||"",this.details=d)}b.prototype.toString=function(){return"["+this.name+"]: "+this.message};return b}()})},"esri/layers/vectorTiles/core/workers/Connection":function(){define(["require","exports","../promiseUtils"],function(m,n,v){return function(){function b(p){this._clientIdx=0;this._clients=p}b.prototype.broadcast=function(p,f,d){for(var a=[],c=0,h=this._clients;c<h.length;c++)a.push(h[c].invoke(p,
f,d));return a};b.prototype.close=function(){for(var p=0,f=this._clients;p<f.length;p++)f[p].close();this._clients=[]};b.prototype.invoke=function(p,f,d,a){var c=a&&a.client;if(!this._clients||!this._clients.length)return v.reject(Error("Connection closed"));null!=c&&-1!==this._clients.indexOf(c)||this._clients.some(function(h){return h.isBusy()?!1:(c=h,!0)})||(this._clientIdx=(this._clientIdx+1)%this._clients.length,c=this._clients[this._clientIdx]);p=c.invoke(p,f,d);a&&(a.client=c);return p};b.prototype.openPorts=
function(){return v.all(this._clients.map(function(p){return p.openPort()}))};return b}()})},"esri/layers/vectorTiles/core/workers/RemoteClient":function(){define("require exports dojo/Deferred ../Error ../promiseUtils ./utils".split(" "),function(m,n,v,b,p,f){function d(e,q){e["delete"](q)}var a=f.MessageType.CLOSE,c=f.MessageType.CANCEL,h=f.MessageType.INVOKE,l=f.MessageType.RESPONSE,k=f.MessageType.OPEN_PORT,g=function(){function e(q){this._timer=null;this._cancelledJobIds=new Set;this._invokeMessages=
[];this._invoke=q;this._timer=null;this._process=this._process.bind(this)}e.prototype.push=function(q){q.type===f.MessageType.CANCEL?this._cancelledJobIds.add(q.jobId):(this._invokeMessages.push(q),null===this._timer&&(this._timer=setTimeout(this._process,0)))};e.prototype.clear=function(){this._invokeMessages.length=0;this._cancelledJobIds.clear();this._timer=null};e.prototype._process=function(){this._timer=null;for(var q=0,u=this._invokeMessages;q<u.length;q++){var r=u[q];this._cancelledJobIds.has(r.jobId)||
this._invoke(r)}this._cancelledJobIds.clear();this._invokeMessages.length=0};return e}();return function(){function e(q,u,r){this._outJobs=new Map;this._inJobs=new Map;this._queue=new g(this._onInvoke.bind(this));this._onMessage=this._onMessage.bind(this);this._client=u;this._port=q;this._port.addEventListener("message",this._onMessage);this._port.start();this._channel=r}e.connect=function(q){var u=new MessageChannel;q="function"===typeof q?new q:"default"in q&&"function"===typeof q["default"]?new q["default"]:
q;q.remoteClient=new e(u.port1,q,u);return u.port2};e.prototype.close=function(){this._post({type:a});this._close()};e.prototype.isBusy=function(){return 0<this._outJobs.size};e.prototype.invoke=function(q,u,r){var x=this;if(!this._port)return p.reject(new b("remote-client:port-closed","Can't invoke(), port is closed"));var t=f.newJobId(),w=new v(function(){d(x._outJobs,t);x._post({type:c,jobId:t})});this._outJobs.set(t,w);this._post({type:h,jobId:t,methodName:q},u,r);return w.promise};e.prototype.openPort=
function(){var q=this,u=f.newJobId(),r=new v(function(){d(q._outJobs,u);q._post({type:c,jobId:u})});this._outJobs.set(u,r);this._post({type:k,jobId:u});return r.promise};e.prototype._close=function(){this._channel&&(this._channel=null);this._port.removeEventListener("message",this._onMessage);this._port.close();this._outJobs.forEach(function(q){q.cancel()});this._inJobs.clear();this._outJobs.clear();this._queue.clear();this._port=this._client=null};e.prototype._onMessage=function(q){if(q=f.receiveMessage(q))switch(q.type){case l:this._onResponse(q);
break;case h:this._queue.push(q);break;case c:this._onCancel(q);break;case a:this._close();break;case k:this._onOpenPort(q)}};e.prototype._onCancel=function(q){var u=this._inJobs,r=q.jobId,x=u.get(r);this._queue.push(q);x&&(d(u,r),x.cancel())};e.prototype._onInvoke=function(q){var u=this,r=q.methodName,x=q.jobId;q=q.data;var t=this._inJobs,w=this._client,z=w[r];try{if(!z&&r&&-1!==r.indexOf("."))for(var B=r.split("."),A=0;A<B.length-1;A++)w=w[B[A]],z=w[B[A+1]];if("function"!==typeof z)throw new TypeError(r+
" is not a function");var y=z.call(w,q,this)}catch(E){this._post({type:l,jobId:x,error:f.toInvokeError(E)});return}p.isThenable(y)?(t.set(x,y),y.then(function(E){t.has(x)&&(d(t,x),u._post({type:l,jobId:x},E))})["catch"](function(E){t.has(x)&&(d(t,x),E&&"cancel"===E.dojoType||u._post({type:l,jobId:x,error:f.toInvokeError(E||{message:"Error encountered at method "+r})}))})):this._post({type:l,jobId:x},y)};e.prototype._onOpenPort=function(q){var u=new MessageChannel;new e(u.port1,this._client);this._post({type:l,
jobId:q.jobId},u.port2,[u.port2])};e.prototype._onResponse=function(q){var u=q.jobId,r=q.error;q=q.data;var x=this._outJobs;if(x.has(u)){var t=x.get(u);d(x,u);r?t.reject(b.fromJSON(JSON.parse(r))):t.resolve(q)}};e.prototype._post=function(q,u,r){return f.postMessage(this._port,q,u,r)};return e}()})},"esri/layers/vectorTiles/core/workers/utils":function(){define(["require","exports","dojo/has"],function(m,n,v){function b(f){return f&&"object"===typeof f&&("result"in f||"transferList"in f)}Object.defineProperty(n,
"__esModule",{value:!0});(function(f){f[f.HANDSHAKE=0]="HANDSHAKE";f[f.CONFIGURE=1]="CONFIGURE";f[f.CONFIGURED=2]="CONFIGURED";f[f.OPEN=3]="OPEN";f[f.OPENED=4]="OPENED";f[f.RESPONSE=5]="RESPONSE";f[f.INVOKE=6]="INVOKE";f[f.CANCEL=7]="CANCEL";f[f.CLOSE=8]="CLOSE";f[f.OPEN_PORT=9]="OPEN_PORT"})(n.MessageType||(n.MessageType={}));var p=0;n.newJobId=function(){return p++};n.isTranferableResult=b;n.toInvokeError=function(f){return f?f.toJSON?JSON.stringify(f):JSON.stringify({name:f.name,message:f.message,
details:f.details,stack:f.stack}):null};n.postMessage=function(f,d,a,c){2===arguments.length||void 0===a&&void 0===c?f.postMessage(d):(v("esri-workers-supports-transfer-arraybuffer")||(c?(c=c.filter(function(h){return!(h instanceof ArrayBuffer)}),c.length||(c=null)):b(a)&&a.transferList&&(a.transferList=a.transferList.filter(function(h){return!(h instanceof ArrayBuffer)}),a.transferList.length||(a.transferList=null))),c?(d.data=a,f.postMessage(d,c)):b(a)?(d.data=a.result,a.transferList?f.postMessage(d,
a.transferList):f.postMessage(d)):(d.data=a,f.postMessage(d)))};n.receiveMessage=function(f){return f?(f=f.data)?"string"===typeof f?JSON.parse(f):f:null:null}})},"esri/layers/vectorTiles/core/workers/WorkerOwner":function(){define("require exports dojo/Deferred ../../kernel ../Error ../Logger ../promiseUtils ./utils ./workerFactory".split(" "),function(m,n,v,b,p,f,d,a,c){var h=f.getLogger("esri.core.workers"),l=a.MessageType.CANCEL,k=a.MessageType.INVOKE,g=a.MessageType.OPEN,e=a.MessageType.OPENED,
q=a.MessageType.RESPONSE;return function(){function u(r,x){this._outJobs=new Map;this._inJobs=new Map;this.worker=r;this.id=x;r.addEventListener("message",this._onMessage.bind(this));r.addEventListener("error",function(t){t.preventDefault();h.error(t)})}u.create=function(r){return c.createWorker().then(function(x){return new u(x,r)})};u.prototype.terminate=function(){this.worker.terminate()};u.prototype.open=function(r){var x=this,t=a.newJobId(),w=new v(function(z){x._outJobs["delete"](t);x._post({type:l,
jobId:t})});this._outJobs.set(t,w);this._post({type:g,jobId:t,modulePath:r});return w.promise};u.prototype._onMessage=function(r){if(r=a.receiveMessage(r))switch(r.type){case e:case q:this._onResponse(r);break;case l:this._onCancel(r);break;case k:this._onInvoke(r)}};u.prototype._onCancel=function(r){(r=this._inJobs.get(r.jobId))&&r.cancel()};u.prototype._onInvoke=function(r){var x=this,t=r.methodName,w=r.jobId;r=r.data;var z=this._inJobs,B=b.workerMessages[t];try{if("function"!==typeof B)throw new TypeError(t+
" is not a function");var A=B.call(null,r)}catch(y){this._post({type:q,jobId:w,error:a.toInvokeError(y)});return}d.isThenable(A)?(z.set(w,A),A.then(function(y){z["delete"](w);x._post({type:q,jobId:w},y)})["catch"](function(y){z["delete"](w);y||(y={message:"Error encountered at method"+t});y.dojoType&&"cancel"===y.dojoType||x._post({type:q,jobId:w,error:a.toInvokeError(y)})})):this._post({type:q,jobId:w},A)};u.prototype._onResponse=function(r){var x=r.jobId,t=r.error;r=r.data;var w=this._outJobs.get(x);
w&&(this._outJobs["delete"](x),t?w.reject(p.fromJSON(JSON.parse(t))):w.resolve(r))};u.prototype._post=function(r,x,t){return a.postMessage(this.worker,r,x,t)};return u}()})},"esri/layers/vectorTiles/kernel":function(){define(["require","exports","esri/kernel","./identity/IdentityManager"],function(m,n,v,b){return function(){function p(){}Object.defineProperty(p,"id",{get:function(){return v.id?b:null},enumerable:!0,configurable:!0});p.workerMessages={};return p}()})},"esri/layers/vectorTiles/identity/IdentityManager":function(){define(["require",
"exports","esri/IdentityManager"],function(m,n,v){Object.defineProperty(n,"__esModule",{value:!0});n.findCredential=function(b){return v.findCredential(b)}})},"esri/layers/vectorTiles/core/workers/workerFactory":function(){define("require exports ../tsSupport/assignHelper dojo/_base/kernel ../../config ../../request ../Logger ../promiseUtils ../sniff ../urlUtils ./loaderConfig ./utils ./WorkerFallback".split(" "),function(m,n,v,b,p,f,d,a,c,h,l,k,g){function e(B){return a.create(function(A){function y(G){if(G=
k.receiveMessage(G))switch(G.type){case z:G=B;var F=p.workers.loaderUrl||l.DEFAULT_LOADER_URL;if(null!=p["default"]){var D=v({},p);delete D["default"];D=JSON.parse(JSON.stringify(D))}else D=JSON.parse(JSON.stringify(p));var L=p.workers.loaderConfig;L=l["default"]({baseUrl:L.baseUrl,locale:b.locale,has:v({"config-deferredInstrumentation":0,"dojo-test-sniff":0,"esri-cors":1,"esri-secure-context":c("esri-secure-context"),"esri-workers-supports-transfer-arraybuffer":c("esri-workers-supports-transfer-arraybuffer"),
"events-keypress-typed":0,"host-webworker":1},L.has),map:v({},L.map),paths:v({},L.paths),packages:L.packages||[]});G.postMessage({type:w,configure:{esriConfig:D,loaderUrl:F,loaderConfig:L}});break;case t:B.removeEventListener("message",y),B.removeEventListener("error",E),A(B)}}function E(G){G.preventDefault();B.removeEventListener("message",y);B.removeEventListener("error",E);r.warn("Failed to create Worker. Fallback to execute module in main thread",G);B=new g;B.addEventListener("message",y);B.addEventListener("error",
E)}B.addEventListener("message",y);B.addEventListener("error",E)})}Object.defineProperty(n,"__esModule",{value:!0});var q=h.normalize(m.toUrl("./worker.js")),u=!h.hasSameOrigin(q,location.href),r=d.getLogger("esri.core.workers"),x=null,t=k.MessageType.CONFIGURED,w=k.MessageType.CONFIGURE,z=k.MessageType.HANDSHAKE;n.createWorker=function(){if(!c("esri-workers"))return e(new g);if(!u){var B=void 0;try{B=new Worker(q)}catch(A){r.warn("Failed to create Worker. Fallback to execute module in main thread",
event),B=new g}return e(B)}x||(x=f(q,{responseType:"text"}));return x.then(function(A){return new Worker(URL.createObjectURL(new Blob([A.data],{type:"text/javascript"})))})["catch"](function(A){r.warn("Failed to create Worker. Fallback to execute module in main thread",A);return new g}).then(function(A){return e(A)})}})},"esri/layers/vectorTiles/core/tsSupport/assignHelper":function(){define([],function(){return Object.assign||function(m){for(var n,v=1,b=arguments.length;v<b;v++){n=arguments[v];for(var p in n)Object.prototype.hasOwnProperty.call(n,
p)&&(m[p]=n[p])}return m}})},"esri/layers/vectorTiles/config":function(){define(["require","exports","esri/config"],function(m,n,v){Object.defineProperty(v,"workers",{get:function(){return v.defaults.workers},set:function(b){return v.defaults.workers=b}});return v})},"esri/layers/vectorTiles/request":function(){define(["require","exports","esri/request","dojo/_base/lang","dojo/Deferred"],function(m,n,v,b,p){return function(f,d){var a=b.mixin({},{url:f,failOk:!0},d);"array-buffer"===d.responseType?
(a.handleAs="arraybuffer",delete a.responseType):d.responseType&&(a.handleAs=d.responseType,delete a.responseType);null!==d.query&&(a.content=a.query,delete a.query);if(d.hasOwnProperty("allowImageDataAccess")){var c={allowImageDataAccess:d.allowImageDataAccess};delete a.allowImageDataAccess}var h=new p(function(){l.isFulfilled()||l.cancel()});var l=v(a,c).then(function(k){h.resolve({data:k})})["catch"](function(k){k&&null!=k.httpCode&&(k.details=k.details||{},k.details.httpStatus=k.httpCode);h.reject(k)});
return h.promise}})},"esri/layers/vectorTiles/core/sniff":function(){define(["require","exports","dojo/sniff","./global","../views/webgl/context-util"],function(m,n,v,b,p){function f(){var h={available:!1,version:0,majorPerformanceCaveat:!1,supportsHighPrecisionFragment:!1,supportsVertexShaderSamplers:!1,supportsElementIndexUint:!1,supportsStandardDerivatives:!1},l=document.createElement("canvas");if(!l)return h;var k=p.createContext(l,{failIfMajorPerformanceCaveat:!0},"webgl");!k&&(k=p.createContext(l,
{},"webgl"))&&(h.majorPerformanceCaveat=!0);if(!k)return h;l=k.getParameter(k.VERSION);if(!l)return h;if(l=l.match(/^WebGL\s+([\d.]*)/))h.version=parseFloat(l[1]),h.available=.94<=h.version,l=k.getShaderPrecisionFormat(k.FRAGMENT_SHADER,k.HIGH_FLOAT),h.supportsHighPrecisionFragment=l&&0<l.precision,h.supportsVertexShaderSamplers=0<k.getParameter(k.MAX_VERTEX_TEXTURE_IMAGE_UNITS),h.supportsElementIndexUint=null!==k.getExtension("OES_element_index_uint"),h.supportsStandardDerivatives=null!==k.getExtension("OES_standard_derivatives");
return h}function d(){var h={available:!1,version:0},l=document.createElement("canvas");if(!l)return h;l=p.createContext(l,{},"webgl2");if(!l)return h;h.available=!0;l=l.getParameter(l.VERSION);if(!l)return h;if(l=l.match(/^WebGL\s+([\d.]*)/))h.version=parseFloat(l[1]);return h}(function(){var h=navigator.userAgent,l=h.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i);h=h.match(/iPhone/i);l&&v.add("esri-mobile",l);h&&v.add("esri-iPhone",h);v.add("esri-phonegap",!!b.cordova);
v.add("esri-cors",v("esri-phonegap")||"XMLHttpRequest"in b&&"withCredentials"in new XMLHttpRequest);v.add("esri-geolocation",function(){return!!navigator.geolocation});v.add("esri-canvas-svg-support",function(){return!(v("trident")||v("ie"))});v.add("esri-secure-context",function(){if("isSecureContext"in b)return b.isSecureContext;if(b.location&&b.location.origin)return 0===b.location.origin.indexOf("https:")});v.add("esri-wasm","WebAssembly"in b);v("host-webworker")||(v.add("esri-workers","Worker"in
b),v.add("esri-script-sandbox",function(){return"MessageChannel"in b&&"HTMLIFrameElement"in b&&"sandbox"in HTMLIFrameElement.prototype}),v.add("esri-url-encodes-apostrophe",function(){var k=b.document.createElement("a");k.href="?'";return-1<k.href.indexOf("?%27")}),a||(a=f()),v.add("esri-webgl",a.available),v.add("esri-webgl-high-precision-fragment",a.supportsHighPrecisionFragment),v.add("esri-webgl-vertex-shader-samplers",a.supportsVertexShaderSamplers),v.add("esri-webgl-element-index-uint",a.supportsElementIndexUint),
v.add("esri-webgl-standard-derivatives",a.supportsStandardDerivatives),v.add("esri-webgl-major-performance-caveat",a.majorPerformanceCaveat),v.add("esri-featurelayer-webgl-labeling",!0),c||(c=d()),v.add("esri-webgl2",c.available))})();var a=null,c=null;return v})},"esri/layers/vectorTiles/core/global":function(){define(["require","exports"],function(m,n){return function(){if("undefined"!==typeof global)return global;if("undefined"!==typeof window)return window;if("undefined"!==typeof self)return self}()})},
"esri/layers/vectorTiles/views/webgl/context-util":function(){define(["require","exports"],function(m,n){function v(d,a,c){void 0===a&&(a={});switch(c){case "webgl":var h=["webgl","experimental-webgl","webkit-3d","moz-webgl"];break;case "webgl2":h=["webgl2"];break;default:h=["webgl","experimental-webgl","webkit-3d","moz-webgl"]}c=null;for(var l=0;l<h.length;l++){var k=h[l];try{c=d.getContext(k,a)}catch(g){}if(c)break}return c}function b(d,a){var c=d.parentNode;c&&(c.innerHTML='\x3ctable style\x3d"background-color: #8CE; width: 100%; height: 100%;"\x3e\x3ctr\x3e\x3ctd align\x3d"center"\x3e\x3cdiv style\x3d"display: table-cell; vertical-align: middle;"\x3e\x3cdiv style\x3d""\x3e'+
a+"\x3c/div\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e")}Object.defineProperty(n,"__esModule",{value:!0});n.createContextOrErrorHTML=function(d,a,c){void 0===a&&(a={});if(!window.WebGLRenderingContext)return b(d,p),null;a=v(d,a,c);return a?a:(b(d,f),null)};n.createContext=v;var p='This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e',f='It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e'})},
"esri/layers/vectorTiles/core/urlUtils":function(){define(["require","exports","esri/urlUtils","dojo/_base/url"],function(m,n,v,b){function p(w){return v.normalize(w)}function f(w){return"data:"===w.slice(0,5)}function d(w){return a(w)||x.test(w)}function a(w){return w&&"/"===w[0]&&"/"===w[1]}function c(w){return v.urlToObject(w)}function h(w){if("string"===typeof w)return new b(k(w));w.scheme||(w.scheme=n.appUrl.scheme);return w}function l(w){if(f(w))return null;var z=w.indexOf("://");if(-1===z&&
a(w))z=2;else if(-1!==z)z+=3;else return null;z=w.indexOf("/",z);return-1===z?w:w.slice(0,z)}function k(w,z,B){void 0===z&&(z=n.appBaseUrl);if(a(w))return B&&B.preserveProtocolRelative?w:"http"===n.appUrl.scheme&&n.appUrl.authority===l(w).slice(2)?"http:"+w:"https:"+w;if(x.test(w))return w;"/"===w[0]&&(B=z.indexOf("//"),B=z.indexOf("/",B+2),z=-1===B?z:z.slice(0,B));return e(z,w)}function g(w,z,B){void 0===B&&(B=!1);w=h(w);z=h(z);return B||w.scheme===z.scheme?w.host.toLowerCase()===z.host.toLowerCase()&&
w.port===z.port:!1}function e(){for(var w=[],z=0;z<arguments.length;z++)w[z]=arguments[z];if(w&&w.length){z=[];if(d(w[0])){var B=w[0],A=B.indexOf("//");z.push(B.slice(0,A+1));r.test(w[0])&&(z[0]+="/");w[0]=B.slice(A+2)}else"/"===w[0][0]&&z.push("");w=w.reduce(function(y,E){return E?y.concat(E.split("/")):y},[]);for(B=0;B<w.length;B++)A=w[B],".."===A&&0<z.length?z.pop():!A||"."===A&&0!==z.length||z.push(A);return z.join("/")}}function q(w,z,B){if(!(z&&B&&w&&d(w)))return w;var A=w.indexOf("//"),y=w.indexOf("/",
A+2),E=w.indexOf(":",A+2);y=Math.min(0>y?w.length:y,0>E?w.length:E);if(w.slice(A+2,y).toLowerCase()!==z.toLowerCase())return w;z=w.slice(0,A+2);w=w.slice(y);return""+z+B+w}function u(w,z,B){void 0===z&&(z=n.appBaseUrl);if(!d(w))return w;var A=p(w),y=A.toLowerCase();z=p(z).toLowerCase().replace(/\/+$/,"");if((B=B?p(B).toLowerCase().replace(/\/+$/,""):null)&&0!==z.indexOf(B))return w;for(var E=function(D,L,O){O=D.indexOf(L,O);return-1===O?D.length:O},G=E(y,"/",y.indexOf("//")+2),F=-1;y.slice(0,G+1)===
z.slice(0,G)+"/";){F=G+1;if(G===y.length)break;G=E(y,"/",G+1)}if(-1===F||B&&F<B.length)return w;w=A.slice(F);A=z.slice(F-1).replace(/[^/]+/g,"").length;if(0<A)for(y=0;y<A;y++)w="../"+w;else w="./"+w;return w}Object.defineProperty(n,"__esModule",{value:!0});n.normalize=p;n.canUseXhr=function(w){return v.canUseXhr(w)};n.removeTrailingSlash=function(w){return w.replace(/\/+$/,"")};m=Function("return this")();n.appUrl=new b(m.location);n.appBaseUrl=function(){var w=n.appUrl.path;w=w.substring(0,w.lastIndexOf(w.split("/")[w.split("/").length-
1]));return n.appUrl.scheme+"://"+n.appUrl.host+(null!=n.appUrl.port?":"+n.appUrl.port:"")+w}();var r=/^\s*file:/i,x=/^\s*[a-z][a-z0-9-+.]*:[^0-9]/i;n.isDataProtocol=f;n.isAbsolute=d;n.isProtocolRelative=a;n.urlToObject=c;n.getOrigin=l;n.makeAbsolute=k;n.hasSameOrigin=g;n.join=e;n.removeFile=function(w){var z=0;if(d(w)){var B=w.indexOf("//");-1!==B&&(z=B+2)}B=w.lastIndexOf("/");return B<z?w:w.slice(0,B+1)};n.addProxy=function(w){return v.addProxy(w)};n.makeData=function(w){return w.isBase64?"data:"+
w.mediaType+";base64,"+w.data:"data:"+w.mediaType+","+w.data};var t=/^data:(.*?)(;base64)?,(.*)$/;n.dataComponents=function(w){return(w=w.match(t))?{mediaType:w[1],isBase64:!!w[2],data:w[3]}:null};n.changeDomain=q;n.read=function(w,z){var B=z&&z.url&&z.url.path;w&&B&&(w=k(w,B,{preserveProtocolRelative:!0}));B=w;var A=z&&z.portal;if(A&&!A.isPortal&&A.urlKey&&A.customBaseUrl){var y=A.urlKey+"."+A.customBaseUrl;B=g(n.appUrl,n.appUrl.scheme+"://"+y)?q(B,A.portalHostname,y):q(B,y,A.portalHostname)}return B};
n.write=function(w,z){if(!w)return w;!d(w)&&z&&z.blockedRelativeUrls&&z.blockedRelativeUrls.push(w);var B=k(w);if(z){var A=z.verifyItemRelativeUrls&&z.verifyItemRelativeUrls.rootPath||z.url&&z.url.path;A&&(B=u(B,A,A),B!==w&&z.verifyItemRelativeUrls&&z.verifyItemRelativeUrls.writtenUrls.push(B))}B=(A=z&&z.portal)&&!A.isPortal&&A.urlKey&&A.customBaseUrl?q(B,A.urlKey+"."+A.customBaseUrl,A.portalHostname):B;return B};n.makeRelative=u;n.removeQueryParameters=function(w){w=c(w);Object.keys(w.query||{});
return w.path}})},"esri/layers/vectorTiles/core/workers/loaderConfig":function(){define(["require","exports","../tsSupport/assignHelper","dojo/has","../urlUtils"],function(m,n,v,b,p){Object.defineProperty(n,"__esModule",{value:!0});n.DEFAULT_LOADER_URL=p.makeAbsolute(p.removeQueryParameters(m.toUrl("./worker-init.js")));n.DEFAULT_CONFIG={baseUrl:function(){var f=p.removeQueryParameters(m.toUrl("dojo/x.js"));return p.makeAbsolute(f.slice(0,f.length-5))}(),packages:[{name:"esri"},{name:"dojo"},{name:"dojox"},
{name:"dstore"},{name:"moment",main:"moment"},{name:"@dojo"},{name:"cldrjs",main:"dist/cldr"},{name:"globalize",main:"dist/globalize"},{name:"maquette",main:"dist/maquette.umd"},{name:"maquette-css-transitions",main:"dist/maquette-css-transitions.umd"},{name:"maquette-jsx",main:"dist/maquette-jsx.umd"},{name:"tslib",main:"tslib"}],map:{globalize:{cldr:"cldrjs/dist/cldr","cldr/event":"cldrjs/dist/cldr/event","cldr/supplemental":"cldrjs/dist/cldr/supplemental","cldr/unresolved":"cldrjs/dist/cldr/unresolved"}}};
n["default"]=function(f){var d={async:f.async,isDebug:f.isDebug,locale:f.locale,baseUrl:f.baseUrl,has:v({},f.has),map:v({},f.map),packages:f.packages&&f.packages.concat()||[],paths:v({},f.paths)};f.hasOwnProperty("async")||(d.async=!0);f.hasOwnProperty("isDebug")||(d.isDebug=!1);f.baseUrl||(d.baseUrl=n.DEFAULT_CONFIG.baseUrl);n.DEFAULT_CONFIG.packages.forEach(function(l){a:{for(var k=d.packages,g=0;g<k.length;g++)if(k[g].name===l.name)break a;l=v({},l);g=p.removeQueryParameters(m.toUrl(l.name+"/x.js"));
g=g.slice(0,g.length-5);l.location=p.makeAbsolute(g);k.push(l)}});f=d.map=d.map||{};for(var a=0,c=Object.keys(n.DEFAULT_CONFIG.map);a<c.length;a++){var h=c[a];f[h]||(f[h]=n.DEFAULT_CONFIG.map[h])}return d}})},"esri/layers/vectorTiles/core/workers/WorkerFallback":function(){define(["require","exports","dojo/has","../global","./utils"],function(m,n,v,b,p){var f=function(){return function(){var c=this,h=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(function(l){c[l]=
function(){for(var k=[],g=0;g<arguments.length;g++)k[g]=arguments[g];return h[l].apply(h,k)}})}}(),d=b.MutationObserver||b.WebKitMutationObserver,a=function(){if(b.process&&b.process.nextTick)var c=function(k){b.process.nextTick(k)};else if(b.Promise)c=function(k){b.Promise.resolve().then(k)};else if(d){var h=[],l=document.createElement("div");(new d(function(){for(;0<h.length;)h.shift()()})).observe(l,{attributes:!0});c=function(k){h.push(k);l.setAttribute("queueStatus","1")}}return c}();return function(){function c(){this._dispatcher=
new f;this._isInitialized=!1;this._workerPostMessage({type:p.MessageType.HANDSHAKE})}c.prototype.terminate=function(){};Object.defineProperty(c.prototype,"onmessage",{get:function(){return this._onmessageHandler},set:function(h){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler);(this._onmessageHandler=h)&&this.addEventListener("message",h)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"onerror",{get:function(){return this._onerrorHandler},set:function(h){this._onerrorHandler&&
this.removeEventListener("error",this._onerrorHandler);(this._onerrorHandler=h)&&this.addEventListener("error",h)},enumerable:!0,configurable:!0});c.prototype.postMessage=function(h,l){var k=this;a(function(){k._workerMessageHandler(new MessageEvent("message",{data:h}))})};c.prototype.dispatchEvent=function(h){return this._dispatcher.dispatchEvent(h)};c.prototype.addEventListener=function(h,l,k){this._dispatcher.addEventListener(h,l,k)};c.prototype.removeEventListener=function(h,l,k){this._dispatcher.removeEventListener(h,
l,k)};c.prototype._workerPostMessage=function(h,l){var k=this;a(function(){k.dispatchEvent(new MessageEvent("message",{data:h}))})};c.prototype._workerMessageHandler=function(h){var l=this;if(h=p.receiveMessage(h)){var k=h.jobId;switch(h.type){case p.MessageType.CONFIGURE:this._isInitialized||this._workerPostMessage({type:p.MessageType.CONFIGURED});break;case p.MessageType.OPEN:h=h.modulePath,v("esri-webpack")?m(["esri/core/workers/RemoteClient","esri/views/vectorTiles/WorkerTileHandler","esri/views/2d/layers/features/Pipeline",
"esri/views/3d/layers/PointCloudWorker","esri/views/3d/layers/SceneLayerWorker","esri/layers/graphics/sources/support/CSVSourceWorker","esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker",h],function(g,e,q,u,r,x,t,w){switch(w){case "esri/views/vectorTiles/WorkerTileHandler":break;case "esri/views/2d/layers/features/Pipeline":e=q;break;case "esri/views/3d/layers/PointCloudWorker":e=u;break;case "esri/views/3d/layers/SceneLayerWorker":e=r;break;case "esri/layers/graphics/sources/support/CSVSourceWorker":e=
x;break;case "esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":e=t;break;default:e=w}g=g.connect(e);l._workerPostMessage({type:p.MessageType.OPENED,jobId:k,data:g})}):m(["./RemoteClient",h],function(g,e){var q=g.connect(e);l._workerPostMessage({type:p.MessageType.OPENED,jobId:k,data:q})})}}};return c}()})},"esri/layers/vectorTiles/core/requireUtils":function(){define(["require","exports","dojo/Deferred"],function(m,n,v){function b(p,f){if(Array.isArray(f)){var d=new v;p(f,function(){for(var a=
[],c=0;c<arguments.length;c++)a[c]=arguments[c];d.resolve(a)});return d.promise}return b(p,[f]).then(function(a){return a[0]})}Object.defineProperty(n,"__esModule",{value:!0});n.when=b;n.getAbsMid=function(p,f,d){return f.toAbsMid?f.toAbsMid(p):d.id.replace(/\/[^\/]*$/gi,"/")+p}})},"esri/layers/rasterLib/function/rasterFunctionHelper":function(){define(["dojo/_base/declare","dojo/_base/lang","./rasterFunctionRegistry"],function(m,n,v){return{create:function(b,p){if(b){var f=b.renderTexture,d=Object.keys(b);
if(b.read&&!p)return b;b.read&&p&&(b=b.toJson());-1<d.indexOf("name")&&d.indexOf(!1)?(d=n.mixin({},b),d=this._parseV2(d,p)):(d="esri.layers.RasterFunction"===b.declaredClass?b.toJson():n.mixin({},b),d=this._parseV1(d,p));d.branchCount=d.updateBranchStructure();d.renderTexture||(d.renderTexture=!!f);return d}},_parseV1:function(b,p){var f=b.rasterFunction,d=b.rasterFunctionArguments,a=b.renderTexture||b.rasterFunctionArguments.renderTexture||!1,c,h,l,k,g,e,q;(k=d.raster||d.Raster)&&k.rasterFunction&&
(c=this._parseV1(k,p));(k=d.raster2||d.Raster2)&&k.rasterFunction&&(h=this._parseV1(k,p));(k=d.rasters||d.Rasters)&&0<k.length&&(l=k.map(n.hitch(this,function(u){return u&&u.rasterFunction?this._parseV1(u,p):u})));(k=d.dem||d.DEM)&&(k.functionName||k.rasterFunction)&&(g=this._parseV1(k,p));(k=d.fillRaster||d.FillRaster)&&(k.functionName||k.rasterFunction)&&(e=this._parseV1(k,p));k=v.functions[f];if(!k)return null;f=new k(d);f.variableName&&(k=d[f.variableName])&&(k.functionName||k.rasterFunction)&&
(q=this._parseV1(k,p));b.outputPixelType&&(f.pixelType=b.outputPixelType);"$$"===c?f.functionArguments.raster=p&&p.raster:null!=c?f.functionArguments.raster=c:f.functionArguments.raster||(f.functionArguments.raster=p&&p.raster);null!=h&&(f.functionArguments.raster2=h);null!=l&&(f.functionArguments.rasters=l.map(function(u){"$$"===u&&(u=p&&p.raster);return u}));null!=g&&(f.functionArguments.dem=g);null!=e&&(f.functionArguments.fillRaster=e);null!=q&&(f.functionArguments[f.variableName]=q);f.renderTexture=
a;return f},_parseV2:function(b,p){if(!b)return null;var f=n.clone(b);this._bindV2Args(f,p);var d={};this._convertTov1(f,d);return this._parseV1(d,p)},_bindV2Args:function(b,p){(b||p)&&Object.keys(b).forEach(function(f){b[f]["function"]&&b[f].arguments?this._bindV2Args(b[f].arguments,p):null!=p[b[f].name]&&(b[f].value=p[b[f].name])}.bind(this))},_convertV2Types:function(b){if(!b)return null;"ArgumentArray"===b.type?b.elements&&"RasterStatistics"===b.elements[0].type&&(b=b.elements):b instanceof Array&&
0===b.length&&(b=null);return b},_convertTov1:function(b,p){if((b||p)&&b["function"]){var f=b["function"],d=b.arguments;p.rasterFunction=f.type.replace("Function","");p.outputPixelType="UNKNOWN"===f.pixelType?"Unknown":f.pixelType;p.rasterFunctionArguments={};var a;Object.keys(d).forEach(function(c){d[c]["function"]&&d[c].arguments?(p.rasterFunctionArguments[c]={},this._convertTov1(d[c],p.rasterFunctionArguments[c])):(a=d[c].value,p.rasterFunctionArguments[c]="object"!==typeof a||a.functionArguments?
a:this._convertV2Types(a))}.bind(this))}}}})},"esri/layers/rasterLib/function/rasterFunctionRegistry":function(){define("dojo/_base/declare dojo/_base/lang ../../rasterLib/function/AspectFunction ../../rasterLib/function/BandArithmeticFunction ../../rasterLib/function/ColormapFunction ../../rasterLib/function/CompositeBandFunction ../../rasterLib/function/ContrastBrightnessFunction ../../rasterLib/function/ConvolutionFunction ../../rasterLib/function/ExtractBandFunction ../../rasterLib/function/HillshadeFunction ../../rasterLib/function/LocalFunction ../../rasterLib/function/MaskFunction ../../rasterLib/function/NDVIFunction ../../rasterLib/function/SlopeFunction ../../rasterLib/function/StretchFunction ../../rasterLib/function/RemapFunction ../../rasterLib/function/IdentityFunction ../../rasterLib/function/ResampleFunction".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x){return function(){function t(A){A.prototype.supportWebGL&&(z[A.prototype.functionName]=A);A.prototype.support2D&&(w[A.prototype.functionName]=A);B[A.prototype.functionName]=A}var w={},z={},B={};t(v);t(b);t(p);t(f);t(d);t(a);t(c);t(h);t(l);t(k);t(g);t(e);t(q);t(u);t(r);t(x);return{cpu:w,gpu:z,functions:B,register:t,getFunction:function(A){return B[A]},support:function(A,y){return!!("gpu"===y?z:"cpu"===y?w:B)[A]}}}()})},"esri/layers/rasterLib/function/AspectFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils".split(" "),
function(m,n,v,b,p,f,d,a){return m([v,d],{declaredClass:"esri.layers.rasterLib.function.AspectFunction",functionName:"Aspect",supportWebGL:!0,support2D:!0,constructor:function(c){this.functionArguments=this.mixinIgnoreCase({raster:null},c)},bind:function(){var c=this.getSourceRasterInfo();if(!c.raster)return Error("The raster input to aspect function is invalid.");this.rasterInfo=n.mixin(c.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:[{min:0,max:360}],histograms:null});
this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(c){this._performance.start();c=a.aspect(c.raster);this._addPerformanceMetric(this._performance.elapsed());return c},readGL:function(c){this._performance.start();this._initializeProgram({fragment:f.aspect,fragmentName:"Aspect"});var h=this._setupTextureData(c.raster),l=this.bindFrameBuffer(),k=this.gl,g=k.drawingBufferWidth;k=k.drawingBufferHeight;var e=h.extent;
this._setUniforms({u_resolution:c&&c.raster&&c.raster.pixelBlock?[1/c.raster.pixelBlock.width,1/c.raster.pixelBlock.height]:[1/g,1/k],u_cellSize:[(e.xmax-e.xmin)/g,(e.ymax-e.ymin)/k]});this._bindTexture(h.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:h.extent,texture:l.texture}}})})},"esri/layers/rasterLib/function/RasterFunctionX":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/config ../raster/RasterInfo ../../../geometry/Extent ../../PixelBlock".split(" "),
function(m,n,v,b,p,f){return m(null,{functionName:null,functionArguments:null,pixelType:"Unknown",rasterInfo:null,constructor:function(d){d&&(this.pixelType=d.outputPixelType||d.OutputPixelType||this.pixelType,this.renderTexture=d.renderTexture,this._initFunction())},mixinIgnoreCase:function(d,a){var c=Object.keys(d),h=Object.keys(a),l,k,g=c.length;for(l=0;l<h.length;l++){var e=a[h[l]];if(null!=e)for(k=0;k<g;k++)if(c[k].toLowerCase()===h[l].toLowerCase()){d[c[k]]=e;break}}return d},bind:function(d){},
setProcessingContext:function(d){if(!d)throw"cannot bind to layer without options";this.useWebGL=!!d.useWebGL;this._tileMode=!!d.tileMode;this._glSetting=d.glSetting;this._rawRasterInfo=d.rawRasterInfo;this._xformSetting=d.xformSetting||this._xformSetting;if(!this.useWebGL||this._glSetting&&this._glSetting.gl){this.gl=this.useWebGL?this._glSetting.gl:null;this._glSetting&&(this._glSetting.pingpong=null,this._glSetting.branches=null);var a=this.functionArguments.raster,c=this.functionArguments.raster2,
h=this.functionArguments.dem,l=this.functionArguments.fillRaster,k=this.functionArguments.rasters;a&&a.functionArguments&&a.setProcessingContext(d);c&&c.functionArguments&&c.setProcessingContext(d);h&&h.functionArguments&&h.setProcessingContext(d);l&&l.functionArguments&&l.setProcessingContext(d);if(k)for(a=0;a<k.length;a++)k[a]&&k[a].functionArguments&&k[a].setProcessingContext(d);this.bind()}},updateBranchStructure:function(){var d=0,a=this.functionArguments;a.raster&&a.raster.read&&a.raster.functionArguments&&
(d+=a.raster.updateBranchStructure());a.raster2&&a.raster2.read&&a.raster2.functionArguments&&(d+=a.raster2.updateBranchStructure(),a.raster2.isBranch=!0,a.raster&&a.raster.read&&(a.raster.isBranch=!0));a.rasters&&(d=a.rasters.length,a.rasters.forEach(function(c){c.read&&c.functionArguments&&(c.isBranch=!0)}));a.dem&&a.dem.read&&a.dem.functionArguments&&(d+=a.dem.updateBranchStructure());return 1===d?0:d},read:function(d){d=this.processRasterArgument(d);return this.useWebGL?this.readGL(d):this.read2D(d)},
hasTilingEffects:function(){return!1},read2D:function(){},readGL:function(){},getSourceRasterInfo:function(){var d,a={};if(this.functionArguments.raster2)a.functionArguments.raster=this._bindRaster(this.functionArguments.raster),a.functionArguments.raster2=this._bindRaster(this.functionArguments.raster2);else if(this.functionArguments.rasters)for(a.rasters=[],d=0;d<this.functionArguments.rasters.length;d++)a.rasters[d]=this._bindRaster(this.functionArguments.rasters[d]);else a.raster=this._bindRaster(this.functionArguments.raster);
return this.sourceRasterInfo=a},processRasterArgument:function(d){var a=this.bind();if(!0!==a)throw a;var c={};if(this.functionArguments.raster2)c.raster=this._readRaster(this.functionArguments.raster,d),c.raster2=this._readRaster(this.functionArguments.raster2,d);else if(this.functionArguments.rasters)for(c.rasters=[],a=0;a<this.functionArguments.rasters.length;a++)c.rasters[a]=this._readRaster(this.functionArguments.rasters[a],d);else c.raster=this._readRaster(this.functionArguments.raster,d);return c},
toJson:function(){var d=this.functionArguments,a=d.raster,c=d.raster2;d=d.rasters;a=a?a.toJson?a.toJson():a:null;c=c?c.toJson?c.toJson():c:null;var h;d&&0<d.length&&(h=d.map(function(l){return l.toJson?l.toJson():l}));d=n.mixin({},this.functionArguments);d.raster=a;d.raster2=c;d.rasters=h;d=this._fixRasterFunctionJson(d);return{rasterFunction:this.functionName,rasterFunctionArguments:d,outputPixelType:this.pixelType}},_initFunction:function(d){},_getIntegerRange:function(d){switch(d){case "U8":var a=
[0,255];break;case "U16":a=[0,65535];break;case "U32":a=[0,4294967295];break;case "S8":a=[-128,127];break;case "S16":a=[-32768,32767];break;case "S32":a=[-2147483648,2147483647]}return a},_calculatePixelType:function(d,a){return d&&"unknown"!==d.toLowerCase()?d:a},_clonePixelData:function(d){if(null==d)return d;var a={};d.extent&&(a.extent=new p(d.extent.xmin,d.extent.ymin,d.extent.xmax,d.extent.ymax,d.extent.spatialReference));d=d.pixelBlock;if(null==d)return a;a.pixelBlock=d.clone?d.clone():f.prototype.clone(d);
return a},_readRaster:function(d,a){if(null==d||"$$"===d)var c=this._clonePixelData(a.src[Object.keys(a.src)[0]]);else if(d&&d.rasterInfo&&!d.functionArguments)c=this._clonePixelData(a.src[d._rasterId]);else if(isNaN(d))d.read&&(c=d.functionArguments?d.read(a):this._clonePixelData(a));else{c=a.src?a.src[Object.keys(a.src)[0]]:a;var h=c.pixelBlock;h=new Float32Array(h.width*h.height);h.fill(parseFloat(d));c=this._clonePixelData(c);c.pixelBlock.pixels=[h];c.isConstant=!0}return c},_bindRaster:function(d){if(d&&
"$$"!==d)isNaN(d)?d.rasterInfo?a=d.rasterInfo:d.bind&&d.bind()&&(a=d.rasterInfo):a={};else var a=this._rawRasterInfo;a&&(a=a.clone?a.clone():new b(a),a.bandCount=a.bandCount||3);return a},_getOutputBand:function(d,a){switch(d){case "U8":var c=new Uint8Array(a);break;case "U16":c=new Uint16Array(a);break;case "U32":c=new Uint32Array(a);break;case "S8":c=new Int8Array(a);break;case "S16":c=new Int16Array(a);break;case "S32":c=new Int32Array(a);break;case "U32":c=new Uint32Array(a);break;case "F32":c=
new Float32Array(a);break;case "F64":c=new Float64Array(a);break;default:c=new Float32Array(a)}return c},_clampBand:function(d,a,c){if(("F64"===a||"F32"===a)&&!c)return d;var h,l=this._getIntegerRange(a),k=d.length;if(l)for(c=l[1],l=l[0],a=this._getOutputBand(a,k),h=0;h<k;h++){var g=d[h];a[h]=g>c?c:g<l?l:g}else a=d;return a},_performance:{start:function(){return this._start=self.performance&&self.performance.now()||new Date}.bind(this),elapsed:function(){return(self.performance&&self.performance.now()||
new Date)-this._start}.bind(this)},_addPerformanceMetric:function(d){v.isDebug&&(self.rasterFunctionPerformance||(self.rasterFunctionPerformance=[]),self.rasterFunctionPerformance.push(d),50<self.rasterFunctionPerformance.length&&self.rasterFunctionPerformance.shift())},_fixRasterFunctionJson:function(d){for(var a in d)d.hasOwnProperty(a)&&(null==d[a]?delete d[a]:d[a]instanceof Object&&!d[a].sourceType&&this._fixRasterFunctionJson(d[a],!0));return d}})})},"esri/layers/rasterLib/function/pixelShaders":function(){define(["dojo/_base/declare",
"dojo/_base/lang","./pixelShaderScripts"],function(m,n,v){m={shaderType:"fragment",getShader:function(b,p){var f=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(f,p);b.compileShader(f);b.getShaderParameter(f,b.COMPILE_STATUS)||(f=null);return f}};n.mixin(m,v);return m})},"esri/layers/rasterLib/function/pixelShaderScripts":function(){define([],function(){return{aspect:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform vec2 u_cellSize;\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nfloat pi \x3d 3.141592653589793238;\nfloat dz_dx \x3d 0.0;\nfloat dz_dy \x3d 0.0;\nvec4 va, vb, vc,vd,ve,vf,vg,vh,vi;\nvec2 axy \x3d vec2(-1.0,-1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s)\n{\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t)\n{\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e1.0-u_resolution.s)\n{\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0- u_resolution.t)\n{\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nif (v_texCoord.s \x3e\x3d u_resolution.s \x26\x26 (1.0-u_resolution.s)\x3e\x3dv_texCoord.s \x26\x26 v_texCoord.t \x3e\x3d u_resolution.t \x26\x26 (1.0-u_resolution.t)\x3e\x3dv_texCoord.t)\n{\nva \x3d texture2D(u_image, v_texCoord + u_resolution* axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution* bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution* cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution* dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution* vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution* fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution* gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution* hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution* ixy);\n}\ndz_dx \x3d (vc+2.0*vf+vi - va - 2.0*vd - vg).r/(8.0*u_cellSize[0]);\ndz_dy \x3d -(vg+2.0*vh+vi - va - 2.0*vb - vc).r/(8.0*u_cellSize[1]);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat aspect_rad \x3d 0.0;\nif (dz_dx \x3d\x3d 0.0)\n{\nif (dz_dy \x3e 0.0)\naspect_rad \x3d 0.5 * pi;\nelse if (dz_dy \x3c 0.0)\naspect_rad \x3d 1.5 * pi;\nelse\nalpha \x3d 0.0;//undefined make it nodata\n}\nelse\n{\naspect_rad \x3d 0.5*pi + atan(dz_dy, -dz_dx);\nif (aspect_rad \x3c 0.0)\naspect_rad \x3d 2.0*pi + aspect_rad;\n}\nfloat aspect \x3d aspect_rad * 180.0 / pi;\ngl_FragColor \x3d vec4(aspect, aspect, aspect, alpha);\n}",
bandArithmetic:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandId_nir;\nuniform int u_bandId_red;\nuniform bool u_scaled;\nuniform int u_bandCount;\nuniform int u_method;\nuniform float u_constants[6];\nvec4 calculateNDVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat ndvi_denom \x3d nir + red;\nfloat ndvi;\nif (ndvi_denom \x3d\x3d 0.0) {\nndvi \x3d 0.0;\n} else {\nndvi \x3d (nir - red) / ndvi_denom;\nif (u_scaled) {\nndvi \x3d float(floor(ndvi * 100.0 + 100.5));\n}\n}\nreturn vec4(ndvi, ndvi, ndvi, currentPixel.a);\n}\nvec4 calculateSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat savi_denom \x3d nir + red + u_constants[0];\nfloat savi;\nif (savi_denom \x3d\x3d 0.0) {\nsavi \x3d 0.0;\n} else {\nsavi \x3d (nir - red) / savi_denom * (1.0 + u_constants[0]);\n}\nreturn vec4(savi, savi, savi, currentPixel.a);\n}\nvec4 calculateMSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat msavi \x3d 0.5 * (2.0 * (nir + 1.0) - sqrt(pow((2.0 * nir + 1.0), 2.0) - 8.0 * (nir - red)));\nreturn vec4(msavi, msavi, msavi, currentPixel.a);\n}\nvec4 calculateTSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat s \x3d u_constants[0];\nfloat a \x3d u_constants[1];\nfloat x \x3d u_constants[2];\nfloat tsavi_denom \x3d a * nir + red - a * s + x * (1.0 + s * s);\nfloat tsavi;\nif (tsavi_denom \x3d\x3d 0.0) {\ntsavi \x3d 0.0;\n} else {\ntsavi \x3d s * (nir - s * red - a) / tsavi_denom;\n}\nreturn vec4(tsavi, tsavi, tsavi, currentPixel.a);\n}\nvec4 calculatePVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat a \x3d u_constants[0];\nfloat b \x3d u_constants[1];\nfloat pvi \x3d (nir - a * red - b) / sqrt(1.0 + a * 2.0);\nreturn vec4(pvi, pvi, pvi, currentPixel.a);\n}\nvec4 calculateGEMI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat gemi;\nif (red \x3d\x3d 1.0) {\ngemi \x3d 0.0;\n} else {\nfloat eta \x3d (2.0 * (nir * nir - red * red) + 1.5 * nir + 0.5 * red) / (nir + red + 0.5);\nfloat gemi \x3d eta * (1.0 - 0.25*eta) - (red - 0.125) / (1.0 - red);\n}\nreturn vec4(gemi, gemi, gemi, currentPixel.a);\n}\nvec4 calculateVARI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(currentPixel.r);\nfloat green \x3d float(currentPixel.g);\nfloat blue \x3d float(currentPixel.b);\nfloat vari \x3d (green - red) /(green + red - blue);\nreturn vec4(vari, vari, vari, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 pv;\nif (u_method \x3c 4) {\nif (u_method \x3d\x3d 1) {\npv \x3d calculateNDVI();\n} else if (u_method \x3d\x3d 2) {\npv \x3d calculateSAVI();\n} else if (u_method \x3d\x3d 3) {\npv \x3d calculateTSAVI();\n} else if (u_method \x3d\x3d 4) {\npv \x3d calculateMSAVI();\n}\n} else {\nif (u_method \x3d\x3d 5) {\npv \x3d calculateGEMI();\n} else if (u_method \x3d\x3d 6) {\npv \x3d calculatePVI();\n} else if (u_method \x3d\x3d 7) {\npv \x3d calculateGEMI();\n} else if (u_method \x3d\x3d 9) {\npv \x3d calculateVARI();\n}\n}\ngl_FragColor \x3d pv;\n}",
colormap:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nvec4 colorize() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat clrIndex \x3d currentPixel.r - u_indexedColormapOffset;\nvec4 result;\nif (currentPixel.a \x3d\x3d 0.0 || clrIndex \x3e u_indexedColormapMaxIndex) {\nresult \x3d vec4(0.0, 0.0, 0.0, 0.0);\n}\nelse {\nvec2 clrPosition \x3d vec2(clrIndex / u_indexedColormapMaxIndex, 0.0);\nvec4 color \x3d texture2D(u_image1, clrPosition);\nresult \x3d vec4(color.r, color.g, color.b, color.a);\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d colorize();\n}",
compositeBand:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform int u_rasterCount;\nvec4 composite() {\nvec4 p0, p1, p2;\np0 \x3d texture2D(u_image, v_texCoord);\nvec4 result;\nif (u_rasterCount \x3d\x3d 1){\nresult \x3d p0;\n}\nelse if (u_rasterCount \x3d\x3d 2){\np1 \x3d texture2D(u_image1, v_texCoord);\nresult \x3d vec4(p0.r,p1.r,0.0,min(p0.a,p1.a));\n}\nelse if (u_rasterCount \x3d\x3d 3){\np1 \x3d texture2D(u_image1, v_texCoord);\np2 \x3d texture2D(u_image2, v_texCoord);\nresult \x3d vec4(p0.r,p1.r,p2.r,min(min(p0.a,p1.a),p2.a));\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d composite();\n}",
constant:"precision mediump float;\nuniform vec4 u_color;\nvoid main() {\ngl_FragColor \x3d u_color;\n}",contrastBrightness:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform float u_contrastOffset;\nuniform float u_brightnessOffset;\nuniform float u_scaleFactor;\nvec4 adjustContrastBrightness() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat c \x3d u_contrastOffset;\nfloat b \x3d u_brightnessOffset;\nfloat maxI \x3d 255.0;\nfloat mid \x3d 128.0;\nvec4 v;\nif (c \x3e 0.0 \x26\x26 c \x3c 100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + 2.0 * maxI * b) / (2.0 * (100.0 - c)) + mid;\n} else if (c \x3c\x3d 0.0 \x26\x26 c \x3e -100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + 2.0 * maxI * b) * (100.0 + c) / 20000.0 + mid;\n} else if (c \x3d\x3d 100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + (maxI + 1.0) * (100.0 - c) + 2.0 * maxI * b);\nv \x3d (sign(v) + 1.0) / 2.0; //binary contrast with extra mid tone at 0.5\n} else if (c \x3d\x3d -100.0) {\nv \x3d vec4(mid, mid, mid, currentPixel.a); //no contrast\n}\nreturn vec4(v.r / u_scaleFactor, v.g / u_scaleFactor, v.b / u_scaleFactor, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d adjustContrastBrightness();\n}",
convolution:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform float u_kernel[25];\nuniform int u_kernelSize;\nvec4 convolve33(){\nvec4 vp11, vp12, vp13, vp21, vp22, vp23, vp31, vp32, vp33;\nvec2 xy11 \x3d vec2(-1.0, -1.0);\nvec2 xy12 \x3d vec2(0.0, -1.0);\nvec2 xy13 \x3d vec2(1.0, -1.0);\nvec2 xy21 \x3d vec2(-1.0, 0.0);\nvec2 xy23 \x3d vec2(1.0, 0.0);\nvec2 xy31 \x3d vec2(-1.0, 1.0);\nvec2 xy32 \x3d vec2(0.0, 1.0);\nvec2 xy33 \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\nxy11[0] \x3d 1.0;\nxy21[0] \x3d 1.0;\nxy31[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\nxy11[1] \x3d 1.0;\nxy12[1] \x3d 1.0;\nxy13[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\nxy13[0] \x3d -1.0;\nxy23[0] \x3d -1.0;\nxy33[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\nxy31[1] \x3d -1.0;\nxy32[1] \x3d -1.0;\nxy33[1] \x3d -1.0;\n}\nvec4 convolResult \x3d\ntexture2D(u_image, v_texCoord + u_resolution * xy11) * u_kernel[0] +\ntexture2D(u_image, v_texCoord + u_resolution * xy12) * u_kernel[1] +\ntexture2D(u_image, v_texCoord + u_resolution * xy13) * u_kernel[2] +\ntexture2D(u_image, v_texCoord + u_resolution * xy21) * u_kernel[3] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(0, 0)) * u_kernel[4] +\ntexture2D(u_image, v_texCoord + u_resolution * xy23) * u_kernel[5] +\ntexture2D(u_image, v_texCoord + u_resolution * xy31) * u_kernel[6] +\ntexture2D(u_image, v_texCoord + u_resolution * xy32) * u_kernel[7] +\ntexture2D(u_image, v_texCoord + u_resolution * xy33) * u_kernel[8];\nreturn vec4(convolResult.rgb, texture2D(u_image, v_texCoord).a);\n}\nvec4 convolve55(){\nvec4 vp11, vp12, vp13, vp21, vp22, vp23, vp31, vp32, vp33;\nfloat xdif[5];//https://www.opengl.org/wiki/Data_Type_(GLSL) array constructor ES3.0\nfloat ydif[5];\nfloat a \x3d -2.0;\nfor (int i\x3d0; i\x3c5; i++){\nxdif[i] \x3d a;\nydif[i] \x3d a;\na++;\n}\nif (v_texCoord.s \x3c u_resolution.s *2.0) { //2 pixel\nxdif[0] \x3d 2.0;\nif (v_texCoord.s \x3c u_resolution.s) { //1 pixel\nxdif[1] \x3d 1.0;\n}\n}\nelse if (v_texCoord.s \x3e 1.0 - u_resolution.s *2.0) {\nxdif[0] \x3d -2.0;\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\nxdif[1] \x3d -1.0;\n}\n}\nif (v_texCoord.t \x3c u_resolution.t *2.0) {\nydif[0] \x3d 2.0;\nif (v_texCoord.t \x3c u_resolution.t) {\nydif[1] \x3d 1.0;\n}\n}\nelse if (v_texCoord.t \x3e 1.0 - u_resolution.t*2.0) {\nydif[0] \x3d -2.0;\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\nydif[1] \x3d -1.0;\n}\n}\nvec4 convolResult \x3d\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[0])) * u_kernel[0] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[0])) * u_kernel[1] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[0])) * u_kernel[2] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[0])) * u_kernel[3] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[0])) * u_kernel[4] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[1])) * u_kernel[5] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[1])) * u_kernel[6] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[1])) * u_kernel[7] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[1])) * u_kernel[8] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[1])) * u_kernel[9] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[2])) * u_kernel[10] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[2])) * u_kernel[11] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[2])) * u_kernel[12] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[2])) * u_kernel[13] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[2])) * u_kernel[14] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[3])) * u_kernel[15] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[3])) * u_kernel[16] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[3])) * u_kernel[17] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[3])) * u_kernel[18] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[3])) * u_kernel[19] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[4])) * u_kernel[20] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[4])) * u_kernel[21] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[4])) * u_kernel[22] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[4])) * u_kernel[23] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[4])) * u_kernel[24];\nreturn vec4(convolResult.rgb, texture2D(u_image, v_texCoord).a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nif (u_kernelSize \x3d\x3d 9){\ngl_FragColor \x3d convolve33();\n}\nelse {\ngl_FragColor \x3d convolve55();\n}\n}",
extractBand:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandIDs[3];\nuniform bool u_alterBand;\nvec4 extractBand() {\nvec4 p \x3d texture2D(u_image, v_texCoord);\nif (!u_alterBand){\nreturn p;\n}\nfloat r, g, b;\nif (u_bandIDs[0] \x3d\x3d0){\nr \x3d p.r;\n}\nelse if (u_bandIDs[0] \x3d\x3d1){\nr \x3d p.g;\n}\nelse if (u_bandIDs[0] \x3d\x3d2){\nr \x3d p.b;\n}\nif (u_bandIDs[1] \x3d\x3d0){\ng \x3d p.r;\n}\nelse if (u_bandIDs[1] \x3d\x3d1){\ng \x3d p.g;\n}\nelse if (u_bandIDs[1] \x3d\x3d2){\ng \x3d p.b;\n}\nif (u_bandIDs[2] \x3d\x3d0){\nb \x3d p.r;\n}\nelse if (u_bandIDs[2] \x3d\x3d1){\nb \x3d p.g;\n}\nelse if (u_bandIDs[2] \x3d\x3d2){\nb \x3d p.b;\n}\nreturn vec4(r, g, b, p.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d extractBand();\n}",
hillshade:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform int u_slopeType;\nuniform int u_hillshadeType;\nuniform int u_lightSourceCount;\nuniform float u_sinZcosA;\nuniform float u_sinZsinA;\nuniform float u_cosZ;\nuniform float u_sinZcosAs[6];\nuniform float u_sinZsinAs[6];\nuniform float u_cosZs[6];\nuniform float u_weights[6];\nuniform float u_xFactor;\nuniform float u_yFactor;\nuniform bool u_scaled;\nuniform float u_minValue;\nuniform float u_maxValue;\nuniform bool u_applyColorramp;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nreturn vp;\n}\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvec3 rgb2hsv(vec3 c) {\nvec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\nvec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\nfloat d \x3d q.x - min(q.w, q.y);\nfloat e \x3d 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\nvec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {\nfloat clrIndex \x3d clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\nvec4 rgb \x3d texture2D(u_image1, vec2(clrIndex, 0.0));\nvec3 hsv \x3d rgb2hsv(rgb.xyz);\nhsv.z \x3d hillshade;\nreturn vec4(hsv2rgb(hsv) * alpha, alpha);\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 va, vb, vc, vd, ve, vf, vg, vh, vi;\nvec2 axy \x3d vec2(-1.0, -1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nva \x3d texture2D(u_image, v_texCoord + u_resolution * axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution * bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution * cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution * dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution * vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution * fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution * gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution * hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution * ixy);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat dzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_xFactor;\nfloat dzy \x3d (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_yFactor; //flip\nfloat s2 \x3d sqrt(1.0 + dzx * dzx + dzy * dzy);\nfloat hillshade \x3d 0.0;\nif (u_hillshadeType \x3d\x3d 0){\nfloat cosDelta \x3d u_sinZsinA * dzy - u_sinZcosA * dzx;\nfloat z \x3d (u_cosZ + cosDelta) / s2;\nif (z \x3c 0.0)  z \x3d 0.0;\nhillshade \x3d z;\n}\nelse if (u_hillshadeType \x3d\x3d 1){\nfor (int k \x3d 0; k \x3c 6; k++) {\nfloat cosDelta \x3d u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\nfloat z \x3d (u_cosZs[k] + cosDelta) / s2;\nif (z \x3c 0.0) z \x3d 0.0;\nhillshade \x3d hillshade + z * u_weights[k];\nif (k \x3d\x3d u_lightSourceCount-1) break;\n}\n}\nif (u_applyColorramp) {\nvec4 result \x3d overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);\nif (u_scaled) {\nresult \x3d vec4(result.rgb * 255.0, result.a);\n}\ngl_FragColor \x3d result;\n} else {\nif (u_scaled) {\nhillshade \x3d hillshade * 255.0;\nif (hillshade\x3e 255.0) {\nhillshade \x3d 255.0;\n}\n}\ngl_FragColor \x3d vec4(hillshade, hillshade, hillshade, alpha);\n}\n}",
identity:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandCount;\nfloat shift_right(float v, float amt) {\nv \x3d floor(v) + 0.5;\nreturn floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\nreturn floor(v * exp2(amt) + 0.5);\n}\nfloat mask_last(float v, float bits) {\nreturn mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\nfrom \x3d floor(from + 0.5);\nto \x3d floor(to + 0.5);\nreturn mask_last(shift_right(num, from), to - from);\n}\nvec4 encode_float(float val) {\nif (val \x3d\x3d 0.0)\nreturn vec4(0, 0, 0, 0);\nfloat sign \x3d val \x3e 0.0 ? 0.0 : 1.0;\nval \x3d abs(val);\nfloat exponent \x3d floor(log2(val));\nfloat biased_exponent \x3d exponent + 127.0;\nfloat fraction \x3d ((val / exp2(exponent)) - 1.0) * 8388608.0;\nfloat t \x3d biased_exponent / 2.0;\nfloat last_bit_of_biased_exponent \x3d fract(t) * 2.0;\nfloat remaining_bits_of_biased_exponent \x3d floor(t);\nfloat byte4 \x3d extract_bits(fraction, 0.0, 8.0) / 255.0;\nfloat byte3 \x3d extract_bits(fraction, 8.0, 16.0) / 255.0;\nfloat byte2 \x3d (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\nfloat byte1 \x3d (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\nreturn vec4(byte4, byte3, byte2, byte1);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 currentPixel \x3d  texture2D(u_image, v_texCoord);\ngl_FragColor \x3d vec4( currentPixel.rgb, currentPixel.a); //encode_float(currentPixel.r);\n}",
local:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform int u_rasterCount;\nvec4 polyfill;\nvec4 localOp1() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 result;\nvec4 replaceme1;\nreturn result;\n}\nvec4 localOp2() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 b \x3d texture2D(u_image1, v_texCoord);\nvec4 result;\nvec4 replaceme2;\nreturn result;\n}\nvec4 localOp3() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 b \x3d texture2D(u_image1, v_texCoord);\nvec4 c \x3d texture2D(u_image2, v_texCoord);\nvec4 result;\nvec4 replaceme3;\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d localOp1();\n}",
local0:"precision mediump float;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput[3];\nuniform float u_maxOutput[3];\nuniform float u_factor[3];\nuniform int u_operation;\nuniform int u_constant[3];\nuniform vec4 gamma;\nfloat localOperate1(float a, float b, float c){\nfloat result;\nif (u_operation \x3d\x3d 1){\nresult \x3d a + b;\n}\nelse if (u_operation \x3d\x3d 2){\nresult \x3d a - b;\n}\nelse if (u_operation \x3d\x3d3){\nresult \x3d a * b;\n}\nelse if (u_operation \x3d\x3d4){\nresult \x3d sqrt(a);\n}\nelse if (u_operation \x3d\x3d5){\nresult \x3d pow(a, b);\n}\nelse if (u_operation \x3d\x3d6){\nresult \x3d acos(a);\n}\nelse if (u_operation \x3d\x3d7){\nresult \x3d asin(a);\n}\nelse if (u_operation \x3d\x3d8){\nresult \x3d atan(a);\n}\nelse if (u_operation \x3d\x3d9){\nresult \x3d 999.0; //atanh not available\n}\nelse if (u_operation \x3d\x3d10){\nresult \x3d abs(a);\n}\nelse if (u_operation \x3d\x3d13){\nresult \x3d 999.0; //bitwise not available\n}\nelse if (u_operation \x3d\x3d17){\nresult \x3d a !\x3d 0.0 \x26\x26 b !\x3d0.0;\n}\nelse if (u_operation \x3d\x3d18){\nresult \x3d a \x3d\x3d0.0? 1.0:0.0;\n}\nelse if (u_operation \x3d\x3d19){\nresult \x3d a !\x3d 0.0 || b !\x3d0.0;\n}\nelse if (u_operation \x3d\x3d20){\nresult \x3d a !\x3d 0.0 ^^ b !\x3d0.0; //exclusive or\n}\nelse if (u_operation \x3d\x3d21){\nresult \x3d cos(a);\n}\nelse if (u_operation \x3d\x3d23){\nresult \x3d a / b;\n}\nelse if (u_operation \x3d\x3d24){\nresult \x3d a \x3d\x3d b ? 1.0:0.0;\n}\nelse if (u_operation \x3d\x3d25){\nresult \x3d exp(a);\n}\nelse if (u_operation \x3d\x3d26){\nresult \x3d pow(10.0, a);\n}\nelse if (u_operation \x3d\x3d27){\nresult \x3d exp2(a);\n}\nelse if (u_operation \x3d\x3d28){\nresult \x3d a \x3e b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d29){\nresult \x3d  a \x3e\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d30){\nresult \x3d floor(a); //int\n}\nelse if (u_operation \x3d\x3d31){\nresult \x3d a \x3d\x3d0? 1.0:0.0; //null pass mask\n}\nelse if (u_operation \x3d\x3d32){\nresult \x3d a; //float\n}\nelse if (u_operation \x3d\x3d33){\nresult \x3d a \x3c b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d34){\nresult \x3d a \x3c\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d35){\nresult \x3d log(a);\n}\nelse if (u_operation \x3d\x3d36){\nresult \x3d log2(a) / log2(10.0);\n}\nelse if (u_operation \x3d\x3d37){\nresult \x3d log2(a);\n}\nelse if (u_operation \x3d\x3d44){\nresult \x3d mod(a, b);\n}\nelse if (u_operation \x3d\x3d45){\nresult \x3d -a;\n}\nelse if (u_operation \x3d\x3d46){\nresult \x3d a !\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d48){\nresult \x3d ceil(a);\n}\nelse if (u_operation \x3d\x3d49){\nresult \x3d floor(a);\n}\nelse if (u_operation \x3d\x3d51){\nresult \x3d sin(a);\n}\nelse if (u_operation \x3d\x3d53){\nresult \x3d a * a;\n}\nelse if (u_operation \x3d\x3d56){\nresult \x3d tan(a);\n}\nelse if (u_operation \x3d\x3d57){\nresult \x3d 999.0; //tanh not available\n}\nelse if (u_operation \x3d\x3d59){\nresult \x3d 999.0; //acosh not available\n}\nelse if (u_operation \x3d\x3d60){\nresult \x3d 999.0; //asinh not available\n}\nelse if (u_operation \x3d\x3d61){\nresult \x3d atan(a, b);\n}\nelse if (u_operation \x3d\x3d64){\nresult \x3d a / b;\n}\nelse if (u_operation \x3d\x3d65){\nresult \x3d floor(a/b);\n}\nelse if (u_operation \x3d\x3d76){\nresult \x3d a !\x3d0? b:c;\n}\n}\nvoid main() {\nvec4 currentPixel0 \x3d  texture2D(u_image0, v_texCoord);\nfloat graya, reda, greena, bluea;\nif (u_bandCount \x3d\x3d 1) {\ngraya \x3d stretchOneaue(float(currentPixel.r), u_minCutOff[0], u_maxCutOff[0], u_minOutput[0], u_maxOutput[0], u_factor[0]);\ngl_FragColor \x3d vec4(graya, graya, graya, currentPixel.a);\n}\nelse if (u_bandCount \x3d\x3d 3) {\nreda \x3d stretchOneaue(float(currentPixel.r), u_minCutOff[0], u_maxCutOff[0], u_minOutput[0], u_maxOutput[0], u_factor[0]);\ngreena \x3d stretchOneaue(float(currentPixel.g), u_minCutOff[1], u_maxCutOff[1], u_minOutput[1], u_maxOutput[1], u_factor[1]);\nbluea \x3d stretchOneaue(float(currentPixel.b), u_minCutOff[2], u_maxCutOff[2], u_minOutput[2], u_maxOutput[2], u_factor[2]);\ngl_FragColor \x3d vec4(reda, greena, bluea, currentPixel.a);\n}\n}",
mask:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform float u_includedRanges[6];\nuniform bool u_includedRanges_specified;\nuniform float u_noDataValues[6];\nuniform bool u_noDataValues_specified;\nuniform int u_noDataInterpretation;\nuniform int u_bandCount;\nvec4 mask() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nvec4 processedPixel \x3d currentPixel;\nif (u_includedRanges_specified) {\nif (u_bandCount \x3d\x3d 1) {\nif (currentPixel.r \x3e u_includedRanges[0] \x26\x26 currentPixel.r \x3c u_includedRanges[1])\nprocessedPixel \x3d vec4(currentPixel.rgb, currentPixel.a);\nelse\nprocessedPixel \x3d vec4(currentPixel.rgb, 0);\n} else if (u_bandCount \x3d\x3d 3) {\nif (currentPixel.r \x3e u_includedRanges[0] \x26\x26 currentPixel.r \x3c u_includedRanges[1] \x26\x26 currentPixel.g \x3e u_includedRanges[2] \x26\x26 currentPixel.g \x3c u_includedRanges[3] \x26\x26 currentPixel.b \x3e u_includedRanges[4] \x26\x26 currentPixel.b \x3c u_includedRanges[5])\nprocessedPixel \x3d vec4(currentPixel.rgb, currentPixel.a);\nelse\nprocessedPixel \x3d vec4(currentPixel.rgb, 0);\n}\n}\nif (u_noDataValues_specified) {\nif (u_bandCount \x3d\x3d 1) {\nif (processedPixel.r \x3d\x3d u_noDataValues[0])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse\nprocessedPixel \x3d vec4(processedPixel.rgb, processedPixel.a);\n} else if (u_bandCount \x3d\x3d 3) {\nif (u_noDataInterpretation \x3d\x3d1 \x26\x26 processedPixel.r \x3d\x3d u_noDataValues[0] \x26\x26 processedPixel.g \x3d\x3d u_noDataValues[1] \x26\x26 processedPixel.b \x3d\x3d u_noDataValues[2])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse if (processedPixel.r \x3d\x3d u_noDataValues[0] || processedPixel.g \x3d\x3d u_noDataValues[1] || processedPixel.b \x3d\x3d u_noDataValues[2])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse\nprocessedPixel \x3d vec4(processedPixel.rgb, processedPixel.a);\n}\n}\nreturn processedPixel;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d mask();\n}",
ndvi:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandId_red;\nuniform int u_bandId_nir;\nuniform bool u_scaled;\nuniform int u_bandCount;\nvec4 calculateNDVI(){\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat ndvi_denom \x3d nir + red;\nfloat ndvi;\nif (ndvi_denom \x3d\x3d 0.0) {\nndvi \x3d 0.0;\n}\nelse {\nndvi \x3d (nir - red) / ndvi_denom;\nif (u_scaled) {\nndvi \x3d float(floor(ndvi * 100.0 + 100.5));\n}\n}\nreturn vec4(ndvi, ndvi, ndvi, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d calculateNDVI();\n}",
remap:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nuniform float u_breaks[16];\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nreturn vp;\n}\nfloat getRemapIndex(float pixelValue) {\nif (pixelValue \x3c u_breaks[0] || pixelValue \x3e u_breaks[15]) {\nreturn -1.0;\n}\nfor (int i \x3d 0; i \x3c 16; i++) {\nif (pixelValue \x3c u_breaks[i]) {\nreturn float(i - 1);\n}\n}\nif (pixelValue \x3d\x3d u_breaks[15]) {\nreturn 15.0;\n}\nreturn 0.0;\n}\nvec4 colorize(float pv) {\nfloat clrIndex \x3d pv - u_indexedColormapOffset;\nvec4 result;\nif (clrIndex \x3e u_indexedColormapMaxIndex) {\nresult \x3d vec4(0.0, 0.0, 0.0, 0.0);\n}\nelse {\nvec2 clrPosition \x3d vec2(clrIndex / u_indexedColormapMaxIndex, 0.0);\nvec4 color \x3d texture2D(u_image1, clrPosition);\nresult \x3d vec4(color.r, color.g, color.b, color.a);\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nif (currentPixel.a \x3d\x3d 0.0) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nfloat remappedIndex \x3d getRemapIndex(currentPixel.r);\nif (remappedIndex \x3c 0.0) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\ngl_FragColor \x3d colorize(remappedIndex);\n}",
resample:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resamplingRatio;\nuniform int u_resamplingType;\nuniform vec2 u_anchor;\nuniform vec2 u_resolution;\nvec4 resample(){\nvec2 pos_nn, pos_ul, pos_ur, pos_ll, pos_lr, pos_offset;\nfloat weight,weight_total, weight_ul, weight_ur, weight_ll, weight_lr;\nvec4 vp;  //v_texCoord is canvas space 0-1\nvec2 originalResolution \x3d vec2(u_resolution.s*u_resamplingRatio.s, u_resolution.t*u_resamplingRatio.t);\nvec2 pos \x3d vec2(u_anchor.s+(v_texCoord.s-u_anchor.s),(u_anchor.t+(v_texCoord.t-u_anchor.t)));\nif (u_resamplingType \x3d\x3d 0)\n{//shift and scaling, y \x3d ax+b so x \x3d (y-b)/a\npos_nn \x3d vec2(floor(pos.s/originalResolution.s+0.5)*originalResolution.s,floor(pos.t/originalResolution.t+0.5)*originalResolution.t);\nif (pos_nn.s \x3c0.0 || pos_nn.s \x3e 1.0 || pos_nn.t \x3c0.0 || pos_nn.t \x3e 1.0){\nvp \x3d vec4(1.0, 0.0, 0.0, 1.0);//vec4(0.0, 1.0, 0.0, vp.a);\n}\nelse {\nvp \x3d texture2D(u_image, vec2(pos_nn.s, pos_nn.t));\n}\n}\nelse if (u_resamplingType \x3d\x3d 1)\n{//shift and scaling, 4 neighbors y \x3d ax+b so x \x3d (y-b)/a\npos_ul \x3d vec2(floor(pos.s/originalResolution.s)*originalResolution.s,floor(pos.t/originalResolution.t)*originalResolution.t);\npos_ur \x3d vec2(pos_ul.s+originalResolution.s, pos_ul.t);\npos_ll \x3d vec2(pos_ul.s, pos_ul.t+originalResolution.t);\npos_lr \x3d vec2(pos_ul.s+originalResolution.s, pos_ul.t+originalResolution.t);\npos_offset \x3d vec2(pos.s - floor(pos_ul.s),pos.t - floor(pos_ul.t));\nweight_lr \x3d sqrt(pow(pos_offset.s,2.0) + pow(pos_offset.t,2.0));\nweight_ul \x3d sqrt(pow( originalResolution.s- pos_offset.s,2.0)+ pow(originalResolution.t- pos_offset.t,2.0));\nweight_ur \x3d sqrt(pow( pos_offset.s,2.0)+ 1.0- pow(originalResolution.t - pos_offset.t,2.0));\nweight_ll \x3d sqrt(pow( originalResolution.s- pos_offset.s,2.0)+ pow(pos_offset.t,2.0));\nvp \x3d (texture2D(u_image, pos_ul) * weight_ul + texture2D(u_image, pos_ur) * weight_ur + texture2D(u_image, pos_ll) * weight_ll + texture2D(u_image, pos_lr) * weight_lr)/(weight_ul+weight_ur+weight_ll+weight_lr);\n}\nelse if (u_resamplingType \x3d\x3d 2)\n{//shift and scaling, 16 neighbors\nweight_total \x3d 0.0;\nvp \x3d vec4(0.0,0.0,0.0,0.0);\npos_ul \x3d vec2(floor(pos.s/originalResolution.s)*originalResolution.s-originalResolution.s,floor(pos.t/originalResolution.t)*originalResolution.t-originalResolution.t);\npos_offset \x3d vec2(pos.s - floor(pos_ul.s),pos.t - floor(pos_ul.t));\nfor (int i\x3d0; i\x3c4; i++){//row\nfor (int j\x3d0; j\x3c4; j++){//col\nweight \x3d sqrt(pow(pos_offset.s-float(j),2.0)+ pow(pos_offset.t-float(i),2.0));\nvp +\x3dtexture2D(u_image, vec2(pos_ul.s+float(i)*originalResolution.s,pos_ul.t+float(j)*originalResolution.t)) * weight;\nweight_total +\x3d weight;\n}\n}\nvp \x3d vp/weight_total;\n}\nreturn vp;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d resample();\n}",
slope:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform vec2 u_cellSize;\nuniform float u_zfactor;\nuniform float u_altitude;\nuniform float u_azimuth;\nfloat shift_right(float v, float amt) {\nv \x3d floor(v) + 0.5;\nreturn floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\nreturn floor(v * exp2(amt) + 0.5);\n}\nfloat mask_last(float v, float bits) {\nreturn mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\nfrom \x3d floor(from + 0.5);\nto \x3d floor(to + 0.5);\nreturn mask_last(shift_right(num, from), to - from);\n}\nvec4 encode_float(float val) {\nif (val \x3d\x3d 0.0)\nreturn vec4(0, 0, 0, 0);\nfloat sign \x3d val \x3e 0.0 ? 0.0 : 1.0;\nval \x3d abs(val);\nfloat exponent \x3d floor(log2(val));\nfloat biased_exponent \x3d exponent + 127.0;\nfloat fraction \x3d ((val / exp2(exponent)) - 1.0) * 8388608.0;\nfloat t \x3d biased_exponent / 2.0;\nfloat last_bit_of_biased_exponent \x3d fract(t) * 2.0;\nfloat remaining_bits_of_biased_exponent \x3d floor(t);\nfloat byte4 \x3d extract_bits(fraction, 0.0, 8.0) / 255.0;\nfloat byte3 \x3d extract_bits(fraction, 8.0, 16.0) / 255.0;\nfloat byte2 \x3d (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\nfloat byte1 \x3d (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\nreturn vec4(byte4, byte3, byte2, byte1);\n}\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nvec4 calculateSlope() {\nfloat pi \x3d 3.141592653589793238;\nfloat dzx \x3d 0.0;\nfloat dzy \x3d 0.0;\nvec4 va,  vb,  vc,  vd,  ve,  vf,  vg,  vh,  vi;\nvec2 axy \x3d vec2(-1.0, -1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nif (v_texCoord.s \x3e\x3d u_resolution.s \x26\x26 (1.0 - u_resolution.s) \x3e\x3d v_texCoord.s \x26\x26 v_texCoord.t \x3e\x3d u_resolution.t \x26\x26 (1.0 - u_resolution.t) \x3e\x3d v_texCoord.t) {\nva \x3d texture2D(u_image, v_texCoord + u_resolution * axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution * bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution * cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution * dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution * vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution * fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution * gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution * hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution * ixy);\n}\ndzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r / (8.0 * u_cellSize[0]);\ndzy \x3d -(vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r / (8.0 * u_cellSize[1]);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat slope \x3d atan(u_zfactor * sqrt(dzx * dzx + dzy * dzy)) * 57.2957795;\nreturn vec4(slope, slope, slope, alpha);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d calculateSlope();\n}",
stretch:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput[3];\nuniform float u_maxOutput[3];\nuniform float u_factor[3];\nuniform int u_bandCount;\nuniform vec2 u_sourceDim;\nuniform vec2 u_targetDim;\nuniform int u_state;\nuniform bool u_minMaxTexture;\nuniform bool u_useGamma;\nuniform float u_gamma[4];\nuniform float u_gammaCorrection[4];\nuniform bool u_scaled;\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nif (u_bandCount \x3d\x3d 1) {\nfloat alpha \x3d vp_ul.a * vp_ur.a * vp_ll.a * vp_lr.a;\nvec4 vp_nn \x3d texture2D(u_image, coords);\nreturn alpha \x3d\x3d 0.0 ? vp_nn : vec4(vp.rgb, alpha);\n}\nreturn vp;\n}\nvec4 findMin(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(min(p1.r, p2.r),min(p1.g, p2.g),min(p1.b, p2.b),p1.a);\n}\n}\nvec4 findMax(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(max(p1.r, p2.r),max(p1.g, p2.g),max(p1.b, p2.b),p1.a);\n}\n}\nvec4 findMinMax(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(min(p1.r, p2.r), max(p1.g, p2.g), 0.0, p1.a);\n}\n}\nvec4 minMax(int state) {\nvec2 pixelFract \x3d fract(v_texCoord * u_sourceDim);\nfloat xshift \x3d ((pixelFract.s \x3e\x3d 0.5 || pixelFract.s \x3d\x3d 0.0) ? -1.0 : 1.0) / u_sourceDim.s; //take left pixel if \x3e 0.5\nfloat yshift \x3d ((pixelFract.s \x3e\x3d 0.5 || pixelFract.s \x3d\x3d 0.0) ? -1.0 : 1.0) / u_sourceDim.t; //take bottom pixel if \x3e 0.5\nif (u_sourceDim.s \x3d\x3d 1.0) {\nxshift \x3d 0.0;\n}\nif (u_sourceDim.t \x3d\x3d 1.0) {\nyshift \x3d 0.0;\n}\nvec4 p1 \x3d texture2D(u_image, v_texCoord);\nvec4 p2 \x3d texture2D(u_image, v_texCoord + vec2(xshift, 0.0));\nvec4 p3 \x3d texture2D(u_image, v_texCoord + vec2(0.0, yshift));\nvec4 p4 \x3d texture2D(u_image, v_texCoord + vec2(xshift, yshift));\nvec4 pval;\nif (state \x3d\x3d 2) {\npval \x3d findMinMax(findMinMax(p1, p2), findMinMax(p3, p4));\n} else if (state \x3d\x3d 1) {\npval \x3d findMax(findMax(p1, p2), findMax(p3, p4));\n} else if (state \x3d\x3d 0) {\npval \x3d findMin(findMin(p1, p2), findMin(p3, p4));\n}\nreturn pval;\n}\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool scaled) {\nfloat stretchedVal;\nif (val \x3e minCutOff \x26\x26 val \x3c maxCutOff) {\nstretchedVal \x3d minOutput + (val - minCutOff) * factor;\n} else if (val \x3e\x3d maxCutOff) {\nstretchedVal \x3d maxOutput;\n} else {\nstretchedVal \x3d minOutput;\n}\nif (scaled) {\nreturn stretchedVal;\n}\nelse {\nreturn stretchedVal / maxOutput; //0-1\n}\n}\nfloat stretchOneValueGamma(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, float gamma, float gammaCorrection, bool scaled) {\nfloat stretchedVal;\nfloat tempf \x3d 1.0;\nfloat outRange \x3d maxOutput - minOutput;\nfloat relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\nif (val \x3e minCutOff \x26\x26 val \x3c maxCutOff) {\nif (gamma \x3e 1.0) {\ntempf -\x3d pow(1.0 / outRange, relativeVal * gammaCorrection);\n}\nstretchedVal \x3d floor(tempf * outRange * pow(relativeVal, 1.0 / gamma)) + minOutput;\n}\nelse if (val \x3e\x3d maxCutOff) {\nstretchedVal \x3d maxOutput;\n} else {\nstretchedVal \x3d minOutput;\n}\nif (scaled) {\nreturn stretchedVal;\n}\nelse {\nreturn stretchedVal / maxOutput; //0-1\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nif (u_state \x3d\x3d 100) {\nvec4 currentPixel \x3d getPixelValue(v_texCoord);\nfloat grayVal,\nredVal,\ngreenVal,\nblueVal;\nfloat min0,\nmax0,\nmin1,\nmax1,\nmin2,\nmax2,\nfactor0,\nfactor1,\nfactor2;\nvec4 minV, maxV;\nif (u_minMaxTexture) {\nif (u_bandCount \x3d\x3d 1) {\nminV \x3d texture2D(u_image1, v_texCoord);\nmin0 \x3d minV.r;\nmax0 \x3d minV.g;\nfactor0 \x3d (u_maxOutput[0] - u_minOutput[0]) / (max0 - min0);\n} else {\nminV \x3d texture2D(u_image1, v_texCoord);\nmaxV \x3d texture2D(u_image2, v_texCoord);\nmin0 \x3d minV.r;\nmax0 \x3d maxV.r;\nmin1 \x3d minV.g;\nmax1 \x3d maxV.g;\nmin2 \x3d minV.b;\nmax2 \x3d maxV.b;\nfactor0 \x3d (u_maxOutput[0] - u_minOutput[0]) / (max0 - min0);\nfactor1 \x3d (u_maxOutput[1] - u_minOutput[1]) / (max1 - min1);\nfactor2 \x3d (u_maxOutput[2] - u_minOutput[2]) / (max2 - min2);\n}\n} else {\nmin0 \x3d u_minCutOff[0];\nmax0 \x3d u_maxCutOff[0];\nmin1 \x3d u_minCutOff[1];\nmax1 \x3d u_maxCutOff[1];\nmin2 \x3d u_minCutOff[2];\nmax2 \x3d u_maxCutOff[2];\nfactor0 \x3d u_factor[0];\nfactor1 \x3d u_factor[1];\nfactor2 \x3d u_factor[2];\n}\nif (u_useGamma){\nif (u_bandCount \x3d\x3d 1) {\ngrayVal \x3d stretchOneValueGamma(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_gamma[0], u_gammaCorrection[0], u_scaled);\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, currentPixel.a);\n} else {\nredVal \x3d stretchOneValueGamma(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_gamma[0], u_gammaCorrection[0], u_scaled);\ngreenVal \x3d stretchOneValueGamma(float(currentPixel.g), min1, max1, u_minOutput[1], u_maxOutput[1], factor1, u_gamma[1], u_gammaCorrection[1], u_scaled);\nblueVal \x3d stretchOneValueGamma(float(currentPixel.b), min2, max2, u_minOutput[2], u_maxOutput[2], factor2, u_gamma[1], u_gammaCorrection[2], u_scaled);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n}\n}\nelse {\nif (u_bandCount \x3d\x3d 1) {\ngrayVal \x3d stretchOneValue(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_scaled);\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, currentPixel.a);\n} else {\nredVal \x3d stretchOneValue(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_scaled);\ngreenVal \x3d stretchOneValue(float(currentPixel.g), min1, max1, u_minOutput[1], u_maxOutput[1], factor1, u_scaled);\nblueVal \x3d stretchOneValue(float(currentPixel.b), min2, max2, u_minOutput[2], u_maxOutput[2], factor2, u_scaled);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n}\n}\n} else {\nvec4 currentPixel \x3d minMax(u_state);\ngl_FragColor \x3d currentPixel;\n}\n}"}})},
"esri/layers/rasterLib/function/RasterFunctionWebGLMixin":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ./pixelShaders ./vertexShaders ./webglHelper ./convolutionKernel".split(" "),function(m,n,v,b,p,f,d){return m(null,{gl:null,rgbaFloatData:null,originalTexture:null,lastTexture:null,renderTexture:!1,constructor:function(a){this._isProgramInitialized=!1;this.gl=a&&a.gl;a&&a.renderTexture&&(this.renderTexture=a.renderTexture);this._xformSetting=a&&a._xformSetting||{requireProjection:!1,
meshSize:[20,20]}},bindFrameBuffer:function(){var a=this.gl;this._setupPingPongTextures();this._setupBranchingTextures();var c=this._glSetting;this.isBranch?(c.branchIndex=(c.branchIndex+1)%c.branchCount,c=c.branches[c.branchIndex]):(c.pingpongIndex=(c.pingpongIndex+1)%c.pingpong.length,c=c.pingpong[c.pingpongIndex]);a.bindFramebuffer(a.FRAMEBUFFER,c.frameBuffer);a.viewport(0,0,a.drawingBufferWidth,a.drawingBufferHeight);return c},_initializeProgram:function(a){if(this.gl)try{var c=this.gl;c.viewport(0,
0,c.drawingBufferWidth,c.drawingBufferHeight);var h=this._glSetting.programUniforms,l="local"===this.functionName?"local"+this.functionArguments.operation:this.functionName,k=h[l];if(k)this._uniforms=k.uniforms,this.rasterProgram=k.program;else{var g=(this._useMesh=this._tileMode&&this._xformSetting.requireProjection)?p.mesh:p.basic,e=p.getShader(c,a.vertex||g),q=b.getShader(c,a.fragment),u=this._loadProgram(e,q),r={rasterProgram:f.getUniforms(c,u)};h[l]={uniforms:r,program:u};this.rasterProgram=
u;this._uniforms=r}c.useProgram(this.rasterProgram);var x=c.getAttribLocation(this.rasterProgram,"a_texCoord"),t=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,t);var w=f.createMesh(this._xformSetting.meshSize);c.bufferData(c.ARRAY_BUFFER,w,c.STATIC_DRAW);c.enableVertexAttribArray(x);c.vertexAttribPointer(x,2,c.FLOAT,!1,0,0);c.disable(c.DEPTH_TEST);c.blendFunc(c.SRC_ALPHA,c.ZERO);c.disable(c.BLEND);c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,!1);this._shaderInfo=
{fragment:a.fragmentName}}catch(z){}},_setUniform:function(a,c,h){null!=c&&(h&&!this._uniforms[h]&&(this._uniforms[h]=f.getUniforms(this.gl,this[h])),h=h?this._uniforms[h]:this._uniforms.rasterProgram,(a=h[a]||h[a+"[0]"])&&f.setUniform(this.gl,a,c))},_setUniforms:function(a,c){var h=Object.keys(a),l,k=h.length;for(l=0;l<k;l++)this._setUniform(h[l],a[h[l]],c);this.rawInput?this._setUniform("u_flipY",!0,c):this._setUniform("u_flipY",!1,c);this._tileMode?(this.rawInput?(h=this._xformSetting.offset,l=
this._xformSetting.scale):(h=[0,0],l=[1,1]),this._setUniform("u_xformOffset",h,c),this._setUniform("u_xformScale",l,c),this._xformSetting.requireProjection&&(this.rawInput?(this._setupXformTexture(),this._setUniform("u_projection",!0,c),this._setUniform("u_transformGridSize",this._xformSetting.gridConfig.size,c),this._setUniform("u_transformSpacing",this._xformSetting.gridConfig.spacing,c),this._setUniform("u_targetImageSize",new Float32Array([this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]),
c)):this._setUniform("u_projection",!1,c))):(h=[0,0],l=[1,1],this._setUniform("u_xformOffset",h,c),this._setUniform("u_xformScale",l,c));this.rawInput&&this._rawResolution&&("RSP_BilinearInterpolation"===this.interpolation||"RSP_CubicConvolution"===this.interpolation)?(this._setUniform("u_resampling",1),this._setUniform("u_rawResolution",this._rawResolution)):this._setUniform("u_resampling",0)},_setupTextureData:function(a,c){if(a.texture)return a;a.raster&&a.raster.pixelBlock&&(a=a.raster);this.rawInput=
!0;var h=c&&c.notOriginal,l=c&&c.bandIDs;if(c&&c.reCreate)var k=!1;else(k=this._tileMode?!this._xformSetting.hasNewTexture:!this._glSetting.hasNewTexture)&&this._originalBandIDs&&(k=l?this._originalBandIDs.join("")===l.join(""):!1);0<this._glSetting.branchCount&&(k=!1);if(k&&this.originalTexture)return{extent:a.extent,texture:this.originalTexture};k=this._createTexture();h||(this.originalTexture=k,this._originalBandIDs=l);h=this.gl;var g=a.pixelBlock;this._rawResolution=g?[1/a.pixelBlock.width,1/
a.pixelBlock.height]:[1/this.gl.drawingBufferWidth,1/this.gl.drawingBufferHeight];var e=0;l&&0<l.length&&g&&(e=Math.max.apply(null,l),g.pixels.length>e&&l&&(g.pixels=l.map(function(u){return g.pixels[u]}),g.statistics&&(g.statistics=l.map(function(u){return g.statistics[u]}))));l=g.width;e=g.height;h.getExtension("OES_texture_float");var q=g.getAsRGBAFloat();h.texImage2D(h.TEXTURE_2D,0,h.RGBA,l,e,0,h.RGBA,h.FLOAT,q);return{extent:a.extent,texture:k}},_setupPingPongTextures:function(){var a=this._glSetting;
if(!a||!a.pingpong){a.pingpong=[];var c=f.createBufferTexture(this.gl,!1);a.pingpong.push(c);c=f.createBufferTexture(this.gl,!1);a.pingpong.push(c);a.pingpongIndex=1}},_setupBranchingTextures:function(){var a=this._glSetting;if(!a||!a.branches){a.branches=[];var c=0,h=a.branchCount;if(0<h){for(c=0;c<h;c++){var l=f.createBufferTexture(this.gl,!1);a.branches.push(l)}a.branchIndex=h-1}}},_setupXformTexture:function(a){for(var c=this._createTexture(),h=this.gl,l=4*this._xformSetting.gridConfig.size[0],
k=this._xformSetting.gridConfig.size[1],g=new Float32Array(l*k*4),e=0,q=0;q<this._xformSetting.gridConfig.coefficients.length;q++)g[e++]=this._xformSetting.gridConfig.coefficients[q],2===q%3&&(g[e++]=1);h.getExtension("OES_texture_float");h.texImage2D(h.TEXTURE_2D,0,h.RGBA,l,k,0,h.RGBA,h.FLOAT,g);this._bindTexture(c,"u_transformGrid",a)},_createTexture:function(a){return f.createTexture(this.gl,a)},_bindTexture:function(a,c,h){c=c||"u_image";h=this._uniforms[h||"rasterProgram"];var l=this._getTextureIndex(c);
if(-1!==l){var k=this.gl;k.uniform1i(h[c].location,l);k.activeTexture(k.TEXTURE0+l);k.bindTexture(k.TEXTURE_2D,a)}},_getTextureIndex:function(a,c){var h=this._uniforms[c||"rasterProgram"];if(!h||!h[a]||h[a].info.type!==this.gl.SAMPLER_2D)return-1;if("u_transformGrid"===a)return 0;h="u_image"===a?0:parseInt(a.replace("u_image",""));return this._xformSetting.requireProjection?h+1:h},_drawGL:function(a){var c=this.gl;this.renderTexture?(c.enable(c.BLEND),c.bindFramebuffer(c.FRAMEBUFFER,null)):c.disable(c.BLEND);
a||c.viewport(0,0,c.drawingBufferWidth,c.drawingBufferHeight);a=this._xformSetting.meshSize||[1,1];c.drawArrays(c.TRIANGLES,0,a[0]*a[1]*6);this._drawMesh()},_drawMesh:function(){if(this.renderTexture&&this._glSetting.drawMesh){this.meshProgram=this.meshProgram||this._setupMeshProgram();var a=this.gl;a.useProgram(this.meshProgram);a.bindFramebuffer(a.FRAMEBUFFER,null);var c=a.getAttribLocation(this.meshProgram,"a_texCoord"),h=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,h);h=this._xformSetting.meshSize||
[1,1];var l=f.createMesh(h,!0);a.bufferData(a.ARRAY_BUFFER,l,a.STATIC_DRAW);a.enableVertexAttribArray(c);a.vertexAttribPointer(c,2,a.FLOAT,!1,0,0);a.disable(a.DEPTH_TEST);a.blendFunc(a.ONE,a.ZERO);this._setUniforms({u_color:[0,0,1,1],u_drawMeshLines:!0},"meshProgram");a.drawArrays(a.LINES,0,h[0]*h[1]*10)}},_setupMeshProgram:function(){var a=p.getShader(this.gl,p.mesh),c=b.getShader(this.gl,b.constant);return this._loadProgram(a,c)},_loadProgram:function(a,c){return f.loadProgram(this.gl,a,c)},_getShaderScript:function(a,
c){var h=document.getElementById(c);if(!h)return null;var l="";for(h=h.firstChild;h;)3==h.nodeType&&(l+=h.textContent),h=h.nextSibling;return l}})})},"esri/layers/rasterLib/function/vertexShaders":function(){define(["dojo/_base/declare","dojo/_base/lang","./vertexShaderScripts"],function(m,n,v){m={shaderType:"vertex",getShader:function(b,p){var f=b.createShader(b.VERTEX_SHADER);b.shaderSource(f,p);b.compileShader(f);b.getShaderParameter(f,b.COMPILE_STATUS)||(f=null);return f}};n.mixin(m,v);return m})},
"esri/layers/rasterLib/function/vertexShaderScripts":function(){define([],function(){return{basic:"varying vec2 v_texCoord;\nattribute vec2 a_texCoord;\nuniform vec2 u_xformOffset;\nuniform vec2 u_xformScale;\nuniform bool u_flipY;\nvoid main() {\nv_texCoord \x3d u_xformOffset + a_texCoord * u_xformScale;\nif (u_flipY) {\nv_texCoord.t \x3d 1.0 - v_texCoord.t;\n}\nvec2 position \x3d a_texCoord * 2.0 - 1.0;\ngl_Position \x3d vec4(position, 0.0, 1.0);\n}",histogram:"attribute float a_pixelIndex;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nuniform vec2 u_sourceDim;\nuniform vec2 u_halfPixel;\nuniform vec4 u_bandSelection;\nuniform vec4 u_mins;\nuniform vec4 u_factors;\nuniform float u_size;\nuniform int u_bandCount;\nuniform bool u_minMaxTexture;\nvoid main() {\nfloat row \x3d a_pixelIndex/u_sourceDim.s;\nvec2 coord \x3d vec2(fract(row), floor(row)/u_sourceDim.t);\nvec4 pv \x3d texture2D(u_image, coord + u_halfPixel);\nvec4 minVal, maxVal, pvm;\nif (u_minMaxTexture){\nif (u_bandCount \x3d\x3d1){ //min \x3d red, max \x3d green\nvec4 minmax \x3d texture2D(u_image1, vec2(0.5,0.5));\nminVal \x3d vec4(minmax.r, minmax.r, minmax.r, 0.0);\nmaxVal \x3d vec4(minmax.g, minmax.g, minmax.g, 0.0);\n}\nelse if (u_bandCount \x3d\x3d3){ //min \x3d red, max \x3d green\nminVal \x3d texture2D(u_image1, vec2(0.5,0.5));\nmaxVal \x3d texture2D(u_image2, vec2(0.5,0.5));\n}\nvec4 factors \x3d u_size/(maxVal-minVal+vec4(0.0,0.0,0.0,1.0)) * u_factors;\npvm \x3d (pv - minVal) * factors;\n}\nelse {\npvm \x3d (pv - u_mins) * u_factors;\n}\nfloat histVal \x3d min(floor(pvm.r+pvm.g+pvm.b), u_size-1.0);\nhistVal \x3d pv.a \x3d\x3d 1.0? histVal: u_size;\ngl_Position \x3d vec4((histVal+0.1) / (u_size+1.0) * 2.0 - 1.0, 0.5, 0, 1);\ngl_PointSize \x3d 1.0;\n}",
mesh:"varying vec2 v_texCoord;\nattribute vec2 a_texCoord;\nuniform bool u_drawMeshLines;\nuniform bool u_flipY;\nuniform vec2 u_xformOffset;\nuniform vec2 u_xformScale;\nuniform sampler2D u_transformGrid;\nuniform vec2 u_transformSpacing;\nuniform vec2 u_transformGridSize;\nuniform vec2 u_targetImageSize;\nuniform vec2 u_srcImageSize;\nuniform bool u_projection;\nvec2 projectPixelLocation(vec2 coords) {\nvec2 index_image \x3d floor(coords * u_targetImageSize);\nvec2 oneTransformPixel \x3d vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\nvec2 index_transform \x3d floor(index_image / u_transformSpacing) / u_transformGridSize;\nvec2 pos \x3d fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\nvec2 srcLocation;\nvec2 transform_location \x3d index_transform + oneTransformPixel * 0.5;\nif (pos.s \x3c\x3d pos.t) {\nvec4 ll_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\nvec4 ll_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ll_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ll_def.rgb, vec3(pos, 1.0));\n} else {\nvec4 ur_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\nvec4 ur_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ur_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ur_def.rgb, vec3(pos, 1.0));\n}\nreturn srcLocation;// + halfPixel;\n}\nvoid main() {\nif (u_projection) {\nv_texCoord \x3d projectPixelLocation(a_texCoord);\n} else {\nv_texCoord \x3d u_xformOffset + a_texCoord * u_xformScale;\n}\nif (u_flipY) {\nv_texCoord.t \x3d 1.0 - v_texCoord.t;\n}\nvec2 position \x3d a_texCoord * 2.0 - 1.0;\nif (u_drawMeshLines){\nvec2 adjustedPos \x3d (v_texCoord - u_xformOffset) / u_xformScale;\ngl_Position \x3d vec4( adjustedPos * 2.0 - 1.0, 0.0, 1.0);\n}\nelse {\ngl_Position \x3d vec4(position, 0.0, 1.0);\n}\n}"}})},
"esri/layers/rasterLib/function/webglHelper":function(){define([],function(){var m={getUniforms:function(n,v){var b=n.getProgramParameter(v,n.ACTIVE_UNIFORMS),p,f,d={};for(p=0;p<b;p++)(f=n.getActiveUniform(v,p))&&(d[f.name]={location:n.getUniformLocation(v,f.name),info:f});return d},setUniform:function(n,v,b){var p=v.info;v=v.location;var f=p.type;if(null!=b)switch(f){case n.FLOAT:1<p.size?0!==b.length&&n.uniform1fv(v,b):n.uniform1f(v,b);break;case n.FLOAT_VEC2:if(0===b.length)break;n.uniform2fv(v,
b);break;case n.FLOAT_VEC3:if(0===b.length)break;n.uniform3fv(v,b);break;case n.FLOAT_VEC4:if(0===b.length)break;n.uniform4fv(v,b);break;case n.INT:case n.BOOL:1<p.size?0!==b.length&&n.uniform1iv(v,b):n.uniform1i(v,b);break;case n.INT_VEC2:case n.BOOL_VEC2:if(0===b.length)break;n.uniform2iv(v,b);break;case n.INT_VEC3:case n.BOOL_VEC3:if(0===b.length)break;n.uniform3iv(v,b);break;case n.INT_VEC4:case n.BOOL_VEC4:0!==b.length&&n.uniform4iv(v,b)}},createTexture:function(n,v){var b=n.createTexture();
n.bindTexture(n.TEXTURE_2D,b);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,v?n.LINEAR:n.NEAREST);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,v?n.LINEAR:n.NEAREST);return b},createBufferTexture:function(n,v,b){v=m.createTexture(n,v);n.getExtension("OES_texture_float");b=b||[n.drawingBufferWidth,n.drawingBufferHeight];n.texImage2D(n.TEXTURE_2D,0,n.RGBA,b[0],b[1],0,
n.RGBA,n.FLOAT,null);b=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,b);n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,v,0);return{texture:v,frameBuffer:b}},getShader:function(n,v,b){b=b?n.createShader(n.VERTEX_SHADER):n.createShader(n.FRAGMENT_SHADER);n.shaderSource(b,v);n.compileShader(b);n.getShaderParameter(b,n.COMPILE_STATUS)||(b=null);return b},loadProgram:function(n,v,b){var p=n.createProgram();n.attachShader(p,v);n.attachShader(p,b);n.linkProgram(p);n.getProgramParameter(p,
n.LINK_STATUS)||(n.deleteProgram(p),p=null);return p},createMesh:function(n,v){if(!n||1===n[0]&&1===n[1])return new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]);var b=n&&v?new Float32Array(n[0]*n[1]*20):new Float32Array(n[0]*n[1]*12);var p=.9998/n[1],f=.9998/n[0],d,a,c=0;for(d=0;d<n[1];d++)for(a=0;a<n[0];a++){var h=1E-4+p*d;var l=1E-4+f*a;n&&!v?(b[c++]=h,b[c++]=l,b[c++]=h+p,b[c++]=l,b[c++]=h,b[c++]=l+f,b[c++]=h,b[c++]=l+f,b[c++]=h+p,b[c++]=l,b[c++]=h+p,b[c++]=l+f):(b[c++]=h,b[c++]=l,b[c++]=h,b[c++]=l+
f,b[c++]=h,b[c++]=l+f,b[c++]=h+p,b[c++]=l+f,b[c++]=h+p,b[c++]=l+f,b[c++]=h+p,b[c++]=l,b[c++]=h,b[c++]=l,b[c++]=h+p,b[c++]=l,b[c++]=h,b[c++]=l+f,b[c++]=h+p,b[c++]=l)}return b}};return m})},"esri/layers/rasterLib/function/convolutionKernel":function(){define([],function(){var m={Default:[0,0,0,0,1,0,0,0,0],LineDetectionHorizontal:[-1,-1,-1,2,2,2,-1,-1,-1],LineDetectionVertical:[-1,2,-1,-1,2,-1,-1,2,-1],LineDetectionLeftDiagonal:[2,-1,-1,-1,2,-1,-1,-1,2],LineDetectionRightDiagonal:[-1,-1,2,-1,2,-1,2,
-1,-1],GradientNorth:[-1,-2,-1,0,0,0,1,2,1],GradientWest:[-1,0,1,-2,0,2,-1,0,1],GradientEast:[1,0,-1,2,0,-2,1,0,-1],GradientSouth:[1,2,1,0,0,0,-1,-2,-1],GradientNorthEast:[0,-1,-2,1,0,-1,2,1,0],GradientNorthWest:[-2,-1,0,-1,0,1,0,1,2],SmoothArithmeticMean:[.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111],Smoothing3x3:[.0625,.125,.0625,.125,.25,.125,.0625,.125,.0625],Smoothing5x5:[1,1,1,1,1,1,4,4,4,1,1,4,12,4,1,1,4,4,4,1,
1,1,1,1,1],Sharpening3x3:[-1,-1,-1,-1,9,-1,-1,-1,-1],Sharpening5x5:[-1,-3,-4,-3,-1,-3,0,6,0,-3,-4,6,21,6,-4,-3,0,6,0,-3,-1,-3,-4,-3,-1],Laplacian3x3:[0,-1,0,-1,4,-1,0,-1,0],Laplacian5x5:[0,0,-1,0,0,0,-1,-2,-1,0,-1,-2,17,-2,-1,0,-1,-2,-1,0,0,0,-1,0,0],SobelHorizontal:[-1,-2,-1,0,0,0,1,2,1],SobelVertical:[-1,0,1,-2,0,2,-1,0,1],Sharpen:[0,-.25,0,-.25,2,-.25,0,-.25,0],Sharpen2:[-.25,-.25,-.25,-.25,3,-.25,-.25,-.25,-.25],PointSpread:[-.627,.352,-.627,.352,2.923,.352,-.627,.352,-.627],getKernel:function(n){switch(n){case 0:return m.LineDetectionHorizontal;
case 1:return m.LineDetectionVertical;case 2:return m.LineDetectionLeftDiagonal;case 3:return m.LineDetectionRightDiagonal;case 4:return m.GradientNorth;case 5:return m.GradientWest;case 6:return m.GradientEast;case 7:return m.GradientSouth;case 8:return m.GradientNorthEast;case 9:return m.GradientNorthWest;case 10:return m.SmoothArithmeticMean;case 11:return m.Smoothing3x3;case 12:return m.Smoothing5x5;case 13:return m.Sharpening3x3;case 14:return m.Sharpening5x5;case 15:return m.Laplacian3x3;case 16:return m.Laplacian5x5;
case 17:return m.SobelHorizontal;case 18:return m.SobelVertical;case 19:return m.Sharpen;case 20:return m.Sharpen2;case 21:return m.PointSpread;default:return m.Default}}};return m})},"esri/layers/rasterLib/function/surfaceUtils":function(){define(["dojo/_base/lang"],function(m){return{hillshade:function(n,v){if(null!==n&&null!==n.pixelBlock&&null!==n.pixelBlock.pixels){var b=this._clonePixelBlock(n.pixelBlock),p=v.altitude,f=v.azimuth,d=v.zFactor,a=v.psPower,c=v.psFactor,h=v.hillshadeType,l=v.slopeType,
k=v.isGCS;1===h&&(d*=2);var g=b.width,e=b.height,q=b.pixels[0],u=b.mask,r=new Uint8Array(g*e);u&&r.set(u);var x=new Uint8Array(g*e),t=(n.extent.xmax-n.extent.xmin)/g,w=(n.extent.ymax-n.extent.ymin)/e,z=d/(8*t),B=d/(8*w);.001<d&&k&&(z/=111E3,B/=111E3);3===l&&(k?(z=111E3*t,B=111E3*w,z=(d+Math.pow(z,a)*c)/(8*z),B=(d+Math.pow(B,a)*c)/(8*B)):(z=(d+Math.pow(t,a)*c)/(8*t),B=(d+Math.pow(w,a)*c)/(8*w)));k=(90-p)*Math.PI/180;p=Math.cos(k);var A=(360-f+90)*Math.PI/180;f=Math.sin(k)*Math.cos(A);k=Math.sin(k)*
Math.sin(A);d=[];a=[];c=[];t=[315,270,225,360,180,0];var y=[60,60,60,60,60,90];w=[3,5,3,2,1,4];var E=w.reduce(function(N,K){return N+K});l=w.map(function(N){return N/E});if(1===h){var G=t.length;for(w=0;w<G;w++)p=y[w],f=t[w],k=(90-p)*Math.PI/180,p=Math.cos(k),A=(360-f+90)*Math.PI/180,f=Math.sin(k)*Math.cos(A),k=Math.sin(k)*Math.sin(A),d.push(p),a.push(f),c.push(k)}var F=0;for(w=1;w<e-1;w++)for(y=w*g,t=1;t<g-1;t++)if(u&&!u[y+t])x[y+t]=0;else{A=0;if(u&&(A=u[y-g+t-1]+u[y-g+t]+u[y-g+t+1]+u[y+t-1]+u[y+
t+1]+u[y+g+t-1]+u[y+g+t]+u[y+g+t+1],7>A)){x[y+t]=0;r[y+t]=0;continue}if(7===A){var D=u[y-g+t-1]?q[y-g+t-1]:q[y+t];var L=u[y-g+t]?q[y-g+t]:q[y+t];var O=u[y-g+t+1]?q[y-g+t+1]:q[y+t];A=u[y+t-1]?q[y+t-1]:q[y+t];var S=u[y+t+1]?q[y+t+1]:q[y+t];F=u[y+g+t-1]?q[y+g+t-1]:q[y+t];var Z=u[y+g+t]?q[y+g+t]:q[y+t];var I=u[y+g+t+1]?q[y+g+t+1]:q[y+t]}else D=q[y-g+t-1],L=q[y-g+t],O=q[y-g+t+1],A=q[y+t-1],S=q[y+t+1],F=q[y+g+t-1],Z=q[y+g+t],I=q[y+g+t+1];A=(O+S+S+I-(D+A+A+F))*z;L=(F+Z+Z+I-(D+L+L+O))*B;O=Math.sqrt(1+A*A+
L*L);F=0;if(0===h)Z=k*L-f*A,Z=255*(p+Z)/O,0>Z&&(Z=0),F=Z;else if(1===h)for(D=0;D<G;D++)Z=c[D]*L-a[D]*A,Z=255*(d[D]+Z)/O,0>Z&&(Z=0),F+=Z*l[D];x[y+t]=F}for(w=0;w<e;w++)x[w*g]=x[w*g+1],x[(w+1)*g-1]=x[(w+1)*g-2];for(w=1;w<g-1;w++)x[w]=x[w+g],x[w+(e-1)*g]=x[w+(e-2)*g];b.pixelType="U8";b.pixels=[x];b.statistics=[{minValue:0,maxValue:255}];u&&(b.mask=r);return{extent:n.extent,pixelBlock:b}}},slope:function(n,v){if(null!==n&&null!==n.pixelBlock&&null!==n.pixelBlock.pixels){var b=this._clonePixelBlock(n.pixelBlock),
p=v.zFactor,f=v.psPower,d=v.psFactor,a=v.slopeType,c=v.isGCS,h=b.width,l=b.height,k=b.pixels[0],g=b.mask,e=new Uint8Array(h*l);g&&e.set(g);var q=new Float32Array(h*l),u=(n.extent.xmax-n.extent.xmin)/h,r=(n.extent.ymax-n.extent.ymin)/l,x=p/(8*u),t=p/(8*r);1E-4>Math.abs(p-1)&&c&&(x/=111E3,t/=111E3);3===a&&(c?(x=111E3*u,t=111E3*r,x=(p+Math.pow(x,f)*d)/(8*x),t=(p+Math.pow(t,f)*d)/(8*t)):(x=(p+Math.pow(u,f)*d)/(8*u),t=(p+Math.pow(r,f)*d)/(8*r)));for(p=1;p<l-1;p++)for(d=p*h,f=1;f<h-1;f++)if(g&&!g[d+f])q[d+
f]=0;else{r=0;if(g&&(r=g[d-h+f-1]+g[d-h+f]+g[d-h+f+1]+g[d+f-1]+g[d+f+1]+g[d+h+f-1]+g[d+h+f]+g[d+h+f+1],7>r)){q[d+f]=0;e[d+f]=0;continue}if(7===r){r=g[d-h+f-1]?k[d-h+f-1]:k[d+f];c=g[d-h+f]?k[d-h+f]:k[d+f];u=g[d-h+f+1]?k[d-h+f+1]:k[d+f];var w=g[d+f-1]?k[d+f-1]:k[d+f];var z=g[d+f+1]?k[d+f+1]:k[d+f];var B=g[d+h+f-1]?k[d+h+f-1]:k[d+f];var A=g[d+h+f]?k[d+h+f]:k[d+f];var y=g[d+h+f+1]?k[d+h+f+1]:k[d+f]}else r=k[d-h+f-1],c=k[d-h+f],u=k[d-h+f+1],w=k[d+f-1],z=k[d+f+1],B=k[d+h+f-1],A=k[d+h+f],y=k[d+h+f+1];w=
(u+z+z+y-(r+w+w+B))*x;r=(B+A+A+y-(r+c+c+u))*t;r=Math.sqrt(w*w+r*r);q[d+f]=1===a||3===a?57.2957795*Math.atan(r):100*r}for(p=0;p<l;p++)q[p*h]=q[p*h+1],q[(p+1)*h-1]=q[(p+1)*h-2];for(p=1;p<h-1;p++)q[p]=q[p+h],q[p+(l-1)*h]=q[p+(l-2)*h];b.pixelType="F32";b.pixels=[q];b.statistics=[{minValue:0,maxValue:255}];g&&(b.mask=e);return{extent:n.extent,pixelBlock:b}}},aspect:function(n){if(null!==n&&null!==n.pixelBlock&&null!==n.pixelBlock.pixels){var v=this._clonePixelBlock(n.pixelBlock),b=v.width,p=v.height,f=
v.pixels[0],d=v.mask,a=new Uint8Array(b*p);d&&a.set(d);var c=new Float32Array(b*p),h=1/((n.extent.xmax-n.extent.xmin)/b),l=1/((n.extent.ymax-n.extent.ymin)/p),k,g;for(k=1;k<p-1;k++){var e=k*b;for(g=1;g<b-1;g++)if(d&&!d[e+g])c[e+g]=0;else{var q=0;if(d&&(q=d[e-b+g-1]+d[e-b+g]+d[e-b+g+1]+d[e+g-1]+d[e+g+1]+d[e+b+g-1]+d[e+b+g]+d[e+b+g+1],7>q)){c[e+g]=0;a[e+g]=0;continue}if(7===q){q=d[e-b+g-1]?f[e-b+g-1]:f[e+g];var u=d[e-b+g]?f[e-b+g]:f[e+g];var r=d[e-b+g+1]?f[e-b+g+1]:f[e+g];var x=d[e+g-1]?f[e+g-1]:f[e+
g];var t=d[e+g+1]?f[e+g+1]:f[e+g];var w=d[e+b+g-1]?f[e+b+g-1]:f[e+g];var z=d[e+b+g]?f[e+b+g]:f[e+g];var B=d[e+b+g+1]?f[e+b+g+1]:f[e+g]}else q=f[e-b+g-1],u=f[e-b+g],r=f[e-b+g+1],x=f[e+g-1],t=f[e+g+1],w=f[e+b+g-1],z=f[e+b+g],B=f[e+b+g+1];x=(r+t+t+B-(q+x+x+w))*h;q=(w+z+z+B-(q+u+u+r))*l;0===x&&0===q?q=-1:(q=90-57.29578*Math.atan2(q,-x),0>q&&(q+=360),360===q?q=0:360<q&&(q%=360));c[e+g]=q}}for(k=0;k<p;k++)c[k*b]=c[k*b+1],c[(k+1)*b-1]=c[(k+1)*b-2];for(k=1;k<b-1;k++)c[k]=c[k+b],c[k+(p-1)*b]=c[k+(p-2)*b];
v.pixelType="F32";v.pixels=[c];v.statistics={minValue:0,maxValue:360};d&&(v.mask=a);return{extent:n.extent,pixelBlock:v}}},_clonePixelBlock:function(n){return n.clone?n.clone():m.clone(n)}}})},"esri/layers/rasterLib/function/BandArithmeticFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterIndex".split(" "),function(m,n,v,b,p,f,d){return m([v,f],{declaredClass:"esri.layers.rasterLib.function.BandArithmeticFunction",
functionName:"BandArithmetic",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({method:1,bandIndexes:"",raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to band arithmetic function is invalid.");this.rasterInfo=n.mixin(a.raster,{bandCount:8===this.functionArguments.method?a.raster.bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:null,histograms:null});this.rasterInfo.keyProperties=
this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){this._performance.start();a=a.raster;var c=d.calculate(a.pixelBlock,{bandIndexes:this.functionArguments.bandIndexes,method:this.functionArguments.method});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType);return{extent:a.extent,pixelBlock:c}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:p.bandArithmetic,
fragmentName:"bandArithmetic"});var c=this.functionArguments.bandIndexes.trim().split(" ").map(function(g){return parseInt(g,10)});this._infraredBandID=c[0]-1;this._visibleBandID=c[1]-1;this._alterBand=2<Math.max(this._infraredBandID,this._visibleBandID)?!0:!1;a=this._setupTextureData(a.raster,this._alterBand&&2==c.length?{bandIDs:[this._infraredBandID,this._visibleBandID,this._infraredBandID]}:{bandIDs:[c[0]-1,c[1]-1,c[2]-1]});var h=this.bindFrameBuffer(),l=this.functionArguments.method,k=2<c.length?
c.slice(2):null;this._alterBand?this._setUniforms({u_method:l,u_bandId_nir:0,u_bandId_red:1,u_constants:k}):this._setUniforms({u_method:l,u_bandId_nir:c[0]-1,u_bandId_red:c[1]-1,u_constants:k});this._bindTexture(a.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:h.texture}}})})},"esri/layers/rasterLib/function/rasterIndex":function(){define(["dojo/_base/lang"],function(m){return{calculate:function(n,v){if(n&&n.pixels&&n.pixels.length){var b=
v&&v.bandIndexes,p=v&&v.method,f=b.trim().split(" ").map(function(h){return parseInt(h,10)}).filter(function(h){return null!=h}),d=this._clonePixelBlock(n),a=d.pixels,c=d.mask;switch(p){case 1:a=this._calculateNDVI(c,a[f[0]-1],a[f[1]-1]);break;case 2:a=this._calculateSAVI(c,a[f[0]-1],a[f[1]-1],f[2]);break;case 3:a=this._calculateTSAVI(c,a[f[0]-1],a[f[1]-1],f[2],f[3],f[4]);break;case 4:a=this._calculateMSAVI(c,a[f[0]-1],a[f[1]-1]);break;case 5:a=this._calculateGEMI(c,a[f[0]-1],a[f[1]-1]);break;case 6:a=
this._calculatePVI(c,a[f[0]-1],a[f[1]-1],f[2],f[3]);break;case 7:a=this._calculateGVITM(c,a[f[0]-1],a[f[1]-1],a[f[2]-1],a[f[3]-1],a[f[4]-1],a[f[5]-1]);break;case 8:a=this._calculateSultan(c,a[f[0]-1],a[f[1]-1],a[f[2]-1],a[f[3]-1],a[f[4]-1],a[f[5]-1]);break;case 9:a=this._calculateVARI(c,a[f[0]-1],a[f[1]-1],a[f[2]-1]);break;case 0:a=this._calculateUserDefined(c,a,b)}d.pixels=a;d.pixelType="F32";d.calculateStatistics();return d}},_clonePixelBlock:function(n){return n.clone?n.clone():m.clone(n)},_parseUserDefined:function(n,
v){n=n.replace(" ","");0===n.indexOf("-")&&(n="0"+n);0===n.indexOf("+")&&(n=n.slice(1,n.length));var b=n.split(""),p=[],f=[],d="+-*/()".split(""),a,c="";for(a=0;a<b.length;a++){var h=b[a];d.some(function(l){return l===h})?(""!==c&&f.push(parseFloat(c)),p.push(h),c=""):"b"===h.toLowerCase()?(a++,c=h.concat(b[a]),f.push(v[parseInt(c[1],10)-1]),c=""):(c=c.concat(h),a===b.length-1&&f.push(parseFloat(c)))}return{ops:p,nums:f}},_op:function(n,v,b,p){if(b.constructor===Number&&p.constructor===Number)return b+
p;var f;if(b.constructor===Number){var d=p.length;var a=b;b=new Float32Array(d);for(f=0;f<d;f++)b[f]=a}else if(d=b.length,p.constructor===Number)for(a=p,p=new Float32Array(d),f=0;f<d;f++)p[f]=a;a=new Float32Array(d);if(null==n)if("+"===v)for(f=0;f<d;f++)a[f]=b[f]+p[f];else if("-"===v)for(f=0;f<d;f++)a[f]=b[f]-p[f];else if("*"===v)for(f=0;f<d;f++)a[f]=b[f]*p[f];else{if("/"===v)for(f=0;f<d;f++)a[f]=b[f]/p[f]}else if("+"===v)for(f=0;f<d;f++)n[f]&&(a[f]=b[f]+p[f]);else if("-"===v)for(f=0;f<d;f++)n[f]&&
(a[f]=b[f]-p[f]);else if("*"===v)for(f=0;f<d;f++)n[f]&&(a[f]=b[f]*p[f]);else if("/"===v)for(f=0;f<d;f++)n[f]&&(a[f]=b[f]/p[f]);return a},_shrinkOp:function(n,v){n.splice(v,1);var b=0,p=0,f=0;do{for(b=f=p=0;b<n.length;b++)if("("===n[b])p=b;else if(")"===n[b]){f=b;break}f===p+1&&n.splice(p,2)}while(f===p+1);return n},_getPriorityOpIndex:function(n,v){if(1===n.length)return{opIndex:0,numIndex:0};var b=0,p=0,f=0,d=-1,a=0;for(b=0;b<n.length;b++)if("("===n[b])p=b;else if(")"===n[b]){f=b;break}var c=0===
f?n:n.slice(p+1,f);for(b=0;b<c.length;b++)if("*"===c[b]||"/"===c[b]){d=b;break}if(!(-1<d))for(b=0;b<c.length;b++)if("+"===c[b]||"-"===c[b]){d=b;break}0<f&&(d+=p+1);for(b=0;b<d;b++)"("===n[b]&&a++;return{opIndex:d,numIndex:d-a}},_calculateUserDefined:function(n,v,b){v=this._parseUserDefined(b,v);b=v.ops;for(var p=v.nums,f,d,a;0<b.length&&(v=this._getPriorityOpIndex(b,p),f=b[v.opIndex],d=p[v.numIndex],a=p[v.numIndex+1],f=this._op(n,f,d,a),1!==b.length);)b=this._shrinkOp(b,v.opIndex),p.splice(v.numIndex,
2,f);return[f]},_calculateNDVI:function(n,v,b){var p=b.length,f=new Float32Array(p),d;if(null==n)for(d=0;d<p;d++){var a=b[d];var c=v[d];f[d]=(c-a)/(c+a)}else for(d=0;d<p;d++)n[d]&&(a=b[d],c=v[d],f[d]=(c-a)/(c+a));return[f]},_calculateSAVI:function(n,v,b,p){var f=b.length,d=new Float32Array(f),a;if(null==n)for(a=0;a<f;a++){var c=b[a];var h=v[a];d[a]=(h-c)/(h+c+p)*(1+p)}else for(a=0;a<f;a++)n[a]&&(c=b[a],h=v[a],d[a]=(h-c)/(h+c+p)*(1+p));return[d]},_calculateTSAVI:function(n,v,b,p,f,d){var a=b.length,
c=new Float32Array(a),h=-f*p+d*(1+p*p);if(null==n)for(d=0;d<a;d++){var l=b[d];var k=v[d];c[d]=p*(k-p*l-f)/(f*k+l+h)}else for(d=0;d<a;d++)n[d]&&(l=b[d],k=v[d],c[d]=p*(k-p*l-f)/(f*k+l+h));return[c]},_calculateMSAVI:function(n,v,b){var p=b.length,f=new Float32Array(p),d;if(null==n)for(d=0;d<p;d++){var a=b[d];var c=v[d];f[d]=.5*(2*(c+1)-Math.sqrt(Math.pow(2*c+1,2)-8*(c-a)))}else for(d=0;d<p;d++)n[d]&&(f[d]=.5*(2*(c+1)-Math.sqrt(Math.pow(2*c+1,2)-8*(c-a))));return[f]},_calculateGEMI:function(n,v,b){var p=
b.length,f=new Float32Array(p),d;if(null==n)for(d=0;d<p;d++){var a=b[d];var c=v[d];c=(2*(c*c-a*a)+1.5*c+.5*a)/(c+a+.5);f[d]=c*(1-.25*c)-(a-.125)/(1-a)}else for(d=0;d<p;d++)n[d]&&(a=b[d],c=v[d],c=(2*(c*c-a*a)+1.5*c+.5*a)/(c+a+.5),f[d]=c*(1-.25*c)-(a-.125)/(1-a));return[f]},_calculatePVI:function(n,v,b,p,f){var d=b.length,a=new Float32Array(d),c,h=Math.sqrt(1+p*p);if(null==n)for(c=0;c<d;c++){var l=b[c];var k=v[c];a[c]=(k-p*l-f)/h}else for(c=0;c<d;c++)n[c]&&(l=b[c],k=v[c],a[c]=(k-p*l-f)/h);return[a]},
_calculateGVITM:function(n,v,b,p,f,d,a){var c=v.length,h=new Float32Array(c),l;if(null==n)for(l=0;l<c;l++)h[l]=-.2848*v[l]-.2435*b[l]-.5436*p[l]+.7243*f[l]+.084*d[l]-1.18*a[l];else for(l=0;l<c;l++)n[l]&&(h[l]=-.2848*v[l]-.2435*b[l]-.5436*p[l]+.7243*f[l]+.084*d[l]-1.18*a[l]);return[h]},_calculateSultan:function(n,v,b,p,f,d,a){b=v.length;var c=new Float32Array(b),h=new Float32Array(b),l=new Float32Array(b),k;if(null==n)for(k=0;k<b;k++)c[k]=d[k]/a[k]*100,h[k]=d[k]/v[k]*100,l[k]=p[k]/f[k]*(d[k]/f[k])*
100;else for(k=0;k<b;k++)n[k]&&(c[k]=d[k]/a[k]*100,h[k]=d[k]/v[k]*100,l[k]=p[k]/f[k]*(d[k]/f[k])*100);return[c,h,l]},_calculateVARI:function(n,v,b,p){var f=v.length,d=new Float32Array(f),a;if(null==n)for(a=0;a<f;a++){var c=v[a];var h=b[a];var l=p[a];d[a]=(h-c)/(h+c-l)}else for(a=0;a<f;a++)if(n[a])for(a=0;a<f;a++)c=v[a],h=b[a],l=p[a],d[a]=(h-c)/(h+c-l);return[d]}}})},"esri/layers/rasterLib/function/ColormapFunction":function(){define("dojo/_base/declare dojo/_base/lang ../../../renderers/colorRampGenerator ./RasterFunctionX ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(m,n,v,b,p,f,d){return m([b,f],{declaredClass:"esri.layers.rasterLib.function.ColormapFunction",functionName:"Colormap",pixelType:"U8",renderTexture:!1,supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({colormap:null,colorRampName:null,colorRamp:null,colorMapName:null,raster:null},a);this.invert=a&&a.invert;a=a.colormap||a.Colormap;if(a){if(a.features||a[0].attributes){a=a.features||a;var c=Object.keys(a[0].attributes);var h=c.filter(function(u){return"alpha"===
u.toLowerCase()})[0];var l=c.filter(function(u){return"value"===u.toLowerCase()})[0];var k=c.filter(function(u){return"red"===u.toLowerCase()})[0];var g=c.filter(function(u){return"green"===u.toLowerCase()})[0];var e=c.filter(function(u){return"blue"===u.toLowerCase()})[0];if(!(l&&k&&g&&e))throw"invalid colormap";a=a.map(function(u){return h?[u.attributes[l],u.attributes[k],u.attributes[g],u.attributes[e],u.attributes[h]]:[u.attributes[l],u.attributes[k],u.attributes[g],u.attributes[e]]});var q=1.1>
Math.max.apply(null,a.map(function(u){return u[1]}));c=h&&1.1>Math.max.apply(null,a.map(function(u){return u[4]}));if(q)for(q=0;q<a.length;q++)a[q][1]=Math.round(255*a[q][1]),a[q][2]=Math.round(255*a[q][2]),a[q][3]=Math.round(255*a[q][3]),c&&(a[q][4]=Math.round(255*a[q][4]))}this.functionArguments.colormap=this._sortClr(a)}this._initialize()},bind:function(a){this._initialize();a=this.getSourceRasterInfo(a);if(!a.raster||"F32"===a.raster.pixelType)return Error("The raster input to colormap function is invalid. It must be integer type.");
this.rasterInfo=n.mixin(a.raster,{bandCount:3,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Processed";return!0},read2D:function(a){return this._colorize(a.raster)},readGL:function(a){return this._colorizeGL(a.raster)},_colorize:function(a){this._performance.start();var c=d.colorize(a.pixelBlock,{indexedColormap:this._indexedColormap,indexedColormapOffset:this._indexedColormapOffset,
indexed2DColormap:this._indexed2DColormap,alphaSpecified:this._alphaSpecified});this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,pixelBlock:c}},_binarySearchClr:function(a,c){for(var h=0,l=a.length-1,k=0,g=0;h<l;)if(k=Math.floor((h+l)/2),g=a[k],g[0]<c)h=k;else if(g[0]>c)l=k;else return g.slice(1);return null},_sortClr:function(a,c){var h,l,k=[];for(h=0;h<a.length;h++)k.push(a[h]);for(h=0;h<k.length-1;h++){var g=k[h];for(l=h+1;l<k.length;l++)g[0]>k[l][0]&&(g=k[l],k[l]=
k[h],k[h]=g)}if(c)for(h=0;h<k.length/2;h++)g=k[h],k[k.length-1-h]=k[h],k[h]=g;return k},_invertColorRamp:function(a){if(!a)return a;var c={type:a.type};"random"===a.type?c=a:"multipart"===a.type?c.colorRamps=a.colorRamps.map(function(h){return{fromColor:h.toColor,toColor:h.fromColor}}).reverse():(c.fromColor=a.toColor,c.toColor=a.fromColor);return c},_initialize:function(){this._indexedColormapOffset=0;if(this.functionArguments.colormap){var a=d.buildIndexedColormap(this.functionArguments.colormap);
this._alphaSpecified=a&&a.alphaSpecified;this._indexedColormap=a&&a.indexedColormap;this._indexedColormapOffset=a&&a.offset;this._indexedColormap||(this._indexed2DColormap=this._getIndexed2DColormap())}else this.functionArguments.colorRamp?this._indexedColormap="multipart"===this.functionArguments.colorRamp.type?this.invert?v.createMultiPartColorRamp(this._invertColorRamp(this.functionArguments.colorRamp)):v.createMultiPartColorRamp(this.functionArguments.colorRamp):this.invert?v.createAlgorithmicColorRamp(this._invertColorRamp(this.functionArguments.colorRamp)):
v.createAlgorithmicColorRamp(this.functionArguments.colorRamp):this.functionArguments.colormapName&&"random"===this.functionArguments.colormapName.toLowerCase()&&(this._indexedColormap=v.createRandomColorRamp())},_getIndexed2DColormap:function(){var a=this.functionArguments.colormap;if(!a)return null;var c=0;0>a[0][0]&&(c=a[0][0]);var h=[],l=5===a[0].length,k;for(k=0;k<a.length;k++)h[a[k][0]-c]=l?a[k].slice(1):a[k].slice(1).concat([255]);return h},_colorizeGL:function(a){this._performance.start();
this._initializeProgram({fragment:p.colormap,fragmentName:"Colormap"});var c=this._indexedColormap,h=this._indexedColormapOffset;this._clrTexture||(this._clrTexture=this._setupColormapTexture(c));var l=this._clrTexture,k=this.bindFrameBuffer();a=this._setupTextureData(a);this._setUniforms({u_indexedColormapOffset:h,u_indexedColormapMaxIndex:c.length/4-1});this._bindTexture(l,"u_image1");this._bindTexture(a.texture,"u_image");this._drawGL();return{extent:a.extent,texture:k.texture}},_setupColormapTexture:function(a){var c=
this._createTexture(),h=this.gl,l=a.length/4,k=new Float32Array(a.length),g,e=this.renderTexture?255:1;for(g=0;g<a.length;g++)k[g]=a[g]/e;h.getExtension("OES_texture_float");h.texImage2D(h.TEXTURE_2D,0,h.RGBA,l,1,0,h.RGBA,h.FLOAT,k);return c}})})},"esri/renderers/colorRampGenerator":function(){define(["dojo/_base/declare","dojo/_base/lang","../renderers/colorUtils"],function(m,n,v){return{createAlgorithmicColorRamp:function(b,p){if(!b)return null;var f=b.fromColor,d=b.toColor;if(!f||!d)return null;
void 0===f.r&&3<=f.length&&(f={r:f[0],g:f[1],b:f[2]});void 0===d.r&&3<=d.length&&(d={r:d[0],g:d[1],b:d[2]});var a=b.size||256,c=b.algorithm||"cie-lab";if(1===a)var h=[f.r,f.g,f.b,255];else if(2===a)h=[f.r,f.g,f.b,255,d.r,d.g,f.b,255];else if(-1<c.toLowerCase().indexOf("hsv")){h=v.toHSV(f);d=v.toHSV(d);a=a||256;var l=0===h.s,k=0===d.s;f=h.h;c=d.h;l&&!k?f=h.h=c:k&&!l&&(c=d.h=f);l=Math.abs(c-f);180>l?c=(c-f)/(a-1):(l=360-l,c=f>c?l/(a-1):-l/(a-1));l=(d.s-h.s)/(a-1);k=(d.v-h.v)/(a-1);var g=h.s;h=h.v;var e,
q=new Uint8Array(4*a);for(e=0;e<a-1;e++){var u=v.toRGB({h:f,s:g,v:h});q[4*e]=u.r;q[4*e+1]=u.g;q[4*e+2]=u.b;q[4*e+3]=255;f+=c;g+=l;h+=k;360<f?f-=360:0>f&&(f+=360)}u=v.toRGB(d);q[4*(a-1)]=u.r;q[4*(a-1)+1]=u.g;q[4*(a-1)+2]=u.b;q[4*(a-1)+3]=255;h=q}else if(-1<c.toLowerCase().indexOf("lch")){g=v.toLCH(f);d=v.toLCH(d);a=a||256;h=(d.l-g.l)/(a-1);f=(d.c-g.c)/(a-1);c=(d.h-g.h)/(a-1);l=g.l;k=g.c;g=g.h;q=new Uint8Array(4*a);for(e=0;e<a-1;e++)u=v.toRGB({l:l,c:k,h:g}),q[4*e]=u.r,q[4*e+1]=u.g,q[4*e+2]=u.b,q[4*
e+3]=255,l+=h,k+=f,g+=c;u=v.toRGB(d);q[4*(a-1)]=u.r;q[4*(a-1)+1]=u.g;q[4*(a-1)+2]=u.b;q[4*(a-1)+3]=255;h=q}else if(-1<c.toLowerCase().indexOf("lab")){g=v.toLAB(f);d=v.toLAB(d);a=a||256;h=(d.l-g.l)/(a-1);f=(d.a-g.a)/(a-1);c=(d.b-g.b)/(a-1);l=g.l;k=g.a;g=g.b;q=new Uint8Array(4*a);for(e=0;e<a-1;e++)u=v.toRGB({l:l,a:k,b:g}),q[4*e]=u.r,q[4*e+1]=u.g,q[4*e+2]=u.b,q[4*e+3]=255,l+=h,k+=f,g+=c;u=v.toRGB(d);q[4*(a-1)]=u.r;q[4*(a-1)+1]=u.g;q[4*(a-1)+2]=u.b;q[4*(a-1)+3]=255;h=q}if(p&&!1===p.flattened)for(d=h,
h=[],a=0;a<h/4;a++)h[a]=d.slice(4*a,4*a+4);return h},createMultiPartColorRamp:function(b,p){if(!b)return null;p=p&&n.clone(p)||{flattened:!0};var f=b.colorRamps;if(!f||0===f.length)return null;var d=b.size||256,a=Math.max(Math.floor(d/f.length),1),c=Math.max(a,d-(f.length-1)*a),h=!1!==p.flattened;p.flattened=!0;d=(f.length-1)*a+c;var l=new Uint8Array(4*d);for(d=0;d<f.length;d++){var k={fromColor:f[d].fromColor,toColor:f[d].toColor,size:d===f.length-1?c:a};l instanceof Array?l.concat(this.createAlgorithmicColorRamp(k,
p)):l.set(this.createAlgorithmicColorRamp(k,p),a*d*4)}if(!h)for(f=l,l=[],d=0;d<l/4;d++)l[d]=f.slice(4*d,4*d+4);return l},createRandomColorRamp:function(b){b=b||{};var p=b.size||256,f=!1===b.flattened;var d=f?new Uint8Array(4*p):[];for(b=0;b<p;b++)f?(d[4*b]=Math.round(255*Math.random()),d[4*b+1]=Math.round(255*Math.random()),d[4*b+2]=Math.round(255*Math.random()),d[4*b+3]=255):d[b]=[Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random()),255];return d}}})},"esri/layers/rasterLib/function/rasterUtils":function(){define(["dojo/_base/lang"],
function(m){return{mask:function(n,v){if(n&&n.pixels&&n.pixels.length){var b=this._clonePixelBlock(n),p=v.includedRanges,f=v.noDataInterpretation,d=v.noDataValues;if(null===p&&null===d)return b;var a=b.pixels,c=b.mask,h=b.width*b.height,l=a.length,k;if(null!==d&&d.length!==l)throw"expect "+l+" elements in noDataValues";if(null!==p&&p.length!==2*l)throw"expect "+2*l+" elements in IncludeRanges";if(null==c){c=new Uint8Array(h);for(k=0;k<h;k++)c[k]=1;b.mask=c}if(0===f)for(f=0;f<l;f++){var g=a[f];var e=
null===p?null:p[2*f];var q=null===p?null:p[2*f+1];var u=null===d?null:parseFloat(d[f]);if(null===e||null===q)for(k=0;k<h;k++){if(c[k]){var r=g[k];r===u&&(c[k]=0)}}else if(null===u)for(k=0;k<h;k++)c[k]&&(r=g[k],r<e||r>q)&&(c[k]=0);else for(k=0;k<h;k++)c[k]&&(r=g[k],r<e||r>q||r===u)&&(c[k]=0)}else{var x=new Uint8Array(h);for(k=0;k<h;k++)x[k]=c[k];for(f=0;f<l;f++)if(g=a[f],e=null===p?null:p[2*f],q=null===p?null:p[2*f+1],u=null===d?null:parseFloat(d[f]),null===e||null===q)for(k=0;k<h;k++)x[k]&&(r=g[k],
r!==u&&(x=0));else if(null===u)for(k=0;k<h;k++)x[k]&&(r=g[k],r<=e&&r<=q&&(x=0));else for(k=0;k<h;k++)x[k]&&(r=g[k],r<=e&&r<=q&&r!==u&&(x=0));for(k=0;k<h;k++)c[k]&&x[k]&&(c[k]=0)}return b}},calculateStatisticsHistograms:function(n,v){var b=this._clonePixelBlock(n),p=b.pixelType,f=b.pixels,d=b.mask,a=f.length,c,h,l=[],k;for(c=0;c<a;c++){var g={min:-.5,max:255.5,size:256,counts:new Uint32Array(256)};var e=g.counts;var q=f[c];if("U8"===p)if(d)for(h=0;h<b.width*b.height;h++)d[h]&&e[q[h]]++;else for(h=
0;h<b.width*b.height;h++)e[q[h]]++;else{var u=b.statistics[c].minValue;var r=b.statistics[c].maxValue;g.min=u;g.max=r;r=(r-u)/256;var x=new Uint32Array(257);if(d)for(h=0;h<b.width*b.height;h++)d[h]&&x[Math.floor((q[h]-u)/r)]++;else for(h=0;h<b.width*b.height;h++)x[Math.floor((q[h]-u)/r)]++;for(h=0;255>h;h++)e[h]=x[h];e[255]=x[255]+x[256]}l.push(g);u=b.statistics[c].minValue;r=b.statistics[c].maxValue;for(h=x=k=q=0;h<g.size;h++)q+=e[h],k+=h*e[h];k/=q;for(h=0;h<g.size;h++)x+=e[h]*Math.pow(h-k,2);e=
Math.sqrt(x/(q-1));h=(k+.5)*(g.max-g.min)/g.size+g.min;g=e*(g.max-g.min)/g.size;b.statistics[c]={min:u,minValue:u,max:r,maxValue:r,mean:h,stddev:g}}b.histograms=l;return b},buildIndexedColormap:function(n,v){if(!n)return null;var b=0;0>n[0][0]&&(b=n[0][0]);var p=Math.max(256,n[n.length-1][0]-b);if(65536<p)return null;var f=new Uint8Array(4*p),d=[],a,c=0,h=5===n[0].length;if(v)for(d=n[c],a=d[0]-b;a<p;a++)f[4*a]=d[1],f[4*a+1]=d[2],f[4*a+2]=d[3],f[4*a+3]=h?d[4]:255,a===d[0]-b&&(d=c===n.length-1?d:n[++c]);
else for(a=0;a<n.length;a++)d=n[a],c=4*(d[0]-b),f[c]=d[1],f[c+1]=d[2],f[c+2]=d[3],f[c+3]=h?d[4]:255;return{indexedColormap:f,offset:b,alphaSpecified:h}},colorize:function(n,v){if(null!==n&&null!==n.pixels){var b=this._clonePixelBlock(n),p=b.pixels,f=b.width*b.height,d=b.mask,a=v.indexedColormap,c=v.indexedColormapOffset,h=a&&a.length-1,l=v.indexed2DColormap,k=v.alphaSpecified;if(3<=p.length)throw"colormap only works on single band image";var g=p[0],e=new Uint8Array(g.length),q=new Uint8Array(g.length),
u=new Uint8Array(g.length),r=0;if(a)if(d)for(p=0;p<f;p++)d[p]&&(r=4*(g[p]-c),r<c||r>h?d[p]=0:(e[p]=a[r],q[p]=a[r+1],u[p]=a[r+2],d[p]=a[r+3]));else{d=new Uint8Array(f);for(p=0;p<f;p++)r=4*(g[p]-c),r<c||r>h?d[p]=0:(e[p]=a[r],q[p]=a[r+1],u[p]=a[r+2],d[p]=a[r+3]);b.mask=d}else if(d)for(p=0;p<f;p++)d[p]&&(a=l[g[p]],e[p]=a[0],q[p]=a[1],u[p]=a[2],d[p]=a[3]);else{d=new Uint8Array(f);for(p=0;p<f;p++)a=l[g[p]],e[p]=a[0],q[p]=a[1],u[p]=a[2],d[p]=a[3];b.mask=d}b.pixels=[e,q,u];b.statistics=null;b.pixelType="U8";
b.maskIsAlpha=k;return b}},convolute:function(n,v){var b=this._clonePixelBlock(n),p=b.pixels,f=b.width,d=b.height,a=f*d,c=p.length,h,l,k,g,e,q=[],u=[],r=v.normalizedKernel,x=v.kernelRows,t=v.kernelCols;for(h=0;h<c;h++){var w=p[h];var z=new Float32Array(a);z.set(w);for(g=1;g<d-1;g++){var B=g*f;for(e=1;e<f-1;e++){for(l=u=0;l<x;l++)for(k=0;k<t;k++)u+=w[B+e+(l-1)*f+k-1]*r[l*t+k];z[B+e]=u}}q.push(z)}b.pixels=q;return b},contrastBrightnessStretch:function(n,v){if(null!==n&&null!==n.pixels){var b=this._clonePixelBlock(n),
p=b.pixels,f=b.mask,d=b.width*b.height,a=p.length;var c=v&&v.contrastOffset;var h=v&&v.brightnessOffset;if("U8"!==b.pixelType)throw"the contrast and brightness function only supports 8 bit unsigned integer data";var l=this._createContrastBrightnessLUT(c,h);if(null==f)for(h=0;h<d;h++)for(c=0;c<a;c++)p[c][h]=l[p[c][h]];else for(h=0;h<d;h++)if(f[h])for(c=0;c<a;c++)p[c][h]=l[p[c][h]];b.pixelType="U8";return b}},isNull:function(n,v){if(null!==n&&null!==n.pixels){var b=this._clonePixelBlock(n),p=b.mask,
f=b.pixels[0],d=f.length,a;if(p){for(a=0;a<d;a++)f[a]=p[a]?0:1;b.mask=null}else if(f.fill)f.fill(0);else for(a=0;a<d;a++)f[a]=0;return b}},setNull:function(n){if(null!==v&&null!==v.pixels){var v=this._clonePixelBlock(n);n=v.mask;var b=v.pixels[0],p=b.length,f;n=n||new Uint8Array(p);for(f=0;f<p;f++)n[f]=b[f]?0:1;v.mask=n;return v}},local:function(n,v){if(!v)return n[0];var b=v.rasterCountNeeded,p=v.functor,f=this._clonePixelBlock(n[0]);if(null!==f&&null!==f.pixels){var d=f.width*f.height,a,c=(a=n[1])&&
a.pixels[0],h=a&&a.mask,l=f.mask,k=f.pixels[0];if(2===b)if(!l&&h)l=h;else if(l&&h)for(a=0;a<d;a++)l[a]=l[a]&&h[a]?1:0;f.mask=l;if(1===b)if(null==l)for(a=0;a<d;a++)k[a]=p(k[a]);else for(a=0;a<d;a++)l[a]&&(k[a]=p(k[a]));else if(2===b)if(null==l)for(a=0;a<d;a++)k[a]=p(k[a],c[a]);else for(a=0;a<d;a++)l[a]&&(k[a]=p(k[a],c[a]));f.mask=l;f.calculateStatistics();return f}},remapColor:function(n,v){var b=this._clonePixelBlock(n),p=b.width*b.height,f=v.length,d=Math.floor(f/2),a=v[Math.floor(d)],c=v[0].value,
h=v[v.length-1].value,l=b.pixels[0],k,g,e=!1,q=new Uint8Array(p),u=new Uint8Array(p),r=new Uint8Array(p),x=b.mask,t=4===v[0].mappedColor.length;x&&0!==x.length||(x=new Uint8Array(p),x.fill(t?255:1),b.mask=x);for(g=0;g<p;g++)if(x[g]){var w=l[g];if(w<c||w>h)q[g]=u[g]=r[g]=x[g]=0;else{e=!1;var z=d;var B=a;var A=0;for(k=f-1;1<k-A;){if(w===B.value){e=!0;break}w>B.value?A=z:k=z;z=Math.floor((A+k)/2);B=v[Math.floor(z)]}e||(B=w===v[k].value?v[k]:v[A]);q[g]=B.mappedColor[0];u[g]=B.mappedColor[1];r[g]=B.mappedColor[2];
x[g]=B.mappedColor[3]}}b.pixels=[q,u,r];b.mask=x;b.pixelType="u8";b.maskIsAlpha=t;return b},_clonePixelBlock:function(n){if(n.clone)return n.clone();var v=m.clone(n),b;if(n.pixels&&n.pixels[0]&&0<n.pixels[0].length&&!(v.pixels&&v.pixels[0]&&0<v.pixels[0].length)){v.pixels=[];var p=n.pixels.length;for(b=0;b<p;b++)v.pixels[b]=new n.pixels[b].constructor(n.pixels[b])}if(n.statistics)for(v.statistics=[],p=n.statistics.length,b=0;b<p;b++)v.statistics[b]=m.clone(n.statistics[b]);n.mask&&(v.mask=new Uint8Array(n.mask));
return v},_createContrastBrightnessLUT:function(n,v){if(this._contrastCache&&this._contrastCache.contrastOffset===n&&this._contrastCache.brightnessOffset===v)return this._contrastCache.lut;var b=Math.min(Math.max(n,-100),100),p=Math.min(Math.max(v,-100),100),f,d=new Uint8Array(256);for(f=0;256>f;f++){if(0<b&&100>b)var a=(200*f-25500+510*p)/(2*(100-b))+128;else 0>=b&&-100<b?a=(200*f-25500+510*p)*(100+b)/2E4+128:100===b?(a=200*f-25500+256*(100-b)+510*p,a=0<a?255:0):-100===b&&(a=128);d[f]=255<a?255:
0>a?0:a}this._contrastCache={contrastOffset:n,brightnessOffset:v,lut:d};return d}}})},"esri/layers/rasterLib/function/CompositeBandFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),function(m,n,v,b,p,f){return m([v,f],{declaredClass:"esri.layers.rasterLib.function.CompositeBandFunction",functionName:"CompositeBand",supportWebGL:!0,support2D:!0,constructor:function(d){this.functionArguments=this.mixinIgnoreCase({rasters:null},
d)},bind:function(d){d=this.getSourceRasterInfo(d);if(!d.rasters)return Error("The rasters input to composite band function is invalid.");var a=[],c=[],h=d.rasters.length,l;if(d.rasters[0].statistics)for(l=0;l<h;l++)a.push(d.rasters[l].statistics[0]);if(d.rasters[0].histograms)for(l=0;l<h;l++)c.push(d.rasters[l].histograms[0]);this.rasterInfo=n.mixin(d.rasters[0],{bandCount:h,pixelType:this._calculatePixelType(this.pixelType,d.rasters[0].pixelType),statistics:a,histograms:c});return!0},read2D:function(d){d=
d.rasters;if(null!=d&&0!==d.length){var a=this._clonePixelData(d[0]),c=a.pixelBlock,h=[],l=[];for(k=0;k<d.length;k++)h.push(d[k].pixelBlock.pixels[0]),l.push(d[k].pixelBlock.statistics[0]);c.pixels=h;c.stackedStatistics=l;c.planes=d.length;var k;l=c.width*c.height;for(k=0;k<d.length;k++)if(c=d[k].pixelBlock.mask,g&&c)for(h=0;h<l;h++)g[h]&=c[h];else var g=g||c;a.maks=g;return a}},readGL:function(d){this._performance.start();this._initializeProgram({fragment:p.compositeBand,fragmentName:"CompositeBand"});
var a=d.rasters;if(null!=a&&0!==a.length){a=a.length;var c,h=this.bindFrameBuffer();for(c=0;c<a;c++){var l=this._setupTextureData(d.rasters[c],{notOriginal:0<c});var k=0<c?c.toString():"";this._bindTexture(l.texture,"u_image"+k)}this._setUniforms({u_rasterCount:a});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:l.extent,texture:h.texture}}}})})},"esri/layers/rasterLib/function/ContrastBrightnessFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(m,n,v,b,p,f,d){return m([v,f],{declaredClass:"esri.layers.rasterLib.function.ContrastBrightnessFunction",renderTexture:!0,functionName:"ContrastBrightness",supportWebGL:!0,support2D:!0,pixelType:"U8",constructor:function(a){this.functionArguments=this.mixinIgnoreCase({contrastOffset:0,brightnessOffset:0,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to contrast and brightness function is invalid.");this.rasterInfo=n.mixin(a.raster,
{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Processed";return!0},read2D:function(a){a=a.raster;if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels){var c=d.contrastBrightnessStretch(a.pixelBlock,{contrastOffset:this.functionArguments.contrastOffset,brightnessOffset:this.functionArguments.brightnessOffset});"Unknown"!==
this.pixelType&&(c.pixelType=this.pixelType,c.pixels=c.pixels.map(n.hitch(this,function(h){return this._clampBand(h,c.pixelType)})));return{extent:a.extent,pixelBlock:c}}},readGL:function(a){return this._cbGL(a.raster)},_cbGL:function(a){this._performance.start();this._initializeProgram({fragment:p.contrastBrightness,fragmentName:"ContrastBrightness"});a=this._setupTextureData(a);this._setUniforms({u_contrastOffset:Math.min(Math.max(this.functionArguments.contrastOffset,-100),100),u_brightnessOffset:Math.min(Math.max(this.functionArguments.brightnessOffset,
-100),100),u_scaleFactor:this.renderTexture?255:1});this._bindTexture(a.texture,"u_image");var c=this.bindFrameBuffer();this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:c.texture}}})})},"esri/layers/rasterLib/function/ConvolutionFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./convolutionKernel ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(m,n,v,b,p,f,d,a){return m([v,
d],{declaredClass:"esri.layers.rasterLib.function.ConvolutionFunction",functionName:"Convolution",supportWebGL:!0,support2D:!0,constructor:function(c){this.functionArguments=this.mixinIgnoreCase({columns:3,rows:3,type:0,kernel:null,raster:null},c)},bind:function(c){c=this.getSourceRasterInfo(c);if(!c.raster)return Error("The raster input to convolution function is invalid.");this.rasterInfo=n.mixin(c.raster,{bandCount:c.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,c.raster.pixelType),
statistics:c.raster.statistics,histograms:c.raster.histograms});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(c){this._performance.start();c=c.raster;var h=this._analyzeKernel(),l=a.convolute(c.pixelBlock,{normalizedKernel:h.normalizedKernel,kernelCols:this.functionArguments.columns,kernelRows:this.functionArguments.rows});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&
(l.pixelType=this.pixelType);l.pixels=l.pixels.map(n.hitch(this,function(k){return this._clampBand(k,l.pixelType)}));return{extent:c.extent,pixelBlock:l}},readGL:function(c){this._performance.start();this._initializeProgram({fragment:f.convolution,fragmentName:"Convolution"});var h=this._setupTextureData(c.raster),l=this.bindFrameBuffer(),k=this.gl,g=k.drawingBufferWidth;k=k.drawingBufferHeight;var e=this.functionArguments.kernel;this._setUniforms({u_resolution:c&&c.raster&&c.raster.pixelBlock?[1/
c.raster.pixelBlock.width,1/c.raster.pixelBlock.height]:[1/g,1/k],u_kernel:e,u_kernelSize:e.length});this._bindTexture(h.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:h.extent,texture:l.texture}},_analyzeKernel:function(){var c=this.functionArguments.kernel,h=c.reduce(function(g,e){return g+e});0!==h&&1!==h&&(c=c.map(function(g){return g/h}));var l,k=[];for(l=0;l<c.length;l++)k.some(function(g){return g===c[l]})||k.push(c[l]);return{normalizedKernel:c,
distinctValues:k}},_analyzeKernelPattern:function(){var c=this.functionArguments.rows,h=this.functionArguments.columns,l=this.functionArguments.kernel,k=[],g,e;for(g=0;g<c;g++)k.push({weights:l.slice(g*h,(g+1)*h)});var q;for(g=1;g<c;g++){var u=k[g].weights;for(l=0;l<g;l++)if(q=k[l].weights){var r=u[0]/q[0];for(e=1;e<h;e++)u[e]/q[e]!==r&&(r=null);null!==r&&(k[g]={row:l,factor:r})}}return k}})})},"esri/layers/rasterLib/function/ExtractBandFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),
function(m,n,v,b,p,f){return m([v,f],{declaredClass:"esri.layers.rasterLib.function.ExtractBandFunction",functionName:"ExtractBand",supportWebGL:!0,support2D:!0,constructor:function(d){this.functionArguments=this.mixinIgnoreCase({bandIDs:[],missingBandAction:0,raster:null},d)},bind:function(d){d=this.getSourceRasterInfo(d);if(!d.raster)return Error("The raster input to extract band function is invalid.");var a=[],c=d.raster.statistics,h=[],l=d.raster.histograms,k=this.functionArguments.bandIDs.length||
d.raster.bandCount;this.functionArguments.bandIDs.forEach(n.hitch(this,function(g){if(g>=k-1){if(1===this.functionArguments.missingBandAction)return Error("missing band "+g);g=k-1}if(0>g)return Error("missing band "+g);void 0!==c&&null!==c&&0<c.length&&a.push(c[g]);void 0!==l&&null!==l&&0<l.length&&h.push(l[g])}));this.rasterInfo=n.mixin(d.raster,{bandCount:k,pixelType:this._calculatePixelType(this.pixelType,d.raster.pixelType),statistics:a,histograms:h});return!0},read2D:function(d){d=this._clonePixelData(d.raster);
if(null!==d&&null!==d.pixelBlock&&null!==d.pixelBlock.pixels){this._performance.start();var a=d.pixelBlock,c=a.statistics,h=a.pixels,l=h.length;if(null==this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(0===this.functionArguments.bandIDs.length)return d;var k=[],g=[];this.functionArguments.bandIDs.forEach(function(e){if(e>=l-1){if(1===this.functionArguments.missingBandAction)throw"missing band "+e;e=l-1}if(0>e)throw"missing band "+e;k.push(h[e]);void 0!==c&&null!==c&&0<c.length&&
g.push(c[e])});a.pixels=k;a.statistics=g;a.planes=this.functionArguments.bandIDs.length;return d}},readGL:function(d){this._performance.start();if(null==this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(3<this.functionArguments.bandIDs.length)throw"this version does not support more than 3 bands yet";this._initializeProgram({fragment:p.extractBand,fragmentName:"ExtractBand"});var a=this.functionArguments.bandIDs;1===a.length&&(a=[a[0],a[0],a[0]]);this._bandIDs=a;this._alterBand=!(0===
this.functionArguments.bandIDs.length||0===a[0]&&1===a[1]&&2===a[2]);var c=!!(this._alterBand&&d.raster&&d.raster.texture);d=this._setupTextureData(d.raster,{bandIDs:a});var h=this.bindFrameBuffer();c?this._setUniforms({u_bandIDs:a,u_alterBand:this._alterBand}):this._setUniforms({u_bandIDs:a,u_alterBand:!1});this._bindTexture(d.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:d.extent,texture:h.texture}}})})},"esri/layers/rasterLib/function/HillshadeFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../renderers/colorRampGenerator ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils ./rasterUtils".split(" "),
function(m,n,v,b,p,f,d,a,c,h){return m([v,a],{declaredClass:"esri.layers.rasterLib.function.HillshadeFunction",functionName:"Hillshade",supportWebGL:!0,support2D:!0,renderTexture:!0,constructor:function(l){this.functionArguments=this.mixinIgnoreCase({hillshadeType:0,altitude:45,azimuth:315,zFactor:1,slopeType:1,psPower:.664,psFactor:.024,colorRamp:null,raster:null},l);this._azimuths=[315,270,225,360,180,0];this._altitudes=[60,60,60,60,60,90];this._weights=[3,5,3,2,1,4];var k=this._weights.reduce(function(g,
e){return g+e});this._weights=this._weights.map(function(g){return g/k})},bind:function(l){l=this.getSourceRasterInfo(l);if(!l.raster)return Error("The raster input to hillshade function is invalid.");l.raster.statistics&&(this.srcStatistics=l.raster.statistics);this.rasterInfo=n.mixin(l.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:[{min:0,max:255}],histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType=
"Generic";this._initializeColormap();return!0},read2D:function(l){this._performance.start();l=l.raster;l=c.hillshade(l,{altitude:this.functionArguments.altitude,azimuth:this.functionArguments.azimuth,zFactor:this.functionArguments.zFactor,psPower:this.functionArguments.psPower,psFactor:this.functionArguments.psFactor,hillshadeType:this.functionArguments.hillshadeType,slopeType:this.functionArguments.slopeType,isGCS:l.extent.spatialReference.wkid&&null==p[l.extent.spatialReference.wkid]});this._addPerformanceMetric(this._performance.elapsed());
return l},readGL:function(l){this._performance.start();this._initializeProgram({fragment:d.hillshade,fragmentName:"Hillshade"});this.functionArguments.colorRamp&&this._indexedColormap&&!this._clrTexture&&(this._clrTexture=this._setupColormapTexture(this._indexedColormap));var k=this._setupTextureData(l.raster),g=this.bindFrameBuffer(),e=this.gl,q=e.drawingBufferWidth;e=e.drawingBufferHeight;var u=k.extent,r=(u.xmax-u.xmin)/q,x=(u.ymax-u.ymin)/e,t=this.functionArguments.altitude,w=this.functionArguments.azimuth,
z=this.functionArguments.zFactor;1===this.functionArguments.hillshadeType&&(z*=2);var B=z/(8*r),A=z/(8*x);.001<z&&u.spatialReference.wkid&&null==p[u.spatialReference.wkid]&&(B/=111E3,A/=111E3);var y=this.functionArguments.psPower,E=this.functionArguments.psFactor;3===this.functionArguments.slopeType&&((B=u.spatialReference.wkid&&null==p[u.spatialReference.wkid])?(B=111E3*r,A=111E3*x,B=(z+Math.pow(B,y)*E)/(8*B),A=(z+Math.pow(A,y)*E)/(8*A)):(B=(z+Math.pow(r,y)*E)/(8*r),A=(z+Math.pow(x,y)*E)/(8*x)));
var G=(90-t)*Math.PI/180;t=Math.cos(G);var F=(360-w+90)*Math.PI/180;w=Math.sin(G)*Math.cos(F);G=Math.sin(G)*Math.sin(F);y=Array(6);E=Array(6);u=Array(6);var D=this._weights,L;if(1===this.functionArguments.hillshadeType){var O=this._azimuths.length;for(L=0;L<O;L++)t=this._altitudes[L],w=this._azimuths[L],G=(90-t)*Math.PI/180,t=Math.cos(G),F=(360-w+90)*Math.PI/180,w=Math.sin(G)*Math.cos(F),G=Math.sin(G)*Math.sin(F),y[L]=t,E[L]=w,u[L]=G}else y[0]=t,E[0]=w,u[0]=G;y=y.map(function(S){return parseFloat(S)});
E=E.map(function(S){return parseFloat(S)});u=u.map(function(S){return parseFloat(S)});this._setUniforms({u_cellSize:[r,x],u_zfactor:z,u_xFactor:B,u_yFactor:A,u_sinZcosA:w,u_sinZsinA:G,u_cosZ:t,u_sinZcosAs:E,u_sinZsinAs:u,u_cosZs:y,u_weights:D,u_hillshadeType:this.functionArguments.hillshadeType,u_resolution:l&&l.raster&&l.raster.pixelBlock?[1/l.raster.pixelBlock.width,1/l.raster.pixelBlock.height]:[1/q,1/e],u_scaled:!this.renderTexture,u_applyColorramp:this._clrTexture?!0:!1,u_minValue:this.srcStatistics[0].min,
u_maxValue:this.srcStatistics[0].max,u_indexedColormapOffset:this._indexedColormapOffset||0,u_indexedColormapMaxIndex:this._indexedColormap?this._indexedColormap.length/4-1:0});this._clrTexture&&this._bindTexture(this._clrTexture,"u_image1");this._bindTexture(k.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:k.extent,texture:g.texture}},_initializeColormap:function(){this._indexedColormapOffset=0;var l=this._indexedColormap,k=this.functionArguments.colorRamp;
this.functionArguments.colormap?(this._alphaSpecified=(k=h.buildIndexedColormap(this.functionArguments.colormap))&&k.alphaSpecified,this._indexedColormap=k&&k.indexedColormap,this._indexedColormapOffset=k&&k.offset):k?(this._indexedColormap="multipart"===k.type?this.invert?b.createMultiPartColorRamp(this._invertColorRamp(k)):b.createMultiPartColorRamp(k):this.invert?b.createAlgorithmicColorRamp(this._invertColorRamp(k)):b.createAlgorithmicColorRamp(k),k.fromColor&&k.toColor&&"000"===k.fromColor.slice(0,
3).join("")&&"255255255"===k.toColor.slice(0,3).join("")&&(this._clrTexture=this._indexedColormap=null)):this.functionArguments.colormapName?"random"===this.functionArguments.colormapName.toLowerCase()&&(this._indexedColormap=b.createRandomColorRamp()):this._clrTexture=this._indexedColormap=null;if(l&&this._indexedColormap){k=!0;for(var g=0;g<l.length;g++)if(l[g]!==this._indexedColormap[g]){k=!1;break}k||(this._clrTexture=null)}},_setupColormapTexture:function(l){var k=this._createTexture(),g=this.gl,
e=l.length/4,q=new Float32Array(l.length),u;for(u=0;u<l.length;u++)q[u]=l[u]/255;g.getExtension("OES_texture_float");g.texImage2D(g.TEXTURE_2D,0,g.RGBA,e,1,0,g.RGBA,g.FLOAT,q);return k}})})},"esri/layers/rasterLib/function/LocalFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(m,n,v,b,p,f,d){return m([v,f],{declaredClass:"esri.layers.rasterLib.function.LocalFunction",functionName:"Local",
supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({operation:null,rasters:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);var c=0;a.raster?c=a.raster.bandCount:a.rasters&&(c=Math.max.apply(null,a.rasters.map(function(h){return h.bandCount})));if(0===c)return Error("The raster input to local function is invalid. It only takes single band input.");a=a.raster||a.rasters.filter(function(h){return!!h.extent})[0];this.rasterInfo=n.mixin(a,{bandCount:1,
pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){var c=[];c=a.raster?a.raster2?[a.raster,a.raster2]:[a.raster]:a.rasters;a=c.map(function(e){return e.pixelBlock});var h=this.functionArguments.operation;if(null===h)return c[0];this._performance.start();var l=this._getOperations(),k=l.operators[h-1];l=l.functors[h-1];
if(!this.functionArguments.rasters){if(1!==k)throw"no sufficient rasters, require "+k;}else if(999!==k&&this.functionArguments.rasters.length!==k)throw"number of rasters does not meet (short or exceed) the operation requirment, require "+k;var g=31===h?d.isNull(a[0]):50===h?d.setNull(a[0]):d.local(a,{rasterCountNeeded:k,functor:l});"Unknown"!==this.pixelType&&(g.pixelType=this.pixelType,g.pixels=g.pixels.map(n.hitch(this,function(e){return this._clampBand(e,g.pixelType)})));g.statistics||g.calculateStatistics();
return{extent:c[0].extent,pixelBlock:g}},readGL:function(a){this._performance.start();var c=this.functionArguments.operation,h=this._getWebGLOperations(),l=h.operators[c-1],k=p.local;h="result\x3d"+h.functors[c-1]+";";31!==c&&50!==c&&(h+="result \x3d vec4(result.rgb, a.a);");k=k.replace("vec4 replaceme"+l+";",h);h=this.gl.getParameter(this.gl.VERSION);var g="";if(-1<h.toLowerCase().indexOf("webgl 1.0")||-1<h.toLowerCase().indexOf("webgl 0."))g=this._getPolyfill(c);k=k.replace("vec4 polyfill;",g);
1<l&&(k=k.replace("gl_FragColor \x3d localOp1();","gl_FragColor \x3d localOp1();".replace("1",l.toString())));this._initializeProgram({fragment:k,fragmentName:"Local"});c=a.rasters;if(null!=c&&0!==c.length){c=c.length;h=this.bindFrameBuffer();for(l=0;l<c;l++){k=0<l?l.toString():"";var e=this._setupTextureData(a.rasters[l],{reCreate:!0});this._bindTexture(e.texture,"u_image"+k)}this._setUniforms({});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:e.extent,texture:h.texture}}},
_getOperations:function(){return{operators:[2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,1,1,1,1,999,999,1,1,999,1,1,2,2,2,999,999,999,999,999,999,999,999,999,999,3],functors:[function(a,c){return a+c},function(a,c){return a-c},function(a,c){return a*c},function(a){return Math.sqrt(a)},function(a,c){return Math.pow(a,c)},function(a){return Math.acos(a)},function(a){return Math.asin(a)},function(a){return Math.atan(a)},function(a){return Math.atanh(a)},
function(a){return Math.abs(a)},function(a,c){return a&c},function(a,c){return a<<c},function(a){return~a},function(a,c){return a|c},function(a,c){return a>>c},function(a,c){return a^c},function(a,c){return a&&c},function(a){return!a},function(a,c){return a||c},function(a,c){return a!=c},function(a){return Math.cos(a)},function(a,c){return Math.cosh(a)},function(a,c){return a/c},function(a,c){return a==c},function(a){return Math.exp(a)},function(a){return Math.pow(10,a)},function(a){return Math.pow(2,
a)},function(a,c){return a>c?1:0},function(a,c){return a>=c?1:0},function(a,c){return Math.floor(a)},function(a){return!a},function(a){return a},function(a,c){return a<c?1:0},function(a,c){return a<=c?1:0},function(a){return Math.log(a)},function(a,c){return Math.log10(a)},function(a,c){return Math.log2(a)},999,999,999,999,999,999,function(a,c){return a%c},function(a){return-a},function(a,c){return a!=c?1:0},999,function(a,c){return Math.floor(a)},function(a,c){return Math.ceil(a)},function(a,c){return c?
0:a},function(a,c){return Math.sin(a)},function(a,c){return Math.sinh(a)},function(a,c){return a*a},999,999,function(a){return Math.tan(a)},function(a){return Math.tanh(a)},999,function(a){return Math.acosh(a)},function(a){return Math.asinh(a)},function(a,c){return Math.atan2(a,c)},function(a,c){return a/c},function(a,c){return Math.floor(a/c)},999,999,999,999,999,999,999,999,999,999,function(a,c,h){return a?c:h}]}},_polyfill:{sinh:"vec4 sinh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn halfexp - 1.0/halfexp;\n}",
asinh:"vec4 asinh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn 1.0/(halfexp - 1.0/halfexp);\n}",cosh:"vec4 cosh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn halfexp + 1.0/halfexp;\n}",acosh:"vec4 acosh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn 1.0/(halfexp + 1.0/halfexp);\n}",tanh:"vec4 tanh(vec4 x) {\nvec4 expx \x3d exp(x);\nreturn (expx - 1.0/expx)/(expx + 1.0/expx);\n}",atanh:"vec4 atanh(vec4 x) {\nvec4 expx \x3d exp(x);\nreturn (expx + 1.0/expx)/(expx - 1.0/expx);\n}"},_getPolyfill:function(a){var c=
"";switch(a){case 9:c=this._polyfill.atanh;break;case 22:c=this._polyfill.cosh;break;case 52:c=this._polyfill.sinh;break;case 57:c=this._polyfill.tanh;break;case 59:c=this._polyfill.acosh;break;case 60:c=this._polyfill.asinh}return c},_getWebGLOperations:function(){return{operators:[2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,1,1,1,1,999,999,1,1,999,1,1,2,2,2,999,999,999,999,999,999,999,999,999,999,3],functors:["(a + b)","(a - b)",
"(a * b)","sqrt(a)","pow(a, b)","acos(a)","asin(a)","atan(a)","atanh(a)","abs(a)","a","a","a","a","a","a","(a.r\x3d\x3d0.0 || b.r\x3d\x3d0.0) ? vec4(0.0,0.0,0.0,a.a) : vec4(1.0,1.0,1.0,a.a)","a.r\x3d\x3d0.0?vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","(a.r\x3d\x3d0.0 \x26\x26 b.r\x3d\x3d0.0) ? vec4(0.0,0.0,0.0,a.a) : vec4(1.0,1.0,1.0,a.a)","(a.r\x3d\x3d0.0 ^^ b.r\x3d\x3d0.0) ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","cos(a)","cosh(a)","a / b","a.r \x3d\x3d b.r? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)",
"exp(a)","pow(10.0, a)","pow(2.0, a)","a.r \x3e b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","a.r \x3e\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","floor(a)","a.a \x3d\x3d 0.0? vec4(1.0,1.0,1.0,1.0) : vec4(0.0,0.0,0.0,1.0)","a","a.r \x3c b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","a.r \x3c\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","log(a)","log2(a) / log2(10.0)","log2(a)",999,999,999,999,999,999,"mod(a, b)","-a","a.r !\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)",
999,"floor(a)","ceil(a)","a.r !\x3d 0.0 ? vec4(0.0,0.0,0.0,0.0) : a","sin(a)","sinh(a)","a * a",999,999,"tan(a)","tanh(a)",999,"acosh(a)","asinh(a)","atan(a, b)","a / b","floor(a / b)",999,999,999,999,999,999,999,999,999,999,"a.r!\x3d0 ? b : c"]}}})})},"esri/layers/rasterLib/function/MaskFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(m,n,v,b,p,f,d){return m([v,f],{declaredClass:"esri.layers.rasterLib.function.MaskFunction",
functionName:"Mask",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({includedRanges:null,noDataInterpretation:0,noDataValues:null,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to mask function is invalid.");this.rasterInfo=n.mixin(a.raster,{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,a.raster.pixelType),statistics:a.raster.statistics,histograms:a.raster.histograms});
return!0},read2D:function(a){this._performance.start();a=a.raster;var c=d.mask(a.pixelBlock,{includedRanges:this.functionArguments.includedRanges,noDataInterpretation:this.functionArguments.noDataInterpretation,noDataValues:this.functionArguments.noDataValues});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType);return{extent:a.extent,pixelBlock:c}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:p.mask,fragmentName:"Mask"});
a=this._setupTextureData(a.raster);var c=this.bindFrameBuffer(),h=this.functionArguments.includedRanges,l=this.functionArguments.noDataValues?this.functionArguments.noDataValues.map(function(k){return parseFloat(k,10)}):null;this._setUniforms({u_includedRanges:h,u_includedRanges_specified:h?!0:!1,u_noDataValues:l,u_noDataValues_specified:l?!0:!1,u_noDataInterpretation:this.functionArguments.noDataInterpretation,u_bandCount:Math.min(this.sourceRasterInfo.raster.bandCount,3)});this._bindTexture(a.texture,
"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:c.texture}}})})},"esri/layers/rasterLib/function/NDVIFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterIndex".split(" "),function(m,n,v,b,p,f,d){return m([v,f],{declaredClass:"esri.layers.rasterLib.function.NDVIFunction",functionName:"NDVI",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=
this.mixinIgnoreCase({visibleBandID:1,infraredBandID:2,scaled:!0,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!(a.raster&&1<a.raster.bandCount))return Error("The raster input to ndvi function is invalid. It requires more than 1 band.");this.rasterInfo=n.mixin(a.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,this.scaled?"U8":"F32"),statistics:this.scaled?[{min:0,max:200}]:[{min:-1,max:1}],histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||
{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){this._performance.start();a=a.raster;var c=d.calculate(a.pixelBlock,{bandIndexes:[this.functionArguments.infraredBandID+1,this.functionArguments.visibleBandID+1].join(" "),method:1}),h;if(this.functionArguments.scaled){var l=c.pixels[0];var k=c.mask;var g=l.length;var e=new Uint8Array(g);if(null==k)for(h=0;h<g;h++)e[h]=100*l[h]+100&255;else for(h=0;h<g;h++)k[h]&&(e[h]=100*l[h]+100&255);c.pixels[0]=e;c.pixelType="U8"}this._addPerformanceMetric(this._performance.elapsed());
"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType);return{extent:a.extent,pixelBlock:c}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:p.ndvi,fragmentName:"NDVI"});var c=this.functionArguments.visibleBandID,h=this.functionArguments.infraredBandID,l=this.functionArguments.scaled||!1;this._alterBand=2<Math.max(h,c)?!0:!1;a=this._setupTextureData(a.raster,{bandIDs:this._alterBand?{bandIDs:[h,c,h]}:null});var k=this.bindFrameBuffer();this._alterBand?this._setUniforms({u_bandId_nir:0,
u_bandId_red:1,u_scaled:l}):this._setUniforms({u_bandId_nir:h,u_bandId_red:c,u_scaled:l});this._bindTexture(a.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:k.texture}}})})},"esri/layers/rasterLib/function/SlopeFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils".split(" "),function(m,n,v,b,p,f,
d,a){return m([v,d],{declaredClass:"esri.layers.rasterLib.function.SlopeFunction",functionName:"Slope",supportWebGL:!0,support2D:!0,constructor:function(c){this.functionArguments=this.mixinIgnoreCase({zFactor:1,slopeType:1,psPower:.664,psFactor:.024,raster:null},c)},bind:function(c){c=this.getSourceRasterInfo(c);if(!c.raster)return Error("The raster input to slope function is invalid.");this.rasterInfo=n.mixin(c.raster,{bandCount:1,pixelType:this._calculatePixelType(this.outputPixelType,"F32"),statistics:1===
this.slopeType||3===this.slopeType?[{min:0,max:90}]:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(c){this._performance.start();c=c.raster;c=a.slope(c,{zFactor:this.functionArguments.zFactor,psPower:this.functionArguments.psPower,psFactor:this.functionArguments.psFactor,slopeType:this.functionArguments.slopeType,isGCS:c.extent.spatialReference.wkid&&null==b[c.extent.spatialReference.wkid]});
this._addPerformanceMetric(this._performance.elapsed());return c},readGL:function(c){this._performance.start();this._initializeProgram({fragment:f.slope,fragmentName:"Slope"});var h=this._setupTextureData(c.raster),l=this.bindFrameBuffer(),k=this.gl,g=k.drawingBufferWidth;k=k.drawingBufferHeight;var e=h.extent;this._setUniforms({u_resolution:c&&c.raster&&c.raster.pixelBlock?[1/c.raster.pixelBlock.width,1/c.raster.pixelBlock.height]:[1/g,1/k],u_cellSize:[(e.xmax-e.xmin)/g,(e.ymax-e.ymin)/k],u_zfactor:this.functionArguments.zFactor});
this._bindTexture(h.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:h.extent,texture:l.texture}}})})},"esri/layers/rasterLib/function/StretchFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./vertexShaders ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),function(m,n,v,b,p,f,d){return m([v,d],{declaredClass:"esri.layers.rasterLib.function.StretchFunction",functionName:"Stretch",supportWebGL:!0,
support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,raster:null,computeGamma:!1},a);this.functionArguments.statistics=this._convertStats(this.functionArguments.statistics);-1===[0,3,5,6].indexOf(this.functionArguments.stretchType)&&(this.functionArguments.stretchType=5);this.min=null==this.min?0:this.min;this.max=null==this.max?
255:this.max},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to stretch function is invalid.");a.raster.statistics&&(this.srcStatistics=this._convertStats(a.raster.statistics));a.raster.histograms&&(this.srcHistograms=a.raster.histograms);this.rasterInfo=n.mixin({},a.raster,{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};
this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){a=a.raster;this._stretch(a);return a},hasTilingEffects:function(a){a=a||this.functionArguments;return!!(a.dra||a.raster&&"object"===typeof a.raster&&a.raster.dra)},_convertStats:function(a){return a?a.map(function(c){return c&&null!=c.min?[c.min,c.max,c.mean,c.stddev]:c}):null},_updateStatistisHistograms:function(a){var c=this.functionArguments,h=c.histograms||this.srcHistograms;if(a&&a.pixelBlock&&a.pixelBlock.pixels){if(0===
c.stretchType)this._statistics=c.statistics&&0<c.statistics.length?c.statistics:this.srcStatistics,this._histograms=h;else{var l=a.pixelBlock,k=l.pixels.length,g=6===c.stretchType&&(c.dra||!h)||3===c.stretchType&&c.dra;g&&(l.statistics||l.calculateStatistics(),this._calculateStatisticsHistograms(a));if(c.dra)if(l.statistics||l.calculateStatistics(),g)this._statistics=l.statistics,this._histograms=l.histograms;else for(c=l.statistics,this._statistics=[],a=0;a<k;a++)this._statistics[a]=[c[a].minValue,
c[a].maxValue,0,0];else this._statistics=c.statistics&&0<c.statistics.length?c.statistics:this.srcStatistics,this._histograms=h}this._statistics=this._convertStats(this._statistics);this._gammaCorrection=this._getGammaCorrection()}else this._statistics=c.statistics&&0<c.statistics.length?c.statistics:this.srcStatistics,this._histograms=h,this._gammaCorrection=this._getGammaCorrection(),this._statistics=this._convertStats(this._statistics)},_getGammaCorrection:function(){var a=this.functionArguments.gamma;
if(a){var c=[],h;for(h=0;h<a.length;h++)c[h]=1<a[h]?2<a[h]?6.5+Math.pow(a[h]-2,2.5):6.5+100*Math.pow(2-a[h],4):1;return c}},_stretch:function(a){if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels&&0!==this.functionArguments.stretchType){this._updateStatistisHistograms(a);var c=a.pixelBlock,h=c.pixels;c=c.width*c.height;var l=h.length,k,g;this._createLUT(a);if(null==this.LUT)return this._filterNoLUT(a);var e=this.LUT,q=this.LUTOffset;for(k=0;k<l;k++){var u=e[k];for(g=0;g<c;g++){var r=h[k][g];
h[k][g]=u[r-q]}}a.pixelBlock.pixelType="U8"}},_calculateStatisticsHistograms:function(a){a=a.pixelBlock;var c=a.pixelType,h=a.pixels,l=a.mask,k=h.length,g,e,q=function(E){this.min=-.5;this.max=255.5;this.size=256;n.mixin(this,E);this.counts=this.counts||new Uint32Array(this.size)},u=[],r,x;for(g=0;g<k;g++){var t=new q;var w=t.counts;var z=h[g];if("U8"===c)if(l)for(e=0;e<a.width*a.height;e++)l[e]&&w[z[e]]++;else for(e=0;e<a.width*a.height;e++)w[z[e]]++;else{var B=a.statistics[g].minValue;var A=a.statistics[g].maxValue;
t.min=B;t.max=A;A=(A-B)/256;var y=new Uint32Array(257);if(l)for(e=0;e<a.width*a.height;e++)l[e]&&y[Math.floor((z[e]-B)/A)]++;else for(e=0;e<a.width*a.height;e++)y[Math.floor((z[e]-B)/A)]++;for(e=0;255>e;e++)w[e]=y[e];w[255]=y[255]+y[256]}u.push(t);z=[];B=a.statistics[g].minValue;A=a.statistics[g].maxValue;for(e=x=r=y=0;e<t.size;e++)y+=w[e],r+=e*w[e];r/=y;for(e=0;e<t.size;e++)x+=w[e]*Math.pow(e-r,2);w=Math.sqrt(x/(y-1));e=(r+.5)*(t.max-t.min)/t.size+t.min;t=w*(t.max-t.min)/t.size;z.push(B);z.push(A);
z.push(e);z.push(t);a.statistics[g]={min:B,minValue:B,max:A,maxValue:A,mean:e,stddev:t}}a.histograms=u},_getCutOffPoints:function(a){var c=this.functionArguments,h=999;a&&a.pixelBlock?h=a.pixelBlock.pixels.length:a&&a.texture&&(h=3);a=Math.min(h,this._statistics.length);var l=[],k=[],g,e;switch(c.stretchType){case 5:for(g=0;g<a;g++)l[g]=this._statistics[g][0],k[g]=this._statistics[g][1];break;case 3:for(g=0;g<a;g++)l[g]=this._statistics[g][2]-c.numberOfStandardDeviations*this._statistics[g][3],k[g]=
this._statistics[g][2]+c.numberOfStandardDeviations*this._statistics[g][3],l[g]<this._statistics[g][0]&&(l[g]=this._statistics[g][0]),k[g]>this._statistics[g][1]&&(k[g]=this._statistics[g][1]);break;case 6:for(g=0;g<a;g++){h=this._histograms[g];var q=new Uint32Array(h.size);var u=h.counts;var r=0;var x=-.5===h.min&&1===(h.max-h.min)/u?.5:0;for(e=0;e<h.size;e++)r+=u[e],q[e]=r;u=c.minPercent*r/100;for(e=0;e<h.size;e++)if(q[e]>u){l[g]=h.min+(h.max-h.min)/h.size*(e+x);break}u=(1-c.maxPercent/100)*r;for(e=
h.size-2;0<=e;e--)if(q[e]<u){k[g]=h.min+(h.max-h.min)/h.size*(e+2-x);break}}break;default:for(g=0;g<h;g++)l[g]=0,k[g]=255}return{minCutOff:l,maxCutOff:k}},_createLUT:function(a){var c=this.functionArguments,h=a.pixelBlock,l=h.pixelType;if("U8"===l||"U16"===l||"S8"===l||"S16"===l){if(this._LUTSignature&&(l=this._computeLutSignature(),l.length===this._LUTSignature.length&&!l.some(function(G,F){return G!==this._LUTSignature[F]}.bind(this))))return;l=h.pixels.length;var k=[],g=[],e=c.max,q=c.min,u=c.gamma,
r=e-q,x=this._getCutOffPoints(a);a=x.minCutOff;x=x.maxCutOff;var t=0,w=256;"S8"===h.pixelType?t=-127:"S16"===h.pixelType&&(t=-32767);if("U16"===h.pixelType||"S16"===h.pixelType)w=65536;for(h=0;h<l;h++)k[h]=x[h]-a[h];var z=this._gammaCorrection;if(c.useGamma)for(h=0;h<l;h++){var B=[];for(c=0;c<w;c++){var A=c+t;var y=(A-a[h])/k[h];var E=1;1<u[h]&&(E-=Math.pow(1/r,y*z[h]));A<x[h]&&A>a[h]?B[c]=Math.floor(E*r*Math.pow(y,1/u[h]))+q:A>x[h]?B[c]=e:A<a[h]&&(B[c]=q)}g[h]=B}else for(h=0;h<l;h++){B=[];for(c=
0;c<w;c++)A=c+t,B[c]=A<a[h]?q:A>x[h]?e:Math.floor((A-a[h])/k[h]*r)+q;g[h]=B}this.LUT=g;this.LUTOffset=t;this._LUTSignature=this._computeLutSignature()}},_computeLutSignature:function(){var a=this.functionArguments,c=[],h,l;c.push(a.stretchType);c.push(a.min);c.push(a.max);c.push(a.numberOfStandardDeviations);if(this._statistics)for(h=0;h<this._statistics.length;h++)for(l=0;l<this._statistics[h].length;l++)c.push(this._statistics[h][l]);c.push(a.dra?1:0);c.push(a.minPercent);c.push(a.maxPercent);if(a.gamma)for(h=
0;h<this._statistics.length;h++)c.push(a.gamma[h]);c.push(a.useGamma?1:0);return c},_filterNoLUT:function(a){if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels){var c=this.functionArguments,h=a.pixelBlock,l=h.pixels,k=h.mask;h=h.width*h.height;var g=l.length,e=[],q=[],u=c.max,r=c.min,x=c.gamma,t=u-r;var w=this._getCutOffPoints(a);var z=w.minCutOff,B=w.maxCutOff;for(w=0;w<g;w++)e[w]=B[w]-z[w];if(c.useGamma&&null!==x&&x.length>=g)for(w=0;w<g;w++)q[w]=1<x[w]?2<x[w]?6.5+Math.pow(x[w]-2,2.5):
6.5+100*Math.pow(2-x[w],4):1;if(c.useGamma)if(void 0!==k&&null!==k)for(c=0;c<h;c++){if(k[c])for(w=0;w<g;w++){var A=l[w][c];var y=(A-z[w])/e[w];var E=1;1<x[w]&&(E-=Math.pow(1/t,y*q[w]));A<B[w]&&A>z[w]?l[w][c]=Math.floor(E*t*Math.pow(y,1/x[w]))+r:A>B[w]?l[w][c]=u:A<z[w]&&(l[w][c]=r)}}else for(c=0;c<h;c++)for(w=0;w<g;w++)A=l[w][c],y=(A-z[w])/e[w],E=1,1<x[w]&&(E-=Math.pow(1/t,y*q[w])),A<B[w]&&A>z[w]?l[w][c]=Math.floor(E*t*Math.pow(y,1/x[w]))+r:A>B[w]?l[w][c]=u:A<z[w]&&(l[w][c]=r);else if(void 0!==k&&
null!==k)for(c=0;c<h;c++){if(k[c])for(w=0;w<g;w++)A=l[w][c],A<B[w]&&A>z[w]?l[w][c]=Math.floor((A-z[w])/e[w]*t)+r:A>B[w]?l[w][c]=u:A<z[w]&&(l[w][c]=r)}else for(c=0;c<h;c++)for(w=0;w<g;w++)A=l[w][c],A<B[w]&&A>z[w]?l[w][c]=Math.floor((A-z[w])/e[w]*t)+r:A>B[w]?l[w][c]=u:A<z[w]&&(l[w][c]=r);a.pixelBlock.pixelType="U8";return a}},_computeGammaValues:function(a){var c=this._statistics.length,h,l=[];for(h=0;h<c;h++){var k=this._statistics[h][2];"U8"!==a&&(k=255*(k-this._statistics[h][0])/(this._statistics[h][1]-
this._statistics[h][0]));l.push(this._computeGammaValue(k))}return l},_computeGammaValue:function(a){if(0!==a&&!(255<a||0>a)){var c=0;0<a&&150!=a&&255>a&&(c=150>=a?45*Math.cos(.01047*a):17*Math.sin(.021*a));c=Math.log((a+c)/255);if(0!==c&&(a=Math.log(a/255)/c,!isNaN(a)))return Math.min(9.9,Math.max(.01,a))}},readGL:function(a){return this._stretchGL(a.raster)},_stretchGL:function(a){this._performance.start();var c=this.renderTexture,h,l=a.pixelBlock&&a.pixelBlock.pixels&&a.pixelBlock.pixels.length||
this.sourceRasterInfo.raster.bandCount,k=a.pixelBlock,g=this.gl,e=g.drawingBufferWidth,q=g.drawingBufferHeight;if(!k&&this.functionArguments.dra){var u=new Float32Array(e*q*4),r=new Uint8Array(e*q);var x=new Float32Array(e*q);var t=new Float32Array(e*q);var w=new Float32Array(e*q);g.checkFramebufferStatus(g.FRAMEBUFFER)==g.FRAMEBUFFER_COMPLETE&&g.readPixels(0,0,e,q,g.RGBA,g.FLOAT,u);for(h=0;h<e*q;h++)x[h]=u[4*h],t[h]=u[4*h+1],w[h]=u[4*h+2],r[h]=u[4*h+3];a.pixelBlock=new b({width:e,height:q,pixels:[x,
t,w],mask:r});a.pixelBlock.calculateStatistics()}!k&&this.functionArguments.dra&&this._useGPUStats?(x=new Float32Array(l),t=new Float32Array(l)):(this._updateStatistisHistograms(a),u=this._getCutOffPoints(a),x=new Float32Array(l),t=new Float32Array(l),x.set(u.minCutOff.slice(0,l)),t.set(u.maxCutOff.slice(0,l)));this._initializeProgram({fragment:f.stretch,fragmentName:"Stretch"});u=this._setupTextureData(a);r=this.bindFrameBuffer();this.renderTexture=!1;this._performance.start();if(!k&&this.functionArguments.dra&&
this._useGPUStats){this._setUniforms({u_sourceDim:[e,q],u_bandCount:l});if(1===l)var z=this._readMinMax(u,2);else{z=this._readMinMax(u,0);var B=this._readMinMax(u,1)}if(6===this.functionArguments.stretchType||3===this.functionArguments.stretchType&&this.functionArguments.dra)h=this._readHistogram(z,B,a),x=h.minCutOff||x,t=h.minCutOff||t}w=this.functionArguments.max-this.functionArguments.min;a=new Float32Array(l);for(h=0;h<l;h++)a[h]=w/(t[h]-x[h]);this._useGPUStats&&this._initializeProgram({fragment:f.stretch,
fragmentName:"Stretch"});g.blendFunc(g.SRC_ALPHA,g.ZERO);w=new Float32Array(3);var A=new Float32Array(3);for(h=0;3>h;h++)w[h]=this.functionArguments.min,A[h]=this.functionArguments.max;h=this.functionArguments.useGamma;var y=this.functionArguments.gamma,E=this._gammaCorrection;Array.isArray(y)&&y.length>=l||(h=!1);this._setUniforms({u_sourceDim:[e,q],u_bandCount:l,u_minOutput:w,u_maxOutput:A,u_minCutOff:x,u_maxCutOff:t,u_factor:a,u_state:100,u_useGamma:h,u_gamma:y,u_scaled:!c,u_gammaCorrection:E,
u_minMaxTexture:!k&&this.functionArguments.dra&&this._useGPUStats?!0:!1});this.renderTexture=c;g.viewport(0,0,e,q);this._bindTexture(u.texture,"u_image");!k&&this.functionArguments.dra&&this._useGPUStats&&(c=g.getUniformLocation(this.rasterProgram,"u_image1"),g.uniform1i(c,1),g.activeTexture(g.TEXTURE1),g.bindTexture(g.TEXTURE_2D,z.texture),1<l&&(l=g.getUniformLocation(this.rasterProgram,"u_image2"),g.uniform1i(l,2),g.activeTexture(g.TEXTURE2),g.bindTexture(g.TEXTURE_2D,B.texture)));this._drawGL();
return{extent:u.extent,texture:r.texture}},_readMinMax:function(a,c){var h=this.gl,l=a.width||h.drawingBufferWidth,k=a.height||h.drawingBufferHeight;this._setUniforms({u_state:c});this.renderTexture=!1;var g=a.texture;for(h.activeTexture(h.TEXTURE0);1<l||1<k;){var e=this._createTexture();var q=Math.max(Math.ceil(l/2),1);var u=Math.max(Math.ceil(k/2),1);h.getExtension("OES_texture_float");h.texImage2D(h.TEXTURE_2D,0,h.RGBA,q,u,0,h.RGBA,h.FLOAT,null);var r=h.createFramebuffer();h.bindFramebuffer(h.FRAMEBUFFER,
r);h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,e,0);h.viewport(0,0,q,u);h.bindTexture(h.TEXTURE_2D,g);this._setUniforms({u_sourceDim:[l,k]});l=q;k=u;this._drawGL(!0);g=e}r=new Float32Array(l*k*4);h.checkFramebufferStatus(h.FRAMEBUFFER)==h.FRAMEBUFFER_COMPLETE&&h.readPixels(0,0,l,k,h.RGBA,h.FLOAT,r);return{texture:e,minmax:r}},_readHistogram:function(a,c,h){if(a)try{var l=this.gl,k=l.drawingBufferWidth,g=l.drawingBufferHeight,e,q,u;if(a.texture instanceof WebGLTexture){var r=
!0;var x=[1,0,0,1];if(c){var t=a.minmax;var w=c.minmax}else t=[a.minmax[0]],w=[a.minmax[1]]}else for(w=c,t=a,x=new Float32Array(w.length),e=0;e<w.length;e++)x[e]=256/(w[e]-t[e]);var z=new Float32Array(k*g);for(u=0;u<z.length;u++)z[u]=u;if(!this.histogramProgram){var B=p.getShader(l,p.histogram),A=f.getShader(l,f.constant);this.histogramProgram=this._loadProgram(B,A)}l.blendFunc(l.ONE,l.ONE);l.enable(l.BLEND);l.useProgram(this.histogramProgram);var y=l.getAttribLocation(this.histogramProgram,"a_pixelIndex"),
E=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,E);l.bufferData(l.ARRAY_BUFFER,z,l.STATIC_DRAW);l.enableVertexAttribArray(y);l.vertexAttribPointer(y,1,l.FLOAT,!1,0,0);var G=this._setupHistTexture(h),F=this._createTexture();l.getExtension("OES_texture_float");l.texImage2D(l.TEXTURE_2D,0,l.RGBA,257,1,0,l.RGBA,l.FLOAT,null);var D=l.createFramebuffer();l.bindFramebuffer(l.FRAMEBUFFER,D);l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,F,0);l.viewport(0,0,257,1);var L=l.getUniformLocation(this.histogramProgram,
"u_image");l.uniform1i(L,0);l.activeTexture(l.TEXTURE0);l.bindTexture(l.TEXTURE_2D,G);var O=l.getUniformLocation(this.histogramProgram,"u_sourceDim");l.uniform2f(O,k,g);var S=l.getUniformLocation(this.histogramProgram,"u_bandCount");l.uniform1i(S,3);var Z=l.getUniformLocation(this.histogramProgram,"u_halfPixel");l.uniform2f(Z,.5/k,.5/g);var I=l.getUniformLocation(this.histogramProgram,"u_minMaxTexture");if(r){l.uniform1i(I,1);var N=l.getUniformLocation(this.histogramProgram,"u_image1");l.uniform1i(N,
1);l.activeTexture(l.TEXTURE1);l.bindTexture(l.TEXTURE_2D,a.texture);if(c){var K=l.getUniformLocation(this.histogramProgram,"u_image2");l.uniform1i(K,2);l.activeTexture(l.TEXTURE2);l.bindTexture(l.TEXTURE_2D,c.texture)}}else{var Q=l.getUniformLocation(this.histogramProgram,"u_mins");l.uniform4f(Q,t[0],t[0],t[0],t[0]);l.uniform1i(I,0)}var da=l.getUniformLocation(this.histogramProgram,"u_color"),U=l.getUniformLocation(this.histogramProgram,"u_factors"),aa=l.getUniformLocation(this.histogramProgram,
"u_size");l.uniform1f(aa,256);a=[];c=[];l.uniform4fv(da,[1,0,0,1]);l.uniform4fv(U,[x[0],0,0,1]);l.drawArrays(l.POINTS,0,z.length);var J=this.sourceRasterInfo.raster.bandCount;1<J&&(l.uniform4fv(da,[0,1,0,1]),l.uniform4fv(U,[0,x[0],0,1]),l.drawArrays(l.POINTS,0,z.length),l.uniform4fv(da,[0,0,1,1]),l.uniform4fv(U,[0,0,x[0],1]),l.drawArrays(l.POINTS,0,z.length));if(l.checkFramebufferStatus(l.FRAMEBUFFER)==l.FRAMEBUFFER_COMPLETE){var T=new Float32Array(1028);l.readPixels(0,0,257,1,l.RGBA,l.FLOAT,T);l=
0;var Y=-.5===t[0]&&1===(w[0]-t[0])/256?.5:0;for(e=0;e<J;e++){var W=new Float32Array(257);var R=new Float32Array(257);for(u=l=0;256>u;u++)l+=T[4*u+e],W[u]=l,R[u]=T[4*u+e];R[256]=T[1024+e];W[256]=l+T[1024+e];var X=this.functionArguments.minPercent*l/100;if(w){for(q=0;256>q;q++)if(W[q]>X){a[e]=t[0]+(w[0]-t[0])/256*(q+Y);break}X=(1-this.functionArguments.maxPercent/100)*l;for(q=254;0<=q;q--)if(W[q]<X){c[e]=t[0]+(w[0]-t[0])/256*(q+2-Y);break}}}}return{histogram:T,minCutOff:a,maxCutOff:c}}catch(ia){}},
_setupHistTexture:function(a){if(a instanceof WebGLTexture)return a;var c=this.originalHistTexture=this._createTexture(),h=this.gl;a=a.pixelBlock;var l=a.width,k=a.height;h.getExtension("OES_texture_float");this.rgbaFloatData=a.getAsRGBAFloat();h.texImage2D(h.TEXTURE_2D,0,h.RGBA,l,k,0,h.RGBA,h.FLOAT,this.rgbaFloatData);return c}})})},"esri/layers/rasterLib/function/RemapFunction":function(){define("dojo/_base/declare dojo/_base/lang ../../../renderers/colorRampGenerator ./RasterFunctionX ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(m,n,v,b,p,f,d){return m([b,f],{declaredClass:"esri.layers.rasterLib.function.RemapFunction",functionName:"Remap",pixelType:"U8",renderTexture:!1,supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({inputRanges:null,outputValues:null,outputColors:null,colorBreaks:null,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input is not available.");var c=!(!this.functionArguments.outputColors&&!this.functionArguments.colorBreaks);
this.rasterInfo=n.mixin(a.raster,{bandCount:c?3:1,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType=c?"Processed":"Thematic";return!0},read2D:function(a){return this._remap(a.raster)},readGL:function(a){return this._remapGL(a.raster)},_remap:function(a){this._performance.start();var c=d.remapColor(a.pixelBlock,this.functionArguments.colorBreaks);this._addPerformanceMetric(this._performance.elapsed());
return{extent:a.extent,pixelBlock:c}},_remapGL:function(a){this._performance.start();this._initializeProgram({fragment:p.remap,fragmentName:"Remap"});var c=new Uint8Array(64),h=this.functionArguments.colorBreaks;h.forEach(function(e,q){c[4*q]=e.mappedColor[0];c[4*q+1]=e.mappedColor[1];c[4*q+2]=e.mappedColor[2];c[4*q+3]=1>=e.mappedColor[3]?255*e.mappedColor[3]:e.mappedColor[3]});var l=h[h.length-1],k=l.mappedColor;c[60]=k[0];c[61]=k[1];c[62]=k[2];c[63]=1>=k[3]?255*k[3]:k[3];var g=new Float32Array(16);
h.forEach(function(e,q){g[q]=e.value});g[15]=l.value;this._clrTexture||(this._clrTexture=this._setupColormapTexture(c));h=this._clrTexture;l=this.bindFrameBuffer();a=this._setupTextureData(a);this._setUniforms({u_indexedColormapOffset:0,u_indexedColormapMaxIndex:c.length/4-1,u_breaks:g});this._bindTexture(h,"u_image1");this._bindTexture(a.texture,"u_image");this._drawGL();return{extent:a.extent,texture:l.texture}},_setupColormapTexture:function(a){var c=this._createTexture(),h=a.length/4,l=new Float32Array(a.length),
k=this.renderTexture?255:1,g,e=this.gl;for(g=0;g<a.length;g++)l[g]=a[g]/k;e.getExtension("OES_texture_float");e.texImage2D(e.TEXTURE_2D,0,e.RGBA,h,1,0,e.RGBA,e.FLOAT,l);return c}})})},"esri/layers/rasterLib/function/IdentityFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","./pixelShaders","./RasterFunctionX","./RasterFunctionWebGLMixin"],function(m,n,v,b,p){return m([b,p],{declaredClass:"esri.layers.rasterLib.function.IdentityFunction",functionName:"Identity",supportWebGL:!0,support2D:!0,
constructor:function(f){this.functionArguments={raster:null}},bind:function(f){f=this.getSourceRasterInfo(f);if(!f.raster)return Error("The raster input to identity function is invalid.");this.rasterInfo=n.mixin(f.raster,{});return!0},read2D:function(f){return f.raster},readGL:function(f){this._initializeProgram({fragment:v.identity,fragmentName:"identity"});f=this._setupTextureData(f.raster);var d=this.bindFrameBuffer();this._bindTexture(f.texture,"u_image");this._drawGL();return{extent:f.extent,
texture:d.texture}}})})},"esri/layers/rasterLib/function/ResampleFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","./pixelShaders","./RasterFunctionX","./RasterFunctionWebGLMixin"],function(m,n,v,b,p){return m([b,p],{declaredClass:"esri.layers.rasterLib.function.ResampleFunction",renderTexture:!0,resamplingOrigin:null,resamplingRatio:null,zFactor:1,functionName:"Resample",supportWebGL:!0,support2D:!1,constructor:function(f){this.functionArguments=this.mixinIgnoreCase({resamplingType:0},
f)},bind:function(f){f=this.getSourceRasterInfo(f);if(!f.raster)return Error("The raster input to convolution function is invalid.");this.rasterInfo=n.mixin(f.raster,{bandCount:f.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,f.raster.pixelType),statistics:f.raster.statistics,histograms:f.raster.histograms});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};return!0},readGL:function(f){this._performance.start();this._initializeProgram({fragment:v.resample,fragmentName:"Resample"});
var d=this._setupTextureData(f.raster),a=this.bindFrameBuffer(),c=this.gl,h=c.drawingBufferWidth;c=c.drawingBufferHeight;var l=f.raster;void 0!==l.pixelBlock?(d=d||this._setupTextureData(l),f=l.pixelBlock.width,l=l.pixelBlock.height):(d=d||l,f=h,l=c);this._setUniforms({u_resamplingRatio:this.resamplingRatio||[f/h,l/c],u_anchor:this.resamplingOrigin||[0,1],u_resamplingType:this.functionArguments.resamplingType,u_resolution:[1/h,1/c]});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());
return{extent:d.extent,texture:a.texture}}})})},"esri/layers/rasterLib/renderer/rasterRendererHelper":function(){define("dojo/_base/declare dojo/_base/lang ../../PixelBlock ./RasterColormapRenderer ./RasterUniqueValueRenderer ./RasterRGBRenderer ./RasterStretchColorRampRenderer ./RasterClassBreaksRenderer ./RasterShadedReliefRenderer".split(" "),function(m,n,v,b,p,f,d,a,c){var h=function(){function l(g){k[g.prototype.rendererName]=g}var k={};l(b);l(f);l(d);l(p);l(a);l(c);return k}();return{wellKnownRenderers:h,
isSupported:function(l){if(!l)return!1;var k=!0;h[l.rendererName]||(k=!1);return k},create:function(l){if(!l)return null;if(l.rendererName){var k=l.rendererName;l=l.rendererArguments}else k="uniqueValue rasterStretch rasterShadedRelief rgb rasterColormap classBreaks".split(" ").indexOf(l.type),k="UniqueValue Stretch ShadedRelief RGB Colormap ClassBreaks".split(" ")[k],"rasterStretch"===l.type&&l.bandIndex&&1<l.bandIndex.length&&(k="RGB");return(k=h[k])?new k(l):null},createDefaultRenderer:function(l){if(l&&
l.raster){var k=l.raster.rasterInfo,g=l.raster.dataType;if(k){var e=l.raster.rasterFunction,q=["Stretch","Colormap","ContrastAndBrightness"];if(e&&"U8"===k.pixelType&&-1<q.indexOf(e.functionName))e.renderTexture=!0;else if("Processed"!==g||!(l.useWebGL&&e&&e.renderTexture||!l.useWebGL&&"U8"===k.pixelType)){e&&(k=e.rasterInfo);e=k.bandCount;var u=k.colormap,r=k.vat;q=k.histograms;q&&0===q.length&&(q=null);var x=k.statistics&&k.statistics.map(function(z){return[z.min,z.max,z.mean,z.stddev]});if(1===
e&&u&&0<u.length)var t=this._getDefaultColormapRenderer(r,u);else if(1===e&&r&&r.features&&0<r.features.length)t=new p({});else{u=0;r=!1;g||!l.raster||!l.raster.tileInfo||void 0!==l.raster.tileInfo.tileType&&"Map"!==l.raster.tileInfo.tileType?"U8"===k.pixelType&&"Processed"===g?(u=5,x=x||[[0,255,0,0],[0,255,0,0],[0,255,0,0]],r=!1):"U8"===k.pixelType||"Elevation"===g?(u=5,r=x?!1:!0):"Scientific"===g||"StdTime"===g?(u=5,r=x?!1:!0,t=this._getDefaultScientificColorRamp()):q&&0<q.length?(u=6,r=!1):x?(u=
5,r=!1):(u=6,r=!0):(x=[[0,255,0,0],[0,255,0,0],[0,255,0,0]],u=5,r=!1);x||(u=5,r=!0);var w;3<=e&&!(l.bandIds||l.raster&&l.raster.imageServiceParams&&l.raster.imageServiceParams.bandIds)&&(w=this.getDefaultBandCombination(k));w&&(x=w.map(function(z){return x[z]}));l={stretchType:u,min:0,max:255,dra:r,minPercent:.25,maxPercent:.25,useGamma:!1,computeGamma:!1,statistics:x,histograms:q,numberOfStandardDeviations:2.5,bandIndex:w};1===e||w&&1===w.length?(t&&(l.colorRamp=t,l.invert=!1),t=new d(l)):t=new f(l)}return t}}}},
getDefaultBandCombination:function(l){var k=l.bandCount;if(1===k)return null;if(2===k)return[0];var g=(l=l.keyProperties)&&l.ChangeAnalysisParameters&&l.ChangeAnalysisParameters.AnalysisType;if(g&&("ccdc"===g.toLowerCase()||"landtrendr"===g.toLowerCase()))return[0];l=l&&l.BandProperties;var e;if(l&&l.length===k){var q=this.getWellKnownBandIndexes(l);l=q.red;g=q.green;var u=q.blue;q=q.nir;null!=l&&null!=g&&null!=u?e=[l,g,u]:null!=q&&null!=l&&null!=g&&(e=[q,l,g])}!e&&3<=k&&(e=[0,1,2]);return e},getWellKnownBandIndexes:function(l){for(var k=
{},g=0;g<l.length;g++){var e=l[g],q=e.BandName&&e.BandName.toLowerCase();"red"===q?k.red=g:"green"===q?k.green=g:"blue"===q?k.blue=g:"nearinfrared"===q||"nearinfrared_1"===q||"nir"===q?k.nir=g:e.WavelengthMax&&e.WavelengthMin&&(q=e.WavelengthMin,e=e.WavelengthMax,null==k.blue&&410<=q&&480>=q&&480<=e&&540>=e?k.blue=g:null==k.green&&490<=q&&560>=q&&560<=e&&610>=e?k.green=g:null==k.red&&595<=q&&670>=q&&660<=e&&730>=e?k.red=g:null==k.nir&&700<=q&&860>=q&&800<=e&&950>=e&&(k.nir=g))}return k},_getDefaultColormapRenderer:function(l,
k){if(k||k.length){var g=[],e=this._ratContainsColormap(l);if(e)var q=this._getRATValueClassNameMap(l);k.forEach(function(u){var r=q?q[u[0]]:u[0];g.push({color:[u[1],u[2],u[3]],value:u[0],label:e?null!=r?r:"":u[0]})});return new b({colormapInfos:g})}},_ratContainsColormap:function(l){if(!l||!l.fields)return!1;var k,g,e;return l.fields.some(function(q){q&&q.name&&(q=q.name.toLowerCase(),"red"===q&&(k=!0),"green"===q&&(g=!0),"blue"===q&&(e=!0));return k&&g&&e})},_getRATValueClassNameMap:function(l){if(!l||
!l.fields)return null;var k={},g,e;l.fields.forEach(function(q){if("classname"===q.name.toLowerCase()||"class_name"===q.name.toLowerCase())g=q.name;"value"===q.name.toLowerCase()&&(e=q.name)});l.features.forEach(function(q){q=q.attributes;k[q[e]]=g?q[g]:q[e]});return k},_getDefaultScientificColorRamp:function(){return{type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}].map(function(l){return{fromColor:l.toColor,
toColor:l.fromColor}}).reverse()}}}})},"esri/layers/rasterLib/renderer/RasterColormapRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction"],function(m,n,v,b){return m([v],{declaredClass:"esri.layers.rasterLib.renderer.RasterColormapRenderer",rendererName:"Colormap",renderTexture:!0,constructor:function(p){p&&p.colormapInfos&&(p.colormap=p.colormapInfos.map(function(f){return[f.value].concat(f.color)}));this._function=new b(p);this._function.outputPixelType=
"U8";this._function.renderTexture=!0},draw2D:function(p){this._updateColormapParameters();p=this._clonePixelData(p);return p=this._function._colorize(p)},drawGL:function(p){this._updateColormapParameters();this._function._colorizeGL(p)},toJson:function(){var p=this._function.toJson().rasterFunctionArguments;return{rendererName:this.rendererName,rendererArguments:p}},toCommonRendererJson:function(){return{type:"rasterColormap",colormapInfos:this.colormapInfos||this.colormap.map(function(p){return{value:p[0],
color:p.slice(1),label:p[0]}})}},_updateColormapParameters:function(){var p=this._function.functionArguments;p.colormap=this.colormap;p.colormapName=this.colormapName;p.colorRamp=this.colorRamp;p.colorRampName=this.colorRampName}})})},"esri/layers/rasterLib/renderer/RasterRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","../../../geometry/Extent","../../PixelBlock"],function(m,n,v,b){return m(null,{declaredClass:"esri.layers.rasterLib.renderer.RasterRenderer",raster:null,constructor:function(p){p=
p||{};this.raster=p.raster||p.Raster||this.raster;this.draw=n.hitch(this,this.draw);this.bind=n.hitch(this,this.bind);p=n.clone(p);Object.keys(p).forEach(function(f){null==p[f]&&delete p[f]});n.mixin(this,p)},bind:function(p){if(!p)throw"failed to bind without options";var f=p;p.layer&&(p=p.layer,f={id:p.id,rawRasterInfo:p.raster.rasterInfo,glSetting:p._glSetting,xformSetting:p.tileManager&&p.tileManager.xformSetting,useWebGL:p.useWebGL,resampling:p.tileMode&&p.tileManager&&p.tileManager.xformSetting.requireProjection&&
!p._hasTilingEffects&&"Thematic"!==p.raster.dataType?1:0,tileMode:p.tileMode});this._rawRasterInfo=f.rawRasterInfo;this.useWebGL=f.useWebGL;this._function&&this._function.setProcessingContext(n.mixin({useProcessedData:!0},f));this._processingContext=f},hasTilingEffects:function(){},draw:function(p){return this.useWebGL?this.drawGL(p):this.draw2D(p)},toJson:function(){},_clonePixelData:function(p){if(null==p)return p;var f={};p.extent&&(f.extent=new v(p.extent.xmin,p.extent.ymin,p.extent.xmax,p.extent.ymax,
p.extent.spatialReference));p=p.processedPixelBlock||p.pixelBlock;if(null==p)return f;f.pixelBlock=p.clone?p.clone():b.prototype.clone(p);return f}})})},"esri/layers/rasterLib/renderer/RasterUniqueValueRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction","../../../renderers/colorRampGenerator"],function(m,n,v,b,p){return m([v],{declaredClass:"esri.layers.rasterLib.renderer.RasterUniqueValueRenderer",rendererName:"UniqueValue",field:"",
alias:"",uniqueValueInfos:null,constructor:function(f){f&&f.colormap&&(this.colormap=f.colormap,this._function=new b(f),this._function.outputPixelType="U8",this._function.renderTexture=!0)},bind:function(f){this.inherited(arguments);if(!this._function){var d=(this.raster&&this.raster.rasterInfo||this._rawRasterInfo).vat;if(!d)throw"uv renderer requires data source to have raster attribute table";var a=this.attributeField||this.field1||this.field,c=this.infos||this.uniqueValueInfos;this.defaultColor=
this.defaultColor||this.defaultSymbol&&this.defaultSymbol.color;var h=d.fields.filter(function(t){return"value"===t.name.toLowerCase()})[0];if(h)var l=h.name;a||((a=d.fields.filter(function(t){return-1<["classname","category"].indexOf(t.name.toLowerCase())})[0])||(a=d.fields.filter(function(t){return"esriFieldTypeString"===t.type})[0]),this.alias=(this.field=a=a&&a.name||l)&&a.alias||l);var k=[],g;if(!c){c=[];var e=d.fields.filter(function(t){return"alpha"===t.name.toLowerCase()})[0];var q=d.fields.filter(function(t){return"red"===
t.name.toLowerCase()})[0];var u=d.fields.filter(function(t){return"green"===t.name.toLowerCase()})[0];var r=d.fields.filter(function(t){return"blue"===t.name.toLowerCase()})[0];for(h=0;h<d.features.length;h++){var x=d.features[h].attributes;(g=c.some(function(t){t.value===x[a]}))||(e&&q&&u&&r?c.push({value:x[a],alias:x[a],color:[x[q.name],x[u.name],x[r.name],x[e.name]]}):q&&u&&r?c.push({value:x[a],alias:x[a],color:[x[q.name],x[u.name],x[r.name]]}):c.push({value:x[a],alias:x[a]}))}if(!(q&&u&&r))for(g=
p.createRandomColorRamp({size:c.length}),h=0;h<c.length;h++)c[h].color=g[h];this.uniqueValueInfos=c}if(c)c.forEach(function(t){k=k.concat(d.features.filter(function(w){return t.value==w.attributes[a]}).map(function(w){return[w.attributes[l]].concat(t.color||t.symbol&&t.symbol.color)}))}),this.defaultColor&&d.features.filter(function(t){k.some(function(w){return w[0]===t.attributes[l]})||k.push([t.attributes[l]].concat(this.defaultColor))});else throw"missing uniqueValueInfos property";this._function=
new b({colormap:k});this.colormap=k;this._function.outputPixelType="U8";this._function.renderTexture=!0;this._function.setProcessingContext(this._processingContext)}},draw2D:function(f){f=this._clonePixelData(f);return f=this._function._colorize(f)},drawGL:function(f){this._function._colorizeGL(f)},toJson:function(f){var d={field:this.field,uniqueValueInfos:this.uniqueValueInfos,defaultColor:this.defaultColor};f&&(d.colormap=this.colormap);return{rendererName:this.rendererName,rendererArguments:d}},
toCommonRendererJson:function(){var f=this.attributeField||this.field1||this.field,d=(this.infos||this.uniqueValueInfos).map(function(a){return{value:a.value,label:a.alias+"",symbol:{color:3===a.color.length?a.color.concat([255]):a.color,type:"esriSFS",style:"esriSFSSolid"}}});return{type:"uniqueValue",field1:f,uniqueValueInfos:d}}})})},"esri/layers/rasterLib/renderer/RasterRGBRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/StretchFunction ../function/ContrastBrightnessFunction ../function/rasterUtils".split(" "),
function(m,n,v,b,p,f){return m([v],{declaredClass:"esri.layers.rasterLib.renderer.RasterRGBRenderer",rendererName:"RGB",bandIndex:null,stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,computeGamma:!1,sigmoidStrengthLevel:1,constructor:function(d){this.stretchType="number"===typeof this.stretchType?this.stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ").indexOf(this.stretchType);
d=n.mixin({},d,{stretchType:this.stretchType});this._stretchFunction=new b(d);this._stretchFunction.outputPixelType="U8";this._stretchFunction.renderTexture=!1;this.bandIndex=d.bandIndex||d.BandIndex;this._function=new p(d);this._function.functionArguments.raster=this._stretchFunction;this._function.renderTexture=!0},hasTilingEffects:function(){return this._stretchFunction.hasTilingEffects()},draw2D:function(d){this._updateStretchParameters();d=this._clonePixelData(d);if("U8"===d.pixelBlock.pixelType&&
!this.contrastOffset&&!this.brightnessOffset)return d;this._stretchFunction._stretch(d);var a=d.pixelBlock,c=this.bandIndex,h=Math.max.apply(null,c);a&&a.pixels.length>h&&c&&(a.pixels=c.map(function(l){return a.pixels[l]}),a.statistics&&(a.statistics=c.map(function(l){return a.statistics[l]})));if(this.contrastOffset||this.brightnessOffset)d.pixelBlock=f.contrastBrightnessStretch(d.pixelBlock,{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return d},drawGL:function(d){this._updateStretchParameters();
d.pixelBlock&&(d=this._clonePixelData(d));var a=d.pixelBlock,c=this.bandIndex,h=Math.max.apply(null,c),l=this.statistics&&0<this.statistics.length?this.statistics:this._stretchFunction&&this._stretchFunction.srcStatistics,k=this.histograms&&0<this.histograms.length?this.histograms:this._stretchFunction&&this._stretchFunction.srcHistograms,g,e;a&&a.pixels.length>h&&c&&(a.pixels=c.map(function(q){return a.pixels[q]}),a.statistics&&(a.statistics=c.map(function(q){return a.statistics[q]})),l&&0<l.length&&
l.length!==c.length&&(g=c.map(function(q){return l[q]})),k&&0<k.length&&k.length!==c.length&&(e=c.map(function(q){return k[q]})));this._stretchFunction.functionArguments.statistics=g||l;this._stretchFunction.functionArguments.histograms=e||k;this.contrastOffset||this.brightnessOffset?(this._stretchFunction.renderTexture=!1,this._function.renderTexture=!0,d=this._stretchFunction._stretchGL(d),this._function._cbGL(d)):(this._stretchFunction.renderTexture=!0,this._stretchFunction._stretchGL(d))},toJson:function(){var d=
this._stretchFunction.toJson().rasterFunctionArguments;d.bandIndex=this.bandIndex;d.contrastOffset=this.contrastOffset;d.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,rendererArguments:d}},toCommonRendererJson:function(){return{type:"rasterStretch",stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ")[this.stretchType]||"minMax",min:this.min,max:this.max,numberOfStandardDeviations:this.numberOfStandardDeviations,statistics:n.clone(this.statistics),
dra:this.dra,minPercent:this.minPercent,maxPercent:this.maxPercent,useGamma:this.useGamma,gamma:n.clone(this.gamma),computeGamma:this.computeGamma,sigmoidStrengthLevel:this.sigmoidStrengthLevel}},_updateStretchParameters:function(){var d=this._stretchFunction.functionArguments;d.stretchType=this.stretchType;d.min=this.min;d.max=this.max;d.numberOfStandardDeviations=this.numberOfStandardDeviations;d.statistics=this.statistics;d.histograms=this.histograms;d.dra=this.dra;d.minPercent=this.minPercent;
d.maxPercent=this.maxPercent;d.useGamma=this.useGamma;d.gamma=this.gamma;d.computeGamma=this.computeGamma;this._stretchFunction.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterStretchColorRampRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/ResampleFunction ../function/StretchFunction ../function/ContrastBrightnessFunction ../function/ColormapFunction ../function/rasterUtils".split(" "),function(m,n,v,b,p,f,d,a){return m([v],
{declaredClass:"esri.layers.rasterLib.renderer.RasterStretchColorRampRenderer",rendererName:"Stretch",bandIndex:[0],colorRamp:null,invert:!1,stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,computeGamma:!1,sigmoidStrengthLevel:1,constructor:function(c){this.stretchType="number"===typeof this.stretchType?this.stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ").indexOf(this.stretchType);
c=n.mixin({},c,{stretchType:this.stretchType});Object.keys(c).forEach(function(h){null==c[h]&&delete c[h]});this._function=new f(c);this._stretchFunction=new p(c);this._stretchFunction.outputPixelType="U8";this._stretchFunction.renderTexture=!1;this._clrFunction=new d(c);this._clrFunction.functionArguments.raster=this._stretchFunction;this._clrFunction.renderTexture=!1;this._function.functionArguments.raster=this._clrFunction},hasTilingEffects:function(){return this._stretchFunction.hasTilingEffects()},
draw2D:function(c){this._updateStretchParameters();c=this._clonePixelData(c);if("U8"===c.pixelBlock.pixelType&&!(this.contrastOffset||this.brightnessOffset||this.colorRamp))return c;this._stretchFunction._stretch(c);var h=c.pixelBlock,l=this.bandIndex?this.bandIndex[0]:0;h&&1<h.pixels.length&&h.pixels.length>l&&(h.pixels=[h.pixels[l]],h.statistics&&(h.statistics=[h.statistics[l]]));this.colorRamp&&(c=this._clrFunction._colorize(c));if(this.contrastOffset||this.brightnessOffset)c.pixelBlock=a.contrastBrightnessStretch(c.pixelBlock,
{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return c},drawGL:function(c){this._updateStretchParameters();c.pixelBlock&&(c=this._clonePixelData(c));var h=c.pixelBlock,l=this.bandIndex?this.bandIndex[0]||0:0,k=this.statistics&&0<this.statistics.length?this.statistics:this._stretchFunction&&this._stretchFunction.srcStatistics,g=this.histograms&&0<this.histograms.length?this.histograms:this._stretchFunction&&this._stretchFunction.srcHistograms,e,q;h&&1<h.pixels.length&&
h.pixels.length>l&&(h.pixels=[h.pixels[l]],h.statistics&&(h.statistics=[h.statistics[l]]),k&&k.length>l&&(e=[k[l]]),g&&g.length>l&&(q=[g[l]]));this._stretchFunction.functionArguments.statistics=e||k;this._stretchFunction.functionArguments.histograms=q||g;h=!!this.colorRamp;this.contrastOffset||this.brightnessOffset?(this._stretchFunction.renderTexture=!1,this._clrFunction.renderTexture=!1,this._function.renderTexture=!0,c=this._stretchFunction._stretchGL(c),h&&(c=this._clrFunction._colorizeGL(c)),
this._function._cbGL(c)):h?(this._stretchFunction.renderTexture=!1,this._clrFunction.renderTexture=!0,c=this._stretchFunction._stretchGL(c),this._clrFunction._colorizeGL(c)):(this._stretchFunction.renderTexture=!0,this._stretchFunction._stretchGL(c))},toJson:function(){var c=this._stretchFunction.toJson().rasterFunctionArguments;c.colorRamp=this.colorRamp||"";this.invert&&(c.invert=!0);c.contrastOffset=this.contrastOffset;c.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,
rendererArguments:c}},toCommonRendererJson:function(){return{type:"rasterStretch",stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ")[this.stretchType]||"minMax",colorRamp:this.colorRamp&&this.colorRamp.toJson?this.colorRamp.toJson():this.colorRamp,min:this.min,max:this.max,numberOfStandardDeviations:this.numberOfStandardDeviations,statistics:n.clone(this.statistics),dra:this.dra,minPercent:this.minPercent,maxPercent:this.maxPercent,useGamma:this.useGamma,
gamma:n.clone(this.gamma),computeGamma:this.computeGamma,sigmoidStrengthLevel:this.sigmoidStrengthLevel}},_updateStretchParameters:function(){var c=this._stretchFunction.functionArguments;c.stretchType=this.stretchType;c.min=this.min;c.max=this.max;c.numberOfStandardDeviations=this.numberOfStandardDeviations;c.statistics=this.statistics;c.histograms=this.histograms;c.dra=this.dra;c.minPercent=this.minPercent;c.maxPercent=this.maxPercent;c.useGamma=this.useGamma;c.gamma=this.gamma;c.computeGamma=this.computeGamma;
this._stretchFunction.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterClassBreaksRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction","../function/RemapFunction"],function(m,n,v,b,p){return m([v],{declaredClass:"esri.layers.rasterLib.renderer.RasterClassBreaksRenderer",rendererName:"ClassBreaks",renderTexture:!0,constructor:function(f){f=f||{};this._function=new p(f);this._function.outputPixelType="U8";var d=
f.classBreakInfos;f=f.minValue;null!=f&&d&&(this._function.functionArguments.colorBreaks=this._getSortedColorBreaks(f,d))},bind:function(f){this.inherited(arguments);this.isColormapFunction=!1;var d=this.raster&&this.raster.rasterInfo||this._rawRasterInfo,a=d&&d.vat;if(a&&"u8"===d.pixelType.toLowerCase()&&this.classBreakInfos){var c=this.field;if(d=a.fields.filter(function(q){return"value"===q.name.toLowerCase()})[0])var h=d.name;var l=a.features.sort(function(q,u){return parseFloat(q.attributes[c])-
parseFloat(u.attributes[c])})[0].attributes[c];this.isColormapFunction=!0;var k=[],g=this.field,e=this.classBreakInfos;e.forEach(function(q,u){a.features.forEach(function(r){var x=e[u-1]&&e[u-1].classMaxValue||l;r.attributes[g]<=q.classMaxValue&&(r.attributes[g]>x||r.attributes[g]===l)&&(x=q.symbol.color,k.some(function(t){return t[0]===r.attributes[h]})||k.push([r.attributes[h]].concat(x)))})});this._function=new b({colormap:k});this.colormap=k;this._function.outputPixelType="U8";this._function.renderTexture=
!0}this._function&&this._function.setProcessingContext(n.mixin({useProcessedData:!0},this._processingContext))},draw2D:function(f){if(this.isColormapFunction)return this._updateColormapParameters(),f=this._clonePixelData(f),f=this._function._colorize(f);this._updateRemapParameters();return this._function._remap(f)},drawGL:function(f){this.isColormapFunction?(this._updateColormapParameters(),this._function._colorizeGL(f)):(this._function.renderTexture=!0,this._updateRemapParameters(),this._function._remapGL(f))},
toJson:function(){var f=this._function.toJson().rasterFunctionArguments;return{rendererName:this.rendererName,rendererArguments:f}},toCommonRendererJson:function(){var f,d=this.classBreakInfos,a=this.colorBreaks;if(null==d&&a)for(d=[],f=0;f<a.length-1;f++)d.push({classMaxValue:a[f+1].value,symbol:{color:a[f].mappedColor,type:"esriSFS",style:"esriSFSSolid"},label:a[f].value+" - "+a[f+1].value});return{type:"classBreaks",field:"Value",minValue:null!=this.minValue?this.minValue:a[0].value,classBreakInfos:d}},
_updateRemapParameters:function(){var f=this.classBreakInfos,d=this.minValue;null!=d&&f&&(this._function.functionArguments.colorBreaks=this._getSortedColorBreaks(d,f))},_getSortedColorBreaks:function(f,d){var a=d.map(function(l){return{maxValue:l.classMaxValue,color:l.symbol.color}}).sort(function(l,k){return l.maxValue-k.maxValue}),c,h=[{value:f,mappedColor:a[0].color}];for(c=0;c<a.length;c++)h.push({value:a[c].maxValue,mappedColor:c===a.length-1?a[c].color:a[c+1].color});return h},_updateColormapParameters:function(){this._function.functionArguments.colormap=
this.colormap;this._function.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterShadedReliefRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/HillshadeFunction ../function/ContrastBrightnessFunction ../function/ColormapFunction ../function/rasterUtils".split(" "),function(m,n,v,b,p,f,d){return m([v],{declaredClass:"esri.layers.rasterLib.renderer.RasterShadedReliefRenderer",rendererName:"ShadedRelief",hillshadeType:null,azimuth:315,
altitude:45,zFactor:1,slopeType:null,psPower:.664,psFactor:.024,raster:null,constructor:function(a){this.hillshadeType="number"===typeof this.hillshadeType?this.hillshadeType:["traditional","multi-directional"].indexOf(this.hillshadeType);a&&a.scalingType&&(this.slopeType="adjusted"===a.scalingType?3:1);a&&a.pixelSizePower&&(this.psPower=a.pixelSizePower);a&&a.pixelSizeFactor&&(this.psFactor=a.pixelSizeFactor);a=n.mixin({},a,{hillshadeType:this.hillshadeType,psPower:this.psPower,psFactor:this.psFactor,
slopeType:this.slopeType});Object.keys(a).forEach(function(c){null==a[c]&&delete a[c]});this._function=new p(a);this._hillshadeFunction=new b(a);this._hillshadeFunction.outputPixelType="U8";this._hillshadeFunction.renderTexture=!1;this._function.functionArguments.raster=this._hillshadeFunction},hasTilingEffects:function(){return this._hillshadeFunction.hasTilingEffects()},draw2D:function(a){this._updateHillshadeParameters();a=this._clonePixelData(a);a=this._hillshadeFunction.read2D({raster:a});if(this.contrastOffset||
this.brightnessOffset)a.pixelBlock=d.contrastBrightnessStretch(a.pixelBlock,{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return a},drawGL:function(a){this._updateHillshadeParameters();this.contrastOffset||this.brightnessOffset?(this._hillshadeFunction.renderTexture=!1,this._function.renderTexture=!0,a=this._hillshadeFunction.readGL({raster:a}),this._function._cbGL(a)):(this._hillshadeFunction.renderTexture=!0,this._hillshadeFunction.readGL({raster:a}))},toJson:function(){var a=
this._hillshadeFunction.toJson().rasterFunctionArguments;a.colorRamp=this.colorRamp||"";this.invert&&(a.invert=!0);a.contrastOffset=this.contrastOffset;a.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,rendererArguments:a}},toCommonRendererJson:function(){return{type:"rasterShadedRelief",hillshadeType:["traditional","multi-directional"][this.hillshadeType]||"traditional",azimuth:this.azimuth,altitude:this.altitude,zFactor:this.zFactor,scalingType:3===this.slopeType?"adjusted":
"none",pixelSizePower:this.psPower,pixelSizeFactor:this.psFactor,colorRamp:this.colorRamp&&this.colorRamp.toJson?this.colorRamp.toJson():this.colorRamp}},_updateHillshadeParameters:function(){var a=this._hillshadeFunction.functionArguments;a.hillshadeType=this.hillshadeType;a.azimuth=this.azimuth;a.altitude=this.altitude;a.zFactor=this.zFactor;a.slopeType=this.slopeType;a.psPower=this.psPower;a.psFactor=this.psFactor}})})},"esri/layers/rasterLib/raster/rasterProjectionHelper":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/sniff ../../../kernel ../../../WKIDUnitConversion ../../../geometry/Extent ../../../geometry/projection ../../../geometry/webMercatorUtils ../../../SpatialReference ../../../geometry/Point".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l){m={requirePE:function(g,e){return!(g.equals(e)||g._canProject(e))},load:function(){var g=new v;if(!this._loadPromise)if(a.isSupported())this._loadPromise=a.load();else{var e=new v;e.reject("projection engine is not supported on this version of the browser, please try with a modern browser");this._loadPromise=e.promise}this._loadPromise.isFulfilled()?this._loadPromise.isResolved()?g.resolve():this._loadPromise.isRejected()&&g.resolve():(this._pendingdfds=this._pendingdfds||
[],this._pendingdfds.push(g),this._loadPromise.then(n.hitch(this,function(){this._pendingdfds.forEach(function(q){q.isFulfilled()||q.resolve()})}),n.hitch(this,function(){this._pendingdfds.forEach(function(q){q.isFulfilled()||q.reject()})})));return g.promise},computeError:function(g,e){return[Math.abs((g[0]+g[4]+g[4*e.rows]+g[4*e.rows+4])/4-g[2*e.rows+2]),Math.abs((g[1]+g[5]+g[4*e.rows+1]+g[4*e.rows+5])/4-g[2*e.rows+3])]},getDefaultDatumTransformationForDataset:function(g,e,q){if(!(e&&g.spatialReference&&
this.requirePE(g.spatialReference,e)&&a.isLoaded()))return null;g=new d(g.toJson());e=new h(e.toJson());return q?a.getTransformation(e,g.spatialReference,g):a.getTransformation(g.spatialReference,e,g)},project:function(g,e,q){if(!e||g.spatialReference.equals(e))return g;var u=a.isLoaded()?a:c;"esri.geometry.Extent"===g.declaredClass?g=new d(g.toJson()):"esri.geometry.Point"===g.declaredClass&&(g=new l(g.toJson()));e=new h(e.toJson());(g=u.project(g,e))&&"esri.geometry.Extent"===g.declaredClass?(g=
new d(g.toJson()),q&&(1E-5>Math.abs(g.xmin+180)&&1E-5>Math.abs(g.xmax-180)?(g.xmin=0,g.xmax=360):(0>g.xmin&&(g.xmin+=360,g.xmax+=360),0>g.xmax&&(g.xmax+=360)))):g&&"esri.geometry.Point"===g.declaredClass&&(g=new l(g.toJson()),q&&0>g.x&&(g.x+=360));return g},projectResolution:function(g,e,q){var u=q.xmin+(q.xmax-q.xmin)/2;q=q.ymin+(q.ymax-q.ymin)/2;g=new d(u,q,u+g.x,q+g.y,g.spatialReference);g=this.project(g,e);return new l(g.xmax-g.xmin,g.ymax-g.ymin,e)},getProjectionOffsetGrid:function(g,e,q,u,r,
x,t){null==t&&(t=[32,32]);var w=g.xmin,z=g.ymin,B=g.xmax,A=g.ymax,y=g.spatialReference,E=e.spatialReference,G=a.isLoaded()?a:c,F=r?-r:null,D=t[0]*q.x,L=t[1]*q.y;B={cols:Math.ceil((B-w)/D)+1,rows:Math.ceil((A-z)/L)+1};g=[];for(A=0;A<B.cols;A++){var O=S;var S=[];for(q=0;q<B.rows;q++){var Z=new l({x:w+D*A,y:z+L*q,spatialReference:y});Z=G.project(Z,E,x);if(!Z)return null;u&&0>Z.x&&(Z.x+=360);S.push(Z);0<A&&null!=F&&Z.x<O[q].x&&(Z.x+=r-F,Z.x<O[q].x&&(Z.x+=r-F));g.push((Z.x-e.xmin)/(e.xmax-e.xmin));g.push((Z.y-
e.ymin)/(e.ymax-e.ymin))}}e=this.computeError(g,B);u=new Float32Array((B.cols-1)*(B.rows-1)*12);r=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]);x=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(A=0;A<B.cols-1;A++)for(q=0;q<B.rows-1;q++){D=A*B.rows*2+2*q;w=g[D];z=g[D+1];S=g[D+2];y=g[D+3];D+=2*B.rows;E=g[D];G=g[D+1];F=g[D+2];L=g[D+3];O=0;Z=12*(q*(B.cols-1)+A);for(D=0;3>D;D++)u[Z++]=r[O++]*w+r[O++]*S+r[O++]*F;for(D=O=0;3>D;D++)u[Z++]=r[O++]*z+r[O++]*y+r[O++]*L;for(D=O=0;3>D;D++)u[Z++]=x[O++]*w+x[O++]*E+x[O++]*
F;for(D=O=0;3>D;D++)u[Z++]=x[O++]*z+x[O++]*G+x[O++]*L}return{offsets:g,error:e,coefficients:u,spacing:t,size:[B.cols-1,B.rows-1]}},getHalfWorldWidth:function(g){var e=g&&g.wkid;if(null!=e)return g.isWebMercator()&&(e=3857),null==f[e]?180:k[e]}};n.setObject("layers.rasterLib.raster.rasterProjectionHelper",m,p);var k={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3832:3339584.723798206,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,
8858:7396237.374497803,8859:2465412.4581659334,32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53025:7276828.3848298555,53031:1.0384677558821043E7,53034:2.001508679602057E7,53036:7389443.187332862,53037:2463147.729110953,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,54004:2.0037508342789244E7,
54016:1.4168658027268292E7,54017:1.736753044516137E7,54025:7311399.09166516,54031:1.0396310810074743E7,54034:2.0037508342789244E7,54050:808820.9223376509,54053:1920897.3915568967,54079:2.0037508342789244E7,54080:2.0037508342789244E7,54099:1.3524439768288724E7,54100:2.0037508342789244E7,54101:2.0037508342789244E7,102038:4297258.582585486,102299:5013965.117483125};return m})},"esri/geometry/projection":function(){define("require exports dojo/Deferred ./pe ../SpatialReference ./GeographicTransformation".split(" "),
function(m,n,v,b,p,f){function d(k,g,e,q,u){void 0===q&&(q=null);void 0===u&&(u=!1);if(null===q){var r=f.cacheKey(g,e);void 0!==l[r]?q=l[r]:(q=a(g,e,null),null===q&&(q=new f),l[r]=q)}return c._project(k,g,e instanceof p||!1===u?e:new p(e),q,u)}function a(k,g,e){void 0===e&&(e=null);k=c._getTransformation(k,g,e);return null!==k?f.fromGE(k):null}Object.defineProperty(n,"__esModule",{value:!0});var c=null;n.isLoaded=function(){return!!c&&b.isLoaded()};n.isSupported=function(){return b.isSupported()};
var h=null;n.load=function(){if(h)return h.promise;h=new v;var k=b.load();m(["./geometryEngine"],function(g){c=g;k.then(function(){c._enableProjection(b);h.resolve()},function(e){h.reject(e)})});return h.promise};n.project=function(k,g,e){void 0===e&&(e=null);return k instanceof Array?0===k.length?[]:d(k,k[0].spatialReference,g,e):d([k],k.spatialReference,g,e)[0]};var l={};n.projectMany=d;n.getTransformation=a;n.getTransformations=function(k,g,e){void 0===e&&(e=null);k=c._getTransformationBySuitability(k,
g,e);if(null!==k){g=[];for(e=0;e<k.length;e++)g.push(f.fromGE(k[e]));return g}return[]}})},"esri/geometry/pe":function(){define(["require","exports","../core/tsSupport/extendsHelper","dojo/Deferred","../core/sniff"],function(m,n,v,b,p){function f(r){function x(B,A,y){B[A]=y(B[A])}n._pe=r;k.init();g.init();e.init();q.init();u.init();n.PeGCSExtent=function(B){function A(){return null!==B&&B.apply(this,arguments)||this}v(A,B);A.prototype.destroy=function(){n._pe.destroy(this)};return A}(n._pe.PeGCSExtent);
for(var t=0,w=[n._pe.PeDatum,n._pe.PeGeogcs,n._pe.PeGeogtran,n._pe.PeObject,n._pe.PeParameter,n._pe.PePrimem,n._pe.PeProjcs,n._pe.PeSpheroid,n._pe.PeUnit];t<w.length;t++)r=w[t],x(r.prototype,"getName",function(B){return function(){return B.call(this,Array(k.PE_NAME_MAX))}});t=0;for(w=[n._pe.PeGeogtran,n._pe.PeProjcs];t<w.length;t++)r=w[t],x(r.prototype,"getParameters",function(B){return function(){for(var A=Array(k.PE_PARM_MAX),y=B.call(this),E=0;E<A.length;E++){var G=n._pe.getValue(y,"*");A[E]=G?
n._pe.wrapPointer(G,n._pe.PeParameter):null;y+=Int32Array.BYTES_PER_ELEMENT}return A}});x(n._pe.PeHorizon.prototype,"getCoord",function(B){return function(){var A=this.getSize();if(!A)return null;var y=[],E=B.call(this);h(y,A,E);return y}});x(n._pe.PeGTlistExtendedEntry.prototype,"getEntries",function(B){var A=n._pe._pe_getPeGTlistExtendedGTsSize();return function(){var y=null,E=B.call(this);if(!n._pe.compare(E,n._pe.NULL)){y=[E];var G=this.getSteps();if(1<G){E=n._pe.getPointer(E);for(var F=1;F<G;F++)y.push(n._pe.wrapPointer(E+
A*F,n._pe.PeGTlistExtendedGTs))}}return y}});var z=n._pe._pe_getPeHorizonSize();r=function(B){return function(){var A=this._cache;A||(this._cache=A=new Map);if(A.has(B))return A.get(B);var y=null,E=B.call(this);if(!n._pe.compare(E,n._pe.NULL)){y=[E];var G=E.getNump();if(1<G){E=n._pe.getPointer(E);for(var F=1;F<G;F++)y.push(n._pe.wrapPointer(E+z*F,n._pe.PeHorizon))}}A.set(B,y);return y}};x(n._pe.PeProjcs.prototype,"horizonGcsGenerate",r);x(n._pe.PeProjcs.prototype,"horizonPcsGenerate",r);n._pe.PeObject.prototype.toString=
function(B){void 0===B&&(B=k.PE_STR_OPTS_NONE);n._pe.ensureCache.prepare();var A=n._pe.getPointer(this),y=n._pe.ensureInt8(Array(k.PE_BUFFER_MAX));return n._pe.UTF8ToString(n._pe._pe_object_to_string_ext(A,B,y))}}function d(r){if(r){var x=n._pe.getClass(r);x&&(x=n._pe.getCache(x))&&(r=n._pe.getPointer(r))&&delete x[r]}}function a(r,x){for(var t=[],w=Array(x),z=0;z<r;z++)t.push(n._pe.ensureInt8(w));return t}function c(r){if(Array.isArray(r[0])){var x=[];r.forEach(function(t){x.push(t[0],t[1])})}else x=
r;return x}function h(r,x,t,w){void 0===w&&(w=!1);if(w)for(w=0;w<2*x;w++)r[w]=n._pe.getValue(t+w*Float64Array.BYTES_PER_ELEMENT,"double");else{var z=0===r.length;for(w=0;w<x;w++)z&&(r[w]=Array(2)),r[w][0]=n._pe.getValue(t,"double"),r[w][1]=n._pe.getValue(t+Float64Array.BYTES_PER_ELEMENT,"double"),t+=2*Float64Array.BYTES_PER_ELEMENT}}Object.defineProperty(n,"__esModule",{value:!0});var l;n._pe=null;n.isLoaded=function(){return!!n._pe};n.isSupported=function(){return!!p("esri-wasm")};n.load=function(){if(l)return l.promise;
l=new b;m(["./support/pe-wasm"],function(r){r({locateFile:function(x){return m.toUrl("./support/"+x)},onAbort:function(x){l.reject(Error(x))}}).then(function(x){f(x);l.resolve()})});return l.promise};(function(r){function x(z,B,A){n._pe.ensureCache.prepare();var y=c(A),E=A===y;y=n._pe.ensureFloat64(y);(z=n._pe._pe_geog_to_proj(n._pe.getPointer(z),B,y))&&h(A,B,y,E);return z}function t(z,B,A){return w(z,B,A,0)}function w(z,B,A,y){n._pe.ensureCache.prepare();var E=c(A),G=A===E;E=n._pe.ensureFloat64(E);
(z=n._pe._pe_proj_to_geog_center(n._pe.getPointer(z),B,E,y))&&h(A,B,E,G);return z}r.geogToProj=x;r.projGeog=function(z,B,A,y){switch(y){case k.PE_TRANSFORM_P_TO_G:return t(z,B,A);case k.PE_TRANSFORM_G_TO_P:return x(z,B,A)}return 0};r.projToGeog=t;r.projToGeogCenter=w})(n.PeCSTransformations||(n.PeCSTransformations={}));var k;(function(r){r.init=function(){r.PE_BUFFER_MAX=n._pe.PeDefs.prototype.PE_BUFFER_MAX;r.PE_NAME_MAX=n._pe.PeDefs.prototype.PE_NAME_MAX;r.PE_MGRS_MAX=n._pe.PeDefs.prototype.PE_MGRS_MAX;
r.PE_USNG_MAX=n._pe.PeDefs.prototype.PE_USNG_MAX;r.PE_DD_MAX=n._pe.PeDefs.prototype.PE_DD_MAX;r.PE_DDM_MAX=n._pe.PeDefs.prototype.PE_DDM_MAX;r.PE_DMS_MAX=n._pe.PeDefs.prototype.PE_DMS_MAX;r.PE_UTM_MAX=n._pe.PeDefs.prototype.PE_UTM_MAX;r.PE_PARM_MAX=n._pe.PeDefs.prototype.PE_PARM_MAX;r.PE_TYPE_NONE=n._pe.PeDefs.prototype.PE_TYPE_NONE;r.PE_TYPE_GEOGCS=n._pe.PeDefs.prototype.PE_TYPE_GEOGCS;r.PE_TYPE_PROJCS=n._pe.PeDefs.prototype.PE_TYPE_PROJCS;r.PE_TYPE_GEOGTRAN=n._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;
r.PE_TYPE_COORDSYS=n._pe.PeDefs.prototype.PE_TYPE_COORDSYS;r.PE_TYPE_UNIT=n._pe.PeDefs.prototype.PE_TYPE_UNIT;r.PE_STR_OPTS_NONE=n._pe.PeDefs.prototype.PE_STR_OPTS_NONE;r.PE_STR_AUTH_NONE=n._pe.PeDefs.prototype.PE_STR_AUTH_NONE;r.PE_STR_AUTH_TOP=n._pe.PeDefs.prototype.PE_STR_AUTH_TOP;r.PE_STR_NAME_CANON=n._pe.PeDefs.prototype.PE_STR_NAME_CANON;r.PE_PARM_X0=n._pe.PeDefs.prototype.PE_PARM_X0;r.PE_PARM_ND=n._pe.PeDefs.prototype.PE_PARM_ND;r.PE_TRANSFORM_1_TO_2=n._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;
r.PE_TRANSFORM_2_TO_1=n._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;r.PE_TRANSFORM_P_TO_G=n._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;r.PE_TRANSFORM_G_TO_P=n._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;r.PE_HORIZON_RECT=n._pe.PeDefs.prototype.PE_HORIZON_RECT;r.PE_HORIZON_POLY=n._pe.PeDefs.prototype.PE_HORIZON_POLY;r.PE_HORIZON_LINE=n._pe.PeDefs.prototype.PE_HORIZON_LINE;r.PE_HORIZON_DELTA=n._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(k=n.PeDefs||(n.PeDefs={}));(function(r){function x(B,A){var y=null,E=w[B];
E||(E={},w[B]=E);if(E.hasOwnProperty(String(A)))y=E[A];else{var G=n._pe.PeFactory.prototype.factoryByType(B,A);n._pe.compare(G,n._pe.NULL)||(y=G,E[A]=y)}return y=t(y)}function t(B){if(B){var A=B.getType();switch(A){case k.PE_TYPE_GEOGCS:B=n._pe.castObject(B,n._pe.PeGeogcs);break;case k.PE_TYPE_PROJCS:B=n._pe.castObject(B,n._pe.PeProjcs);break;case k.PE_TYPE_GEOGTRAN:B=n._pe.castObject(B,n._pe.PeGeogtran);break;default:A&k.PE_TYPE_UNIT&&(B=n._pe.castObject(B,n._pe.PeUnit))}}return B}var w={},z={};
r.initialize=function(){n._pe.PeFactory.prototype.initialize(null)};r.coordsys=function(B){return x(k.PE_TYPE_COORDSYS,B)};r.factoryByType=x;r.fromString=function(B,A){var y=null,E=z[B];E||(E={},z[B]=E);if(E.hasOwnProperty(A))y=E[A];else{var G=n._pe.PeFactory.prototype.fromString(B,A);n._pe.compare(G,n._pe.NULL)||(y=G,E[A]=y)}return y=t(y)};r.geogcs=function(B){return x(k.PE_TYPE_GEOGCS,B)};r.geogtran=function(B){return x(k.PE_TYPE_GEOGTRAN,B)};r.getCode=function(B){return n._pe.PeFactory.prototype.getCode(B)};
r.projcs=function(B){return x(k.PE_TYPE_PROJCS,B)};r.unit=function(B){return x(k.PE_TYPE_UNIT,B)}})(n.PeFactory||(n.PeFactory={}));n.PeGCSExtent=null;var g;(function(r){var x;r.init=function(){r.PE_GTLIST_OPTS_COMMON=n._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;x=n._pe._pe_getPeGTlistExtendedEntrySize()};r.getGTlist=function(t,w,z,B,A,y){var E=null,G=new n._pe.PeInteger(y);try{var F=n._pe.PeGTlistExtended.prototype.getGTlist(t,w,z,B,A,G);if(y=G.val)if(E=[F],1<y){var D=n._pe.getPointer(F);
for(t=1;t<y;t++)E.push(n._pe.wrapPointer(D+x*t,n._pe.PeGTlistExtendedEntry))}}finally{n._pe.destroy(G)}return E}})(g=n.PeGTlistExtended||(n.PeGTlistExtended={}));(function(r){r.destroy=function(x){if(x&&x.length){for(var t=0;t<x.length;t++){var w=x[t];d(w);w.getEntries().forEach(function(z){d(z);z=z.getGeogtran();d(z);z.getParameters().forEach(d);[z.getGeogcs1(),z.getGeogcs2()].forEach(function(B){d(B);var A=B.getDatum();d(A);d(A.getSpheroid());d(B.getPrimem());d(B.getUnit())})})}n._pe.PeGTlistExtendedEntry.prototype.Delete(x[0])}}})(n.PeGTlistExtendedEntry||
(n.PeGTlistExtendedEntry={}));(function(r){r.geogToGeog=function(x,t,w,z,B){n._pe.ensureCache.prepare();var A=c(w),y=w===A;A=n._pe.ensureFloat64(A);var E=0;z&&(E=n._pe.ensureFloat64(z));(x=n._pe._pe_geog_to_geog(n._pe.getPointer(x),t,A,E,B))&&h(w,t,A,y);return x}})(n.PeGTTransformations||(n.PeGTTransformations={}));(function(r){function x(w,z,B,A,y,E){n._pe.ensureCache.prepare();switch(w){case "dd":var G=n._pe._pe_geog_to_dd;var F=k.PE_DD_MAX;break;case "ddm":G=n._pe._pe_geog_to_ddm;F=k.PE_DDM_MAX;
break;case "dms":G=n._pe._pe_geog_to_dms,F=k.PE_DMS_MAX}w=0;z&&(w=n._pe.getPointer(z));z=c(A);z=n._pe.ensureFloat64(z);F=a(B,F);A=n._pe.ensureInt32(F);if(y=G(w,B,z,y,A))for(G=0;G<B;G++)E[G]=n._pe.UTF8ToString(F[G]);return y}function t(w,z,B,A,y){n._pe.ensureCache.prepare();switch(w){case "dd":var E=n._pe._pe_dd_to_geog;break;case "ddm":E=n._pe._pe_ddm_to_geog;break;case "dms":E=n._pe._pe_dms_to_geog}w=0;z&&(w=n._pe.getPointer(z));z=A.map(function(G){return n._pe.ensureString(G)});A=n._pe.ensureInt32(z);
z=n._pe.ensureFloat64(Array(2*B));(E=E(w,B,A,z))&&h(y,B,z);return E}r.geog_to_dms=function(w,z,B,A,y){return x("dms",w,z,B,A,y)};r.dms_to_geog=function(w,z,B,A){return t("dms",w,z,B,A)};r.geog_to_ddm=function(w,z,B,A,y){return x("ddm",w,z,B,A,y)};r.ddm_to_geog=function(w,z,B,A){return t("ddm",w,z,B,A)};r.geog_to_dd=function(w,z,B,A,y){return x("dd",w,z,B,A,y)};r.dd_to_geog=function(w,z,B,A){return t("dd",w,z,B,A)}})(n.PeNotationDms||(n.PeNotationDms={}));var e;(function(r){r.init=function(){r.PE_MGRS_STYLE_NEW=
n._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;r.PE_MGRS_STYLE_OLD=n._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;r.PE_MGRS_STYLE_AUTO=n._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;r.PE_MGRS_180_ZONE_1_PLUS=n._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;r.PE_MGRS_ADD_SPACES=n._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};r.geog_to_mgrs_extended=function(x,t,w,z,B,A,y){n._pe.ensureCache.prepare();var E=0;x&&(E=n._pe.getPointer(x));x=c(w);w=n._pe.ensureFloat64(x);x=a(t,k.PE_MGRS_MAX);
var G=n._pe.ensureInt32(x);if(z=n._pe._pe_geog_to_mgrs_extended(E,t,w,z,B,A,G))for(B=0;B<t;B++)y[B]=n._pe.UTF8ToString(x[B]);return z};r.mgrs_to_geog_extended=function(x,t,w,z,B){n._pe.ensureCache.prepare();var A=0;x&&(A=n._pe.getPointer(x));x=w.map(function(y){return n._pe.ensureString(y)});w=n._pe.ensureInt32(x);x=n._pe.ensureFloat64(Array(2*t));(z=n._pe._pe_mgrs_to_geog_extended(A,t,w,z,x))&&h(B,t,x);return z}})(e=n.PeNotationMgrs||(n.PeNotationMgrs={}));(function(r){r.geog_to_usng=function(x,
t,w,z,B,A,y){n._pe.ensureCache.prepare();var E=0;x&&(E=n._pe.getPointer(x));x=c(w);w=n._pe.ensureFloat64(x);x=a(t,k.PE_MGRS_MAX);var G=n._pe.ensureInt32(x);if(z=n._pe._pe_geog_to_usng(E,t,w,z,B,A,G))for(B=0;B<t;B++)y[B]=n._pe.UTF8ToString(x[B]);return z};r.usng_to_geog=function(x,t,w,z){n._pe.ensureCache.prepare();var B=0;x&&(B=n._pe.getPointer(x));x=w.map(function(A){return n._pe.ensureString(A)});w=n._pe.ensureInt32(x);x=n._pe.ensureFloat64(Array(2*t));(B=n._pe._pe_usng_to_geog(B,t,w,x))&&h(z,t,
x);return B}})(n.PeNotationUsng||(n.PeNotationUsng={}));var q;(function(r){r.init=function(){r.PE_UTM_OPTS_NONE=n._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;r.PE_UTM_OPTS_ADD_SPACES=n._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;r.PE_UTM_OPTS_NS=n._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};r.geog_to_utm=function(x,t,w,z,B){n._pe.ensureCache.prepare();var A=0;x&&(A=n._pe.getPointer(x));x=c(w);w=n._pe.ensureFloat64(x);x=a(t,k.PE_UTM_MAX);var y=n._pe.ensureInt32(x);if(z=n._pe._pe_geog_to_utm(A,
t,w,z,y))for(A=0;A<t;A++)B[A]=n._pe.UTF8ToString(x[A]);return z};r.utm_to_geog=function(x,t,w,z,B){n._pe.ensureCache.prepare();var A=0;x&&(A=n._pe.getPointer(x));x=w.map(function(y){return n._pe.ensureString(y)});w=n._pe.ensureInt32(x);x=n._pe.ensureFloat64(Array(2*t));(z=n._pe._pe_utm_to_geog(A,t,w,z,x))&&h(B,t,x);return z}})(q=n.PeNotationUtm||(n.PeNotationUtm={}));var u;(function(r){var x=new Map;r.init=function(){r.PE_PCSINFO_OPTION_NONE=n._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;r.PE_PCSINFO_OPTION_DOMAIN=
n._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;r.PE_POLE_OUTSIDE_BOUNDARY=n._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;r.PE_POLE_POINT=n._pe.PePCSInfo.prototype.PE_POLE_POINT};r.generate=function(t,w){void 0===w&&(w=r.PE_PCSINFO_OPTION_DOMAIN);var z;if(x.has(t)){var B=x.get(t);B[w]&&(z=B[w])}z||(z=n._pe.PePCSInfo.prototype.generate(t,w),B||(B=[],x.set(t,B)),B[w]=z);return z}})(u=n.PePCSInfo||(n.PePCSInfo={}));(function(r){r.version_string=function(){return n._pe.PeVersion.prototype.version_string()}})(n.PeVersion||
(n.PeVersion={}));n._init=f})},"esri/core/tsSupport/extendsHelper":function(){define([],function(){return function(){var m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,v){n.__proto__=v}||function(n,v){for(var b in v)v.hasOwnProperty(b)&&(n[b]=v[b])};return function(n,v){function b(){this.constructor=n}m(n,v);n.prototype=null===v?Object.create(v):(b.prototype=v.prototype,new b)}}()})},"esri/geometry/GeographicTransformation":function(){define(["require","exports","./GeographicTransformationStep"],
function(m,n,v){return function(){function b(p){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(p&&p.steps){var f=0;for(p=p.steps;f<p.length;f++){var d=p[f];d instanceof v?this.steps.push(d):this.steps.push(new v({wkid:d.wkid,wkt:d.wkt,isInverse:d.isInverse}))}}}b.cacheKey=function(p,f){return[void 0!==p.wkid&&null!==p.wkid?p.wkid.toString():"-1",void 0!==p.wkt&&null!==p.wkt?p.wkt.toString():"",void 0!==f.wkid&&null!==f.wkid?f.wkid.toString():"-1",void 0!==f.wkt&&
null!==f.wkt?f.wkt.toString():""].join()};b.fromGE=function(p){var f=new b,d="",a=0;for(p=p.steps;a<p.length;a++){var c=v.fromGE(p[a]);f.steps.push(c);d+=c.uid.toString()+","}f._cached_projection={};f._gtlistentry=null;f._chain=d;return f};b.prototype.getInverse=function(){var p=new b;p.steps=[];for(var f=this.steps.length-1;0<=f;f--)p.steps.push(this.steps[f].getInverse());return p};b.prototype.getGTListEntry=function(){for(var p="",f=0,d=this.steps;f<d.length;f++)p+=d[f].uid.toString()+",";p!==
this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=p);return this._gtlistentry};b.prototype.assignCachedGe=function(p,f,d){this._cached_projection[b.cacheKey(p,f)]=d};b.prototype.getCachedGeTransformation=function(p,f){for(var d="",a=0,c=this.steps;a<c.length;a++)d+=c[a].uid.toString()+",";d!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=d);d=this._cached_projection[b.cacheKey(p,f)];return void 0===d?null:d};return b}()})},"esri/geometry/GeographicTransformationStep":function(){define(["require",
"exports"],function(m,n){var v=0;return function(){function b(p){void 0===p&&(p=null);this.uid=v++;p?(this._wkt=void 0!==p.wkt?p.wkt:null,this._wkid=void 0!==p.wkid?p.wkid:-1,this._isInverse=void 0!==p.isInverse?!0===p.isInverse:!1):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}b.fromGE=function(p){var f=new b;f._wkt=p.wkt;f._wkid=p.wkid;f._isInverse=p.isInverse;return f};Object.defineProperty(b.prototype,"wkt",{get:function(){return this._wkt},set:function(p){this._wkt=p;this.uid=v++},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"wkid",{get:function(){return this._wkid},set:function(p){this._wkid=p;this.uid=v++},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isInverse",{get:function(){return this._isInverse},set:function(p){this._isInverse=p;this.uid=v++},enumerable:!0,configurable:!0});b.prototype.getInverse=function(){var p=new b;p._wkt=this.wkt;p._wkid=this._wkid;p._isInverse=!this.isInverse;return p};return b}()})},"esri/layers/rasterLib/raster/TileServiceRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterTileInfo ./RasterInfo ./BasicRaster".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x,t,w,z,B,A){m=n([A],{declaredClass:"esri.layers.rasterLib.raster.TileServiceRaster",constructor:function(y){},open:function(){var y=new b,E=this.serviceInfo||this._getServiceInfo(null),G=v.hitch(this,function(D){this.serviceInfo=D;this.version=D.currentVersion;this.rasterInfo=this._parseRasterInfo(D);this.loaded=!0;this._getRasterIdentifier();y.resolve(this)}),F=v.hitch(this,function(D){this.loaded=!0;this._getRasterIdentifier();y.reject(D)});h(E,G,F);return y.promise},
read:function(y){var E=this.url+"/tile/"+y.level+"/"+y.row+"/"+y.col,G={width:this.tileInfo.cols,height:this.tileInfo.rows,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:"elevation"===this.tileType.toLowerCase()?!0:!1};return this._requestPixels({url:E+(this.disableClientCaching?"?_ts\x3d "+(new Date).getTime():""),payload:{},decodeParams:G,tileOptions:y})},identify:function(y,E){null==E&&(E=this.tileInfo.lods[this.tileInfo.lods.length-1].level);var G=(y.x-this.tileInfo.origin.x)/
this.tileInfo.lods[E].resolution/this.tileInfo.cols,F=(this.tileInfo.origin.y-y.y)/this.tileInfo.lods[E].resolution/this.tileInfo.rows,D=Math.floor(G),L=Math.floor(F),O=Math.floor((G-D)*this.tileInfo.cols);O=Math.min(O,this.tileInfo.cols-1);var S=Math.floor((F-L)*this.tileInfo.rows);S=Math.min(S,this.tileInfo.rows-1);var Z=new b;this.read({level:E,row:L,col:D}).then(function(I){var N=S*I.width+O;I&&I.pixels&&0<I.pixels.length?(I=I.mask?I.mask[N]?I.pixels.map(function(K){return K[N]}):null:I.pixels.map(function(K){return K[N]}),
Z.resolve(I)):Z.reject("no valid data")},function(I){Z.reject(I)});return Z.promise},setFetchParameters:function(y,E){},_getRasterIdentifier:function(){this._rasterId||(this._rasterId=this.url.replace("http:","").replace("https:",""));return this._rasterId},_getServiceInfo:function(){var y=this.url,E=new b(r._dfdCanceller);E._pendingDfd=g({url:y,content:{f:"json"},handleAs:"json",callbackParamName:"callback"});E._pendingDfd.then(function(G){E.callback(G)},function(G){E.errback(G)});return E},_parseRasterInfo:function(y){var E=
new B;E.extent=new e(y.fullExtent);E.spatialReference=new u(y.spatialReference);this.tileType=y.cacheType||"Map";switch(this.tileType){case "Map":E.bandCount=3;E.pixelType="U8";this.dataType="Processed";break;case "Elevation":E.bandCount=1;E.pixelType=y.pixelType||"F32";this.dataType="Elevation";break;case "Raster":E.bandCount=null,E.pixelType=null,this.dataType=y.serviceDataType&&y.serviceDataType.replace("esriImageServiceDataType","")||"Generic"}var G=y.tileInfo;E.width=Math.floor((y.fullExtent.xmax-
y.fullExtent.xmin)/G.lods[G.lods.length-1].resolution+.5);E.height=Math.floor((y.fullExtent.ymax-y.fullExtent.ymin)/G.lods[G.lods.length-1].resolution+.5);E.cellSize=new q({x:G.lods[G.lods.length-1].resolution,y:G.lods[G.lods.length-1].resolution,spatialReference:y.spatialReference});this.tileInfo=new z(G);this.tileInfo.tileType=this.tileType;return E}});v.setObject("layers.rasterLib.raster.TileServiceRaster",m,l);return m})},"esri/layers/rasterLib/raster/TileRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterTileInfo ./RasterInfo ./BasicRaster".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x,t,w,z,B,A){m=n([A],{declaredClass:"esri.layers.rasterLib.raster.TileRaster",sourceType:"TileCache",_RECORD_SIZE:8,constructor:function(y){this._cloudBlobStorage=y&&y._cloudBlobStorage},open:function(){var y=new b,E=this.datasetInfo||this._getDatasetInfo(null),G=v.hitch(this,function(D){this.datasetInfo=D;this.rasterInfo=D=this._parseRasterInfo(D);this.tileType="Cache/LERC"===D.format?"Elevation":"Cache/MIXED"===D.format||"Cache/JPEG"===D.format||"Cache/PNG"===
D.format?"Map":"Raster";this.tileInfo=D.tileInfo;this.dataType=["Generic","Elevation","Processed"][["Raster","Elevation","Map"].indexOf(this.tileType)];this._HEADER_SIZE=D.packetSize*D.packetSize*this._RECORD_SIZE+64;this.loaded=!0;this._cloudBlobStorage=this._cloudBlobStorage||-1<this.url.toLowerCase().indexOf("s3.amazonaws.com")||-1<this.url.toLowerCase().indexOf("windows.net")||-1<this.url.toLowerCase().indexOf("googleapis.com");this._getRasterIdentifier();y.resolve(this)}),F=v.hitch(this,function(D){this.loaded=
!0;this._getRasterIdentifier();y.reject(D)});h(E,G,F);return y.promise},read:function(y){var E=new b,G=y.level,F=y.row,D=y.col,L=this._buildCacheFilePath(this.url,G,F,D),O=this._getIndexRecordFromBundle(G,F,D);g({url:L,content:{},headers:{Range:"bytes\x3d0-"+(this._HEADER_SIZE-1).toString()},handleAs:"arraybuffer"}).then(v.hitch(this,function(S,Z){if(!E.isCanceled()){var I=new Uint8Array(S);I=this._getTileEndAndContentType(I,O);var N={width:this.tileInfo.cols,height:this.tileInfo.rows,planes:null,
pixelType:null,format:null,decodeFunc:null,isPoint:"elevation"===this.tileType.toLowerCase()?!0:!1};this._requestPixels({url:L+(this.disableClientCaching?"?_ts\x3d "+(new Date).getTime():""),payload:{},headers:{Range:"bytes\x3d"+I.position.toString()+"-"+(I.position+I.recordSize).toString()},decodeParams:N,tileOptions:y}).then(function(K){E.isCanceled()||E.resolve(K)},function(K){E.isCanceled()||E.reject(K)})}}));return E.promise},identify:function(){return null},setFetchParameters:function(y,E){},
toJson:function(){return{url:this.url,tileInfo:this.tileInfo.toJson(),rasterInfo:this.rasterInfo.toJson(),datasetInfo:this.datasetInfo,sourceType:this.sourceType,tileType:this.tileType,_rasterId:this._rasterId}},_getDatasetInfo:function(){return g({url:this.url+"/conf.json",handleAs:"json",content:{}})},_parseRasterInfo:function(y){var E=new B;switch(y.pixelType){case 1:var G="U1";break;case 1:G="U2";break;case 2:G="U4";break;case 3:G="U8";break;case 4:G="S8";break;case 5:G="U16";break;case 6:G="S16";
break;case 7:G="U32";break;case 8:G="S32";break;case 9:G="F32";break;default:G="F32"}var F,D=[],L=y.LODInfos;for(F=0;F<L.levels.length;F++)D.push({level:L.levels[F],resolution:L.resolutions[F],scale:96/.0254*L.resolutions[F]});F=new u(y.extent.spatialReference||y.geodataXform.spatialReference);D=new z({rows:y.blockHeight,cols:y.blockWidth,dpi:96,format:y.format,compressionQuality:0,origin:y.origin,spatialReference:F,lods:D});E.pixelType=G;E.bandCount=y.bandCount;E.spatialReference=F;E.extent=new e({xmin:y.extent.xmin,
ymin:y.extent.ymin,xmax:y.extent.xmax,ymax:y.extent.ymax,spatialReference:F});E.cellSize=new q({x:y.pixelSizeX,y:y.pixelSizeY,spatialReference:F});E.width=Math.floor((E.extent.xmax-E.extent.xmin)/E.cellSize.x+.5);E.height=Math.floor((E.extent.ymax-E.extent.ymin)/E.cellSize.y+.5);E.statistics=y.statistics.map(function(O){Object.keys(O).forEach(function(S){isNaN(O[S])&&(O[S]=null)});return O});E.histograms=y.histograms;E.geodataXform=y.geodataXform;E.packetSize=y.packetSize;E.format=y.format;E.compressionQuality=
y.compressionQuality;E.tileInfo=D;return E},_getRasterIdentifier:function(){this._rasterId||(this._rasterId=this.url.replace("http:","").replace("https:",""));return this._rasterId},_buildCacheFilePath:function(y,E,G,F){var D=this.rasterInfo.packetSize;F=Math.floor(F/D)*D;G="R"+this._toHexString4(Math.floor(G/D)*D)+"C"+this._toHexString4(F);D="L";D=10<=E?D+E.toString():D+("0"+E.toString());return this._cloudBlobStorage?y+"/_alllayers/"+D+"/"+G+".bundle":y+"/"+D+"_"+G+"/bundle"},_getIndexRecordFromBundle:function(y,
E,G){y=this.rasterInfo.packetSize;E=E%y*y+G%y;if(0>E)throw"Invalid level / row / col";return E*this._RECORD_SIZE+64},_getTileEndAndContentType:function(y,E){var G=y.subarray(E,E+8),F=0,D;for(D=0;5>D;D++)F|=(G[D]&255)<<8*D;var L=F&0xffffffffff;F=0;for(D=5;8>D;D++)F|=(G[D]&255)<<8*(D-5);return{position:L,recordSize:F&0xffffffffff}},_toHexString4:function(y){y=y.toString(16);if(4!=y.length)for(var E=4-y.length;0<E--;)y="0"+y;return y}});v.setObject("layers.rasterLib.raster.TileRaster",m,l);return m})},
"esri/layers/rasterLib/raster/FunctionRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff ../DeferredList2 dojo/when ../../../kernel ../../../Evented ../../../request ../../../deferredUtils ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../rasterFormats/rasterCodec ./RasterInfo ./BasicRaster ../../rasterLib/function/rasterFunctionHelper".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x,t,w,z,B,A){m=n([B],{declaredClass:"esri.layers.rasterLib.raster.FunctionRaster",rasterFunction:null,sourceType:"Function",constructor:function(y){y&&y.rasterFx&&this._init(y.rasterFx,y.rasterFxArgs)},open:function(){var y=this.getMemberRasters().map(function(G){return G.open()});this.identifiers=this.getMemberRasters().map(function(G){return G._rasterId});var E=new b;(new c(y,null,null,!0)).then(function(G){G.some(function(F){return!F[0]})?E.reject(G):
(this.rasterFunction.bind(),this.rasterInfo=this.rasterFunction.rasterInfo,this.dataType=this.rasterInfo.keyProperties&&this.rasterInfo.keyProperties.DataType||"Generic",this.tileInfo=G[0][1].tileInfo,E.resolve(this))}.bind(this));return E.promise},getProjectedFullExtent:function(y){var E=new b;this.getMemberRasters()[0].getProjectedFullExtent(y).then(v.hitch(this,function(G){this.projectedFullExtent=G;E.resolve(G)}));return E.promise},setProcessingContext:function(y){var E=y;y.layer&&(y=y.layer,
E={id:y.id,rawRasterInfo:y.raster.rasterInfo,glSetting:y._glSetting,xformSetting:y.tileManager&&y.tileManager.xformSetting,useWebGL:y.useWebGL,resampling:y.tileMode&&y.tileManager&&y.tileManager.xformSetting.requireProjection&&!y._hasTilingEffects&&"Thematic"!==y.raster.dataType?1:0,tileMode:y.tileMode});this.rasterFunction.setProcessingContext(E);this._layerOptions=E},alterDefinition:function(y){if(y=y||this.rasterFunction)1===this.memberRasters.length&&!y._bindComplete&&(this.rasterFunction=A.create(y,
{raster:this.memberRasters[0]}))&&(this.rasterFunction.bind(),this.rasterInfo=this.rasterFunction.rasterInfo,this.dataType=this.rasterInfo.keyProperties&&this.rasterInfo.keyProperties.DataType||"Generic",this.rasterFunction.setProcessingContext(this._layerOptions)),this._rasterHandler&&this._rasterHandler._connected&&this.rasterFunction&&this._rasterHandler.setRasterFunction({layerId:this._layerOptions.id,data:this.rasterFunction.toJson(!0)})},setFetchParameters:function(y,E){var G=this.getMemberRasters();
G&&1===G.length&&G[0].setFetchParameters(y,E)},getMemberRasters:function(){this.memberRasters||(this.memberRasters=[],this._getMemberRasters(this.rasterFunction.functionArguments,this.memberRasters));return this.memberRasters},read:function(y){var E=new b(e._dfdCanceller);if(y.src){var G=this.rasterFunction.read(y);E.resolve(G);return E.promise}var F=this.getMemberRasters().map(function(S){return S.read(y)});F=new c(F);var D,L,O=this.identifiers;E._pendingDfd=F;F.then(v.hitch(this,function(S){if(D=
S.some(function(Z){return Z[0]}))L={},S.forEach(function(Z,I){L[O[I]]=Z[0]?Z[1]:null});G=L?this.rasterFunction.read({extent:y.extent,src:L}):null;G.srcData=L;E.resolve(G)}));return E},_init:function(y,E){if(this.rasterFunction=A.create(y,E))this.rasterFunction._bindComplete=!0;else throw"Cannot initialize a function raster without a raster function";},_getMemberRasters:function(y,E){var G=Object.keys(y),F,D,L;for(F=0;F<G.length;F++)if(L=y[G[F]]){var O=L instanceof Array?L:[L];for(D=0;D<O.length;D++)(L=
O[D])&&("function"===typeof L||"object"===typeof L)&&L.read&&(L.functionArguments?this._getMemberRasters(L.functionArguments,E):L.sourceType&&"Function"!==L.sourceType&&(L._identifier=L._getRasterIdentifier(),E.some(function(S){return S._identifier===L._identifier})||E.push(L)))}return E}});v.setObject("layers.rasterLib.raster.FunctionRaster",m,l);return m})},"esri/layers/rasterLib/DeferredList2":function(){define(["dojo/DeferredList"],function(m){return function(n,v,b,p,f){this.list=n;v=new m(n,
v,b,p,f);var d=v.resolve.bind(v),a=v.cancel.bind(v);v.cancel=function(){n&&n.forEach(function(c){c.cancel&&c.cancel()});a.apply(this,arguments)}.bind(v);v.resolve=function(){this.isFulfilled()||d.apply(this,arguments)}.bind(v);return v}})},"esri/layers/rasterLib/tile/RasterTileManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/when ../DeferredList2 ../../../geometry/Extent ../../../SpatialReference ../../../geometry/Point ../../PixelBlock ./RasterTileInfo ../raster/rasterProjectionHelper".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l){var k=function(g,e){var q;for(q=0;q<g.length;q++)if(e(g[q]))return q;return-1};return m(null,{declaredClass:"esri.layers.rasterLib.tile.RasterTileManager",count:null,fullBoundary:null,tileBoundary:null,tiles:null,resolution:null,virtual:!0,prefetchBufferSize:0,_progressiveGlobal:!1,_MAX_TILES:128,_defaultMatrixResolution:20,constructor:function(g){this.tiles=[];this.xformSetting={};this.mapSpatialReference=g&&g.mapSR;this.layer=g&&g.layer;this.identifiers=this.layer.raster.rasterFunction?
this.layer.raster.getMemberRasters().map(function(e){return e._rasterId}):[this.layer.raster._rasterId];(g=g&&g.tileInfo)&&this.setTileInfo(g)},setTileInfo:function(g){this.tileInfo=g;this.virtual=g.virtual;this.mapResolution=null;this.tiles.length=0;this.xformSetting.requireProjection=!this.virtual&&!this.mapSpatialReference.equals(this.tileInfo.spatialReference);this.xformSetting.requirePE=l.requirePE(this.mapSpatialReference,this.tileInfo.spatialReference);this.xformSetting.meshSize=this.xformSetting.requireProjection?
[this._defaultMatrixResolution,this._defaultMatrixResolution]:[1,1];this.halfWorldWidth=l.getHalfWorldWidth(g.spatialReference)},updateResolution:function(g,e){if(!(this.mapResolution&&g&&this._resolutionEqual(this.mapResolution.x,g.x)&&this._resolutionEqual(this.mapResolution.y,g.y))){this.resetTiles();var q=this.xformSetting.requireProjection;this.mapResolution=this.resolution=g;q&&(this.resolution=l.projectResolution(g,this.tileInfo.spatialReference,this.layer.projectedFullExtent||e));this._resolution=
this.resolution;q=this.resolution;if(!this.tileInfo.virtual){var u=.75*Math.min(q.x,q.y)+.25*Math.max(q.x,q.y);if(u>=this.tileInfo.lods[0].resolution){var r=this.tileInfo.lods[0];this.ooe=!0}else{if(u<=this.tileInfo.lods[this.tileInfo.lods.length-1].resolution)r=this.tileInfo.lods[this.tileInfo.lods.length-1];else for(q=0;q<this.tileInfo.lods.length-1;q++){r=this.tileInfo.lods[q];var x=this.tileInfo.lods[q+1];if(r.resolution>=u&&x.resolution<=u){r.resolution-u>u-x.resolution&&(r=x);break}}this.ooe=
!1}this.level=r&&r.level;q=this.resolution=new a({x:r.resolution,y:r.resolution,spatialReference:this.tileInfo.spatialReference})}u=this.layer.raster.rasterInfo.extent;r=this.tileInfo.origin;x=this.tileInfo.cols;var t=this.tileInfo.rows;this.fullBoundary={rowStart:Math.floor((r.y-u.ymax)/q.y/t),rowEnd:Math.floor((r.y-u.ymin-q.y)/q.y/t),colStart:Math.floor((u.xmin-r.x)/q.x/x),colEnd:Math.floor((u.xmax-r.x-q.x)/q.x/x)};if(u=this.halfWorldWidth){t=Math.ceil(u/q.x/(x/2));var w=this.tileInfo.applyGCS360Transform?
360:u,z=Math.round(x-(w-r.x)/q.x%x);z===x&&(z=0);this.fullBoundary.colRange=t;this.fullBoundary.paddingRight=z;this.fullBoundary.paddingLeft=Math.round((t*x*q.x+r.x-w-(this.tileInfo.applyGCS360Transform?0:r.x+u))/q.x)}this.hasNewData=!0}},getXformGrid:function(){var g=this.mapExtent,e=this.layer._hasTilingEffects?this.extent:this.fullExtent,q=this.layer.getCurrentResolution(),u=JSON.stringify(g.toJson())+JSON.stringify(e.toJson());this._datumTransformationInitialized||(this._datumTransformationInitialized=
!0,this._datumTransformation=l.getDefaultDatumTransformationForDataset(this.layer.raster.rasterInfo.extent,g.spatialReference,!0));this._cachedExtentString&&this._cachedExtentString===u||(this._cachedExtentString=u,this._xformGrid=g=l.getProjectionOffsetGrid(g,e,q,this.tileInfo.applyGCS360Transform,this.halfWorldWidth,this._datumTransformation));g=this._xformGrid;this.xformSetting.meshSize=g&&g.size;return g},getWrapTimes:function(g){var e=l.getHalfWorldWidth(g.spatialReference);if(!e)return 0;var q=
2*e;e=this.tileInfo.applyGCS360Transform?0:-e;return Math.floor((g.xmax-e)/q)-Math.floor((g.xmin-e)/q)},normalizeCoordinate:function(g,e){if(!e)return 0;var q=2*e;if(0<g){for(;g>e;)g-=q;return g}for(;g<-e;)g+=q;return g},resetTiles:function(){this.tiles.forEach(n.hitch(this,function(g){g.fetch&&!g.fetch.isCanceled()&&g.fetch.cancel();g.update&&!g.update.isCanceled()&&g.update.cancel()}));this.tiles.length=0},updateExtent:function(g,e){this.mapExtent=this.extent=g;var q=this.xformSetting.requireProjection;
if(q){this.extent=l.project(g,this.tileInfo.spatialReference,this.tileInfo.applyGCS360Transform);if(!this.extent)return;this.extent.spatialReference=new d(this.extent.spatialReference.toJson())}this.updateResolution(e,g);var u=this.extent,r=this.tileInfo,x=r.cols,t=r.rows;e=this.resolution;var w=u,z=q?this.layer.raster.rasterInfo.extent:this.layer.raster.projectedFullExtent;this.ooe&&(w=this._getIntersect(u,z));var B=Math.floor((w.xmin-r.origin.x)/e.x/x)-this.prefetchBufferSize,A=Math.floor((w.xmax-
r.origin.x)/e.x/x)+this.prefetchBufferSize,y=null,E=this.getWrapTimes(g),G=this.fullBoundary&&this.fullBoundary.colRange;E&&this.halfWorldWidth&&(A===B&&(y=B),A+=E*G);if(q=this.halfWorldWidth&&this.tiles.length&&(E!==this.wrapTimes||y!==this._circlularColId))this._wrapSwitchCount=this._wrapSwitchCount?this._wrapSwitchCount+1:1;this.wrapTimes=E;this._circlularColId=y;var F=Math.floor((r.origin.y-w.ymax)/e.y/t)-this.prefetchBufferSize;y=Math.floor((r.origin.y-w.ymin)/e.y/t)+this.prefetchBufferSize;
this.tileBoundary={rowStart:F,rowEnd:y,colStart:B,colEnd:A};var D,L;((w=(y-F+1)*(A-B+1)>this._MAX_TILES||!this.virtual&&this._resolution.x>8*this.tileInfo.lods[0].resolution)||2<E||q)&&this.resetTiles();if(!(w||2<E)){w=this.tiles;q=!1;for(D=w.length-1;0<=D;D--){var O=w[D].row;var S=w[D].wrapCol;if(O<F||O>y||S<B||S>A)w[D].fetch&&!w[D].fetch.isCanceled()&&w[D].fetch.cancel(),w[D].update&&!w[D].update.isCanceled()&&w[D].update.cancel(),w.splice(D,1),q=!0}for(D=F;D<=y;D++)for(L=B;L<=A;L++){F=new f(r.origin.x+
e.x*x*L,r.origin.y-e.y*t*(D+1),r.origin.x+e.x*x*(L+1),r.origin.y-e.y*t*D,u.spatialReference);var Z=E&&G?0<=L?L%G:G- -L%G:L;O=k(w,function(I){return I.row===D&&I.col===Z&&I.wrapCol===L});S=z.xmax>=F.xmax?x:Math.round((z.xmax-F.xmin)/e.x);-1===O&&(w.push({row:D,col:Z,wrapCol:L,cellsizeX:e.x,cellsizeY:e.y,width:x,height:t,actualWidth:S,extent:F,normalizedExtent:this._wrapExtent(F,Z),pixelBlock:null,virtual:this.virtual,level:this.level,tileType:this.tileInfo.tileType||"Raster"}),q=!0)}q&&this._sortTiles();
r=this.tileInfo.rows*(this.tileBoundary.rowEnd-this.tileBoundary.rowStart+1);this.width=this.tileInfo.cols*(this.tileBoundary.colEnd-this.tileBoundary.colStart+1);this.height=r;this.count=w.length;r=Math.min.apply(null,w.map(function(I){return I.extent.xmin}));x=Math.max.apply(null,w.map(function(I){return I.extent.xmax}));t=Math.min.apply(null,w.map(function(I){return I.extent.ymin}));z=Math.max.apply(null,w.map(function(I){return I.extent.ymax}));r=this.fullExtent=new f(r,t,x,z,u.spatialReference);
if(this.layer.roaming||this.layer.useWebGL)this.layer._hasTilingEffects?(this.xformSetting.offset=[0,0],this.xformSetting.scale=[1,1]):(q&&(this._tilesChanged=!0),this.xformSetting.offset=[(u.xmin-r.xmin)/(r.xmax-r.xmin),-(r.ymin-u.ymin)/(r.ymax-r.ymin)],this.xformSetting.scale=[(u.xmax-u.xmin)/(r.xmax-r.xmin),(u.ymax-u.ymin)/(r.ymax-r.ymin)])}},fetchTiles:function(g){(this._tilesChanged||g)&&this._fetchTiles(g)},_fetchTiles:function(g){this._fetchCounter=0;var e=this.extent;this.fetchAllCompleted=
g?new v:null;(this._tilesChanged||g&&this.layer._hasTilingEffects)&&this.tiles.forEach(n.hitch(this,function(u){u.updateCompleted=!1}));var q={};!this.layer.roaming&&this.layer._hasTilingEffects&&g?(this.identifiers.forEach(function(u,r){q[u]={extent:this.extent,pixelBlock:new c({width:this.layer._map.width,height:this.layer._map.height,pixels:[],pixelType:"",mask:null,statistics:[]})}}.bind(this)),this.originalPixelData={extent:this.extent,src:q,isEmpty:!0}):this._tilesChanged&&(this.identifiers.forEach(function(u,
r){q[u]={extent:this.fullExtent,pixelBlock:new c({width:128,height:128,pixels:[],pixelType:"",mask:null,statistics:[]})}}.bind(this)),this.originalPixelData={extent:this.fullExtent,src:q,isEmpty:!0});this.tiles.forEach(n.hitch(this,function(u){if(u.fetch)u.update||(u.update=this.updateTile(u));else{if(this._isTileOutSide(u,e)){u.updateCompleted=!0;return}this._requestTile(u)}this.layer.roaming&&this.layer.useWebGL?this._fillPixelData(u):u.src&&g&&(this.layer._hasTilingEffects||this.layer.useWebGL)&&
(this._fillPixelData(u),this.layer._hasTilingEffects&&(u.updateCompleted=!0),u.processedPixelBlock=null,u.renderedPixelBlock=null)}));0===this._fetchCounter&&(this._fetched=!0);this._tilesChanged=!1;g&&this._updateFetchStatus()},updateTile:function(g,e){var q=new v;if(!g.src&&!g.fetch)return q.resolve(g),q.promise;b(g.src||g._fetched||g.fetch,n.hitch(this,function(){var u=this.layer.tileMode&&this.layer._rasterHandler&&!(this.layer._hasTilingEffects||this.layer.useWebGL),r=this.layer._drawTile,x=
this._validateRawPixelBlocks(g);this.layer._hasTilingEffects&&!this.layer.useWebGL&&(r=r&&(this._progressiveGlobal||e));if((e||!e&&x)&&(u||r||this.layer.roaming)){if(this.xformSetting.requireProjection&&this.layer.useWebGL&&(this.xformSetting.gridConfig=this.getXformGrid(),null==this.xformSetting.gridConfig))return q.cancel(),q.promise;this._processTile(g,e).then(n.hitch(this,function(t){q.isCanceled()||this._renderTile(t,e).then(n.hitch(this,function(w){this.hasNewData=!1;q.isCanceled()||q.resolve(w)}))}))}else e||
x||(g.updateCompleted=!0),this.layer.useWebGL||this.layer._hasTilingEffects?q.resolve(this.originalPixelData):q.resolve()}));return q.promise},setLayer:function(g){this.layer=g},fillupTiles:function(){this.tiles.forEach(n.hitch(this,function(g){g.update&&g.updateCompleted&&!g.filled&&(g.updateCompleted=!1,this._fillPixelData(g),g.updateCompleted=!0)}))},_validateRawPixelBlocks:function(g){return g&&g.src&&!this.identifiers.some(function(e){return!(g.src[e].pixelBlock&&0!==g.src[e].pixelBlock.validPixelCount&&
g.src[e].pixelBlock.pixels&&0<g.src[e].pixelBlock.pixels.length)})},_wrapExtent:function(g,e){if(g){if(this.tileInfo.applyGCS360Transform){var q=this.normalizeCoordinate(g.xmin,180);0>q&&(q+=360);return new f({xmin:q,ymin:g.ymin,xmax:g.xmax-g.xmin+q,ymax:g.ymax,spatialReference:g.spatialReference})}if(this.halfWorldWidth){q=null!=e?new f({xmin:this.tileInfo.origin.x+this.tileInfo.cols*e*this.resolution.x,ymin:g.ymin,xmax:this.tileInfo.origin.x+this.tileInfo.cols*(e+1)*this.resolution.x,ymax:g.ymax,
spatialReference:g.spatialReference}):new f({xmin:g.xmin,ymin:g.ymin,xmax:g.xmax,ymax:g.ymax,spatialReference:g.spatialReference});var u=this.normalizeCoordinate(q.xmin,this.halfWorldWidth),r=u-q.xmin;.01<Math.abs(r)&&(q.xmin=u,q.xmax+=r)}return q||g}},_getIntersect:function(g,e){return new f(Math.max(g.xmin,e.xmin),Math.max(g.ymin,e.ymin),Math.min(g.xmax,e.xmax),Math.min(g.ymax,e.ymax),g.spatialReference)},_isTileOutSide:function(g,e){var q=!1;if(g.virtual){var u=g.normalizedExtent;if(e=e||(this.xformSetting.requireProjection?
this.layer.raster.rasterInfo.extent:this.layer.raster.projectedFullExtent)){q=u.xmin-this.prefetchBufferSize*this.tileInfo.cols*this.resolution.x;var r=u.ymin-this.prefetchBufferSize*this.tileInfo.rows*this.resolution.y;var x=u.xmax+this.prefetchBufferSize*this.tileInfo.cols*this.resolution.x;u=u.ymax+this.prefetchBufferSize*this.tileInfo.rows*this.resolution.y;q=x<=e.xmin||q>=e.xmax||u<=e.ymin||r>=e.ymax}else q=!1}else q=0>g.level||g.row<this.fullBoundary.rowStart||g.row>this.fullBoundary.rowEnd||
g.col<this.fullBoundary.colStart||g.col>this.fullBoundary.colEnd;return q},_resolutionEqual:function(g,e){return g===e||g&&e&&Math.abs(g-e)<Math.abs(e/1E4)?!0:!1},_requestTile:function(g){var e=this.identifiers,q;if(this._isTileOutSide(g)){var u=new v;g.updateCompleted=!0;u.resolve(null);u=u.promise}else u=this.layer.raster.rasterFunction?new p(this.layer.raster.getMemberRasters().map(function(r){return r.read(g)})):new p([this.layer.raster.read(g)]);g.fetch=u;this._fetchCounter++;b(g.src||g._fetched||
u,n.hitch(this,function(r){if(q=r&&r.some(function(t){return t[0]})){var x={};r.forEach(function(t,w){x[e[w]]=t[0]&&t[1]?{extent:t[1].extent,pixelBlock:t[1].pixelBlock,width:t[1].width,height:t[1].height}:null});g.src=x}else g.src=null;this._fetchCounter--;0===this._fetchCounter&&(this._fetched=!0);g._fetched=!0;this._updateFetchStatus()}),n.hitch(this,function(){this._fetchCounter--;0===this._fetchCounter&&(this._fetched=!0);g._fetched=!0;this._updateFetchStatus()}));g.update=this.updateTile(g)},
_updateFetchStatus:function(){this.layer._drawTile&&this.fetchAllCompleted&&!this.fetchAllCompleted.isResolved()&&!this.tiles.some(function(g){return!g._fetched})&&(this.tiles.forEach(n.hitch(this,function(g){this._fillPixelData(g)})),this.fetchAllCompleted.resolve())},_fillPixelData:function(g,e){if(g&&!g.updateCompleted)if(Math.abs(g.cellsizeX-this.resolution.x)>g.cellsizeX/10)g.updateCompleted=!0;else if(!1===this._validateRawPixelBlocks(g))g.updateCompleted=!0;else{var q=g.extent;if(this.layer.roaming||
this.layer.useWebGL&&!this.layer._hasTilingEffects){var u=this.fullExtent;var r=this.tileInfo.cols*(this.tileBoundary.colEnd-this.tileBoundary.colStart+1);var x=this.tileInfo.rows*(this.tileBoundary.rowEnd-this.tileBoundary.rowStart+1);e?this.originalPixelData.renderedPixelBlock||(this.originalPixelData.renderedPixelBlock=new c({width:r,height:x,pixels:[],pixelType:"",mask:null,statistics:[]})):this.identifiers.forEach(n.hitch(this,function(w){this.originalPixelData.src[w].pixelBlock.width=r;this.originalPixelData.src[w].pixelBlock.height=
x}))}else u=this.extent,r=this.layer._map.width,x=this.layer._map.height,e?this.originalPixelData.renderedPixelBlock||(this.originalPixelData.renderedPixelBlock=new c({width:r,height:x,pixels:[],pixelType:"",mask:null,statistics:[]})):this.identifiers.forEach(n.hitch(this,function(w){this.originalPixelData.src[w].pixelBlock.width=r;this.originalPixelData.src[w].pixelBlock.height=x}));if(u.xmax<=q.xmin||u.xmin>=q.xmax||u.ymax<=q.ymin||u.ymin>=q.ymax)return null;var t=this.originalPixelData.isEmpty=
!1;this.identifiers.forEach(n.hitch(this,function(w){g.src&&(this._fillPixelBlock(g.src[w],this.originalPixelData.src[w],{extent:u,width:r,height:x,normalizedExtent:g.normalizedExtent},!1),t=!0)}));g.filled=t;this.hasNewData=!0}},_fillPixelBlock:function(g,e,q,u){var r=g.extent,x=q.extent;u=q.width;var t=q.height;if(g.pixelBlock&&g.pixelBlock.pixels&&g.pixelBlock.pixels[0]){var w=(r.xmax-r.xmin)/g.width,z=Math.max(r.xmin,x.xmin),B=Math.min(r.ymax,x.ymax),A=Math.round((z-r.xmin)/w),y=g.width-Math.round(Math.abs(r.xmax-
Math.min(r.xmax,x.xmax))/w),E=Math.round(Math.abs(r.ymax-B)/w),G=g.height-Math.round((Math.max(r.ymin,x.ymin)-r.ymin)/w),F=this.halfWorldWidth;z=Math.round((z-x.xmin)/w);q=q.normalizedExtent;if(!(this.wrapTimes&&F&&r.xmin<-F)){if(this.wrapTimes&&F){if(this.tileInfo.applyGCS360Transform)360<r.xmin&&(z-=this.fullBoundary.paddingLeft);else if(r.xmin>F){z-=this.fullBoundary.paddingLeft;var D=this.normalizeCoordinate(r.xmin,F);var L=this.normalizeCoordinate(r.xmax,F)}else D=r.xmin,L=r.xmax;this.tileInfo.applyGCS360Transform?
q&&360>q.xmin&&360<q.xmax&&(y-=this.fullBoundary.paddingRight):q&&q.xmin<F&&q.xmax>F?y-=this.fullBoundary.paddingRight:D<F&&L>F&&(y-=this.fullBoundary.paddingRight)}D=Math.round(Math.abs(x.ymax-B)/w);L=g.pixelBlock.pixels.length;e=e.pixelBlock;q=g.width;r=e.mask||new Uint8Array(u*t);var O=g.pixelBlock,S=O.mask,Z=0;for(w=0;w<L;w++){B=O.pixels[w];F=e.pixels[w]||new B.constructor(u*t);for(g=E;g<G;g++)for(Z=(D+g-E)*u+z,x=A;x<y;x++)F[Z+x-A]=B[g*q+x];e.pixels[w]=F}if(S)for(g=E;g<G;g++)for(Z=(D+g-E)*u+z,
x=A;x<y;x++)r[Z+x-A]=S[g*q+x];else for(g=E;g<G;g++)for(Z=(D+g-E)*u+z,x=A;x<y;x++)r[Z+x-A]=1;e.pixelType=e.pixelType||O.pixelType;e.mask=r;if(!(e.statistics&&0<e.statistics.length))for(e.statistics=[],g=0;g<O.statistics.length;g++)e.statistics[g]={minValue:O.statistics[g].minValue,maxValue:O.statistics[g].maxValue};else if(O.statistics&&e.statistics)for(g=0;g<e.statistics.length;g++)e.statistics[g].minValue=Math.min(O.statistics[g].minValue,e.statistics[g].minValue),e.statistics[g].maxValue=Math.max(O.statistics[g].maxValue,
e.statistics[g].maxValue)}}},_processTile:function(g,e){var q=new v,u=this.layer._hasTilingEffects,r=this.layer.useWebGL,x=u||r,t=this.layer.raster.rasterFunction&&g&&(u||r||!g.processedPixelBlock);if(e)var w=g;else this._fillPixelData(g),w=x?this.originalPixelData:g;this.xformSetting.hasNewTexture=this.hasNewData;var z;t?(this.identifiers.forEach(function(B){if(0===w.src[B].pixelBlock.pixels.length||0===w.src[B].pixelBlock.pixels[0].length)z=!0}),z?q.resolve({extent:w.extent,processedPixelBlock:w.src[this.identifiers[0]],
pixelBlock:w.src[this.identifiers[0]]}):r?(this.processedPixelData=this.layer.raster.rasterFunction.read(w),q.resolve(this.processedPixelData)):this.layer._rasterHandler?this.layer._rasterHandler.process({extent:w.extent,src:w.src}).then(function(B){u?(this.processedPixelData=B,q.resolve(this.processedPixelData)):(g.processedPixelBlock=B.pixelBlock,q.resolve(g))}):(r=this.layer.raster.rasterFunction.read(g),g.processedPixelBlock=r.pixelBlock,q.resolve(g))):x?q.resolve(w.src[this.identifiers[0]]):
(g.pixelBlock=w.src[this.identifiers[0]]&&w.src[this.identifiers[0]].pixelBlock,q.resolve(g));return q.promise},_renderTile:function(g){var e=new v,q=this.layer._hasTilingEffects,u=this.layer.useWebGL,r=Math.abs((g.extent.xmax-g.extent.xmin)/g.width-this.layer.getCurrentResolution().x)>this.resolution.x/10;r=this.layer.useWebGL&&(r||this._isTileOutSide(g,this.layer._map.extent));this.xformSetting.hasNewTexture=this.hasNewData;this.layer._rasterRenderer&&g&&(g.texture||g.src||g.pixelBlock||g.processedPixelBlock)?
(this.layer._rasterRenderer.interpolation=this.layer.interpolation,u&&!r?(this.layer.raster.rasterFunction&&this.layer.raster.rasterFunction.renderTexture||this.layer._rasterRenderer.draw(g),e.resolve(g)):this.layer._rasterHandler?this.layer._rasterHandler.render({extent:g.extent,pixelBlock:g.processedPixelBlock||g.pixelBlock}).then(function(x){q?(x.renderedPixelBlock=x.pixelBlock,e.resolve(x)):(g.renderedPixelBlock=x.pixelBlock,e.resolve(g))}.bind(this)):(g.renderedPixelBlock=this.layer._rasterRenderer.draw(g).pixelBlock,
e.resolve(g))):(g.renderedPixelBlock=g.processedPixelBlock||g.pixelBlock,e.resolve(g));return e.promise},_sortTiles:function(){this.tiles.sort(function(g,e){return g.row<e.row||g.row==e.row&&g.col<e.col?-1:1})}})})},"esri/virtualearth/VETiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/_base/config dojo/has dojo/string dojo/_base/Deferred ../kernel ../urlUtils ../SpatialReference ../layers/TileInfo ../layers/TiledMapServiceLayer ../geometry/Extent ../request".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q){m=m(g,{declaredClass:"esri.virtualearth.VETiledLayer",constructor:function(u){try{if(u=n.mixin({bingMapsKey:null,culture:"en-US"},u||{}),this.url=h.getProtocolForWebResource()+"//dev.virtualearth.net/REST/v1",this._url=h.urlToObject(this.url),this.spatialReference=new l({wkid:102100}),this.tileInfo=new k({rows:256,cols:256,dpi:96,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},
{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,
scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,
scale:1128.497176},{level:20,resolution:.1492910708238085,scale:564.248588}]}),this.initialExtent=this.fullExtent=new e(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new l({wkid:102100})),n.mixin(this,u),this.hasAttributionData=this.showAttribution,this._initLayer=n.hitch(this,this._initLayer),this._errorHandler=n.hitch(this,this._errorHandler),this._getTileInfo=n.hitch(this,this._getTileInfo),this.bingMapsKey)this._getTileInfo();else throw Error("BingMapsKey must be provided.");
}catch(r){throw this.onError(r),r;}},_unsetMap:function(u,r){this.inherited("_unsetMap",arguments)},_getTileInfo:function(){if(this.mapStyle){var u=this._url.path+"/Imagery/Metadata/"+this.mapStyle,r=window.location.protocol;if(this.bingMapsKey){var x=this.resourceInfo;!this.loaded&&x?this._initLayer(x):q({url:u,content:n.mixin({},{uriScheme:"https:"===r?"https":"http",key:this.bingMapsKey,ss:!0,c:this.culture,include:this.hasAttributionData?"imageryProviders":null}),callbackParamName:"jsonp",load:this._initLayer,
error:this._errorHandler})}}},_initLayer:function(u,r){if(200!==u.statusCode){var x=Error();x.code=u.statusCode;x.message=u.statusDescription;x.details=u.errorDetails;x.authenticationResultCode=u.authenticationResultCode;this.onError(x)}else try{this.resourceInfo=v.toJson(u);x=u.resourceSets[0].resources[0];var t=x.imageUrl.replace("{","${");this.tileServers=b.map(x.imageUrlSubdomains,function(z){var B=h.getProtocolForWebResource();return d.substitute(t,{subdomain:z}).replace("http:",B)});this._tsLength=
this.tileServers.length;if(this.loaded)this.refresh(),this.onMapStyleChange();else{this.copyright=this.copyright||"\x26copy; 2017 Microsoft Corporation and its data suppliers";this.loaded=!0;this.onLoad(this);var w=this.loadCallback;w&&(delete this.loadCallback,w(this))}}catch(z){this.onError(z)}},getAttributionData:function(){var u=new a,r=v.fromJson(this.resourceInfo),x;this.hasAttributionData&&r&&(x=n.getObject("resourceSets.0.resources.0.imageryProviders",!1,r));x?u.callback({contributors:x}):
(r=Error("Layer does not have attribution data"),r.log=p.isDebug,u.errback(r));return u},getTileUrl:function(u,r,x){return d.substitute(this.tileServers[r%this._tsLength].replace(/\{/g,"${"),{quadkey:this._getQuadKey(u,r,x),culture:this.culture,token:this.bingMapsKey})},_getQuadKey:function(u,r,x){var t="",w;for(w=u;0<w;w--){u="0";var z=1<<w-1;0!=(x&z)&&u++;0!=(r&z)&&(u++,u++);t+=u}return t},setMapStyle:function(u){this.mapStyle=u;this._getTileInfo()},setCulture:function(u){this.culture=u;this._getTileInfo()},
setBingMapsKey:function(u){this.bingMapsKey=u},onMapStyleChange:function(){}});n.mixin(m,{MAP_STYLE_AERIAL:"aerial",MAP_STYLE_AERIAL_WITH_LABELS:"aerialWithLabelsOnDemand",MAP_STYLE_ROAD:"roadOnDemand"});n.setObject("virtualearth.VETiledLayer",m,c);return m})},"esri/dijit/Attribution":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-style dojo/dom-class dojo/dom-geometry ../kernel ../lang ../SpatialReference ../geometry/webMercatorUtils ../geometry/Extent".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x){m=m(null,{declaredClass:"esri.dijit.Attribution",itemDelimiter:" | ",listClass:"esriAttributionList",itemClass:"esriAttributionItem",lastItemClass:"esriAttributionLastItem",delimiterClass:"esriAttributionDelim",constructor:function(t,w){try{n.mixin(this,t);this._attributions={};this._pendingDfds={};this._activeLayers=[];this._sharedLayers=[];this._layerHandles={};var z=this.domNode=a.byId(w),B=this.map,A="\x3cspan class\x3d'"+this.listClass+"'\x3e\x3c/span\x3e";
z&&(c.set(z,"innerHTML",A),this.listNode=p.query(".esriAttributionList",z)[0],this.itemNodes={});this._eventConnections=[b.connect(B,"onLayerAdd",this,this._onLayerAdd),b.connect(B,"onLayerRemove",this,this._onLayerRemove),b.connect(B,"onLayerSuspend",this,this._onLayerSuspend),b.connect(B,"onLayerResume",this,this._onLayerResume),b.connect(B,"onResize",this,this._adjustFocus),b.connect(B,"onExtentChange",this,this._onExtentChange)];if(B.loaded){var y=B.layerIds.concat(B.graphicsLayerIds),E,G=y.length;
for(E=0;E<G;E++){var F=B.getLayer(y[E]);F.loaded&&this._onLayerAdd(F)}}}catch(D){}},startup:function(){},destroy:function(){v.forEach(this._eventConnections,b.disconnect);h.destroy(this.listNode);var t=this._layerHandles,w;for(w in t)t[w]&&t[w].remove();this.map=this.domNode=this._eventConnections=this.listNode=this._attributions=this._pendingDfds=this.itemNodes=this._activeLayers=this._lastItem=this._sharedLayers=this._layerHandles=null},_onLayerAdd:function(t){try{var w=this._attributions,z=t.id;
if(!q.isDefined(w[z])&&t.showAttribution){if(t.hasAttributionData){var B=t.getAttributionData();this._pendingDfds[z]=1;w[z]=B;B.addBoth(n.partial(this._onAttributionLoad,this,t))}else w[z]=t.copyright||t.copyrightText||"",w[z]?(t.suspended||this._activeLayers.push(z),this._createNode(z)):this._onLayerRemove(t);-1<t.declaredClass.toLowerCase().indexOf("vetiledlayer")&&(this._layerHandles[z]=t.on("map-style-change",n.hitch(this,function(){this._onLayerRemove(t);this._onLayerAdd(t)})))}}catch(A){}},
_onAttributionLoad:function(t,w,z){var B=t._attributions,A=t._pendingDfds,y=w.id;if(A&&A[y]){delete A[y];if(!z||z instanceof Error)z="";B[y]=z?t._createIndexByLevel(z,-1!==w.declaredClass.toLowerCase().indexOf("vetiledlayer")):w.copyright||w.copyrightText||"";B[y]?(w.suspended||t._activeLayers.push(y),t._createNode(y)):t._onLayerRemove(w)}},_onLayerRemove:function(t){try{var w=t.id,z=this.itemNodes,B=-1;this._onLayerSuspend(t);this._layerHandles[w]&&this._layerHandles[w].remove();delete this._attributions[w];
delete this._pendingDfds[w];delete this._layerHandles[w];var A=this._getGroupIndex(w);-1!==A&&(B=v.indexOf(this._sharedLayers[A],w),-1!==B&&(this._sharedLayers[A].splice(B,1),1>=this._sharedLayers[A].length&&this._sharedLayers.splice(A,1)));z[w]&&-1===B&&h.destroy(z[w]);delete z[w];this._updateLastItem()}catch(y){}},_onLayerSuspend:function(t){try{var w=t.id;if(this._attributions[w]){var z=v.indexOf(this._activeLayers,w),B=this.itemNodes[w];-1!==z&&this._activeLayers.splice(z,1);B&&this._toggleItem(B,
!1,this._getGroupIndex(w))}}catch(A){}},_adjustFocus:function(){var t=this.domNode.scrollWidth>this.domNode.clientWidth,w=k.contains(this.domNode,"esriAttributionOpen");c.set(this.domNode,"tabIndex",t||w?"0":"")},_onLayerResume:function(t){try{var w=t.id,z=this._attributions[w],B=this.itemNodes[w];if(z&&(-1===v.indexOf(this._activeLayers,w)&&this._activeLayers.push(w),B)){var A=n.isString(z)?z:this._getContributorsList(z,this.map.extent,this.map.getLevel());n.isString(z)||c.set(B,"innerHTML",A?A+
this._getDelimiter():"");A&&this._toggleItem(B,!0,this._getGroupIndex(w))}}catch(y){}},_onExtentChange:function(t,w,z,B){try{var A=this._activeLayers,y=this._attributions,E=this.itemNodes,G,F,D=A.length||0;for(F=0;F<D;F++){var L=A[F];var O=y[L];if((G=E[L])&&!n.isString(O)){var S=this._getContributorsList(O,t,B?B.level:-1);c.set(G,"innerHTML",S?S+this._getDelimiter():"");this._toggleItem(G,!!S,-1)}}}catch(Z){}this._adjustCursorStyle()},_createNode:function(t){if(this.domNode){var w=this._checkShareInfo(t),
z=w&&w.sharedWith;z=z&&this.itemNodes[z];var B=this.map,A=this._attributions[t];A=n.isString(A)?A:this._getContributorsList(A,B.extent,B.getLevel());B=!!A&&!B.getLayer(t).suspended;z?(this.itemNodes[t]=z,this._toggleItem(z,B,w.index)):(t=this.itemNodes[t]=h.create("span",{"class":this.itemClass,innerHTML:A?A+this._getDelimiter():"",style:{display:B?"inline":"none"}},this.listNode),B&&this._setLastItem(t));this._adjustCursorStyle()}},_checkShareInfo:function(t){var w=this._attributions,z,B=-1,A=w[t];
if(A&&n.isString(A)){for(z in w){var y=w[z];if(z!==t&&y&&n.isString(y)&&y.length===A.length&&y.toLowerCase()===A.toLowerCase()){var E=z;break}}w=this._sharedLayers;y=w.length;if(E){for(z=0;z<y;z++)if(A=w[z],-1!==v.indexOf(A,E)){B=z;A.push(t);break}-1===B&&(B=w.push([E,t])-1)}}return-1<B?{index:B,sharedWith:E}:null},_getGroupIndex:function(t){var w=this._sharedLayers,z,B=w.length,A=-1;for(z=0;z<B;z++)if(-1!==v.indexOf(w[z],t)){A=z;break}return A},_getDelimiter:function(){var t=this.itemDelimiter;return t?
"\x3cspan class\x3d'"+this.delimiterClass+"'\x3e"+t+"\x3c/span\x3e":""},_toggleItem:function(t,w,z){if(-1<z&&!w){z=this._sharedLayers[z];var B,A=z.length,y=this._activeLayers;for(B=0;B<A;B++)if(-1!==v.indexOf(y,z[B]))return}l.set(t,"display",w?"inline":"none");this._updateLastItem()},_updateLastItem:function(){var t=this.listNode.childNodes;var w=t.length;if(w)for(--w;0<=w;w--){var z=t[w];if("none"!==l.get(z,"display")){this._setLastItem(z);break}}this._adjustCursorStyle()},_setLastItem:function(t){var w=
this.itemClass,z=this.lastItemClass;this._lastItem&&k.replace(this._lastItem,w,z);t&&(k.replace(t,z,w),this._lastItem=t)},_createIndexByLevel:function(t,w){var z=t.contributors,B,A,y=z?z.length:0,E,G=new u(4326),F={};for(A=0;A<y;A++){var D=z[A];var L=(B=D.coverageAreas)?B.length:0;for(E=0;E<L;E++){var O=B[E];var S=O.bbox;S={extent:r.geographicToWebMercator(new x(S[1],S[0],S[3],S[2],G)),attribution:D.attribution||"",zoomMin:O.zoomMin-(w&&O.zoomMin?1:0),zoomMax:O.zoomMax-(w&&O.zoomMax?1:0),score:q.isDefined(O.score)?
O.score:100,objectId:A};for(O=S.zoomMin;O<=S.zoomMax;O++)F[O]=F[O]||[],F[O].push(S)}}return F},_getContributorsList:function(t,w,z){var B="";if(w&&q.isDefined(z)&&-1<z){t=t[z];z=w.getCenter().normalize();var A=t?t.length:0,y=[],E={};for(B=0;B<A;B++)w=t[B],!E[w.objectId]&&w.extent.contains(z)&&(E[w.objectId]=1,y.push(w));y.sort(function(G,F){return F.score-G.score||G.objectId-F.objectId});A=y.length;for(B=0;B<A;B++)y[B]=y[B].attribution;B=y.join(", ")}return B},_adjustCursorStyle:function(){var t=
g.position(this.listNode.parentNode,!0).h;k.contains(this.listNode.parentNode,"esriAttributionOpen")?(k.remove(this.listNode.parentNode,"esriAttributionOpen"),t>g.position(this.listNode.parentNode,!0).h?(l.set(this.listNode.parentNode,"cursor","pointer"),k.add(this.listNode.parentNode,"esriAttributionOpen")):l.set(this.listNode.parentNode,"cursor","default")):(k.add(this.listNode.parentNode,"esriAttributionOpen"),t<g.position(this.listNode.parentNode,!0).h?l.set(this.listNode.parentNode,"cursor",
"pointer"):l.set(this.listNode.parentNode,"cursor","default"),k.remove(this.listNode.parentNode,"esriAttributionOpen"));this._adjustFocus()}});n.setObject("dijit.Attribution",m,e);return m})},"esri/dijit/TimeSlider":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/kernel dojo/has dojo/dom-class dojo/dom-construct dojo/dom-style dojo/dom-geometry dijit/_Widget dijit/_Templated dijit/form/HorizontalSlider dijit/form/HorizontalRule dijit/form/HorizontalRuleLabels dojox/timing/_base dojox/form/RangeSlider dojo/text!dojox/form/resources/HorizontalRangeSlider.html ../kernel ../lang ../TimeExtent ./_EventedWidget dojo/text!./templates/TimeSlider.html dojo/i18n!../nls/jsapi".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x,t,w,z,B,A){p=m([z,h,l],{declaredClass:"esri.dijit.TimeSlider",widgetsInTemplate:!0,templateString:B,intermediateChanges:!1,_slideDuration:1E3,_defaultCount:10,_eventMap:{"time-extent-change":!0,play:!0,pause:!0,next:!0,previous:!0},constructor:function(y,E){n.mixin(this,A.widgets.timeSlider);this._iconClass="tsButton tsPlayButton";this.loop=this.playing=!1;this.thumbCount=1;this.thumbMovingRate=1E3;this._createTimeInstants=!1;this._options=n.mixin({excludeDataAtTrailingThumb:!1,
excludeDataAtLeadingThumb:!1},y.options||{})},postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments);this._timer=new q.Timer;this._timer.setInterval(this.thumbMovingRate);this._timer.onTick=n.hitch(this,"_bumpSlider",1);this._createSlider()},destroy:function(){this._timer.stop();this.timeStops=this._timer=null;this._slider.destroy();this._slider=null;this._hTicks&&(this._hTicks.destroyRecursive(),this._hTicks=null);this._hLabels&&(this._hLabels.destroyRecursive(),
this._hLabels=null);this.inherited(arguments)},onTimeExtentChange:function(){},onPlay:function(){},onPause:function(){},onNext:function(){},onPrevious:function(){},_onHorizontalChange:function(){var y=this._sliderToTimeExtent();this.onTimeExtentChange(y)},_onPlay:function(){this.playing=!this.playing;this._updateUI();this.playing?(this._timer.start(),this.onPlay(this._sliderToTimeExtent())):(this._timer.stop(),this.onPause(this._sliderToTimeExtent()));var y=this._getSliderValue();this._offset=n.isArray(y)?
y[1]-y[0]:0},_onNext:function(){this.playing||(this._bumpSlider(1),this.onNext(this._sliderToTimeExtent()))},_onPrev:function(){this.playing||(this._bumpSlider(-1),this.onPrevious(this._sliderToTimeExtent()))},createTimeStopsByCount:function(y,E){y&&y.startTime&&y.endTime&&(E=E||this._defaultCount,this.createTimeStopsByTimeInterval(y,Math.ceil((y.endTime-y.startTime)/(E-1)),"esriTimeUnitsMilliseconds"))},createTimeStopsByTimeInterval:function(y,E,G,F){if(y&&y.startTime&&y.endTime){this.fullTimeExtent=
new w(y.startTime,y.endTime);F&&!0===F.resetStartTime&&this._resetStartTime(this.fullTimeExtent,G);this._timeIntervalUnits=G;F=this.fullTimeExtent.startTime;for(var D=[];F<=y.endTime;)D.push(F),F=y._getOffsettedDate(F,E,G);0<D.length&&D[D.length-1]<y.endTime&&D.push(F);this.setTimeStops(D)}},getCurrentTimeExtent:function(){return this._sliderToTimeExtent()},setTimeStops:function(y){this.timeStops=y||[];this._numTicks=this._numStops=this.timeStops.length;!1===t.isDefined(this.fullTimeExtent)&&(this.fullTimeExtent=
new w(y[0],y[y.length-1]))},setLoop:function(y){this.loop=y},setThumbCount:function(y){this.thumbCount=y;this.singleThumbAsTimeInstant(this._createTimeInstants);this._slider&&this._createSlider()},setThumbIndexes:function(y){this.thumbIndexes=n.clone(y)||[0,1];this._initializeThumbs()},setThumbMovingRate:function(y){this.thumbMovingRate=y;this._timer&&this._timer.setInterval(this.thumbMovingRate)},setLabels:function(y){this.labels=y;this._slider&&this._createSlider()},setTickCount:function(y){this._numTicks=
y;this._slider&&this._createSlider()},singleThumbAsTimeInstant:function(y){this._createTimeInstants=y&&1===this.thumbCount},next:function(){this._onNext()},pause:function(){this.playing=!1;this._updateUI();this._timer.stop()},play:function(){!0!==this.playing&&(this.playing=!1,this._onPlay())},previous:function(){this._onPrev()},_setIntermediateChangesAttr:function(y){this.intermediateChanges=!!y;this._slider&&this._slider.set("intermediateChanges",!!y)},_updateUI:function(){f.remove(this.playPauseBtn.iconNode,
this._iconClass);this._iconClass=this.playing?"tsButton tsPauseButton":"tsButton tsPlayButton";f.add(this.playPauseBtn.iconNode,this._iconClass);this.previousBtn.set("disabled",this.playing);this.nextBtn.set("disabled",this.playing)},_createSlider:function(){this._slider&&(this._slider.destroy(),this._slider=null);for(var y=this.domNode;y.parentNode&&!y.dir;)y=y.parentNode;y={onChange:n.hitch(this,"_onHorizontalChange"),showButtons:!1,discreteValues:this._numStops,slideDuration:this._slideDuration,
"class":"ts",dir:"ltr",intermediateChanges:this.intermediateChanges};this._ts=d.create("div",{},b.query(".tsTmp",this.domNode)[0],"first");this._timeSliderTicks=d.create("div",{},this._ts,"first");this._timeSliderLabels=d.create("div",{},this._ts);2===this.thumbCount?this._createRangeSlider(y):this._createSingleSlider(y);this.thumbIndexes=this.thumbIndexes||[0,1];this._createHorizRule();this._createLabels();!0===this._createTimeInstants&&b.query(".dijitSliderProgressBarH, .dijitSliderLeftBumper, .dijitSliderRightBumper",
this._ts).forEach(function(E){a.set(E,{background:"none"})});this._initializeThumbs();v.disconnect(this._onChangeConnect);this._onChangeConnect=v.connect(this._slider,"onChange",n.hitch(this,"_updateThumbIndexes"))},_createRangeSlider:function(y){this._isRangeSlider=!0;this._slider=new (m([k,u],{templateString:r}))(y,this._ts)},_createSingleSlider:function(y){this._isRangeSlider=!1;this._slider=new k(y,this._ts)},_createHorizRule:function(){this._hTicks&&(this._hTicks.destroyRecursive(),this._hTicks=
null);2>this._numTicks||(this._hTicks=new g({container:"topDecoration",ruleStyle:"","class":"tsTicks",count:this._numTicks},this._timeSliderTicks))},_createLabels:function(){this._hLabels&&(this._hLabels.destroyRecursive(),this._hLabels=null);this.labels&&0<this.labels.length&&(this._hLabels=new e({labels:this.labels,labelStyle:"","class":"tsLabels"},this._timeSliderLabels))},_initializeThumbs:function(){if(this._slider){this._offset=this._toSliderValue(this.thumbIndexes[1])||0;var y=this._toSliderValue(this.thumbIndexes[0]);
y=y>this._slider.maximum||y<this._slider.minimum?this._slider.minimum:y;if(!0===this._isRangeSlider){var E=this._toSliderValue(this.thumbIndexes[1]);E=E>this._slider.maximum||E<this._slider.minimum?this._slider.maximum:E;this._setSliderValue([y,E<y?y:E])}else this._setSliderValue(y);this._onHorizontalChange()}},_bumpSlider:function(y){var E=this._getSliderValue(),G=E,F=G,D=y;n.isArray(E)&&(F=E[0],G=E[1],D=[{change:y,useMaxValue:!0},{change:y,useMaxValue:!1}]);1E-10>Math.abs(F-this._slider.minimum)&&
0>y||1E-10>Math.abs(G-this._slider.maximum)&&0<y?this._timer.isRunning&&(this.loop?(this._timer.stop(),this._setSliderValue(this._getSliderMinValue()),y=this._sliderToTimeExtent(),this.onTimeExtentChange(y),this._timer.start(),this.playing=!0):this.pause()):this._slider._bumpValue(D)},_updateThumbIndexes:function(){var y=this._getSliderValue();n.isArray(y)?(this.thumbIndexes[0]=this._toSliderIndex(y[0]),this.thumbIndexes[1]=this._toSliderIndex(y[1])):this.thumbIndexes[0]=this._toSliderIndex(y)},_sliderToTimeExtent:function(){if(this.timeStops&&
0!==this.timeStops.length){var y=new w,E=this._getSliderValue();if(n.isArray(E)){if(E[0]>E[1]){var G=E[0];var F=E[1]}else F=E[0],G=E[1];y.startTime=new Date(this.timeStops[this._toSliderIndex(F)]);y.endTime=new Date(this.timeStops[this._toSliderIndex(G)]);this._adjustTimeExtent(y)}else y.startTime=!0===this._createTimeInstants?new Date(this.timeStops[this._toSliderIndex(E)]):new Date(this.fullTimeExtent.startTime),y.endTime=!0===this._createTimeInstants?y.startTime:new Date(this.timeStops[this._toSliderIndex(E)]);
return y}},_adjustTimeExtent:function(y){if((!1!==this._options.excludeDataAtTrailingThumb||!1!==this._options.excludeDataAtLeadingThumb)&&y.startTime.getTime()!==y.endTime.getTime()){if(this._options.excludeDataAtTrailingThumb){var E=y.startTime;E.setUTCSeconds(E.getUTCSeconds()+1)}this._options.excludeDataAtLeadingThumb&&(y=y.endTime,y.setUTCSeconds(y.getUTCSeconds()-1))}},_resetStartTime:function(y,E){switch(E){case "esriTimeUnitsSeconds":y.startTime.setUTCMilliseconds(0);break;case "esriTimeUnitsMinutes":y.startTime.setUTCSeconds(0,
0,0);break;case "esriTimeUnitsHours":y.startTime.setUTCMinutes(0,0,0);break;case "esriTimeUnitsDays":y.startTime.setUTCHours(0,0,0,0);break;case "esriTimeUnitsWeeks":y.startTime.setUTCDate(y.startTime.getUTCDate()-y.startTime.getUTCDay());break;case "esriTimeUnitsMonths":y.startTime.setUTCDate(1);y.startTime.setUTCHours(0,0,0,0);break;case "esriTimeUnitsDecades":y.startTime.setUTCFullYear(y.startTime.getUTCFullYear()-y.startTime.getUTCFullYear()%10);break;case "esriTimeUnitsCenturies":y.startTime.setUTCFullYear(y.startTime.getUTCFullYear()-
y.startTime.getUTCFullYear()%100)}},_getSliderMinValue:function(){return this._isRangeSlider?[this._slider.minimum,this._slider.minimum+this._offset]:this._slider.minimum},_toSliderIndex:function(y){y=Math.floor((y-this._slider.minimum)*this._numStops/(this._slider.maximum-this._slider.minimum));0>y&&(y=0);y>=this._numStops&&(y=this._numStops-1);return y},_toSliderValue:function(y){return y*(this._slider.maximum-this._slider.minimum)/(this._numStops-1)+this._slider.minimum},_getSliderValue:function(){return this._slider.get("value")},
_setSliderValue:function(y){this._slider._setValueAttr(y,!1,!1)}});n.setObject("dijit.TimeSlider",p,x);return p})},"esri/dijit/MultidimensionalSlider":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/on dojo/json dijit/form/VerticalSlider dojox/form/VerticalRangeSlider dijit/form/VerticalRule dijit/form/VerticalRuleLabels dijit/form/HorizontalSlider dojox/form/HorizontalRangeSlider dijit/form/HorizontalRule dijit/form/HorizontalRuleLabels dijit/_Widget dijit/_Templated dojox/timing/_base dojo/_base/array dojo/Deferred dojo/DeferredList ../layers/MosaicRule ../layers/DimensionalDefinition ../kernel ../lang ./_EventedWidget dojo/text!./templates/MultidimensionalSlider_vertical.html dojo/text!./templates/MultidimensionalSlider_horizontal.html dojo/i18n!../nls/jsapi dojo/dom-class dojo/dom-style dojo/dom-geometry dojo/touch dojo/query dojo/dom-construct dojo/_base/sniff".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x,t,w,z,B,A,y,E,G,F,D,L,O,S,Z,I){var N={LAYOUT_VERTICAL:"vertical",LAYOUT_HORIZONTAL:"horizontal"};e=m([y,e,q],{declaredClass:"esri.dijit.MultidimensionalSlider",widgetsInTemplate:!0,templateString:E,nLabels:10,_thumbCount:1,useRanges:void 0,loop:!0,useLayersDimSlices:!0,prefetch:!0,prefetchedValues:{},showPlayButton:!0,prefetchFactor:2,_hasUnitConflict:!1,_update:!0,useDefaults:!1,playDirectionAscending:!0,unitSymbols:{meter:"m",pascal:"Pa"},_eventMap:{"dimension-value-change":!0,
play:!0,pause:!0,next:!0,previous:!0,change:!0,"dimension-array-create":!0},onChange:function(){},onPlay:function(){},onPause:function(){},onDimensionValueChange:function(){},_onPlay:function(){this.playing=!this.playing;this._updateUI();this.playing?(this._timer.start(),this.onPlay()):(this._timer.stop(),this.onPause())},constructor:function(K,Q){m.safeMixin(this,K);this.playing=!1;this._iconClass="mdsButton mdsPlayButton";this.map&&this._getImageLayers();this.layout===N.LAYOUT_HORIZONTAL&&(this.templateString=
G);this.thumbMovingRate=this.thumbMovingRate||3E3;this._i18n=F;this.prefetchImgNodes={}},postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments);var K=this;this._getAllLayersMDInfo().then(function(){K._sortDimensionValues();K.dimensionValues=K.dimensionValues&&K.dimensionValues.length&&!K.useLayersDimSlices?K.dimensionValues:K._mapSortedDimensionValues;K.getUnit();K._setupSlider()});this._timer=new u.Timer;this._timer.setInterval(this.thumbMovingRate);this._timer.onTick=
n.hitch(this,function(){this.playDirectionAscending?this._bumpSlider(1):this._bumpSlider(-1)});this.layout===N.LAYOUT_VERTICAL&&(this.computeSliderStyle(),this.on("resize",n.hitch(this,"computeSliderStyle")));this._setupHandles()},_insertPassiveLabels:function(){var K=Z(".dijitSliderMoveable.dijitSliderMoveableV",this.domNode);this._passiveLbl1=I.create("div");D.add(this._passiveLbl1,"esriMdSliderPassiveLbl");I.place(this._passiveLbl1,K[0]);2===this._thumbCount&&(this._passiveLbl2=I.create("div"),
D.add(this._passiveLbl2,"esriMdSliderPassiveLbl"),I.place(this._passiveLbl2,K[1]))},_setupHandles:function(){this._eventHandles=[];this._eventHandles.push(b(this.domNode,"mouseover",n.hitch(this,"activateSlider")));this._eventHandles.push(b(this.domNode,"mouseleave",n.hitch(this,"deactivateSlider")));this._eventHandles.push(b(this.domNode,S.press,n.hitch(this,"activateSlider")));this._eventHandles.push(b(this.domNode,S.release,n.hitch(this,"deactivateSlider")));this._eventHandles.push(b(this.prevBtn.domNode,
S.press,n.hitch(this,"activateSlider")));this._eventHandles.push(b(this.playPauseBtn.domNode,S.press,n.hitch(this,"activateSlider")));this._eventHandles.push(b(this.nextBtn.domNode,S.press,n.hitch(this,"activateSlider")));var K=Z(".dijitSliderImageHandle.dijitSliderImageHandleV",this.domNode);r.forEach(K,function(Q){this._eventHandles.push(b(Q,S.press,n.hitch(this,"activateSlider")));this._eventHandles.push(b(Q,S.release,n.hitch(this,"deactivateSlider")))},this)},_removeHandles:function(){r.forEach(this._eventHandles,
function(K){K&&K.remove()})},activateSlider:function(){9>v("ie")&&L.set(this.domNode,"background","#fff");this.sliderActive=!0;this.deactivateTimer&&clearTimeout(this.deactivateTimer);D.remove(this.domNode,"esriMdSliderPassive");D.add(this.domNode,"esriMdSliderActive");L.set(this._passiveLbl1,"display","none");this._passiveLbl2&&L.set(this._passiveLbl2,"display","none")},deactivateSlider:function(){if(!(10>v("ie"))){var K=this;this.deactivateTimer=setTimeout(function(){K.sliderActive=!1;K.updatePassiveLabels();
D.remove(K.domNode,"esriMdSliderActive");D.add(K.domNode,"esriMdSliderPassive");K._showPassiveLabels()},2500)}},updatePassiveLabels:function(){this._slider&&A.isDefined(this._slider.value)&&(this._passiveLbl1.innerHTML=this.value.length?this.value[0]:this.value,this._slider.value.length&&(this._passiveLbl2.innerHTML=this.value[1]),this.sliderActive||this._showPassiveLabels())},_showPassiveLabels:function(){A.isDefined(this.value)&&(L.set(this._passiveLbl1,"display","inline-block"),this.value.length?
L.set(this._passiveLbl2,"display","inline-block"):this._passiveLbl2&&L.set(this._passiveLbl2,"display","none"))},increment:function(){var K=1;!this.playDirectionAscending&&this.playing&&(K=-1);this._bumpSlider(K)},decrement:function(){var K=-1;!this.playDirectionAscending&&this.playing&&(K=1);this._bumpSlider(K)},_setDimensionAttr:function(K){this._slider&&(K.dimension&&(this.dimension=K.dimension),this.dimensionValues=K.dimensionValues&&K.dimensionValues.length?K.dimensionValues:[],this.update())},
update:function(){var K=this;this._mapSortedDimensionValues=[];this._getImageLayers();this.value=this.dimensionValues[this._slider.value];this._getAllLayersMDInfo().then(function(){K._sortDimensionValues();K.getUnit();K.dimensionValues&&K.dimensionValues.length&&!K.useLayersDimSlices||(K.dimensionValues=K._mapSortedDimensionValues);K._setupSlider()})},pause:function(){this.playing=!1;this._updateUI();this._timer.stop()},play:function(K){!0!==this.playing&&(this.playing=!1,this._onPlay())},_setupSlider:function(){this._destroySlider();
this.dimensionValues&&this.dimensionValues.length&&(this.sliderNode=document.createElement("div"),this._getDimensionAlias(),this._layers&&this._layers.length&&1===this._layers.length&&this._readMosaicRule(),this._createRule(),this._createLabels(),this._createSlider(),this._insertPassiveLabels(),this._slider.onChange(this._slider.value))},_createLabels:function(){this.layout===N.LAYOUT_HORIZONTAL?this._createHorizontalLabels():this._createVerticalLabels()},_createRule:function(){this.layout===N.LAYOUT_HORIZONTAL?
this._createHorizontalRule():this._createVerticalRule()},_createVerticalLabels:function(){this.labelsNode=document.createElement("div");this.sliderNode.appendChild(this.labelsNode);this._sliderLabels=new c({labels:this._filterLabels(),labelStyle:"font-size: 83%; padding-left: 5px;"},this.labelsNode)},_createVerticalRule:function(){this.rulesNode=document.createElement("div");this.sliderNode.appendChild(this.rulesNode);100>=this.dimensionValues.length&&(this._sliderRules=new a({count:this.dimensionValues.length,
style:"width:5px;"},this.rulesNode),this._sliderRules.startup())},_createHorizontalLabels:function(){this.labelsNode=document.createElement("div");this.sliderNode.appendChild(this.labelsNode);this._sliderLabels=new g({labels:this._filterLabels(),labelStyle:"font-size: 83%"},this.labelsNode)},_createHorizontalRule:function(){this.rulesNode=document.createElement("div");this.sliderNode.appendChild(this.rulesNode);100>=this.dimensionValues.length&&(this._sliderRules=new k({count:this.dimensionValues.length,
style:"height:5px;"},this.rulesNode),this._sliderRules.startup())},_createHorizontalSingleSlider:function(K){K=K?K:this.playDirectionAscending?0:this.dimensionValues.length-1;this._slider=new h({name:"horizontal",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,style:"width: 100%;",increment:n.hitch(this,"increment"),decrement:n.hitch(this,"decrement"),value:K||0,onChange:n.hitch(this,this._onSingleSliderChange),showButtons:!1},this.sliderNode);
this._slider.startup()},_createHorizontalRangeSlider:function(K){K=K?K:this.playDirectionAscending?[0,1]:[this.dimensionValues.length-2,this.dimensionValues.length-1];this._slider=new l({name:"horizontal",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,style:"width:100%;",increment:n.hitch(this,"increment"),decrement:n.hitch(this,"decrement"),value:K||[0,1],onChange:n.hitch(this,this._onRangeSliderChange),showButtons:!1},this.sliderNode);
this._slider.startup();b(this._slider.incrementButton,"click",this._slider.increment);b(this._slider.decrementButton,"click",this._slider.decrement);this._slider._typematicCallback=function(){}},_createVerticalSingleSlider:function(K){K=A.isDefined(K)?K:this.playDirectionAscending?0:this.dimensionValues.length-1;this._slider=new f({name:"vertical",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,style:this.computeSliderStyle(),increment:n.hitch(this,
"increment"),decrement:n.hitch(this,"decrement"),value:K||0,onChange:n.hitch(this,this._onSingleSliderChange),showButtons:!1},this.sliderNode);this._slider.startup()},_createVerticalRangeSlider:function(K){K=K?K:this.playDirectionAscending?[0,1]:[this.dimensionValues.length-2,this.dimensionValues.length-1];this._slider=new d({name:"vertical",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,style:this.computeSliderStyle(),increment:n.hitch(this,
"increment"),decrement:n.hitch(this,"decrement"),value:K||[0,1],onChange:n.hitch(this,this._onRangeSliderChange),showButtons:!1},this.sliderNode);this._slider.startup();this._slider._typematicCallback=function(){}},_onSingleSliderChange:function(K){var Q=this.dimensionValues[K];this.setDimensionInfoText(Q);r.forEach(this._layers,function(da){this._updateMosaicRule(da,Q);this.prefetch&&this.playing&&"esri.layers.RasterXLayer"!==da.declaredClass&&this._prefetchData(K,da)},this);this._oldValue=K;this.value=
Q;this.updatePassiveLabels();this.onChange(Q)},_onRangeSliderChange:function(K){if(this._update){this._snap&&(K=this._snapToNearestRange(K));var Q=[this.dimensionValues[K[1]],this.dimensionValues[K[0]]];Q.sort(this._sortCompareFunction);this.value=Q;this.setDimensionInfoText(Q);this.updatePassiveLabels();r.forEach(this._layers,function(da){this._updateMosaicRule(da,Q);this.prefetch&&this.playing&&this._prefetchData(K,da)},this);this._update=!0;this._oldValue=n.clone(K);this.onChange(Q)}},destroy:function(){this.inherited(arguments);
this._timer.stop();this._destroySlider();this._removeHandles()},_destroySlider:function(){if(this._slider)try{this._slider.destroy()}catch(K){this._slider.domNode&&I.destroy(this._slider.domNode)}finally{this._slider=null}},_createSlider:function(){this.mdSliderCell.appendChild(this.sliderNode);if(this.value&&this.value.length&&0<=r.indexOf(this.dimensionValues,this.value[0])&&0<=r.indexOf(this.dimensionValues,this.value[1]))var K=[r.indexOf(this.dimensionValues,this.value[0]),r.indexOf(this.dimensionValues,
this.value[1])];else if(A.isDefined(this.value)){var Q=r.indexOf(this.dimensionValues,this.value);0<=Q&&(K=Q)}A.isDefined(K)||(K=this._getDefaultSliderValue());this.useDefaults&&A.isDefined(K)&&(K===this.dimensionValues.length-1||K.length&&0<=r.indexOf(K,this.dimensionValues.length-1))&&(this.playDirectionAscending=!1);2===this._thumbCount?this.layout===N.LAYOUT_HORIZONTAL?this._createHorizontalRangeSlider(K):this._createVerticalRangeSlider(K):this.layout===N.LAYOUT_HORIZONTAL?this._createHorizontalSingleSlider(K):
this._createVerticalSingleSlider(K)},_getDefaultSliderValue:function(){if(this.dimensionValues&&this.dimensionValues.length){var K=Infinity,Q=1,da;if(this.dimension&&"stdz"===this.dimension.toLowerCase())for(da=0;da<this.dimensionValues.length;da++){var U=this.dimensionValues[da];var aa=Math.abs(U-0);if(aa<K){K=aa;var J=U}if(0===aa)break}else J=this.dimensionValues[0];J=r.indexOf(this.dimensionValues,J);J=0>J?0:J;2===this._thumbCount&&(J===this.dimensionValues.length-1&&(Q=-1),J=[J,J+Q]);return J}},
_getMultidimensionalInfo:function(K){function Q(){K.getMultidimensionalInfo().then(function(U){K.multidimensionalInfo=U;da.resolve(K)},function(U){da.reject(U)})}var da=new x;if(K.multidimensionalInfo)da.resolve(K);else if(K.loaded)Q();else K.on("load",function(){Q()});return da},_getAllLayersMDInfo:function(){var K=[];r.forEach(this._layers,function(Q){K.push(this._getMultidimensionalInfo(Q))},this);return new t(K)},_getImageLayers:function(){var K=this.map.layerIds.concat(this.map.graphicsLayerIds),
Q;this._layers=[];r.forEach(K,function(da){Q=this.map.getLayer(da);"esri.layers.ArcGISImageServiceLayer"!==Q.declaredClass&&"esri.layers.ArcGISImageServiceVectorLayer"!==Q.declaredClass&&"esri.layers.RasterLayer"!==Q.declaredClass&&"esri.layers.WCSLayer"!==Q.declaredClass&&"esri.layers.RasterXLayer"!==Q.declaredClass||this._layers.push(Q)},this);return this._layers},_sortCompareFunction:function(K,Q){return A.isDefined(K)&&A.isDefined(Q)?K-Q:!1},_getDimensionObjects:function(){function K(U){if(U&&
U.values&&U.hasRanges){var aa=[];r.forEach(U.values,function(J){J.length?aa=Q(aa,J):aa.push.apply(Q(aa.sort(this._sortCompareFunction),[J]))},this);aa=aa.sort(da._sortCompareFunction);U.decodedValues=aa}return U}var Q=this._merge,da=this;this._allRangeValues=!0;this._thumbCount=1;this._snap=!1;this._dimensionObjects=[];this._layers=this._filterLayers();r.forEach(this._layers,function(U){U.multidimensionalInfo&&r.some(U.multidimensionalInfo.variables,function(aa){r.some(aa.dimensions,function(J){J.name!==
this.dimension||J.hasRanges||(this._allRangeValues=!1)},this)},this)},this);this.useRanges?(this._thumbCount=2,this._snap=!1):this._allRangeValues&&this.useLayersDimSlices?(this._thumbCount=2,this._snap=!0):this._snap=!1;r.forEach(this._layers,function(U){U.multidimensionalInfo&&r.some(U.multidimensionalInfo.variables,function(aa){r.some(aa.dimensions,function(J){J.name===this.dimension&&(this._allRangeValues&&J.hasRanges||this.useRanges?this._dimensionObjects.push(K(n.clone(J))):this._dimensionObjects.push(n.clone(J)))},
this)},this)},this)},_merge:function(K,Q){for(var da=[],U=0,aa=0;U<K.length&&aa<Q.length;)K[U]<Q[aa]?da.push(K[U++]):K[U]>Q[aa]?da.push(Q[aa++]):(da.push(Q[aa++]),U++);da=da.concat(K.slice(U)).concat(Q.slice(aa));return da=r.filter(da,function(J,T,Y){return Y.indexOf(J)===T})},_mergeRangeArrays:function(K,Q){for(var da=[],U=0,aa=0;U<K.length&&aa<Q.length;)K[U][0]<Q[aa][0]||K[U][0]===Q[aa][0]&&K[U][1]<Q[aa][1]?da.push(K[U++]):K[U][0]>Q[aa][0]||K[U][0]===Q[aa][0]&&K[U][1]>Q[aa][1]?da.push(Q[aa++]):
(da.push(Q[aa++]),U++);da=da.concat(K.slice(U)).concat(Q.slice(aa));return da=r.filter(da,function(J,T,Y){return Y.indexOf(J)===T},this)},_sortDimensionValues:function(){var K=0,Q=this._merge,da=this._mergeRangeArrays;this._getDimensionObjects();1<=this._dimensionObjects.length&&(this._mapSortedDimensionValues=this._dimensionObjects[0].decodedValues||this._dimensionObjects[0].values,this._allRangeValues&&(this._dimensionRangeValues=this._dimensionObjects[0].values));if(1<this._dimensionObjects.length)for(K=
1;K<this._dimensionObjects.length;K++)this._mapSortedDimensionValues=Q(this._mapSortedDimensionValues,this._dimensionObjects[K].decodedValues||this._dimensionObjects[K].values),this._allRangeValues&&(this._dimensionRangeValues=da(this._dimensionRangeValues,this._dimensionObjects[K].values))},_createDimensionalDefinition:function(K,Q){var da=[K];return new z({variableName:Q,dimensionName:this.dimension,values:da,isSlice:1===da.length})},_updateMosaicRule:function(K,Q){var da=!1,U=K.mosaicRule||K.defaultMosaicRule||
new w({multidimensionalDefinition:[]}),aa="esri.layers.WCSLayer"===K.declaredClass,J="esri.layers.RasterXLayer"===K.declaredClass,T=(aa?K.multidimensionalDefinition:U.multidimensionalDefinition)||[];Q.length&&Q.sort(this._sortCompareFunction);r.forEach(T,function(R){R.dimensionName===this.dimension&&(R.values=[Q],R.isSlice=!this.useRanges,da=!0)},this);if(!da){var Y="",W=r.filter(K.multidimensionalInfo.variables,function(R){return r.some(T,function(X){return X.variableName&&X.variableName.toLowerCase()===
R.name.toLowerCase()},this)},this);0===W.length&&(W=K.multidimensionalInfo.variables);r.some(W,function(R){if(r.some(R.dimensions,function(X){if(X.name===this.dimension){if(aa||J)Y=R.name;return!0}},this))return!0},this)&&(T.push(this._createDimensionalDefinition(Q,Y)),da=!0)}da&&(aa&&K.setMultidimensionalDefinition(T),J?K.setMultiDimensionalDefinition(U):(U.multidimensionalDefinition=T,K.setMosaicRule(U)))},_prefetchData:function(K,Q){if(Q&&(Q.mosaicRule||Q.multidimensionalDefinition)){var da,U,
aa=!1,J,T=this,Y;this.prefetchedValues[Q.id]||(this.prefetchedValues[Q.id]=[]);this.prefetchImgNodes[Q.id]=[];var W=n.clone(Q._params);var R=(U=n.clone(Q.mosaicRule))&&U.multidimensionalDefinition||n.clone(Q.multidimensionalDefinition);for(da=1;da<=this.prefetchFactor;da++)aa=!1,r.forEach(R,function(X){X.dimensionName===this.dimension&&(this.playDirectionAscending?K.length?(this.snap?(J=this._getNextRangeIndex(K)||K,X.values=[this.dimensionValues[J[0]],this.dimensionValues[J[1]]]):X.values=[this.dimensionValues[(K[0]+
da)%this.dimensionValues.length],this.dimensionValues[(K[1]+da)%this.dimensionValues.length]],X.values.sort(this._sortCompareFunction)):X.values=[this.dimensionValues[(K+da)%this.dimensionValues.length]]:K.length?(this.snap?(J=this._getNextRangeIndex(K,-1)||K,X.values=[this.dimensionValues[J[0]],this.dimensionValues[J[1]]]):X.values=[this.dimensionValues[(this.dimensionValues.length+K[0]-da)%this.dimensionValues.length],this.dimensionValues[(this.dimensionValues.length+K[1]-da)%this.dimensionValues.length]],
X.values.sort(this._sortCompareFunction)):X.values=[this.dimensionValues[(this.dimensionValues.length+K-da)%this.dimensionValues.length]],r.some(this.prefetchedValues[Q.id],function(ia){if(p.stringify(ia)===p.stringify(X.values))return!0})||(aa=!0,this.prefetchedValues[Q.id].push(X.values)))},this),aa&&"esri.layers.WCSLayer"!==Q.declaredClass&&(W.mosaicRule=p.stringify(U.toJson()),Q.getImageUrl(this.map.extent,this.map.width,this.map.height,function(X){Y=new Image;T.prefetchImgNodes[Q.id].push(Y);
Y.src=X},W))}},setDimensionInfoText:function(K){if(A.isDefined(K)){var Q=this.unitSymbol||this.unit;if("number"!==typeof K){K=n.clone(K.sort(this._sortCompareFunction));if(0!==K[0]%1||0!==K[1]%1)K[0]=parseFloat(K[0].toFixed(2)),K[1]=parseFloat(K[1].toFixed(2));K="["+K[0]+", "+K[1]+"]"}else 0!==K%1&&(K=K.toFixed(2));this.dimensionInfo.innerHTML=this.unitSymbol?"\x3clabel style\x3d'font-weight:700;'\x3e"+this.dimensionAlias+" ("+Q+")\x3c/label\x3e":"\x3clabel style\x3d'font-weight:700;'\x3e"+this.dimensionAlias+
"\x3c/label\x3e";this.dimensionInfo.innerHTML=this.layout===N.LAYOUT_HORIZONTAL?this.dimensionInfo.innerHTML+(": "+K):this.dimensionInfo.innerHTML+("\x3cbr/\x3e "+K)}},setLabels:function(K){},_filterLabels:function(){if(this.nLabels&&this.dimensionValues&&this.dimensionValues.length){var K=Math.ceil(this.dimensionValues.length/this.nLabels);return r.map(this.dimensionValues,function(Q,da){return 0===da%K||da===this.dimensionValues.length-1?(0!==Q%1&&(Q=parseFloat(Q.toFixed(2))),Q):""},this)}},_filterLayers:function(){return r.filter(this._layers,
function(K){if(K.multidimensionalInfo&&K.visible&&K.useMapDimensionValue&&r.some(K.multidimensionalInfo.variables,function(Q){if(r.some(Q.dimensions,function(da){if(da.name===this.dimension)return!0},this))return!0},this))return!0},this)},_updateUI:function(){D.remove(this.playPauseBtn.iconNode,this._iconClass);this._iconClass=this.playing?"mdsButton mdsPauseButton":"mdsButton mdsPlayButton";D.add(this.playPauseBtn.iconNode,this._iconClass)},_bumpSlider:function(K){var Q=this._slider.value;if(0<=
K)!this._snap&&(0>Q||Q>=this.dimensionValues.length-1||Q[0]>=this.dimensionValues.length-1||Q[1]>=this.dimensionValues.length-1)?this._timer.isRunning&&(this.loop?(this._timer.stop(),this.prefetchedValues={},this.prefetchImgNodes={},2===this._thumbCount?this._snap?this._slider.set("value",this._getNextRangeIndex(Q)):this._slider.set("value",[0,Math.abs(Q[0]-Q[1])]):this._slider.set("value",0),this._timer.start(),this.playing=!0):this.pause()):2===this._thumbCount&&!this._snap&&Q[0]<this.dimensionValues.length-
1&&Q[1]<this.dimensionValues.length-1?this._slider.set("value",[Q[0]+1,Q[1]+1]):1===this._thumbCount&&Q<this.dimensionValues.length-1?this._slider.set("value",Q+1):this._snap&&this._slider.set("value",this._getNextRangeIndex(Q));else if(0>=Q||0>=Q[0]||0>=Q[1])this._timer.isRunning&&(this.loop?(this._timer.stop(),this.prefetchedValues={},2===this._thumbCount?this._snap?this._slider.set("value",this._getNextRangeIndex(Q,-1)):this._slider.set("value",[this.dimensionValues.length-1,this.dimensionValues.length-
1-Math.abs(Q[0]-Q[1])]):this._slider.set("value",this.dimensionValues.length-1),this._timer.start(),this.playing=!0):this.pause());else if(0<=Q||0<=Q[1])2===this._thumbCount&&0<Q[1]&&0<Q[0]?this._snap?this._slider.set("value",this._getNextRangeIndex(Q,-1)):this._slider.set("value",[Q[0]-1,Q[1]-1]):1===this._thumbCount&&0<Q&&this._slider.set("value",Q-1)},setThumbMovingRate:function(K){this.thumbMovingRate=K;this._timer&&this._timer.setInterval(this.thumbMovingRate)},getFullDimensionRange:function(K){K=
K||this.dimension;var Q,da;r.forEach(this._layers,function(U){U.multidimensionalInfo&&U.multidimensionalInfo.variables&&r.forEach(U.multidimensionalInfo.variables,function(aa){r.forEach(aa.dimensions,function(J){if(J.name===K&&J.extent&&J.extent.length&&1<J.extent.length){if(!A.isDefined(Q)||J.extent[0]<Q)Q=J.extent[0];if(!A.isDefined(da)||J.extent[1]>da)da=J.extent[1]}},this)},this)},this);return[Q,da]},setThumbCount:function(K){this._thumbCount=2==K?2:1;this.value=this.dimensionValues[this._slider.value];
this._setupSlider()},clearDimensionalDefinition:function(K){var Q=[];if(K&&K.mosaicRule&&K.mosaicRule.multidimensionalDefinition){var da=K.mosaicRule;var U=da.multidimensionalDefinition;r.forEach(U,function(aa){aa.dimensionName!==this.dimension&&Q.push(aa)},this);da.multidimensionalDefinition=Q;K.setMosaicRule(da)}},getUnit:function(){var K=null,Q=!1;this.unit=null;r.forEach(this._layers,function(da){da.multidimensionalInfo&&r.forEach(da.multidimensionalInfo.variables,function(U){r.forEach(U.dimensions,
function(aa){aa.name===this.dimension&&aa.unit&&(null!=K||Q?A.isDefined(aa.unit)&&aa.unit.replace("esri","").toLowerCase()!==K.toLowerCase()&&(K=null,Q=!0):K=aa.unit.replace("esri",""))},this)},this)},this);K&&(K=K.replace("esri",""));this.unit=K;this.unitSymbol=this.getUnitSymbol();this._hasUnitConflict=Q;return K},_getDimensionAlias:function(){this.dimensionAlias=this.dimension;r.some(this._layers,function(K){if(K.fields&&K.fields.length&&r.some(K.fields,function(Q){if(Q.name&&Q.name===this.dimension&&
Q.alias)return this.dimensionAlias=Q.alias,!0},this))return!0},this)},_readMosaicRule:function(){var K;r.forEach(this._layers,function(Q){(Q=Q.mosaicRule&&Q.mosaicRule.multidimensionalDefinition||Q.multidimensionalDefinition)&&r.forEach(Q,function(da){da&&da.dimensionName===this.dimension&&da.values&&(K=da.values.length&&da.values[0]&&da.values[0].length?da.values[0]:da.values)},this)},this);this.useRanges=A.isDefined(this.useRanges)?this.useRanges:K&&1!==K.length?!0:!1;K&&(this.useRanges?(this._thumbCount=
2,this.value=1===K.length?[K[0],this.dimensionValues[this.dimensionValues.length-1]]:K):1<K.length&&this._snap?(this._thumbCount=2,this.value=K):(this._thumbCount=1,this.useRanges=!1,this.value=K[0]))},hasUnitConflict:function(){this.getUnit();return this._hasUnitConflict},resizeSlider:function(K,Q){L.set(this.domNode,{height:K+"px",width:Q+"px"});L.set(this.mdSliderTable,{height:K+"px",width:Q+"px"});this.computeSliderStyle()},computeSliderStyle:function(){var K=O.getContentBox(this.domNode).h-O.getContentBox(this.dimensionInfo).h-
(O.getContentBox(this.playPauseBtnRow).h+20);10>=v("ie")&&(K-=53);var Q="height: "+K+"px;";this._slider&&this._slider.domNode&&L.set(this._slider.domNode,"height",K+"px");return Q},getUnitSymbol:function(){if(!A.isDefined(this.unit))return null;var K=this.unit.toLowerCase();if("meters"===K||"meter"===K)return this.unitSymbols.meter;if("pascal"===K||"pascals"===K)return this.unitSymbols.pascal},_snapToNearestRange:function(K){if(K&&K.length&&this._snap){var Q,da,U,aa=this;var J=[this.dimensionValues[K[1]],
this.dimensionValues[K[0]]];J.sort(this._sortCompareFunction);if(r.some(this._dimensionObjects,function(X){if(r.some(X.values,function(ia){if(ia&&ia.length&&ia[0]===J[0]&&ia[1]===J[1])return!0}))return!0},this))return K;if(r.some(this._dimensionObjects,function(X){if(r.some(X.values,function(ia){if(ia&&ia.length&&ia[0]===J[0])return Q=n.clone(ia.sort(this._sortCompareFunction)),!0},this))return!0},this)){r.some(this.dimensionValues,function(X,ia){X===Q[0]&&(da=ia);X===Q[1]&&(U=ia)});var T=Math.abs(K[0]-
da);var Y=[da,U]}if(r.some(this._dimensionObjects,function(X){if(r.some(X.values,function(ia){if(ia&&ia.length&&ia[1]===J[1])return Q=n.clone(ia.sort(this._sortCompareFunction)),!0},this))return!0},this)){r.some(this.dimensionValues,function(X,ia){X===Q[1]&&(U=ia);X===Q[0]&&(da=ia)});var W=Math.abs(K[1]-U);var R=[da,U]}K=T&&W?this._oldValue&&this._oldValue.length&&this._arraysEqual(this._oldValue,Y)?R:this._oldValue&&this._oldValue.length&&this._arraysEqual(this._oldValue,R)?Y:T<=W?Y:R:Y||R||K;this._update=
!1;setTimeout(function(){aa._slider.set("value",K)},100);return K}},_arraysEqual:function(K,Q){var da;if(!A.isDefined(K)||!A.isDefined(Q))return!1;if(K===Q)return!0;if(K.length!==Q.length)return!1;K.sort(this._sortCompareFunction);Q.sort(this._sortCompareFunction);for(da=0;da<K.length;++da)if(K[da]!==Q[da])return!1;return!0},_getNextRangeIndex:function(K,Q){if(!this._dimensionRangeValues||!this._dimensionRangeValues.length)return null;var da,U,aa;Q=A.isDefined(Q)?Q:1;r.some(this._dimensionRangeValues,
function(T,Y){if(this._arraysEqual(T,[this.dimensionValues[K[0]],this.dimensionValues[K[1]]]))return da=Y,!0},this);var J=this._dimensionRangeValues[0<Q?(da+1)%this._dimensionRangeValues.length:(this._dimensionRangeValues.length+da-1)%this._dimensionRangeValues.length];r.some(this.dimensionValues,function(T,Y){T===J[0]&&(U=Y);T===J[1]&&(aa=Y);if(U&&aa)return!0},this);return[U,aa]}});n.mixin(e,N);n.setObject("dijit.MultidimensionalSlider",e,B);return e})},"esri/dijit/BasemapGallery":function(){define("require dojo/_base/declare dojo/_base/array dojo/_base/connect dojo/_base/lang dojo/_base/kernel dojo/_base/sniff dojo/has dojo/query dojo/Deferred dojo/DeferredList dojo/dom dojo/dom-construct dojo/dom-class dijit/_Widget dijit/_Templated ../kernel ../lang ../urlUtils ../request ../geometry/Extent ../SpatialReference ../virtualearth/VETiledLayer ../layers/OpenStreetMapLayer ../layers/ArcGISTiledMapServiceLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/WebTiledLayer ../layers/VectorTileLayer ../layers/TileInfo ../layers/ArcGISImageServiceLayer ../layers/ImageServiceParameters ../layers/ImageParameters ../layers/RasterFunction ../layers/RasterXLayer ./Basemap ./_EventedWidget dojo/text!./templates/BasemapGallery.html".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x,t,w,z,B,A,y,E,G,F,D,L,O,S,Z,I,N,K,Q,da){n=n([Q,q,u],{declaredClass:"esri.dijit.BasemapGallery",widgetsInTemplate:!0,templateString:da,loaded:!1,basemaps:[],bingMapsKey:null,flowContainer:null,_hasUI:!1,_supportsVTL:null,_selectedBasemap:null,_selectBasemapInProgress:!1,_eventMap:{load:!0,"selection-change":!0,add:["basemap"],remove:["basemap"],error:["message"]},constructor:function(U,aa){U=U||{};this.map=U.map;this._hasUI=aa?!0:!1;this.bingMapsKey=U.bingMapsKey&&
0<U.bingMapsKey.length?U.bingMapsKey:null;this.showArcGISBasemaps=!1!==U.showArcGISBasemaps;this.basemaps=U.basemaps||[];this.basemapIds=U.basemapIds;this.referenceIds=U.referenceIds;this.basemapsGroup=U.basemapsGroup;this.arcgisUrl=r.dijit._arcgisUrl;U.portalUrl&&(this.arcgisUrl=U.portalUrl+"/sharing/rest");0>this.arcgisUrl.indexOf("://")?this.arcgisUrl=t.getProtocolForWebResource()+"//"+this.arcgisUrl:"https:"===window.location.protocol&&(this.arcgisUrl=this.arcgisUrl.replace("http:","https:"));
this.init()},init:function(){this.inherited(arguments);this._checkVTLSupport().then(p.hitch(this,function(U){this._supportsVTL=U}));v.forEach(this.basemaps,function(U){U.id&&0!==U.id.length||(U.id=this._getUniqueId());v.forEach(U.layers,function(aa){aa.opacity=0<=aa.opacity?aa.opacity:1;aa.visibility=!0},this)},this);this.basemapIds&&0<this.basemapIds.length&&v.forEach(this.basemapIds,function(U){this.map.getLayer(U)._basemapGalleryLayerType="basemap"},this);this.referenceIds&&0<this.referenceIds.length&&
v.forEach(this.referenceIds,function(U){U=this.map.getLayer(U);U._basemapGalleryLayerType="reference";U.attr("data-reference",!0)},this);this.basemapsGroup&&(this.basemapsGroup.owner&&this.basemapsGroup.title||this.basemapsGroup.id)?this._findCustomBasemapsGroup(p.hitch(this,"_handleArcGISBasemapsResponse")):this.showArcGISBasemaps?this._findArcGISBasemapsGroup(p.hitch(this,"_handleArcGISBasemapsResponse")):this._finishStartup()},startup:function(){this.loaded?this._refreshUI():b.connect(this,"onLoad",
p.hitch(this,function(){this._refreshUI()}))},select:function(U){this._select(U)},getSelected:function(){return this._selectedBasemap},get:function(U){var aa;for(aa=0;aa<this.basemaps.length;aa++)if(this.basemaps[aa].id===U)return this.basemaps[aa];return null},add:function(U){return U&&!U.id?(U.id=this._getUniqueId(),this.basemaps.push(U),this._refreshUI(),this.onAdd(U),!0):U&&this._isUniqueId(U.id)?(this.basemaps.push(U),this._refreshUI(),this.onAdd(U),!0):!1},remove:function(U){var aa;for(aa=0;aa<
this.basemaps.length;aa++){var J=this.basemaps[aa];if(J.id===U)return this._selectedBasemap&&this._selectedBasemap.id===J.id&&(this._selectedBasemap=null),this.basemaps.splice(aa,1),this._refreshUI(),this.onRemove(J),J}return null},onLoad:function(){},onSelectionChange:function(){},onAdd:function(U){},onRemove:function(U){},onError:function(U){},_defaultBasemapGalleryGroupQuery:'title:"ArcGIS Online Basemaps" AND owner:esri',_basemapGalleryGroupQuery:null,_finishStartup:function(){this.loaded=!0;
this.onLoad();0===this.map.layerIds.length&&0<this.basemaps.length&&!this._selectBasemapInProgress&&this._select(this.basemaps[0].id)},_findCustomBasemapsGroup:function(U){this.basemapsGroup&&this.basemapsGroup.id?this._findArcGISBasemaps(this.basemapsGroup.id,U):(this._basemapGalleryGroupQuery='title:"'+this.basemapsGroup.title+'" AND owner:'+this.basemapsGroup.owner,this._findArcGISBasemapsGroup(U))},_findArcGISBasemapsGroup:function(U){if(this._basemapGalleryGroupQuery)this._findArcGISBasemapsGroupContent(U);
else{var aa=this.arcgisUrl+"/portals/self",J={f:"json"};J.culture=f.locale;w({url:aa,content:J,callbackParamName:"callback",load:p.hitch(this,function(T,Y){T&&T.useVectorBasemaps&&T.vectorBasemapGalleryGroupQuery?this._checkVTLSupport().then(p.hitch(this,function(W){this._basemapGalleryGroupQuery=W?T.vectorBasemapGalleryGroupQuery:T&&T.basemapGalleryGroupQuery?T.basemapGalleryGroupQuery:this._defaultBasemapGalleryGroupQuery;this._findArcGISBasemapsGroupContent(U)})):(this._basemapGalleryGroupQuery=
T&&T.basemapGalleryGroupQuery?T.basemapGalleryGroupQuery:this._defaultBasemapGalleryGroupQuery,this._findArcGISBasemapsGroupContent(U))}),error:p.hitch(this,function(T,Y){this._basemapGalleryGroupQuery=this._defaultBasemapGalleryGroupQuery})})}},_findArcGISBasemapsGroupContent:function(U){var aa=p.hitch(this,"_findArcGISBasemaps"),J=this.arcgisUrl+"/community/groups",T={};T.q=this._basemapGalleryGroupQuery;T.f="json";w({url:J,content:T,callbackParamName:"callback",load:p.hitch(this,function(Y,W){if(0<
Y.results.length)aa(Y.results[0].id,U,Y.results[0].sortField,Y.results[0].sortOrder);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:p.hitch(this,function(Y){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})},_findArcGISBasemaps:function(U,aa,J,T){var Y=p.hitch(this,function(W,R,X,ia){var ka=this.arcgisUrl+"/search",ca={};ca.q="group:"+W+' AND type:"web map" NOT type:"web mapping application"';ca.sortField=X;ca.sortOrder="asc"===
ia?"desc":"asc";ca.num=100;ca.f="json";w({url:ka,content:ca,callbackParamName:"callback",load:p.hitch(this,function(la,oa){if(0<la.results.length)R(la.results);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:p.hitch(this,function(la,oa){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})});J&&T?Y(U,aa,J,T):w({url:this.arcgisUrl+"/community/groups/"+U,content:{f:"json"},callbackParamName:"callback",load:p.hitch(this,function(W,
R){W.sortField?Y(U,aa,W.sortField,W.sortOrder):Y(U,aa,"name","desc")}),error:p.hitch(this,function(W,R){Y(U,aa,"name","desc")})})},_handleArcGISBasemapsResponse:function(U){0<U.length&&(v.forEach(U,function(aa,J){if(this.bingMapsKey||!this.bingMapsKey&&aa.title&&-1===aa.title.indexOf("Bing Maps")){var T={};T.id=this._getUniqueId();T.title=aa.title;T.thumbnailUrl="";if(aa.thumbnail&&aa.thumbnail.length&&(T.thumbnailUrl=this.arcgisUrl+"/content/items/"+aa.id+"/info/"+aa.thumbnail,r.id)){var Y=r.id.findCredential(t.urlToObject(this.arcgisUrl).path);
Y&&(T.thumbnailUrl+="?token\x3d"+Y.token)}T.itemId=aa.id;T=new K(T,this);this.basemaps.splice(0,0,T)}},this),this._finishStartup())},_refreshUI:function(){this._hasUI&&(g.empty(this.flowContainer),v.forEach(this.basemaps,function(U,aa){U.id||(U.id="basemap_"+aa);this.flowContainer.appendChild(this._buildNodeLayout(U))},this),g.create("br",{style:{clear:"both"}},this.flowContainer),this._markSelected(this._selectedBasemap))},_buildNodeLayout:function(U){var aa=g.create("div",{id:"galleryNode_"+U.id,
"class":"esriBasemapGalleryNode"}),J=g.create("a",{href:"javascript:void(0);"},aa);b.connect(J,"onclick",p.hitch(this,"_onNodeClick",U));var T=U.title||"";U.thumbnailUrl?g.create("img",{"class":"esriBasemapGalleryThumbnail",src:U.thumbnailUrl,title:T,alt:T},J):g.create("img",{"class":"esriBasemapGalleryThumbnail",src:m.toUrl("./images/transparent.gif"),title:T,alt:T},J);U=g.create("div",{"class":"esriBasemapGalleryLabelContainer"},aa);g.create("span",{innerHTML:T,alt:T,title:T},U);return aa},_onNodeClick:function(U,
aa){aa.preventDefault();this._markSelected(U);this.select(U.id)},_markSelected:function(U){U&&(v.forEach(f.query(".esriBasemapGallerySelectedNode",this.domNode),function(aa){e.remove(aa,"esriBasemapGallerySelectedNode")}),(U=k.byId("galleryNode_"+U.id))&&e.add(U,"esriBasemapGallerySelectedNode"))},_select:function(U){this._selectBasemapInProgress=!0;var aa=this.get(U);aa?(aa.layers?this._getServiceInfos(aa):(U=aa.getLayers(this.arcgisUrl),p.isArray(U)?this._getServiceInfos(aa):U.addCallback(p.hitch(this,
function(J){this._getServiceInfos(aa)}))),this._markSelected(aa)):this._selectBasemapInProgress=!1},_getServiceInfos:function(U){"https:"===location.protocol&&v.forEach(U.layers,function(J){if(this._isAgolService(J.url)||this._isHostedService(J.url))J.url=J.url.replace("http:","https:")},this);this._selectedBasemap=U;var aa=[];v.forEach(U.layers,function(J){J.url&&0<J.url.length&&!J.isReference&&!J.type&&(J.deferredsPos=aa.length,aa.push(this._getServiceInfo(J.url)))},this);0<aa.length?(new l(aa)).addCallback(p.hitch(this,
function(J){var T=null;v.forEach(U.layers,function(Y){if(0===Y.deferredsPos||Y.deferredsPos){Y.serviceInfoResponse=J[Y.deferredsPos][1];var W=Y.serviceInfoResponse.fullExtent;W||(W=Y.serviceInfoResponse.extent);T=T?T.union(new z(W)):new z(W)}},this);this.map.extent&&5>this._getIntersectionPercent(T,this.map.extent)&&this.map.setExtent(T,!0);this._switchBasemapLayers(U);this._updateReferenceLayer(U)})):(this._switchBasemapLayers(U),this._updateReferenceLayer(U))},_checkVTLSupport:function(){var U=
new h;d("ie")?U.resolve(!1):U.resolve(D.supported());return U},_switchBasemapLayers:function(U){var aa=U.layers,J=!1,T,Y,W;v.forEach(aa,function(X){"VectorTileLayer"===X.type&&(J=!0)});if(J&&!0!==this._supportsVTL)this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because layer type is not supported by your current browser version.");else if(0<this.map.layerIds.length&&0===this.map.getNumLevels()&&("OpenStreetMap"===aa[0].type||aa[0].type&&-1<aa[0].type.indexOf("BingMaps")||"WebTiledLayer"===
aa[0].type||"VectorTileLayer"===aa[0].type))this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");else{v.forEach(aa,function(X){if(!X.isReference&&X.type&&-1<X.type.indexOf("BingMaps")&&!this.bingMapsKey)this.onError("esri.dijit.BasemapGallery: Invalid Bing Maps key.")},this);var R=0;v.forEach(aa,function(X,ia){if(!X.isReference){if("OpenStreetMap"===X.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");
return}var ka=new y({id:"layer_osm",opacity:X.opacity})}else if(X.type&&-1<X.type.indexOf("BingMaps")){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}ka=A.MAP_STYLE_AERIAL_WITH_LABELS;"BingMapsAerial"===X.type?ka=A.MAP_STYLE_AERIAL:"BingMapsRoad"===X.type&&(ka=A.MAP_STYLE_ROAD);ka=new A({id:"layer_bing",bingMapsKey:this.bingMapsKey,
mapStyle:ka,opacity:X.opacity})}else if("WebTiledLayer"===X.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}ka=X.initialExtent||X.fullExtent;ka=new F(X.templateUrl||X.url,{visible:X.visibility,opacity:X.opacity,copyright:X.copyright,fullExtent:X.fullExtent&&new z(X.fullExtent),initialExtent:ka&&new z(ka),subDomains:X.subDomains,
tileInfo:X.tileInfo?new L(X.tileInfo):null,tileServers:X.tileServers})}else if("VectorTileLayer"===X.type){ka=new D(X.styleUrl,{visible:X.visibility,opacity:X.opacity});0===ia&&1<aa.length&&this._removeBasemapLayers();var ca=this;b.connect(ka,"onLoad",p.hitch(this,function(la,oa,wa){var za=ca._sameSpatialReference(wa.spatialReference,ca.map.spatialReference);if(ca.map.spatialReference&&!za)ca.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");
else{if(0<ca.map.getNumLevels()){if(za=ca._sameTilingScheme(wa.tileInfo,ca.map.__tileInfo),!za){ca.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");return}}else if(ca.map.loaded){ca.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a vector tile layer and cannot be loaded as a dynamic layer.");return}0===oa&&1===aa.length&&ca._removeBasemapLayers();wa._basemapGalleryLayerType="basemap";ca.map.addLayer(wa,
la)}},R,ia))}else if(X.serviceInfoResponse&&X.serviceInfoResponse.mapName){T=new B(X.serviceInfoResponse.spatialReference);Y=this._sameSpatialReference(T,this.map.spatialReference);if(this.map.spatialReference&&!Y){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");return}if(!0===X.serviceInfoResponse.singleFusedMapCache&&0<this.map.getNumLevels()){if(W=this._sameTilingScheme(X.serviceInfoResponse.tileInfo,this.map.__tileInfo),
!W){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");return}}else if(!0===X.serviceInfoResponse.singleFusedMapCache&&-1<X.serviceInfoResponse.capabilities.toLowerCase().indexOf("tilesonly")&&this.map.loaded&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}ka=(0===this.map.layerIds.length||0<this.map.getNumLevels())&&
!0===X.serviceInfoResponse.singleFusedMapCache?this._loadAsCached(X):this._loadAsDynamic(X)}else if(X.serviceInfoResponse&&X.serviceInfoResponse.pixelSizeX){T=new B(X.serviceInfoResponse.spatialReference);Y=this._sameSpatialReference(T,this.map.spatialReference);if(this.map.spatialReference&&!Y){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");return}if(!0===X.serviceInfoResponse.singleFusedMapCache&&0<this.map.getNumLevels()&&
(W=this._sameTilingScheme(X.serviceInfoResponse.tileInfo,this.map.__tileInfo),!W)){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");return}X.serviceInfoResponse.singleFusedMapCache&&"ArcGISImageServiceLayer"!==X.type?ka="Raster"===X.serviceInfoResponse.cacheType?new N(X.url,{serviceInfo:X.serviceInfoResponse,opacity:X.opacity,visible:X.visibility,bandIds:X.bandIds&&0<X.bandIds.length?X.bandIds:null}):new E(X.url,{resourceInfo:X.serviceInfoResponse,
opacity:X.opacity,visible:X.visibility}):X.serviceInfoResponse.pixelSizeX?(ka=new S,ka.bandIds=X.bandIds,X.renderingRule?ka.renderingRule=new I(X.renderingRule):!X.bandIds&&X.serviceInfoResponse.bandCount&&3<parseInt(X.serviceInfoResponse.bandCount,10)&&(ka.bandIds=[0,1,2]),ka=new O(X.url,{resourceInfo:X.serviceInfoResponse,opacity:X.opacity,visible:X.visibility,imageServiceParameters:ka})):(ka=new Z,ka.format="png24",X.serviceInfoResponse.supportedImageFormatTypes&&-1<X.serviceInfoResponse.supportedImageFormatTypes.indexOf("PNG32")&&
(ka.format="png32"),ka=new G(X.url,{resourceInfo:X.serviceInfoResponse,opacity:X.opacity,visible:X.visibility,imageParameters:ka}))}"VectorTileLayer"===X.type?R++:ka&&(0===ia&&this._removeBasemapLayers(),ka._basemapGalleryLayerType="basemap",this.map.addLayer(ka,R),R++)}},this);this._selectBasemapInProgress=!1;this.onSelectionChange()}},_removeBasemapLayers:function(){var U=this.map.layerIds,aa=[];v.forEach(U,function(J){J=this.map.getLayer(J);"basemap"===J._basemapGalleryLayerType&&aa.push(J)},this);
0===aa.length&&0<U.length&&aa.push(this.map.getLayer(U[0]));0<aa.length&&v.forEach(aa,function(J){this.map.removeLayer(J)},this)},_updateReferenceLayer:function(U){var aa;this._removeReferenceLayer();for(aa=0;aa<U.layers.length;aa++)!0===U.layers[aa].isReference&&this._addReferenceLayer(U.layers[aa])},_removeReferenceLayer:function(){var U;for(U=this.map.layerIds.length-1;0<=U;U--){var aa=this.map.getLayer(this.map.layerIds[U]);"reference"===aa._basemapGalleryLayerType&&this.map.removeLayer(aa)}},
_addReferenceLayer:function(U){"VectorTileLayer"===U.type?this._handleReferenceServiceInfoResponse(U):this._getServiceInfo(U.url,p.hitch(this,"_handleReferenceServiceInfoResponse",U))},_handleReferenceServiceInfoResponse:function(U,aa,J){U.serviceInfoResponse=aa;if("VectorTileLayer"===U.type)var T=new D(U.styleUrl,{visible:U.visibility,opacity:U.opacity});else aa&&aa.mapName?T=!0===aa.singleFusedMapCache?this._loadAsCached(U):this._loadAsDynamic(U):aa&&aa.pixelSizeX&&(U.serviceInfoResponse.singleFusedMapCache?
T=new E(U.url,{resourceInfo:U.serviceInfoResponse,opacity:U.opacity,visible:U.visibility}):U.serviceInfoResponse.pixelSizeX?(J=new S,J.bandIds=U.bandIds,U.renderingRule?J.renderingRule=new I(U.renderingRule):!U.bandIds&&aa.bandCount&&3<parseInt(aa.bandCount,10)&&(J.bandIds=[0,1,2]),T=new O(U.url,{resourceInfo:aa,opacity:U.opacity,visible:U.visibility,imageServiceParameters:J})):(aa=new Z,aa.format="png24",U.serviceInfoResponse.supportedImageFormatTypes&&-1<U.serviceInfoResponse.supportedImageFormatTypes.indexOf("PNG32")&&
(aa.format="png32"),aa.transparent=!0,T=new G(U.url,{resourceInfo:U.serviceInfoResponse,opacity:U.opacity,visible:U.visibility,imageParameters:aa})));T&&(T._basemapGalleryLayerType="reference",T.attr("data-reference",!0),this.map.addLayer(T))},_getServiceInfo:function(U,aa){return w({url:U,content:{f:"json"},callbackParamName:"callback",load:function(J,T){aa&&aa(J,T)},error:p.hitch(this,function(J,T){this.onError("esri.dijit.BasemapGallery: service not accessible.")})})},_loadAsCached:function(U){var aa=
[];U.displayLevels||(aa=v.map(U.serviceInfoResponse.tileInfo.lods,function(T){return T.level}));var J=null;U.exclusionAreas&&U.exclusionAreas.length&&(J=[],v.forEach(U.exclusionAreas,function(T){J.push({minZoom:T.minZoom,maxZoom:T.maxZoom,minScale:T.minScale,maxScale:T.maxScale,geometry:new z(T.geometry)})}));return new E(U.url,{resourceInfo:U.serviceInfoResponse,opacity:U.opacity,visible:U.visibility,exclusionAreas:J,displayLevels:U.displayLevels||aa})},_loadAsDynamic:function(U){var aa=new G(U.url,
{resourceInfo:U.serviceInfoResponse,opacity:U.opacity,visible:U.visibility});U.visibleLayers&&aa.setVisibleLayers(U.visibleLayers);return aa},_getIntersectionPercent:function(U,aa){var J=aa.intersects(U);if(J){J=J.getWidth()*J.getHeight();var T=aa.getWidth()*aa.getHeight();return J/T*100}return 0},_getIds:function(){var U=[];v.forEach(this.basemaps,function(aa){U.push(aa.id)},this);return U},_getUniqueId:function(){for(var U=","+this._getIds().toString()+",",aa=0;;)if(-1<U.indexOf(",basemap_"+aa+
","))aa++;else return"basemap_"+aa},_isUniqueId:function(U){return-1===(","+this._getIds().toString()+",").indexOf(","+U+",")?!0:!1},_isAgolService:function(U){return U?-1!==U.indexOf("/services.arcgisonline.com/")||-1!==U.indexOf("/server.arcgisonline.com/"):!1},_isHostedService:function(U){return U?-1!==U.indexOf(".arcgis.com/"):!1},_sameSpatialReference:function(U,aa){return U&&aa&&U.wkt==aa.wkt&&(U.wkid===aa.wkid||x.isDefined(U.latestWkid)&&U.latestWkid===aa.wkid||x.isDefined(aa.latestWkid)&&
U.wkid===aa.latestWkid||x.isDefined(U.latestWkid)&&U.latestWkid===aa.latestWkid)||U&&aa&&U.isWebMercator()&&aa.isWebMercator()?!0:!1},_sameTilingScheme:function(U,aa){var J=this.map;J=J.width>J.height?J.width:J.height;var T=!1,Y=!1,W,R;for(W=0;W<U.lods.length;W++){var X=U.lods[W].scale;U.dpi!==aa.dpi&&(X=U.lods[W].scale/U.dpi);for(R=0;R<aa.lods.length;R++){var ia=aa.lods[R].scale;U.dpi!==aa.dpi&&(ia=aa.lods[R].scale/aa.dpi);if(Math.abs(ia-X)/ia<1/J)if(T){Y=!0;break}else T=!0;if(ia<X)break}if(Y)break}return Y||
T&&(1===U.lods.length||1===aa.lods.length)?!0:!1}});p.setObject("dijit.BasemapGallery",n,r);return n})},"esri/layers/WebTiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/url dojo/sniff dojo/string ../config ../kernel ../request ../urlUtils ../SpatialReference ../geometry/Extent ./TiledMapServiceLayer ./TileInfo".split(" "),function(m,n,v,b,p,f,d,a,c,h,l,k,g,e){function q(u,r){var x=[];if(u&&r&&(r.customLayerParameters||r.customParameters)){var t=n.clone(r.customParameters||
{});n.mixin(t,r.customLayerParameters||{});var w=h.urlToObject(u);for(var z in w.query)t.hasOwnProperty(z)||x.push(z+"\x3d"+w.query[z]);u=w.path+(x.length?"?"+x.join("\x26"):"")}return u}m=m(g,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(u,r){r||(r={});this.urlTemplate=u=q(u,r.wmtsInfo);var x=new k(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new l({wkid:102100})),t=new k(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new l({wkid:102100}));
this.initialExtent=r.initialExtent||x;this.fullExtent=r.fullExtent||t;this.tileInfo=r.tileInfo?r.tileInfo:new e({dpi:96,rows:256,cols:256,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:0,resolution:156543.033928,scale:5.91657527591555E8},{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,
scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,
resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,scale:1128.497176},{level:20,resolution:.14929107082380833,scale:564.248588},{level:21,resolution:.07464553541190416,scale:282.124294},
{level:22,resolution:.03732276770595208,scale:141.062147},{level:23,resolution:.01866138385297604,scale:70.5310735}]});this.spatialReference=new l(this.tileInfo.spatialReference.toJson());this.copyright=r.copyright||"";var w=new b(u);x=w.scheme+"://"+w.authority+"/";this.urlPath=u.substring(x.length);this.tileServers=r.tileServers||[];-1===w.authority.indexOf("{subDomain}")&&this.tileServers.push(x);if(r.subDomains&&0<r.subDomains.length&&1<w.authority.split(".").length){this.subDomains=r.subDomains;
var z;v.forEach(r.subDomains,function(E){-1<w.authority.indexOf("${subDomain}")?z=w.scheme+"://"+f.substitute(w.authority,{subDomain:E})+"/":-1<w.authority.indexOf("{subDomain}")&&(z=w.scheme+"://"+w.authority.replace(/\{subDomain\}/gi,E)+"/");this.tileServers.push(z)},this)}this.tileServers=v.map(this.tileServers,function(E){"/"!==E.charAt(E.length-1)&&(E+="/");return E});this._levelToLevelValue=[];var B=0;v.forEach(this.tileInfo.lods,function(E,G){this._levelToLevelValue[E.level]=E.levelValue||
E.level;0===G&&(B=this._levelToLevelValue[E.level])},this);this._wmtsInfo=r.wmtsInfo;var A=n.hitch(this,function(){this.loaded=!0;this.onLoad(this)});if(p("chrome")){x=this.getTileUrl(B,0,0);t=d.defaults.io;var y="with-credentials"===t.useCors?h.canUseXhr(x,!0):-1;(t=-1<y?t.corsEnabledServers[y]:null)&&t.withCredentials?c({url:x,handleAs:"arraybuffer"}).addBoth(function(){A()}):A()}else A()},getTileUrl:function(u,r,x){u=this._levelToLevelValue[u];var t=this.tileServers[r%this.tileServers.length]+
f.substitute(this.urlPath,{level:u,z:u,col:x,x:x,row:r,y:r});t=t.replace(/\{level\}/gi,u).replace(/\{row\}/gi,r).replace(/\{col\}/gi,x).replace(/\{z\}/gi,u).replace(/\{x\}/gi,x).replace(/\{y\}/gi,r);t=this._appendCustomLayerParameters(t);t=this.addTimestampToURL(t);return h.addProxy(t)},_appendCustomLayerParameters:function(u){var r;if(this._wmtsInfo&&(this._wmtsInfo.customLayerParameters||this._wmtsInfo.customParameters)){var x=n.clone(this._wmtsInfo.customParameters||{});n.mixin(x,this._wmtsInfo.customLayerParameters||
{});for(r in x)u+=(-1===u.indexOf("?")?"?":"\x26")+r+"\x3d"+encodeURIComponent(x[r])}return u}});n.setObject("layers.WebTiledLayer",m,a);return m})},"esri/dijit/Basemap":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../request ./BasemapLayer".split(" "),function(m,n,v,b,p,f,d){m=m(null,{declaredClass:"esri.dijit.Basemap",id:null,title:"",thumbnailUrl:null,layers:null,itemId:null,basemapGallery:null,constructor:function(a,c){a=a||{};this.id=a.id;this.itemId=
a.itemId;this.layers=a.layers;this.title=a.title||"";this.thumbnailUrl=a.thumbnailUrl;this.basemapGallery=c},getLayers:function(a){if(this.layers)return this.layers;if(this.itemId)return a=f({url:(a||p.dijit._arcgisUrl)+"/content/items/"+this.itemId+"/data",content:{f:"json"},callbackParamName:"callback",error:v.hitch(this,function(c,h){if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.")})}),a.addCallback(v.hitch(this,function(c,h){if(c.baseMap)return this.layers=
[],n.forEach(c.baseMap.baseMapLayers,function(l){this.layers.push(new d(l))},this),this.layers;if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.");return[]})),a}});v.setObject("dijit.Basemap",m,p);return m})},"esri/dijit/BasemapLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(m,n,v,b){m=m(null,{declaredClass:"esri.dijit.BasemapLayer",constructor:function(p){p=p||{};this.url=p.url;this.type=p.type;
this.isReference=!0===p.isReference?!0:!1;this.opacity=p.opacity;this.visibleLayers=p.visibleLayers;this.displayLevels=p.displayLevels;this.exclusionAreas=p.exclusionAreas;this.bandIds=p.bandIds;this.renderingRule=p.renderingRule;this.templateUrl=p.templateUrl;this.copyright=p.copyright;this.subDomains=p.subDomains;this.fullExtent=p.fullExtent;this.initialExtent=p.initialExtent;this.tileInfo=p.tileInfo;this.tileServers=p.tileServers;this.styleUrl=p.styleUrl}});n.setObject("dijit.BasemapLayer",m,b);
return m})},"esri/dijit/HomeButton":function(){define("dojo/Evented dojo/_base/declare dojo/_base/lang dojo/has ../kernel dijit/_WidgetBase dijit/a11yclick dijit/_TemplatedMixin dojo/on dojo/Deferred dojo/text!./templates/HomeButton.html dojo/i18n!../nls/jsapi dojo/dom-class dojo/dom-style".split(" "),function(m,n,v,b,p,f,d,a,c,h,l,k,g,e){m=n("esri.dijit.HomeButton",[f,a,m],{templateString:l,options:{theme:"HomeButton",map:null,extent:null,fit:!1,visible:!0},constructor:function(q,u){var r=v.mixin({},
this.options,q);this.domNode=u;this._i18n=k;this.set("map",r.map);this.set("theme",r.theme);this.set("visible",r.visible);this.set("extent",r.extent);this.set("fit",r.fit);this.watch("theme",this._updateThemeWatch);this.watch("visible",this._visible);this._css={container:"homeContainer",home:"home",loading:"loading"}},postCreate:function(){this.inherited(arguments);this.own(c(this._homeNode,d,v.hitch(this,this.home)))},startup:function(){this.inherited(arguments);this.map||this.destroy();if(this.map.loaded)this._init();
else c.once(this.map,"load",v.hitch(this,function(){this._init()}))},destroy:function(){this.inherited(arguments)},home:function(){var q=new h,u=this.get("extent");this._showLoading();var r={extent:u};u?this.map.extent!==u?this.map.setExtent(u,this.get("fit")).then(v.hitch(this,function(){this._hideLoading();this.emit("home",r);q.resolve(r)}),v.hitch(this,function(x){x||(x=Error("HomeButton::Error setting map extent"));r.error=x;this.emit("home",r);q.reject(x)})):(this._hideLoading(),this.emit("home",
r),q.resolve(r)):(this._hideLoading(),u=Error("HomeButton::home extent is undefined"),r.error=u,this.emit("home",r),q.reject(u));return q.promise},show:function(){this.set("visible",!0)},hide:function(){this.set("visible",!1)},_init:function(){this._visible();this.get("extent")||this.set("extent",this.map.extent);this.set("loaded",!0);this.emit("load",{})},_showLoading:function(){g.add(this._homeNode,this._css.loading)},_hideLoading:function(){g.remove(this._homeNode,this._css.loading)},_updateThemeWatch:function(q,
u,r){g.remove(this.domNode,u);g.add(this.domNode,r)},_visible:function(){this.get("visible")?e.set(this.domNode,"display","block"):e.set(this.domNode,"display","none")}});v.setObject("dijit.HomeButton",m,p);return m})},"esri/dijit/LocateButton":function(){define("require dojo/Evented dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../config dijit/_WidgetBase dijit/a11yclick dijit/_TemplatedMixin dojo/on dojo/Deferred dojo/text!./templates/LocateButton.html dojo/i18n!../nls/jsapi dojo/dom-class dojo/dom-style dojo/dom-attr ../geometry/webMercatorUtils ../geometry/Point ../SpatialReference ../graphic ../symbols/PictureMarkerSymbol ../tasks/ProjectParameters".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x,t,w,z,B,A){m=v("esri.dijit.LocateButton",[a,h,n],{templateString:g,options:{theme:"LocateButton",map:null,visible:!0,highlightLocation:!0,symbol:new B(m.toUrl("./images/sdk_gps_location.png"),28,28),infoTemplate:null,scale:null,useTracking:!1,clearOnTrackingStop:!1,setScale:!0,centerAt:!0,timeout:15E3,graphicsLayer:null,geolocationOptions:{maximumAge:0,timeout:15E3,enableHighAccuracy:!0}},constructor:function(y,E){var G=b.mixin({},this.options,y);this.domNode=
E;this._i18n=e;var F=navigator.geolocation,D=window.hasOwnProperty("isSecureContext");(D&&window.isSecureContext||!D&&"https:"===window.location.protocol)&&F||(G.visible=!1);this.set("map",G.map);this.set("theme",G.theme);this.set("visible",G.visible);this.set("scale",G.scale);this.set("highlightLocation",G.highlightLocation);this.set("symbol",G.symbol);this.set("infoTemplate",G.infoTemplate);this.set("geolocationOptions",G.geolocationOptions);this.set("useTracking",G.useTracking);this.set("setScale",
G.setScale);this.set("centerAt",G.centerAt);this.set("timeout",G.timeout);this.set("graphicsLayer",G.graphicsLayer);this.set("clearOnTrackingStop",G.clearOnTrackingStop);this.watch("theme",this._updateThemeWatch);this.watch("visible",this._visible);this.watch("tracking",this._locate);this.watch("useTracking",b.hitch(this,function(){this.get("tracking")&&!this.get("useTracking")&&this._stopTracking();this._setTitle()}));this._css={container:"locateContainer",locate:"zoomLocateButton",loading:"loading",
tracking:"tracking"}},postCreate:function(){this.inherited(arguments);this.own(l(this._locateNode,c,b.hitch(this,this.locate)))},startup:function(){this.inherited(arguments);this.get("map")||this.set("visible",!1);if(this.get("map").loaded)this._init();else l.once(this.get("map"),"load",b.hitch(this,function(){this._init()}))},destroy:function(){this.clear();this._graphicsEvent&&this._graphicsEvent.remove();this._removeWatchPosition();this.inherited(arguments)},clear:function(){var y=this.get("highlightGraphic"),
E=this.get("graphicsLayer");y&&(E?E.remove(y):this.get("map").graphics.remove(y),this.set("highlightGraphic",null))},locate:function(){this.get("useTracking")&&this.set("tracking",!this.get("tracking"));return this._locate()},show:function(){this.set("visible",!0)},hide:function(){this.set("visible",!1)},_setTitle:function(){this.get("useTracking")?this.get("tracking")?r.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.stopTracking):r.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.tracking):
r.set(this._locateNode,"title",this._i18n.widgets.locateButton.locate.title)},_removeWatchPosition:function(){this.get("watchId")&&(navigator.geolocation.clearWatch(this.get("watchId")),this.set("watchId",null));this._removePrivateVars()},_stopTracking:function(){q.remove(this._locateNode,this._css.tracking);this._removeWatchPosition();this.get("clearOnTrackingStop")&&this.clear();this._hideLoading()},_positionToObject:function(y){return y?{coords:b.mixin({},y.coords),timestamp:y.timestamp}:{}},_startTracking:function(){q.add(this._locateNode,
this._css.tracking);this._removeWatchPosition();var y=navigator.geolocation.watchPosition(b.hitch(this,function(E){E=this._positionToObject(E);this._setPosition(E).then(b.hitch(this,function(G){this._locateEvent(G)}),b.hitch(this,function(G){G||(G=Error("LocateButton::Error setting the position."));this._locateError(G)}))}),b.hitch(this,function(E){this.set("tracking",!1);E||(E=Error("LocateButton::Could not get tracking position."));this._locateError(E)}),this.get("geolocationOptions"));this.set("watchId",
y)},_removePrivateVars:function(){this._scale=this._position=this._graphic=null},_getCurrentPosition:function(){var y=new k;this._removePrivateVars();var E=setTimeout(b.hitch(this,function(){clearTimeout(E);y.reject(Error("LocateButton::time expired for getting location."))}),this.get("timeout"));navigator.geolocation.getCurrentPosition(b.hitch(this,function(G){G=this._positionToObject(G);clearTimeout(E);this._setPosition(G).then(b.hitch(this,function(F){y.resolve(F)}),b.hitch(this,function(F){F||
(F=Error("LocateButton::Error setting map position."));y.reject(F)}))}),b.hitch(this,function(G){G||(G=Error("LocateButton::Could not get current position."));y.reject(G)}),this.get("geolocationOptions"));return y.promise},_locate:function(){var y=new k;this._showLoading();if(navigator.geolocation)this.get("useTracking")?this.get("tracking")?(this._startTracking(),y.resolve({tracking:!0})):(this._stopTracking(),y.resolve({tracking:!1})):this._getCurrentPosition().then(b.hitch(this,function(G){this._locateEvent(G);
y.resolve(G)}),b.hitch(this,function(G){G||(G=Error("LocateButton::Could not get current position."));this._locateError(G);y.reject(G)}));else{var E=Error("LocateButton::geolocation unsupported");this._locateError(E);y.reject(E)}this._setTitle();return y.promise},_projectPoint:function(y){var E=new k,G=this.get("map").spatialReference,F=G.wkid;G.isWebMercator()?(y=x.geographicToWebMercator(y),E.resolve(y)):d.defaults.geometryService&&4326!==F?(F=new A,F.geometries=[y],F.outSR=G,d.defaults.geometryService.project(F).then(b.hitch(this,
function(D){D&&D.length?E.resolve(D[0]):E.reject(Error("LocateButton::Point was not projected."))}),function(D){D||(D=Error("LocateButton::please specify a geometry service on esri/config to project."));E.reject(D)})):E.resolve(y);return E.promise},_getScale:function(y){var E=this.get("scale");return y&&y.coords?E||y.coords.accuracy||5E4:E||5E4},_createPoint:function(y){var E;y&&y.coords&&(E=new t([y.coords.longitude,y.coords.latitude],new w({wkid:4326})));return E},_setPosition:function(y){var E=
new k,G,F;this._removePrivateVars();if((this._position=y)&&y.coords){if(G=this._createPoint(y))this._graphic=F=this._createGraphic(G,y);var D=this._getScale(y);this._scale=D;G?this._projectPoint(G).then(b.hitch(this,function(L){this._graphic=F=this._createGraphic(L,y);var O={graphic:F,scale:D,position:y};this.get("setScale")&&this.get("map").setScale(D);this.get("centerAt")?this.get("map").centerAt(L).then(b.hitch(this,function(){E.resolve(O)}),b.hitch(this,function(S){S||(S=Error("LocateButton::Could not center map."));
E.reject(S)})):E.resolve(O)}),b.hitch(this,function(L){L||(L=Error("LocateButton::Error projecting point."));E.reject(L)})):(G=Error("LocateButton::Invalid point"),E.reject(G))}else G=Error("LocateButton::Invalid position"),E.reject(G);return E.promise},_createGraphic:function(y,E){if(y){var G={position:E};G=new z(y,this.get("symbol"),G,this.get("infoTemplate"))}return G},_locateEvent:function(y){if(y.graphic){var E=this.get("highlightGraphic"),G=this.get("graphicsLayer");E?(E.setGeometry(y.graphic.geometry),
E.setAttributes(y.graphic.attributes),E.setInfoTemplate(y.graphic.infoTemplate),E.setSymbol(y.graphic.symbol)):(E=y.graphic,this.get("highlightLocation")&&(G?G.add(E):this.get("map").graphics.add(E)));this.set("highlightGraphic",E)}this._hideLoading();this.emit("locate",y)},_locateError:function(y){y={graphic:this._graphic,scale:this._scale,position:this._position,error:y};this._hideLoading();this.emit("locate",y)},_showLoading:function(){this.get("useTracking")||q.add(this._locateNode,this._css.loading)},
_hideLoading:function(){this.get("useTracking")||q.remove(this._locateNode,this._css.loading)},_init:function(){this._visible();this._setTitle();this.get("tracking")&&this.get("useTracking")&&this._locate();this.set("loaded",!0);this.emit("load",{})},_updateThemeWatch:function(y,E,G){q.remove(this.domNode,E);q.add(this.domNode,G)},_visible:function(){this.get("visible")?u.set(this.domNode,"display","block"):u.set(this.domNode,"display","none")}});b.setObject("dijit.LocateButton",m,f);return m})},
"esri/layers/graphics":function(){define(["./GraphicsLayer","../graphic","../renderer"],function(){return{}})},"esri/renderer":function(){define("./renderers/Renderer ./renderers/SimpleRenderer ./renderers/UniqueValueRenderer ./renderers/ClassBreaksRenderer ./renderers/TemporalRenderer ./renderers/SymbolAger ./renderers/TimeClassBreaksAger ./renderers/TimeRampAger ./renderers/StretchRenderer ./renderers/jsonUtils".split(" "),function(m,n,v,b,p,f,d,a,c,h){return{Renderer:m,SimpleRenderer:n,UniqueValueRenderer:v,
ClassBreaksRenderer:b,TemporalRenderer:p,SymbolAger:f,TimeClassBreaksAger:d,TimeRampAger:a,StretchRenderer:c,jsonUtils:h}})},"esri/layers/agstiled":function(){define(["./agscommon","./ArcGISTiledMapServiceLayer"],function(){return{}})},"esri/layers/agsdynamic":function(){define(["./agscommon","./ArcGISDynamicMapServiceLayer","../_time"],function(){return{}})},"esri/_time":function(){define(["./TimeExtent"],function(){return{}})},"esri/layers/agsimageservice":function(){define("./agscommon ./ArcGISImageServiceLayer ./ImageServiceParameters ./MosaicRule ./RasterFunction ../utils".split(" "),
function(){return{}})},"esri/layers/KMLLayer":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/sniff dojo/io-query dojo/dom-construct dojo/dom-style ../kernel ../config ../lang ../request ../urlUtils ../SpatialReference ../geometry/webMercatorUtils ../dijit/PopupTemplate ./layer ./KMLFolder ./KMLGroundOverlay ./MapImageLayer ./FeatureLayer".split(" "),function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x,t,w,z,B,A){var y=
n([t],{declaredClass:"esri.layers.KMLLayer",serviceUrl:q.getProtocolForWebResource()+"//utility.arcgis.com/sharing/kml",constructor:function(E,G){this._url=q.urlToObject(this.url=E);this._outSR=G&&G.outSR||new u({wkid:4326});this._options=b.mixin({},G);k.defaults.kmlService&&(this.serviceUrl=k.defaults.kmlService);var F=this.linkInfo=G&&G.linkInfo;F&&(this.visible=!!F.visibility,this._waitingForMap=!!F.viewFormat);(!F||F&&F.visibility&&!this._waitingForMap)&&this._parseKml();this.refresh=b.hitch(this,
this.refresh);this.registerConnectEvents("esri.layers.KMLLayer",!0)},getFeature:function(E){if(E){var G=E.type,F=E.id,D;switch(G){case "esriGeometryPoint":case "esriGeometryPolyline":case "esriGeometryPolygon":(E=this["_"+G])&&(D=b.getObject("_mode._featureMap."+F,!1,E));break;case "GroundOverlay":if(E=this._groundLyr){var L=E.getImages();G=L.length;for(E=0;E<G;E++)if(L[E].id===F){D=L[E];break}}break;case "NetworkLink":p.some(this._links,function(O){return O.linkInfo&&O.linkInfo.id===F?(D=O,!0):!1});
break;case "Folder":for(G=(L=this.folders)?L.length:0,E=0;E<G;E++)if(L[E].id===F){D=L[E];break}}return D}},getLayers:function(){var E=[];this._groundLyr&&E.push(this._groundLyr);this._fLayers&&(E=E.concat(this._fLayers));this._links&&p.forEach(this._links,function(G){G.declaredClass&&E.push(G)});return E},setFolderVisibility:function(E,G){E&&(this._fireUpdateStart(),(E.visible=G)&&(G=this._areLocalAncestorsVisible(E)),this._setState(E,G),this._fireUpdateEnd())},_eventMap:{"network-link-error":["error"]},
onRefresh:function(){},onOpacityChange:function(){},onNetworkLinkError:function(){},_parseKml:function(E){var G=this;this._fireUpdateStart();this._io=e({url:this.serviceUrl,content:{url:this._url.path+this._getQueryParameters(E),model:"simple",folders:"",refresh:this.loaded?!0:void 0,outSR:f.toJson(this._outSR.toJson())},callbackParamName:"callback",load:function(F){G._io=null;G._initLayer(F)},error:function(F){G._io=null;F=b.mixin(Error(),F);F.message="Unable to load KML: "+(F.message||"");G._fireUpdateEnd(F);
G._errorHandler(F)}})},_initLayer:function(E){if(this.loaded){var G=[];p.forEach(this.folders,function(I){I.visible&&G.push(I.id)});this._options.minScale=this.minScale;this._options.maxScale=this.maxScale;this._options.opacity=this.opacity;this._removeInternalLayers()}this.name=E.name;this.description=E.description;this.snippet=E.snippet;this.visibility=E.visibility;this.featureInfos=E.featureInfos;var F,D=this.folders=E.folders,L=[];if(D){var O=D.length;for(F=0;F<O;F++){var S=D[F]=new w(D[F]);-1===
S.parentFolderId&&L.push(S)}}D=this._links=E.networkLinks;O=D?D.length:0;for(F=0;F<O;F++)if(!D[F].viewRefreshMode||-1===D[F].viewRefreshMode.toLowerCase().indexOf("onregion")){var Z=b.mixin({},this._options);Z.linkInfo=D[F];Z.id&&(Z.id=Z.id+"_"+F);S=D[F]=new y(D[F].href,Z);S._parentLayer=this;S._parentFolderId=this._getLinkParentId(S.linkInfo.id);S._linkErrorHandle=S.on("error,network-link-error",b.hitch(S,function(I){this._parentLayer.onNetworkLinkError(I.error)}))}if((D=E.groundOverlays)&&0<D.length)for(Z=
b.mixin({},this._options),Z.id&&(Z.id+="_mapImage"),S=this._groundLyr=new B(Z),O=D.length,F=0;F<O;F++)S.addImage(new z(D[F]));(E=b.getObject("featureCollection.layers",!1,E))&&0<E.length&&(this._fLayers=[],p.forEach(E,function(I,N){var K=b.getObject("featureSet.features",!1,I);K&&0<K.length&&(Z=b.mixin({outFields:["*"],infoTemplate:I.popupInfo?new x(I.popupInfo):null,editable:!1},this._options),Z.id&&(Z.id=Z.id+"_"+N),Z.webgl=!1,I.layerDefinition.capabilities="Query,Data",K=new A(I,Z),K.geometryType&&
(this["_"+K.geometryType]=K),this._fLayers.push(K))},this),0===this._fLayers.length&&delete this._fLayers);if(!this.loaded)for(O=L.length,F=0;F<O;F++)S=L[F],this._setState(S,S.visible);this._fireUpdateEnd();this.loaded?(this._addInternalLayers(),p.forEach(this.folders,function(I){-1<p.indexOf(G,I.id)?this.setFolderVisibility(I,!0):this.setFolderVisibility(I,!1)},this),this.onRefresh()):(this.loaded=!0,this.onLoad(this))},_addInternalLayers:function(){var E=this._map;this._fireUpdateStart();this._links&&
p.forEach(this._links,function(L){L.declaredClass&&(E.addLayer(L),L._waitingForMap&&(L._waitingForMap=null,L.visible?L._parseKml(E):L._wMap=E))});var G=E.spatialReference,F=this._outSR;if(!G.equals(F))if(G.isWebMercator()&&4326===F.wkid)var D=r.geographicToWebMercator;else if(F.isWebMercator()&&4326===G.wkid)D=r.webMercatorToGeographic;else return;this._groundLyr&&(D&&p.forEach(this._groundLyr.getImages(),function(L){L.extent=D(L.extent)}),E.addLayer(this._groundLyr));(G=this._fLayers)&&0<G.length&&
p.forEach(G,function(L){if(D){var O=L.graphics,S,Z,I=O?O.length:0;for(S=0;S<I;S++)(Z=O[S].geometry)&&O[S].setGeometry(D(Z))}E.addLayer(L)});this.onVisibilityChange(this.visible)},_removeInternalLayers:function(){var E=this._map;this._links&&p.forEach(this._links,function(G){G.declaredClass&&G._io&&G._io.cancel();G._linkErrorHandle&&(G._linkErrorHandle.remove(),G._linkErrorHandle=null)});E&&p.forEach(this.getLayers(),E.removeLayer,E)},_setState:function(E,G){var F=E.featureInfos,D,L,O=F?F.length:0,
S=G?"show":"hide",Z=G?"_resume":"_suspend";for(L=0;L<O;L++){var I=F[L];if(D=this.getFeature(I))if("Folder"===I.type)this._setState(D,G&&D.visible);else if("NetworkLink"===I.type)this._setInternalVisibility(D,G);else if(D[Z])D[Z]();else D[S]()}},_areLocalAncestorsVisible:function(E){var G=E.parentFolderId;for(E=E.visible;E&&-1!==G;)G=this.getFeature({type:"Folder",id:G}),E=E&&G.visible,G=G.parentFolderId;return E},_setInternalVisibility:function(E,G){var F=E._parentLayer,D=E._parentFolderId;for(G=
G&&E.visible;G&&F;)G=G&&F.visible,-1<D&&(G=G&&F._areLocalAncestorsVisible(F.getFeature({type:"Folder",id:D}))),D=F._parentFolderId,F=F._parentLayer;this._setIntState(E,G)},_setIntState:function(E,G){E&&p.forEach(E.getLayers(),function(F){F.linkInfo?E._setIntState(F,G&&F.visible&&E._areLocalAncestorsVisible(E.getFeature({type:"Folder",id:F._parentFolderId}))):F.setVisibility(G)})},_getLinkParentId:function(E){var G=-1;this.folders&&p.some(this.folders,function(F){return F.networkLinkIds&&-1!==p.indexOf(F.networkLinkIds,
E)?(G=F.id,!0):!1});return G},_checkAutoRefresh:function(){var E=this.linkInfo;if(E)if(this.visible){if(this.loaded&&this._map){var G=E.refreshMode,F=E.refreshInterval,D=E.viewRefreshMode;E=E.viewRefreshTime;G&&-1!==G.toLowerCase().indexOf("oninterval")&&0<F&&(this._stopAutoRefresh(),this._timeoutHandle=setTimeout(this.refresh,1E3*F));D&&-1!==D.toLowerCase().indexOf("onstop")&&0<E&&!this._extChgHandle&&(this._extChgHandle=v.connect(this._map,"onExtentChange",this,this._extentChanged))}}else this._stopAutoRefresh(),
v.disconnect(this._extChgHandle),delete this._extChgHandle},_stopAutoRefresh:function(){clearTimeout(this._timeoutHandle);this._timeoutHandle=null},_getQueryParameters:function(E){E=E||this._map;var G={},F=this.linkInfo,D=E&&E.extent;if(this._url.query){b.mixin(G,this._url.query);var L=!!this._url.query.token}l.id&&!L&&(L=l.id.findCredential(this._url.path))&&(G.token=L.token);if(F){L=F.viewFormat;var O=F.httpQuery;F=F.viewBoundScale;if(D&&L){var S=D,Z=D,I=D.spatialReference;I&&(I.isWebMercator()?
S=r.webMercatorToGeographic(D):4326===I.wkid&&(Z=r.geographicToWebMercator(D)));D=S.getCenter();Z=Math.max(Z.getWidth(),Z.getHeight());F&&(S=S.expand(F));L=L.replace(/\[bboxWest\]/ig,S.xmin).replace(/\[bboxEast\]/ig,S.xmax).replace(/\[bboxSouth\]/ig,S.ymin).replace(/\[bboxNorth\]/ig,S.ymax).replace(/\[lookatLon\]/ig,D.x).replace(/\[lookatLat\]/ig,D.y).replace(/\[lookatRange\]/ig,Z).replace(/\[lookatTilt\]/ig,0).replace(/\[lookatHeading\]/ig,0).replace(/\[lookatTerrainLon\]/ig,D.x).replace(/\[lookatTerrainLat\]/ig,
D.y).replace(/\[lookatTerrainAlt\]/ig,0).replace(/\[cameraLon\]/ig,D.x).replace(/\[cameraLat\]/ig,D.y).replace(/\[cameraAlt\]/ig,Z).replace(/\[horizFov\]/ig,60).replace(/\[vertFov\]/ig,60).replace(/\[horizPixels\]/ig,E.width).replace(/\[vertPixels\]/ig,E.height).replace(/\[terrainEnabled\]/ig,0);b.mixin(G,a.queryToObject(L))}O&&(O=O.replace(/\[clientVersion\]/ig,l.version).replace(/\[kmlVersion\]/ig,2.2).replace(/\[clientName\]/ig,"ArcGIS API for JavaScript").replace(/\[language\]/ig,m.locale),b.mixin(G,
a.queryToObject(O)))}E=[];for(var N in G)g.isDefined(G[N])&&E.push(N+"\x3d"+G[N]);return(E=E.join("\x26"))?"?"+E:""},setScaleRange:function(E,G){this.inherited(arguments);p.forEach(this.getLayers(),function(F){F.setScaleRange(E,G)})},setOpacity:function(E){this.opacity!=E&&(p.forEach(this.getLayers(),function(G){G.setOpacity(E)}),this.opacity=E,this.onOpacityChange(E))},_setMap:function(E,G){this.inherited(arguments);this._map=E;var F=this._div=c.create("div",null,G);h.set(F,"position","absolute");
this._addInternalLayers();this.evaluateSuspension();return F},_unsetMap:function(E,G){this._io&&this._io.cancel();this._stopAutoRefresh();v.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var F=this._div;F&&(G.removeChild(F),c.destroy(F));this._wMap=this._div=null;this.inherited(arguments)},onVisibilityChange:function(E){this.loaded?(this._fireUpdateStart(),this._setInternalVisibility(this,E),this._checkAutoRefresh(),this._fireUpdateEnd()):this.linkInfo&&E&&(this._waitingForMap||
this._parseKml(this._wMap))},refresh:function(){this.loaded&&this._map&&!this._io&&this.visible&&this._parseKml()},getFeatureCollection:function(E){var G,F=[];(E=this.getFeature({type:"Folder",id:E}))&&(G=p.map(E.featureInfos,function(D){if("esriGeometryPoint"===D.type||"esriGeometryPolyline"===D.type||"esriGeometryPolygon"===D.type)return D.id},this))&&0<G.length&&p.forEach(this._fLayers,function(D){var L;var O=D.toJson();O.featureSet.features&&0<O.featureSet.features.length&&(L=p.filter(O.featureSet.features,
function(S){if(-1!==p.indexOf(G,S.attributes[D.objectIdField]))return S},this));L&&0<L.length&&(O.featureSet.features=L,F.push(O))},this);return F},getFeatureCount:function(E){E=this.getFeature({type:"Folder",id:E});var G={points:0,polylines:0,polygons:0};E&&p.forEach(E.featureInfos,function(F){"esriGeometryPoint"===F.type&&(G.points+=1);"esriGeometryPolyline"===F.type&&(G.polylines+=1);"esriGeometryPolygon"===F.type&&(G.polygons+=1)});return G},_extentChanged:function(){this._stopAutoRefresh();this._timeoutHandle=
setTimeout(this.refresh,1E3*this.linkInfo.viewRefreshTime)}});b.setObject("layers.KMLLayer",y,l);return y})},"esri/layers/KMLFolder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(m,n,v,b,p){m=m(null,{declaredClass:"esri.layers.KMLFolder",constructor:function(f){n.mixin(this,f);p.isDefined(this.visibility)&&(this.visible=!!this.visibility)}});n.setObject("layers.KMLFolder",m,b);return m})},"esri/layers/KMLGroundOverlay":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ./MapImage".split(" "),
function(m,n,v,b,p,f){m=m([f],{declaredClass:"esri.layers.KMLGroundOverlay",constructor:function(d){p.isDefined(this.visibility)&&(this.visible=!!this.visibility)}});n.setObject("layers.KMLGroundOverlay",m,b);return m})},"esri/layers/osm":function(){define(["./OpenStreetMapLayer"],function(){return{}})},"esri/SnappingManager":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/Color dojo/_base/Deferred dojo/has dojo/keys ./kernel ./graphic ./geometry/ScreenPoint ./geometry/Extent ./symbols/SimpleMarkerSymbol ./symbols/SimpleLineSymbol ./tasks/query".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q){m=m(null,{declaredClass:"esri.SnappingManager",constructor:function(u){u=u||{};this.map=u.map;this.tolerance=u.tolerance||15;this.layerInfos=[];if(u.layerInfos)this.layerInfos=u.layerInfos;else{var r;for(r=0;r<this.map.graphicsLayerIds.length;r++){var x=this.map.getLayer(this.map.graphicsLayerIds[r]);this.layerInfos.push({layer:x})}if(this.map.loaded)this.layerInfos.push({layer:this.map.graphics});else var t=n.connect(this.map,"onLoad",this,function(w){n.disconnect(t);
t=null;this.layerInfos.push({layer:this.map.graphics});this.setLayerInfos(this.layerInfos)})}this.snapPointSymbol=u.snapPointSymbol?u.snapPointSymbol:new g(g.STYLE_CROSS,15,new e(e.STYLE_SOLID,new p([0,255,255]),1),new p([0,255,0,0]));this.alwaysSnap=u.alwaysSnap?u.alwaysSnap:!1;this.snapKey=u.snapKey?u.snapKey:d("mac")?a.META:a.CTRL;this._SelectionLyrQuery=new q;this._SelectionLyrQuery.spatialRelationship=q.SPATIAL_REL_INTERSECTS;this._snappingGraphic=new h;this.setLayerInfos(this.layerInfos);this._currentGraphicOption=
{snapToPoint:!0,snapToVertex:!0,snapToLastVertex:!0,snapToEdge:!0};this._snappingCallback=v.hitch(this,this._snappingCallback)},getSnappingPoint:function(u){var r=this.layers,x=this.tolerance,t=this.map,w=this.layerOptions,z=t.toMap(u.offset(-x,x));x=t.toMap(u.offset(x,-x));z=new k(z.x,z.y,x.x,x.y,t.spatialReference);var B=new q;B.geometry=z;B.spatialRelationship=q.SPATIAL_REL_INTERSECTS;var A=[],y=[],E=this._extractPointsAndLines,G=new f,F=0,D;x=z.xmin;var L=z.xmax;b.forEach(r,function(N,K){N.visible&&
N.loaded&&"esri.layers.FeatureLayer"===N.declaredClass&&N.mode!==N.constructor.MODE_SELECTION&&F++});t.spatialReference._isWrappable()&&(x=k.prototype._normalizeX(z.xmin,t.spatialReference._getInfo()).x,L=k.prototype._normalizeX(z.xmax,t.spatialReference._getInfo()).x);var O=new k(x,z.ymin,L,z.ymax,t.spatialReference);b.forEach(r,function(N,K){if("esri.layers.GraphicsLayer"===N.declaredClass&&N.visible){var Q=[];b.forEach(N.graphics,function(U){U&&U.visible&&O.intersects(U.geometry)&&Q.push(U)});
var da=E(Q,w[K]);A=A.concat(da[0]);y=y.concat(da[1])}});var S=v.hitch(this,function(N){F--;N instanceof Error||(N=E(N.features,w[D]),A=A.concat(N[0]),y=y.concat(N[1]));F||(I=this._getSnappingPoint(A,y,u),G.callback(I))}),Z=!1;b.forEach(r,function(N,K){N.visible&&N.loaded&&(D=K,"esri.layers.FeatureLayer"===N.declaredClass&&N.mode!==N.constructor.MODE_SELECTION&&(Z=!0,N.queryFeatures(B,S,S)))});if(!Z){var I=this._getSnappingPoint(A,y,u);G.callback(I)}return G},setLayerInfos:function(u){this.layers=
[];this.layerOptions=[];var r;for(r=0;r<u.length;r++)this.layers.push(u[r].layer),this.layerOptions.push({snapToPoint:!0,snapToVertex:!0,snapToEdge:!0}),!1===u[r].snapToPoint&&(this.layerOptions[r].snapToPoint=u[r].snapToPoint),!1===u[r].snapToVertex&&(this.layerOptions[r].snapToVertex=u[r].snapToVertex),!1===u[r].snapToEdge&&(this.layerOptions[r].snapToEdge=u[r].snapToEdge);this._featurePtsFromSelectionLayer=[];this._featureLinesFromSelectionLayer=[];this._selectionLayers=[];this._selectionLayerOptions=
[];b.forEach(this.layers,function(x,t){"esri.layers.FeatureLayer"===x.declaredClass&&x.mode===x.constructor.MODE_SELECTION&&(this._selectionLayers.push(x),this._selectionLayerOptions.push(this.layerOptions[t]))},this);this.layerInfos=u},destroy:function(){n.disconnect(this._onExtentChangeConnect);this._killOffSnapping();this._featurePtsFromSelectionLayer=this._featureLinesFromSelectionLayer=this._currentFeaturePts=this._currentFeatureLines=this.layers=this.map=null},_startSelectionLayerQuery:function(){n.disconnect(this._onExtentChangeConnect);
this._mapExtentChangeHandler(this._selectionLayers,this._selectionLayerOptions,this.map.extent);this._onExtentChangeConnect=n.connect(this.map,"onExtentChange",v.hitch(this,"_mapExtentChangeHandler",this._selectionLayers,this._selectionLayerOptions))},_stopSelectionLayerQuery:function(){n.disconnect(this._onExtentChangeConnect)},_mapExtentChangeHandler:function(u,r,x){this._featurePtsFromSelectionLayer=[];this._featureLinesFromSelectionLayer=[];var t;this._SelectionLyrQuery.geometry=x;var w=v.hitch(this,
function(z){z instanceof Error||(z=this._extractPointsAndLines(z.features,r[t]),this._featurePtsFromSelectionLayer=this._featurePtsFromSelectionLayer.concat(z[0]),this._featureLinesFromSelectionLayer=this._featureLinesFromSelectionLayer.concat(z[1]))});b.forEach(u,function(z,B){z.visible&&z.loaded&&(t=B,z.queryFeatures(this._SelectionLyrQuery,w,w))},this)},_extractPointsAndLines:function(u,r){var x=r&&!1===r.snapToLastVertex?!1:!0,t=[],w=[],z,B;b.forEach(u,function(A,y){if((!A._graphicsLayer||A.visible)&&
A.geometry&&A._isSnapTarget)if("point"===A.geometry.type&&r.snapToPoint)t.push(A.geometry);else if("polyline"===A.geometry.type)for(z=0;z<A.geometry.paths.length;z++){w.push("lineStart");var E=A.geometry.paths[z].length;for(B=0;B<E;B++)if(x||B!==E-1){var G=A.geometry.getPoint(z,B);r.snapToVertex&&t.push(G);r.snapToEdge&&w.push(G)}w.push("lineEnd")}else if("polygon"===A.geometry.type)for(z=0;z<A.geometry.rings.length;z++){w.push("lineStart");E=A.geometry.rings[z].length;for(B=0;B<E;B++)if(x||B!==E-
1)G=A.geometry.getPoint(z,B),r.snapToVertex&&t.push(G),r.snapToEdge&&w.push(G);w.push("lineEnd")}});return[t,w]},_getSnappingPoint:function(u,r,x){var t,w=this.tolerance,z=this.map,B=this.map._getFrameWidth();u=u.concat(this._featurePtsFromSelectionLayer);r=r.concat(this._featureLinesFromSelectionLayer);if(this._currentGraphic){var A=this._extractPointsAndLines([this._currentGraphic],this._currentGraphicOption);u=u.concat(A[0]);r=r.concat(A[1])}var y,E;b.forEach(u,function(aa,J){var T=z.toScreen(aa,
!0);if(-1!==B&&(T.x%=B,0>T.x&&(T.x+=B),z.width>B))for(var Y=(z.width-B)/2;T.x<Y;)T.x+=B;t=Math.sqrt((T.x-x.x)*(T.x-x.x)+(T.y-x.y)*(T.y-x.y));t<=w&&(w=t,y=T.x,E=T.y)});if(y){r=new l(y,E);var G=r=z.toMap(r)}else{w=this.tolerance;for(u=0;u<r.length;u++)if("lineStart"===r[u])for(A=u+1;A<r.length;A++){if("lineEnd"!==r[A+1]&&"lineStart"!==r[A+1]&&"lineEnd"!==r[A]&&"lineStart"!==r[A]){var F=z.toScreen(r[A],!0),D=z.toScreen(r[A+1],!0),L=F.x>=D.x?F:D,O=F.x>=D.x?D:F;-1!==B&&(L.x%=B,0>L.x&&(L.x+=B),O.x%=B,0>
O.x&&(O.x+=B),O.x>L.x&&(O.x-=B));F=L.x;L=L.y;D=O.x;O=O.y;var S;if(F===D){var Z=F;var I=x.y;var N=S=F;var K=L<=O?L:O;var Q=L<=O?O:L}else L===O?(Z=x.x,I=L,N=F<=D?F:D,S=F<=D?D:F,K=Q=L):(I=(O-L)/(D-F),N=(L*D-F*O)/(D-F),Z=(N-(x.y*O-x.y*L-x.x*F+x.x*D)/(O-L))/((F-D)/(O-L)-I),I=I*Z+N,N=F<=D?F:D,S=F<=D?D:F,K=L<=O?L:O,Q=L<=O?O:L);if(Z>=N&&Z<=S&&I>=K&&I<=Q){if(F=Math.sqrt((x.x-Z)*(x.x-Z)+(x.y-I)*(x.y-I)),F<=w){w=F;var da=Z;var U=I}}else Z=Math.sqrt((F-x.x)*(F-x.x)+(L-x.y)*(L-x.y)),I=Math.sqrt((D-x.x)*(D-x.x)+
(O-x.y)*(O-x.y)),Z<=I?(N=Z,Z=F,I=L):(N=I,Z=D,I=O),N<=w&&(w=N,da=Z,U=I)}if("lineEnd"===r[A]){u=A;break}}da&&(r=new l(da,U),G=r=z.toMap(r))}return G},_setGraphic:function(u,r){this._currentGraphic=u;this._currentGraphicOption.snapToLastVertex=r&&!1===r.snapToLastVertex?!1:!0},_addSnappingPointGraphic:function(){var u=this.map;this._snappingGraphic.setSymbol(this.snapPointSymbol);u.graphics.add(this._snappingGraphic)},_setUpSnapping:function(){var u=this.map;this._onSnapKeyDown_connect=n.connect(u,"onKeyDown",
this,"_onSnapKeyDownHandler");this._onSnapKeyUp_connect=n.connect(u,"onKeyUp",this,"_onSnapKeyUpHandler");this._onSnappingMouseMove_connect=n.connect(u,"onMouseMove",this,"_onSnappingMouseMoveHandler");this._onSnappingMouseDrag_connect=n.connect(u,"onMouseDrag",this,"_onSnappingMouseMoveHandler");this.alwaysSnap&&this._activateSnapping()},_killOffSnapping:function(){n.disconnect(this._onSnapKeyDown_connect);n.disconnect(this._onSnapKeyUp_connect);n.disconnect(this._onSnappingMouseMove_connect);n.disconnect(this._onSnappingMouseDrag_connect);
this._deactivateSnapping()},_onSnapKeyDownHandler:function(u){u.keyCode===this.snapKey&&(n.disconnect(this._onSnapKeyDown_connect),this.alwaysSnap?this._deactivateSnapping():this._activateSnapping())},_activateSnapping:function(){this._snappingActive=!0;this._addSnappingPointGraphic();this._currentLocation&&this._onSnappingMouseMoveHandler(this._currentLocation)},_onSnapKeyUpHandler:function(u){u.keyCode===this.snapKey&&(this._onSnapKeyDown_connect=n.connect(this.map,"onKeyDown",this,"_onSnapKeyDownHandler"),
this.alwaysSnap?this._activateSnapping():this._deactivateSnapping())},_deactivateSnapping:function(){this._snappingActive=!1;this._snappingPoint=null;this.map.graphics.remove(this._snappingGraphic);this._snappingGraphic.setGeometry(null)},_onSnappingMouseMoveHandler:function(u){this._currentLocation=u;this._snappingPoint=null;this._snappingActive&&(this._snappingGraphic.hide(),this.getSnappingPoint(u.screenPoint).addCallback(this._snappingCallback))},_snappingCallback:function(u){if(this._snappingPoint=
u)this._snappingGraphic.show(),this._snappingGraphic.setGeometry(u)}});return c.SnappingManager=m})},"esri/tasks/geometry":function(){define("./GeometryService ./TrimExtendParameters ./BufferParameters ./AreasAndLengthsParameters ./LengthsParameters ./RelationParameters ./DensifyParameters ./GeneralizeParameters ./OffsetParameters ./DistanceParameters ./ProjectParameters".split(" "),function(){return{}})},"esri/tasks/TrimExtendParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel".split(" "),
function(m,n,v,b,p,f){m=m(null,{declaredClass:"esri.tasks.TrimExtendParameters",polylines:null,trimExtendTo:null,extendHow:null,toJson:function(){var d=v.map(this.polylines,function(c){return c.toJson()}),a={};a.polylines=b.toJson(d);a.trimExtendTo=b.toJson(this.trimExtendTo.toJson());a.sr=b.toJson(this.polylines[0].spatialReference.toJson());a.extendHow=this.extendHow||0;return a}});n.mixin(m,{DEFAULT_CURVE_EXTENSION:0,RELOCATE_ENDS:1,KEEP_END_ATTRIBUTES:2,NO_END_ATTRIBUTES:4,NO_EXTEND_AT_FROM:8,
NO_EXTEND_AT_TO:16});n.setObject("tasks.TrimExtendParameters",m,f);return m})},"esri/tasks/BufferParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/Polygon ../geometry/jsonUtils".split(" "),function(m,n,v,b,p,f,d,a){m=m(null,{declaredClass:"esri.tasks.BufferParameters",geometries:null,outSpatialReference:null,bufferSpatialReference:null,distances:null,unit:null,unionResults:!1,geodesic:!1,toJson:function(){var c={unit:this.unit,
unionResults:this.unionResults,geodesic:this.geodesic},h=this.distances,l=this.outSpatialReference,k=this.bufferSpatialReference,g=v.map(this.geometries,function(u){u="extent"===u.type?d.fromExtent(u):u;return u.toJson()},this),e=this.geometries;if(e&&0<e.length){var q="extent"===e[0].type?"esriGeometryPolygon":a.getJsonType(e[0]);c.geometries=b.toJson({geometryType:q,geometries:g});c.inSR=e[0].spatialReference.wkid?e[0].spatialReference.wkid:b.toJson(e[0].spatialReference.toJson())}h&&(c.distances=
h.join(","));l&&(c.outSR=l.wkid?l.wkid:b.toJson(l.toJson()));k&&(c.bufferSR=k.wkid?k.wkid:b.toJson(k.toJson()));return c}});n.setObject("tasks.BufferParameters",m,f);return m})},"esri/tasks/RelationParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(m,n,v,b,p,f,d){m=m(null,{declaredClass:"esri.tasks.RelationParameters",geometries1:null,geometries2:null,relation:null,relationParam:null,toJson:function(){var a=
v.map(this.geometries1,function(k){return k.toJson()}),c=v.map(this.geometries2,function(k){return k.toJson()}),h={},l=this.geometries1;l&&0<l.length&&(h.geometries1=b.toJson({geometryType:d.getJsonType(l[0]),geometries:a}),a=this.geometries1[0].spatialReference,h.sr=a.wkid?a.wkid:b.toJson(a.toJson()));(a=this.geometries2)&&0<a.length&&(h.geometries2=b.toJson({geometryType:d.getJsonType(a[0]),geometries:c}));this.relation&&(h.relation=this.relation);this.relationParam&&(h.relationParam=this.relationParam);
return h}});n.mixin(m,{SPATIAL_REL_CROSS:"esriGeometryRelationCross",SPATIAL_REL_DISJOINT:"esriGeometryRelationDisjoint",SPATIAL_REL_IN:"esriGeometryRelationIn",SPATIAL_REL_INTERIORINTERSECTION:"esriGeometryRelationInteriorIntersection",SPATIAL_REL_INTERSECTION:"esriGeometryRelationIntersection",SPATIAL_REL_COINCIDENCE:"esriGeometryRelationLineCoincidence",SPATIAL_REL_LINETOUCH:"esriGeometryRelationLineTouch",SPATIAL_REL_OVERLAP:"esriGeometryRelationOverlap",SPATIAL_REL_POINTTOUCH:"esriGeometryRelationPointTouch",
SPATIAL_REL_TOUCH:"esriGeometryRelationTouch",SPATIAL_REL_WITHIN:"esriGeometryRelationWithin",SPATIAL_REL_RELATION:"esriGeometryRelationRelation"});n.setObject("tasks.RelationParameters",m,f);return m})},"esri/tasks/DensifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(m,n,v,b,p,f,d){m=m(null,{declaredClass:"esri.tasks.DensifyParameters",geometries:null,geodesic:null,lengthUnit:null,maxSegmentLength:null,
toJson:function(){var a=v.map(this.geometries,function(h){return h.toJson()}),c={};this.geometries&&0<this.geometries.length&&(c.geometries=b.toJson({geometryType:d.getJsonType(this.geometries[0]),geometries:a}),c.sr=b.toJson(this.geometries[0].spatialReference.toJson()));this.geodesic&&(c.geodesic=this.geodesic);this.lengthUnit&&(c.lengthUnit=this.lengthUnit);this.maxSegmentLength&&(c.maxSegmentLength=this.maxSegmentLength);return c}});n.setObject("tasks.DensifyParameters",m,f);return m})},"esri/tasks/GeneralizeParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),
function(m,n,v,b,p,f,d){m=m(null,{declaredClass:"esri.tasks.GeneralizeParameters",geometries:null,deviationUnit:null,maxDeviation:null,toJson:function(){var a=v.map(this.geometries,function(h){return h.toJson()}),c={};this.geometries&&0<this.geometries.length&&(c.geometries=b.toJson({geometryType:d.getJsonType(this.geometries[0]),geometries:a}),c.sr=b.toJson(this.geometries[0].spatialReference.toJson()));this.deviationUnit&&(c.deviationUnit=this.deviationUnit);this.maxDeviation&&(c.maxDeviation=this.maxDeviation);
return c}});n.setObject("tasks.GeneralizeParameters",m,f);return m})},"esri/tasks/OffsetParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(m,n,v,b,p,f,d){m=m(null,{declaredClass:"esri.tasks.OffsetParameters",geometries:null,bevelRatio:null,offsetDistance:null,offsetHow:null,offsetUnit:null,toJson:function(){var a=v.map(this.geometries,function(h){return h.toJson()}),c={};this.geometries&&
0<this.geometries.length&&(c.geometries=b.toJson({geometryType:d.getJsonType(this.geometries[0]),geometries:a}),c.sr=b.toJson(this.geometries[0].spatialReference.toJson()));this.bevelRatio&&(c.bevelRatio=this.bevelRatio);this.offsetDistance&&(c.offsetDistance=this.offsetDistance);this.offsetHow&&(c.offsetHow=this.offsetHow);this.offsetUnit&&(c.offsetUnit=this.offsetUnit);return c}});n.mixin(m,{OFFSET_BEVELLED:"esriGeometryOffsetBevelled",OFFSET_MITERED:"esriGeometryOffsetMitered",OFFSET_ROUNDED:"esriGeometryOffsetRounded"});
n.setObject("tasks.OffsetParameters",m,f);return m})},"esri/tasks/DistanceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(m,n,v,b,p,f){m=m(null,{declaredClass:"esri.tasks.DistanceParameters",geometry1:null,geometry2:null,distanceUnit:null,geodesic:null,toJson:function(){var d={},a=this.geometry1;a&&(d.geometry1=v.toJson({geometryType:f.getJsonType(a),geometry:a}));if(a=this.geometry2)d.geometry2=v.toJson({geometryType:f.getJsonType(a),
geometry:a});d.sr=v.toJson(this.geometry1.spatialReference.toJson());this.distanceUnit&&(d.distanceUnit=this.distanceUnit);this.geodesic&&(d.geodesic=this.geodesic);return d}});n.setObject("tasks.DistanceParameters",m,p);return m})},"esri/tasks/identify":function(){define(["./IdentifyTask","./IdentifyParameters","./IdentifyResult"],function(){return{}})},"esri/tasks/IdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./IdentifyResult".split(" "),
function(m,n,v,b,p,f,d,a,c){m=m(a,{declaredClass:"esri.tasks.IdentifyTask",_eventMap:{complete:["results"]},constructor:function(h,l){this._url.path+="/identify";this._handler=n.hitch(this,this._handler);this.gdbVersion=l&&l.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(h,l,k,g,e){try{var q=[];v.forEach(h.results,function(u,r){q[r]=new c(u)});this._successHandler([q],"onComplete",k,e)}catch(u){this._errorHandler(u,g,e)}},execute:function(h,
l,k,g){var e=g.assembly;h=this._encode(n.mixin({},this._url.query,{f:"json"},h.toJson(e&&e[0])));var q=this._handler,u=this._errorHandler;this.gdbVersion&&(h.gdbVersion=this.gdbVersion);return f({url:this._url.path,content:h,callbackParamName:"callback",load:function(r,x){q(r,x,l,k,g.dfd)},error:function(r){u(r,k,g.dfd)}})},onComplete:function(){}});d._createWrappers(m);n.setObject("tasks.IdentifyTask",m,p);return m})},"esri/tasks/IdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../graphic ../geometry/jsonUtils".split(" "),
function(m,n,v,b,p,f){m=m(null,{declaredClass:"esri.tasks.IdentifyResult",constructor:function(d){n.mixin(this,d);this.feature=new p(d.geometry?f.fromJson(d.geometry):null,null,d.attributes);delete this.geometry;delete this.attributes}});n.setObject("tasks.IdentifyResult",m,b);return m})},"esri/tasks/IdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../layerUtils ../geometry/jsonUtils ../geometry/scaleUtils".split(" "),function(m,
n,v,b,p,f,d,a,c){var h=m(null,{declaredClass:"esri.tasks.IdentifyParameters",constructor:function(){this.layerOption=h.LAYER_OPTION_TOP},geometry:null,spatialReference:null,layerIds:null,tolerance:null,returnGeometry:!1,returnFieldName:!1,returnUnformattedValues:!1,mapExtent:null,width:400,height:400,dpi:96,layerDefinitions:null,timeExtent:null,layerTimeOptions:null,dynamicLayerInfos:null,toJson:function(l){var k=l&&l.geometry||this.geometry,g=this.mapExtent,e=this.spatialReference,q=this.layerIds;
l={tolerance:this.tolerance,returnGeometry:this.returnGeometry,returnFieldName:this.returnFieldName,returnUnformattedValues:this.returnUnformattedValues,imageDisplay:this.width+","+this.height+","+this.dpi,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision};if(k){var u=k.toJson();delete u.spatialReference;l.geometry=b.toJson(u);l.geometryType=a.getJsonType(k)}e?l.sr=e.wkid||b.toJson(e.toJson()):k&&k.spatialReference?l.sr=k.spatialReference.wkid||b.toJson(k.spatialReference.toJson()):
g&&g.spatialReference&&(l.sr=g.spatialReference.wkid||b.toJson(g.spatialReference.toJson()));g&&(l.mapExtent=g.xmin+","+g.ymin+","+g.xmax+","+g.ymax);l.layers=this.layerOption;q&&(l.layers+=":"+q.join(","));l.layerDefs=d._serializeLayerDefinitions(this.layerDefinitions,!0);k=this.timeExtent;l.time=k?k.toJson().join(","):null;l.layerTimeOptions=d._serializeTimeOptions(this.layerTimeOptions);if(this.dynamicLayerInfos&&0<this.dynamicLayerInfos.length){g=c.getScale({extent:g,width:this.width,spatialReference:g.spatialReference});
var r=d._getLayersForScale(g,this.dynamicLayerInfos),x=[];v.forEach(this.dynamicLayerInfos,function(t){if(!t.subLayerIds){var w=t.id;if((!this.layerIds||this.layerIds&&-1!==v.indexOf(this.layerIds,w))&&-1!==v.indexOf(r,w)){var z={id:w};z.source=t.source&&t.source.toJson();var B;this.layerDefinitions&&this.layerDefinitions[w]&&(B=this.layerDefinitions[w]);B&&(z.definitionExpression=B);var A;this.layerTimeOptions&&this.layerTimeOptions[w]&&(A=this.layerTimeOptions[w]);A&&(z.layerTimeOptions=A.toJson());
x.push(z)}}},this);g=b.toJson(x);"[]"===g&&(g="[{}]");l.dynamicLayers=g}return l}});n.mixin(h,{LAYER_OPTION_TOP:"top",LAYER_OPTION_VISIBLE:"visible",LAYER_OPTION_ALL:"all"});n.setObject("tasks.IdentifyParameters",h,f);return h})},"esri/virtualearth/VEGeocoder":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/has ../kernel ../urlUtils ../tasks/Task ./VEGeocodeResult ../deferredUtils ../request".split(" "),function(m,n,v,b,p,f,d,a,c,h,l){m=m(a,{declaredClass:"esri.virtualearth.VEGeocoder",
constructor:function(k){try{if(k=n.mixin({bingMapsKey:null},k||{}),this.url=d.getProtocolForWebResource()+"//serverapi.arcgisonline.com/veadaptor/production/services/geocode/geocode",this._url=d.urlToObject(this.url),this._queue=[],this.bingMapsKey=k.bingMapsKey,this.culture=k.culture||"en-US",this._errorHandler=n.hitch(this,this._errorHandler),this._addressToLocationsHandler=n.hitch(this,this._addressToLocationsHandler),!this.bingMapsKey)throw Error("BingMapsKey must be provided.");}catch(g){throw this.onError(g),
g;}},addressToLocations:function(k,g,e){if(this.bingMapsKey){var q=n.mixin({},this._url.query,{query:k,token:this.bingMapsKey,culture:this.culture}),u=this._addressToLocationsHandler,r=this._errorHandler,x=new b(h._dfdCanceller);x._pendingDfd=l({url:this._url.path,content:q,callbackParamName:"callback",load:function(t,w){u(t,w,g,e,x)},error:function(t){r(t,e,x)}});return x}this._queue.push(arguments)},_addressToLocationsHandler:function(k,g,e,q,u){try{v.forEach(k,function(r,x){k[x]=new c(r)}),this._successHandler([k],
"onAddressToLocationsComplete",e,u)}catch(r){this._errorHandler(r,q,u)}},onAddressToLocationsComplete:function(){},setBingMapsKey:function(k){this.bingMapsKey=k},setCulture:function(k){this.culture=k}});n.setObject("virtualearth.VEGeocoder",m,f);return m})},"esri/virtualearth/VEGeocodeResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/Point ../geometry/Extent ./VEAddress".split(" "),function(m,n,v,b,p,f,d){m=m(null,{declaredClass:"esri.virtualearth.VEGeocodeResult",
constructor:function(a){n.mixin(this,{address:null,bestView:null,calculationMethod:null,confidence:null,displayName:null,entityType:null,location:null,matchCodes:null},a);this.address&&(this.address=new d(this.address));this.bestView&&(this.bestView=new f(this.bestView));this.locationArray&&(this.calculationMethod=this.locationArray[0].calculationMethod,this.location=new p(this.locationArray[0]))}});n.setObject("virtualearth.VEGeocodeResult",m,b);return m})},"esri/virtualearth/VEAddress":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel"],function(m,n,v,b){m=m(null,{declaredClass:"esri.virtualearth.VEAddress",constructor:function(p){n.mixin(this,{addressLine:null,adminDistrict:null,countryRegion:null,district:null,formattedAddress:null,locality:null,postalCode:null,postalTown:null},p)}});n.setObject("virtualearth.VEAddress",m,b);return m})},"esri/dijit/Geocoder":function(){define("require dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/_base/event dojo/dom-attr dojo/dom-class dojo/dom-style dojo/dom-construct dojo/keys dojo/on dojo/query dojo/i18n!../nls/jsapi dojo/text!./templates/Geocoder.html dojo/uacss dojo/_base/kernel dijit/a11yclick dijit/_TemplatedMixin dijit/focus dijit/_FocusMixin ../kernel ../urlUtils ../SpatialReference ../graphic ../symbols/PictureMarkerSymbol ./_EventedWidget ../geometry/Point ../geometry/Extent ../tasks/locator ../tasks/query ../tasks/QueryTask ../geometry/scaleUtils".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x,t,w,z,B,A,y,E,G,F,D,L,O,S,Z){n=n("esri.dijit.Geocoder",[G,x,w],{templateString:e,reHostedFS:/https?:\/\/services.*\.arcgis\.com/i,_eventMap:{select:["result"],"find-results":["results"],"auto-complete":["results"],"geocoder-select":["geocoder"],clear:!0,"enter-key-select":!0,load:!0},constructor:function(I,N){u.deprecated("esri.dijit.Geocoder","Use esri.dijit.Search instead","4.0");this._css={GeocoderContainerClass:"esriGeocoderContainer",GeocoderClass:"esriGeocoder",
GeocoderMultipleClass:"esriGeocoderMultiple",GeocoderIconClass:"esriGeocoderIcon",GeocoderActiveClass:"esriGeocoderActive",GeocoderResultsOpenClass:"esriGeocoderResultsOpen",GeocoderMenuOpenClass:"esriGeocoderMenuOpen",loadingClass:"esriGeocoderLoading",resultsContainerClass:"esriGeocoderResults",resultsItemClass:"esriGeocoderResult",resultsItemEvenClass:"esriGeocoderResultEven",resultsItemOddClass:"esriGeocoderResultOdd",resultsItemFirstClass:"esriGeocoderResultFirst",resultsItemLastClass:"esriGeocoderResultLast",
resultsPartialMatchClass:"esriGeocoderResultPartial",searchButtonClass:"esriGeocoderSearch",clearButtonClass:"esriGeocoderReset",hasValueClass:"esriGeocoderHasValue",geocoderMenuClass:"esriGeocoderMenu",geocoderMenuHeaderClass:"esriGeocoderMenuHeader",geocoderMenuCloseClass:"esriGeocoderMenuClose",activeMenuClass:"esriGeocoderMenuActive",geocoderMenuArrowClass:"esriGeocoderMenuArrow",geocoderSelectedClass:"esriGeocoderSelected",geocoderSelectedCheckClass:"esriGeocoderSelectedCheck",GeocoderClearClass:"esriGeocoderClearFloat"};
this.options={autoComplete:!1,arcgisGeocoder:!0,value:"",theme:"simpleGeocoder",activeGeocoderIndex:0,maxLocations:6,minCharacters:3,searchDelay:300,geocoderMenu:!0,autoNavigate:!0,showResults:!0,map:null,activeGeocoder:null,geocoders:null,zoomScale:1E4,highlightLocation:!1,symbol:new E(m.toUrl("./images/sdk_gps_location.png"),28,28),graphicsLayer:null};var K=v.mixin({},this.options,I);this.set("autoComplete",K.autoComplete);this.set("arcgisGeocoder",K.arcgisGeocoder);this.set("value",K.value);this.set("theme",
K.theme);this.set("activeGeocoderIndex",K.activeGeocoderIndex);this.set("maxLocations",K.maxLocations);this.set("minCharacters",K.minCharacters);this.set("searchDelay",K.searchDelay);this.set("geocoderMenu",K.geocoderMenu);this.set("autoNavigate",K.autoNavigate);this.set("showResults",K.showResults);this.set("map",K.map);this.set("activeGeocoder",K.activeGeocoder);this.set("geocoders",K.geocoders);this.set("zoomScale",K.zoomScale);this.set("highlightLocation",K.highlightLocation);this.set("symbol",
K.symbol);this.set("graphicsLayer",K.graphicsLayer);this.set("results",[]);this._i18n=g;this._deferreds=[];this._defaultSR=new A(4326);this.watch("value",this._updateValue);this.watch("theme",this._updateTheme);this.watch("activeGeocoder",this._setActiveGeocoder);this.watch("activeGeocoderIndex",this._setActiveGeocoderIndex);this.watch("geocoders",this._updateGeocoder);this.watch("arcgisGeocoder",this._updateGeocoder);this.watch("geocoderMenu",this._updateGeocoder);this.watch("map",this._setupEvents);
this.domNode=N},startup:function(){this.inherited(arguments);if(this._geocoders.length)if(this.domNode)if(this.get("map"))if(this.get("map").loaded)this._init();else l.once(this.get("map"),"load",v.hitch(this,function(){this._init()}));else this._init();else this.destroy();else this.destroy()},postCreate:function(){this.inherited(arguments);this.own(l(this.submitNode,r,v.hitch(this,this._findThenSelect)));this.own(l(this.geocoderMenuArrowNode,r,v.hitch(this,this._toggleGeolocatorMenu)));this.own(l(this.inputNode,
r,v.hitch(this,this._inputClick)));this.own(l(this.clearNode,r,v.hitch(this,this.clear)));this.own(l(this.geocoderMenuCloseNode,r,v.hitch(this,this._hideGeolocatorMenu)));this._updateGeocoder();this._setupEvents();this.get("value")&&this._checkStatus();this._hideMenus()},destroy:function(){this._removeEvents();c.empty(this.domNode);this.inherited(arguments)},clear:function(){this.onClear();var I=this.get("highlightGraphic"),N=this.get("graphicsLayer");I&&(N?N.remove(I):this.get("map").graphics.remove(I),
this.set("highlightGraphic",null));f.set(this.inputNode,"value","");this.set("value","");this.set("results",[]);d.remove(this.containerNode,this._css.hasValueClass);f.set(this.clearNode,"title","");this._hideMenus();this._hideLoading()},show:function(){a.set(this.domNode,"display","block")},hide:function(){a.set(this.domNode,"display","none")},find:function(I){var N=new b;if(I)if("string"===typeof I)this._findQuery(I).then(function(Q){N.resolve(Q)});else if("object"===typeof I&&I.hasOwnProperty("geometry")){switch(I.geometry.type){case "extent":var K=
I.geometry.getCenter();break;case "multipoint":K=I.geometry.getExtent().getCenter();break;case "point":K=I.geometry;break;case "polygon":K=I.geometry.getExtent().getCenter();break;case "polyline":K=I.geometry.getExtent().getCenter()}K&&this._reverseGeocodePoint(K,I.geometry).then(function(Q){Q.results[0]&&(I.hasOwnProperty("attributes")&&Q.results[0].feature.setAttributes(v.mixin(Q.results[0].feature.attributes,I.attributes)),I.hasOwnProperty("infoTemplate")&&Q.results[0].feature.setInfoTemplate(I.infoTemplate),
I.hasOwnProperty("symbol")&&Q.results[0].feature.setSymbol(I.symbol));N.resolve(Q)},function(Q){N.reject(Q)})}else"object"===typeof I&&"point"===I.type?this._reverseGeocodePoint(I).then(function(Q){N.resolve(Q)},function(Q){N.reject(Q)}):I instanceof Array&&2===I.length?(K=new F(I,new A({wkid:4326})),this._reverseGeocodePoint(K).then(function(Q){N.resolve(Q)},function(Q){N.reject(Q)})):N.reject("Geocoder:: Invalid find type");else this._findQuery(this.get("value")).then(function(Q){N.resolve(Q)});
return N.promise},focus:function(){t.focus(this.inputNode);var I=this.get("map");I&&I.disableKeyboardNavigation()},blur:function(){t.curNode&&t.curNode.blur();this.inputNode.blur();this._hideMenus();var I=this.get("map");I&&I.enableKeyboardNavigation()},select:function(I){this.onSelect(I);this._hideMenus();this._hideLoading();this.get("autoNavigate")&&I&&I.hasOwnProperty("extent")&&this.get("map")&&this.get("map").setExtent(I.extent);if(I.feature){var N=this.get("highlightGraphic"),K=this.get("graphicsLayer"),
Q=this.get("symbol")||I.feature.symbol;N?(N.setGeometry(I.feature.geometry),N.setAttributes(I.feature.attributes),N.setInfoTemplate(I.feature.infoTemplate),N.setSymbol(Q)):(N=I.feature,this.get("highlightLocation")&&(N.setSymbol(Q),K?K.add(N):this.get("map").graphics.add(N)));this.set("highlightGraphic",N)}},onSelect:function(){},onFindResults:function(){},onAutoComplete:function(){},onGeocoderSelect:function(){},onClear:function(){},onEnterKeySelect:function(){},onLoad:function(){},_onFocus:function(){this.focus();
this.inherited(arguments)},_onBlur:function(){this.blur();this.inherited(arguments)},_autoComplete:function(){var I=this.get("activeGeocoder"),N=this.reHostedFS.test(I.url);("query"!==I.type||N)&&this._query({delay:this.get("searchDelay"),autoComplete:!0,search:this.get("value")}).then(v.hitch(this,function(K){this.onAutoComplete(K);this.get("showResults")&&this._showResults(K)}))},_init:function(){this.set("loaded",!0);this.onLoad()},_containsNonLatinCharacter:function(I){for(var N=0;N<I.length;N++)if(255<
I.charCodeAt(N))return!0;return!1},_findQuery:function(I){var N=new b;this._query({delay:0,search:I}).then(v.hitch(this,function(K){this.onFindResults(K);N.resolve(K)}),v.hitch(this,function(K){this.onFindResults(K);N.reject(K)}));return N.promise},_reverseGeocodePoint:function(I,N){var K=new b;if(I&&this.get("activeGeocoder")){var Q=N||I,da=this.get("activeGeocoder").distance||1500;this._task.outSpatialReference=this._defaultSR;this.get("map")&&(this._task.outSpatialReference=this.get("map").spatialReference);
this._task.locationToAddress(I,da,v.hitch(this,function(U){U={results:[this._hydrateResult(U)],geometry:Q};this.onFindResults(U);K.resolve(U)}),v.hitch(this,function(U){K.reject(U)}))}else K.reject("Geocoder:: no point or active geocoder defined");return K.promise},_setEsriGeocoder:function(){this.get("arcgisGeocoder")?("object"===typeof this.get("arcgisGeocoder")?this._arcgisGeocoder=this.get("arcgisGeocoder"):this._arcgisGeocoder={},this._arcgisGeocoder.hasOwnProperty("suggest")||(this._arcgisGeocoder.suggest=
!0),this._arcgisGeocoder.hasOwnProperty("singleLineFieldName")||(this._arcgisGeocoder.singleLineFieldName="SingleLine"),this._arcgisGeocoder.url||(this._arcgisGeocoder.url=B.getProtocolForWebResource()+"//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"),this._arcgisGeocoder.name||(this._arcgisGeocoder.name=g.widgets.Geocoder.esriGeocoderName),this._arcgisGeocoder.hasOwnProperty("localSearchOptions")||(this._arcgisGeocoder.localSearchOptions={minScale:3E5,distance:5E4}),this.set("arcgisGeocoder",
this._arcgisGeocoder)):this.set("arcgisGeocoder",!1)},_setActiveGeocoder:function(){this.set("activeGeocoder",this._geocoders[this.get("activeGeocoderIndex")]);this._task="query"===this.activeGeocoder.type?new S(this.get("activeGeocoder").url):new L(this.get("activeGeocoder").url);this._updatePlaceholder()},_setGeocoderList:function(){var I=[];this.get("arcgisGeocoder")&&(I=I.concat([this._arcgisGeocoder]));this.get("geocoders")&&this.get("geocoders").length&&(I=I.concat(this.get("geocoders")));this._geocoders=
I},_updateGeocoder:function(){this.set("activeGeocoderIndex",0);this._setEsriGeocoder();this._setGeocoderList();this._setActiveGeocoder();this._insertGeocoderMenuItems()},_updatePlaceholder:function(){this._placeholder="";this.get("activeGeocoder")&&this.get("activeGeocoder").placeholder&&(this._placeholder=this.get("activeGeocoder").placeholder);f.set(this.inputNode,"placeholder",this._placeholder);f.set(this.submitNode,"title",this._placeholder)},_updateValue:function(I,N,K){this._ignoreUpdateValue||
(f.set(this.inputNode,"value",K),this._checkStatus())},_updateTheme:function(I,N,K){d.remove(this.domNode,N);d.add(this.domNode,K)},_setActiveGeocoderIndex:function(I,N,K){this.set("activeGeocoderIndex",K);this._setActiveGeocoder();this._hideMenus();this._insertGeocoderMenuItems();I={attr:this.get("activeGeocoder"),oldVal:N,newVal:K};this.onGeocoderSelect(I)},_clearQueryTimeout:function(){this._queryTimer&&clearTimeout(this._queryTimer)},_query:function(I){I||(I={delay:0});I.search||(I.search=this.get("value"));
var N=new b;this._deferreds.push(N);I.delay?(this._clearQueryTimeout(),this._queryTimer=setTimeout(v.hitch(this,function(){this._performTask(N,I)}),I.delay)):this._performTask(N,I);return N.promise},_performTask:function(I,N){if(N.search){this._hideGeolocatorMenu();this._showLoading();var K="";this.get("activeGeocoder").prefix&&(K+=this.get("activeGeocoder").prefix);K+=N.search;this.get("activeGeocoder").suffix&&(K+=this.get("activeGeocoder").suffix);var Q=this.get("activeGeocoder").outFields;Q&&
(Q instanceof Array||(Q=[Q]));var da=this.get("maxLocations")||6,U=this.get("activeGeocoder").searchExtent,aa=this._defaultSR;this.get("map")&&(aa=this.get("map").spatialReference);if("query"===this.get("activeGeocoder").type){var J=new O;J.outSpatialReference=aa;J.returnGeometry=!0;J.num=da;U&&(J.geometry=U);da=this.get("activeGeocoder").exactMatch;U=this.get("activeGeocoder").field;aa="";this.reHostedFS.test(this.get("activeGeocoder").url)&&this._containsNonLatinCharacter(K)&&(aa="N");J.where=da?
U+" \x3d "+aa+"'"+K+"'":"UPPER("+U+") LIKE "+aa+"'%"+K.toUpperCase()+"%'";Q&&(J.outFields=Q);this._task.execute(J,v.hitch(this,function(T){this._receivedResults(T.features,I,N)}),v.hitch(this,function(T){this._receivedResults([],I,N)}))}else J={},this.get("activeGeocoder").categories&&(J.categories=this.get("activeGeocoder").categories),this._task.outSpatialReference=aa,this.get("map")&&this.get("activeGeocoder").localSearchOptions&&this.get("activeGeocoder").localSearchOptions.hasOwnProperty("distance")&&
this.get("activeGeocoder").localSearchOptions.hasOwnProperty("minScale")&&(aa=this.get("map").getScale(),!this.get("activeGeocoder").localSearchOptions.minScale||aa&&aa<=parseFloat(this.get("activeGeocoder").localSearchOptions.minScale))&&(J.location=this.get("map").extent.getCenter(),J.distance=this.get("activeGeocoder").localSearchOptions.distance),this.get("activeGeocoder").suggest&&N.autoComplete?(J.text=K,U&&(J.searchExtent=U),this._task.suggestLocations(J).then(v.hitch(this,function(T){this._receivedResults(T,
I,N)}),v.hitch(this,function(T){this._receivedResults(T,I,N)}))):(J.address={},J.maxLocations=da,U&&(J.searchExtent=U),this.get("activeGeocoder").sourceCountry&&(J.countryCode=this.get("activeGeocoder").sourceCountry),N.magicKey&&(J.magicKey=N.magicKey),this.get("activeGeocoder").singleLineFieldName?J.address[this.get("activeGeocoder").singleLineFieldName]=K:J.address["Single Line Input"]=K,Q&&(J.outFields=Q),this._task.addressToLocations(J,v.hitch(this,function(T){this._receivedResults(T,I,N)}),
v.hitch(this,function(T){this._receivedResults(T,I,N)})))}else this._hideLoading(),I.reject("Geocoder:: no search to perform")},_showResults:function(){this._hideGeolocatorMenu();var I="";if(this.get("results")&&this.get("results").length&&this.resultsNode){var N=this.get("value"),K=new RegExp("("+N+")","gi");I+='\x3cul role\x3d"presentation"\x3e';for(N=0;N<this.get("results").length&&5>N;++N){var Q=this.get("results")[N].text||this.get("results")[N].name,da=this._css.resultsItemClass+" ";da=0===
N%2?da+this._css.resultsItemOddClass:da+this._css.resultsItemEvenClass;0===N?da+=" "+this._css.resultsItemFirstClass:N===this.get("results").length-1&&(da+=" "+this._css.resultsItemLastClass);I+='\x3cli title\x3d"'+Q+'" data-text\x3d"'+Q+'" data-item\x3d"true" data-index\x3d"'+N+'" role\x3d"menuitem" tabindex\x3d"0" class\x3d"'+da+'"\x3e'+Q.replace(K,'\x3cstrong class\x3d"'+this._css.resultsPartialMatchClass+'"\x3e$1\x3c/strong\x3e')+"\x3c/li\x3e"}I+="\x3c/ul\x3e";this.resultsNode&&(this.resultsNode.innerHTML=
I);this._autoCompleteEvent();this._showResultsMenu()}else this.resultsNode&&(this.resultsNode.innerHTML=I),this._hideResultsMenu()},_receivedResults:function(I,N){this._hideLoading();var K=this._hydrateResults(I);this.set("results",K);K={results:K,value:this.get("value")};N.resolve(K)},_showLoading:function(){d.add(this.containerNode,this._css.loadingClass)},_hideLoading:function(){d.remove(this.containerNode,this._css.loadingClass)},_showGeolocatorMenu:function(){d.add(this.containerNode,this._css.activeMenuClass);
d.add(this.domNode,this._css.GeocoderMenuOpenClass);a.set(this.geocoderMenuNode,"display","block");f.set(this.geocoderMenuInsertNode,"aria-hidden","false");f.set(this.geocoderMenuArrowNode,"aria-expanded","true")},_hideGeolocatorMenu:function(){d.remove(this.containerNode,this._css.activeMenuClass);d.remove(this.domNode,this._css.GeocoderMenuOpenClass);a.set(this.geocoderMenuNode,"display","none");f.set(this.geocoderMenuInsertNode,"aria-hidden","true");f.set(this.geocoderMenuArrowNode,"aria-expanded",
"false")},_toggleGeolocatorMenu:function(){this._hideResultsMenu();"block"===a.get(this.geocoderMenuNode,"display")?this._hideGeolocatorMenu():this._showGeolocatorMenu()},_showResultsMenu:function(){d.add(this.containerNode,this._css.GeocoderActiveClass);d.add(this.domNode,this._css.GeocoderResultsOpenClass);a.set(this.resultsNode,"display","block");f.set(this.resultsNode,"aria-hidden","false")},_hideResultsMenu:function(){a.set(this.resultsNode,"display","none");d.remove(this.containerNode,this._css.GeocoderActiveClass);
d.remove(this.domNode,this._css.GeocoderResultsOpenClass);f.set(this.resultsNode,"aria-hidden","true")},_hideMenus:function(){this._hideGeolocatorMenu();this._hideResultsMenu()},_insertGeocoderMenuItems:function(){if(this.get("geocoderMenu")&&this._geocoders&&1<this._geocoders.length){var I="",N;var K='\x3cul role\x3d"presentation"\x3e';for(N=0;N<this._geocoders.length;N++){I=this._css.resultsItemClass+" ";I=0===N%2?I+this._css.resultsItemOddClass:I+this._css.resultsItemEvenClass;N===this.get("activeGeocoderIndex")&&
(I+=" "+this._css.geocoderSelectedClass);0===N?I+=" "+this._css.resultsItemFirstClass:N===this._geocoders.length-1&&(I+=" "+this._css.resultsItemLastClass);var Q=this._geocoders[N].name||g.widgets.Geocoder.main.untitledGeocoder;K+='\x3cli data-index\x3d"'+N+'" data-item\x3d"true" role\x3d"menuitem" tabindex\x3d"0" class\x3d"'+I+'"\x3e';K+='\x3cdiv class\x3d"'+this._css.geocoderSelectedCheckClass+'"\x3e\x3c/div\x3e';K+=Q;K+='\x3cdiv class\x3d"'+this._css.GeocoderClearClass+'"\x3e\x3c/div\x3e';K+="\x3c/li\x3e"}this.geocoderMenuInsertNode.innerHTML=
K+"\x3c/ul\x3e";this._geocoderMenuEvent();a.set(this.geocoderMenuNode,"display","none");a.set(this.geocoderMenuArrowNode,"display","block");d.add(this.containerNode,this._css.GeocoderMultipleClass)}else this.geocoderMenuInsertNode.innerHTML="",a.set(this.geocoderMenuNode,"display","none"),a.set(this.geocoderMenuArrowNode,"display","none"),d.remove(this.containerNode,this._css.GeocoderMultipleClass)},_checkStatus:function(){this.get("value")?(d.add(this.containerNode,this._css.hasValueClass),f.set(this.clearNode,
"title",g.widgets.Geocoder.main.clearButtonTitle)):this.clear()},_autoCompleteEvent:function(){var I=k('[data-item\x3d"true"]',this.resultsNode);this._acEvent&&this._acEvent.remove();this._acEvent=l(I,"click, keydown",v.hitch(this,function(N){this._clearQueryTimeout();var K=parseInt(f.get(N.currentTarget,"data-index"),10),Q=f.get(N.currentTarget,"data-text");"click"===N.type||"keydown"===N.type&&N.keyCode===h.ENTER?(f.set(this.inputNode,"value",Q),this.set("value",Q),this.get("results")&&this.get("results")[K]&&
(N=this.get("results")[K],N.name?this.select(N):this._query({delay:0,search:N.text,magicKey:N.magicKey||null}).then(v.hitch(this,function(da){this.select(da.results[0])})))):"keydown"!==N.type||N.keyCode!==h.BACKSPACE&&N.keyCode!==h.DELETE?"keydown"===N.type&&N.keyCode===h.UP_ARROW?(p.stop(N),N=K-1,0>N?this.inputNode.focus():I[N].focus()):"keydown"===N.type&&N.keyCode===h.DOWN_ARROW?(p.stop(N),N=K+1,N>=I.length?this.inputNode.focus():I[N].focus()):N.keyCode===h.ESCAPE&&this._hideMenus():(p.stop(N),
this.inputNode.focus(),N=this.inputNode.value.slice(0,-1),f.set(this.inputNode,"value",N),this.set("value",N))}))},_geocoderMenuEvent:function(){var I=k('[data-item\x3d"true"]',this.geocoderMenuInsertNode);this._gmEvent&&this._gmEvent.remove();this._gmEvent=l(I,"click, keydown",v.hitch(this,function(N){var K=parseInt(f.get(N.currentTarget,"data-index"),10);"click"===N.type||"keydown"===N.type&&N.keyCode===h.ENTER?(this._setActiveGeocoderIndex(null,null,K),this._hideGeolocatorMenu()):"keydown"===N.type&&
N.keyCode===h.UP_ARROW?(p.stop(N),N=K-1,0>N?this.geocoderMenuArrowNode.focus():I[N].focus()):"keydown"===N.type&&N.keyCode===h.DOWN_ARROW?(p.stop(N),N=K+1,N>=I.length?this.geocoderMenuArrowNode.focus():I[N].focus()):N.keyCode===h.ESCAPE&&this._hideGeolocatorMenu()}))},_removeEvents:function(){var I;if(this._events&&this._events.length)for(I=0;I<this._events.length;I++)this._events[I].remove();this._acEvent&&this._acEvent.remove();this._gmEvent&&this._gmEvent.remove();this._events=[]},_setupEvents:function(){this._removeEvents();
var I=l(document,"click",v.hitch(this,function(N){this._hideResultsMenu(N)}));this._events.push(I);I=l(this.inputNode,"keyup",v.hitch(this,function(N){this._inputKeyUp(N)}));this._events.push(I);I=l(this.inputNode,"keydown",v.hitch(this,function(N){this._inputKeyDown(N)}));this._events.push(I);I=l(this.geocoderMenuArrowNode,"keydown",this._geocoderMenuButtonKeyDown());this._events.push(I);this.get("map")&&(I=l(this.get("map"),"mouse-down",v.hitch(this,function(){this.blur()})),this._events.push(I));
this._geocoderMenuEvent();this._autoCompleteEvent()},_findThenSelect:function(){this.find().then(v.hitch(this,function(I){I.results&&I.results.length&&(this.select(I.results[0]),this.onEnterKeySelect())}))},_inputKeyUp:function(I){if(I){this._clearQueryTimeout();var N=this.inputNode.value;this._ignoreUpdateValue=!0;this.set("value",N);this._ignoreUpdateValue=!1;var K=0;N&&(K=N.length);if(I.ctrlKey||I.metaKey||I.altKey||I.keyCode===h.copyKey||I.keyCode===h.ALT||I.keyCode===h.CTRL||I.keyCode===h.META||
I.keyCode===h.SHIFT||I.keyCode===h.UP_ARROW||I.keyCode===h.DOWN_ARROW||I.keyCode===h.LEFT_ARROW||I.keyCode===h.RIGHT_ARROW)return I;I&&I.keyCode===h.ENTER?(this._cancelDeferreds(),this._findThenSelect()):I&&I.keyCode===h.ESCAPE?(this._cancelDeferreds(),this._hideMenus()):I&&I.keyCode===h.TAB?(this._cancelDeferreds(),this._hideMenus()):this.get("autoComplete")&&K>=this.get("minCharacters")?this._autoComplete():this._hideMenus();this._checkStatus()}},_cancelDeferreds:function(){if(this._deferreds.length){for(var I=
0;I<this._deferreds.length;I++)this._deferreds[I].cancel("Geocoder:: stop query");this._deferreds=[]}},_inputKeyDown:function(I){var N=k('[data-item\x3d"true"]',this.resultsNode);I&&I.keyCode===h.TAB?(this._cancelDeferreds(),this._hideMenus()):I&&I.keyCode===h.UP_ARROW?(p.stop(I),(I=N.length)&&N[I-1].focus()):I&&I.keyCode===h.DOWN_ARROW&&(p.stop(I),N[0]&&N[0].focus())},_geocoderMenuButtonKeyDown:function(I){var N=k('[data-item\x3d"true"]',this.geocoderMenuInsertNode);I&&I.keyCode===h.UP_ARROW?(p.stop(I),
this._showGeolocatorMenu(),(I=N.length)&&N[I-1].focus()):I&&I.keyCode===h.DOWN_ARROW&&(p.stop(I),this._showGeolocatorMenu(),N[0]&&N[0].focus())},_inputClick:function(){this._hideGeolocatorMenu()},_hydrateResult:function(I){var N={},K=this._defaultSR,Q;this.get("map")&&(K=this.get("map").spatialReference);if(I.hasOwnProperty("text")&&I.hasOwnProperty("magicKey"))return I;if(I.hasOwnProperty("feature"))N.feature=new y(I.feature),(Q=N.feature.geometry)&&Q.setSpatialReference(K);else if(I.hasOwnProperty("geometry")){var da=
I.symbol||null;Q=I.attributes||{};N.feature=new y(I.geometry,da,Q,I.infoTemplate||null);(Q=N.feature.geometry)&&Q.setSpatialReference(K)}else I.hasOwnProperty("location")?(da=new F(I.location.x,I.location.y,K),Q={},I.hasOwnProperty("attributes")&&(Q=I.attributes),I.hasOwnProperty("score")&&(Q.score=I.score),N.feature=new y(da,null,Q,null)):N.feature=null;if(I.hasOwnProperty("extent"))N.extent=new D(I.extent),N.extent.setSpatialReference(new A(K));else if(N.feature&&N.feature.geometry)switch(N.feature.geometry.type){case "extent":N.extent=
N.feature.geometry;break;case "multipoint":N.extent=N.feature.geometry.getExtent();break;case "polygon":N.extent=N.feature.geometry.getExtent();break;case "polyline":N.extent=N.feature.geometry.getExtent();break;case "point":this.get("map")?this.get("map").getScale()>this.get("zoomScale")?N.extent=Z.getExtentForScale(this.get("map"),this.get("zoomScale")).centerAt(N.feature.geometry):N.extent=this.get("map").extent.centerAt(N.feature.geometry):N.extent=new D({xmin:N.feature.geometry.x-.25,ymin:N.feature.geometry.y-
.25,xmax:N.feature.geometry.x+.25,ymax:N.feature.geometry.y+.25,spatialReference:{wkid:4326}})}else N.extent=null;I.hasOwnProperty("name")?N.name=I.name:"query"===this.activeGeocoder.type&&this.activeGeocoder.field&&I.hasOwnProperty("attributes")&&I.attributes.hasOwnProperty(this.activeGeocoder.field)?N.name=I.attributes[this.activeGeocoder.field]:I.hasOwnProperty("Match_addr")&&"string"===typeof I.Match_addr?N.name=I.Match_addr:I.hasOwnProperty("address")&&"object"===typeof I.address&&I.address.hasOwnProperty("Match_addr")?
N.name=I.address.Match_addr:I.hasOwnProperty("address")&&"string"===typeof I.address?N.name=I.address:I.hasOwnProperty("address")&&"object"===typeof I.address&&I.address.hasOwnProperty("Address")?N.name=I.address.Address:N.name=N.feature&&N.feature.geometry?N.feature.geometry.x+","+N.feature.geometry.y:"";return N},_hydrateResults:function(I){var N=[],K=0;if(I&&I.length)for(K;K<I.length;K++){var Q=this._hydrateResult(I[K]);N.push(Q)}return N}});v.setObject("dijit.Geocoder",n,z);return n})},"dojox/lang/functional":function(){define(["./functional/lambda",
"./functional/array","./functional/object"],function(m){return m})},"dojox/lang/functional/lambda":function(){define(["../..","dojo/_base/lang","dojo/_base/array"],function(m,n,v){var b=n.getObject("lang.functional",!0,m),p={},f=1<"ab".split(/a*/).length?String.prototype.split:function(c){var h=this.split.call(this,c);(c=c.exec(this))&&0==c.index&&h.unshift("");return h},d=function(c){var h=[],l=f.call(c,/\s*->\s*/m);if(1<l.length)for(;l.length;)c=l.pop(),h=l.pop().split(/\s*,\s*|\s+/m),l.length&&
l.push("(function("+h.join(", ")+"){ return ("+c+"); })");else if(c.match(/\b_\b/))h=["_"];else{l=c.match(/^\s*(?:[+*\/%&|\^\.=<>]|!=)/m);var k=c.match(/[+\-*\/%&|\^\.=<>!]\s*$/m);if(l||k)l&&(h.push("$1"),c="$1"+c),k&&(h.push("$2"),c+="$2");else{l=c.replace(/(?:\b[A-Z]|\.[a-zA-Z_$])[a-zA-Z_$\d]*|[a-zA-Z_$][a-zA-Z_$\d]*:|this|true|false|null|undefined|typeof|instanceof|in|delete|new|void|arguments|decodeURI|decodeURIComponent|encodeURI|encodeURIComponent|escape|eval|isFinite|isNaN|parseFloat|parseInt|unescape|dojo|dijit|dojox|window|document|'(?:[^'\\]|\\.)*'|"(?:[^"\\]|\\.)*"/g,
"").match(/([a-z_$][a-z_$\d]*)/gi)||[];var g={};v.forEach(l,function(e){g.hasOwnProperty(e)||(h.push(e),g[e]=1)})}}return{args:h,body:c}},a=function(c){return c.length?function(){var h=c.length-1,l=b.lambda(c[h]).apply(this,arguments);for(--h;0<=h;--h)l=b.lambda(c[h]).call(this,l);return l}:function(h){return h}};n.mixin(b,{rawLambda:function(c){return d(c)},buildLambda:function(c){c=d(c);return"function("+c.args.join(",")+"){return ("+c.body+");}"},lambda:function(c){if("function"==typeof c)return c;
if(c instanceof Array)return a(c);if(p.hasOwnProperty(c))return p[c];var h=d(c);return p[c]=new Function(h.args,"return ("+h.body+");")},clearLambdaCache:function(){p={}}});return b})},"dojox/lang/functional/array":function(){define(["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","./lambda"],function(m,n,v,b){var p={};n.mixin(b,{filter:function(f,d,a){"string"==typeof f&&(f=f.split(""));a=a||m.global;d=b.lambda(d);var c=[],h;if(n.isArray(f)){var l=0;for(h=f.length;l<h;++l){var k=f[l];d.call(a,
k,l,f)&&c.push(k)}}else if("function"==typeof f.hasNext&&"function"==typeof f.next)for(l=0;f.hasNext();)k=f.next(),d.call(a,k,l++,f)&&c.push(k);else for(l in f)l in p||(k=f[l],d.call(a,k,l,f)&&c.push(k));return c},forEach:function(f,d,a){"string"==typeof f&&(f=f.split(""));a=a||m.global;d=b.lambda(d);var c;if(n.isArray(f)){var h=0;for(c=f.length;h<c;d.call(a,f[h],h,f),++h);}else if("function"==typeof f.hasNext&&"function"==typeof f.next)for(h=0;f.hasNext();d.call(a,f.next(),h++,f));else for(h in f)h in
p||d.call(a,f[h],h,f);return a},map:function(f,d,a){"string"==typeof f&&(f=f.split(""));a=a||m.global;d=b.lambda(d);var c,h;if(n.isArray(f)){var l=Array(c=f.length);for(h=0;h<c;l[h]=d.call(a,f[h],h,f),++h);}else if("function"==typeof f.hasNext&&"function"==typeof f.next)for(l=[],h=0;f.hasNext();l.push(d.call(a,f.next(),h++,f)));else for(h in l=[],f)h in p||l.push(d.call(a,f[h],h,f));return l},every:function(f,d,a){"string"==typeof f&&(f=f.split(""));a=a||m.global;d=b.lambda(d);var c;if(n.isArray(f)){var h=
0;for(c=f.length;h<c;++h)if(!d.call(a,f[h],h,f))return!1}else if("function"==typeof f.hasNext&&"function"==typeof f.next)for(h=0;f.hasNext();){if(!d.call(a,f.next(),h++,f))return!1}else for(h in f)if(!(h in p||d.call(a,f[h],h,f)))return!1;return!0},some:function(f,d,a){"string"==typeof f&&(f=f.split(""));a=a||m.global;d=b.lambda(d);var c;if(n.isArray(f)){var h=0;for(c=f.length;h<c;++h)if(d.call(a,f[h],h,f))return!0}else if("function"==typeof f.hasNext&&"function"==typeof f.next)for(h=0;f.hasNext();){if(d.call(a,
f.next(),h++,f))return!0}else for(h in f)if(!(h in p)&&d.call(a,f[h],h,f))return!0;return!1}});return b})},"dojox/lang/functional/object":function(){define(["dojo/_base/kernel","dojo/_base/lang","./lambda"],function(m,n,v){var b={};n.mixin(v,{keys:function(p){var f=[],d;for(d in p)d in b||f.push(d);return f},values:function(p){var f=[],d;for(d in p)d in b||f.push(p[d]);return f},filterIn:function(p,f,d){d=d||m.global;f=v.lambda(f);var a={},c;for(c in p)if(!(c in b)){var h=p[c];f.call(d,h,c,p)&&(a[c]=
h)}return a},forIn:function(p,f,d){d=d||m.global;f=v.lambda(f);for(var a in p)a in b||f.call(d,p[a],a,p);return d},mapIn:function(p,f,d){d=d||m.global;f=v.lambda(f);var a={},c;for(c in p)c in b||(a[c]=f.call(d,p[c],c,p));return a}});return v})},"dojox/charting/axis2d/common":function(){define(["dojo/_base/lang","dojo/_base/window","dojo/dom-geometry","dojox/gfx","dojo/has"],function(m,n,v,b,p){var f=m.getObject("dojox.charting.axis2d.common",!0),d=function(a){a.marginLeft="0px";a.marginTop="0px";
a.marginRight="0px";a.marginBottom="0px";a.paddingLeft="0px";a.paddingTop="0px";a.paddingRight="0px";a.paddingBottom="0px";a.borderLeftWidth="0px";a.borderTopWidth="0px";a.borderRightWidth="0px";a.borderBottomWidth="0px"};return m.mixin(f,{createText:{gfx:function(a,c,h,l,k,g,e,q){return c.createText({x:h,y:l,text:g,align:k}).setFont(e).setFill(q)},html:function(a,c,h,l,k,g,e,q,u){c=n.doc.createElement("div");var r=c.style;a.getTextDir&&(c.dir=a.getTextDir(g));d(r);r.font=e;c.innerHTML=String(g).replace(/\s/g,
"\x26nbsp;");r.color=q;r.position="absolute";r.left="-10000px";n.body().appendChild(c);var x=b.normalizedLength(b.splitFontString(e).size);if(!u)if(c.getBoundingClientRect){var t=c.getBoundingClientRect();t=t.width||t.right-t.left}else t=v.getMarginBox(c).w;"rtl"==c.dir&&(h+=u?u:t);n.body().removeChild(c);r.position="relative";if(u)switch(r.width=u+"px",k){case "middle":r.textAlign="center";r.left=h-u/2+"px";break;case "end":r.textAlign="right";r.left=h-u+"px";break;default:r.left=h+"px",r.textAlign=
"left"}else switch(k){case "middle":r.left=Math.floor(h-t/2)+"px";break;case "end":r.left=Math.floor(h-t)+"px";break;default:r.left=Math.floor(h)+"px"}r.top=Math.floor(l-x)+"px";r.whiteSpace="nowrap";u=n.doc.createElement("div");r=u.style;d(r);r.width="0px";r.height="0px";u.appendChild(c);a.node.insertBefore(u,a.node.firstChild);p("dojo-bidi")&&a.htmlElementsRegistry.push([u,h,l,k,g,e,q]);return u}}})})},"esri/tasks/RouteTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../request ../geometry/normalizeUtils ./Task ./RouteResult ./NAMessage ./NAServiceDescription".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k){m=m([c,k],{declaredClass:"esri.tasks.RouteTask",_eventMap:{"solve-complete":["result"]},constructor:function(g){this._url.orig=this._url.path;this._url.path+="/solve";this._handler=n.hitch(this,this._handler);this.registerConnectEvents()},__msigns:[{n:"solve",c:3,a:[{i:0,p:["stops.features","barriers.features","polylineBarriers.features","polygonBarriers.features"]}],e:2}],_handler:function(g,e,q,u,r){try{var x=[],t=[],w=g.directions||[],z=g.routes?g.routes.features:
[],B=g.stops?g.stops.features:[],A=g.barriers?g.barriers.features:[],y=g.polygonBarriers?g.polygonBarriers.features:[],E=g.polylineBarriers?g.polylineBarriers.features:[],G=g.messages,F=v.forEach,D=v.indexOf,L=!0,O,S,Z=g.routes&&g.routes.spatialReference||g.stops&&g.stops.spatialReference||g.barriers&&g.barriers.spatialReference||g.polygonBarriers&&g.polygonBarriers.spatialReference||g.polylineBarriers&&g.polylineBarriers.spatialReference;this._chk=g.checksum;F(w,function(K){x.push(O=K.routeName);
t[O]={directions:K}});F(z,function(K){-1===D(x,O=K.attributes.Name)&&(x.push(O),t[O]={});t[O].route=K});F(B,function(K){S=K.attributes;-1===D(x,O=S.RouteName||"esri.tasks.RouteTask.NULL_ROUTE_NAME")&&(x.push(O),t[O]={});"esri.tasks.RouteTask.NULL_ROUTE_NAME"!==O&&(L=!1);void 0===t[O].stops&&(t[O].stops=[]);t[O].stops.push(K)});0<B.length&&!0===L&&(t[x[0]].stops=t["esri.tasks.RouteTask.NULL_ROUTE_NAME"].stops,delete t["esri.tasks.RouteTask.NULL_ROUTE_NAME"],x.splice(v.indexOf(x,"esri.tasks.RouteTask.NULL_ROUTE_NAME"),
1));var I=[];F(x,function(K,Q){t[K].routeName="esri.tasks.RouteTask.NULL_ROUTE_NAME"===K?null:K;t[K].spatialReference=Z;I.push(new h(t[K]))});g=function(K){F(K,function(Q,da){Q.geometry&&(Q.geometry.spatialReference=Z);K[da]=new f(Q)});return K};F(G,function(K,Q){G[Q]=new l(K)});var N={routeResults:I,barriers:g(A),polygonBarriers:g(y),polylineBarriers:g(E),messages:G};this._successHandler([N],"onSolveComplete",q,r)}catch(K){this._errorHandler(K,u,r)}},solve:function(g,e,q,u){var r=u.assembly;g=this._encode(n.mixin({},
this._url.query,{f:"json"},g.toJson(r&&r[0]),this._chk?{checksum:this._chk}:{}));var x=this._handler,t=this._errorHandler;return d({url:this._url.path,timeout:25E4,content:g,callbackParamName:"callback",load:function(w,z){x(w,z,e,q,u.dfd)},error:function(w){t(w,q,u.dfd)}})},onSolveComplete:function(){}});a._createWrappers(m);n.setObject("tasks.RouteTask",m,p);return m})},"esri/tasks/RouteResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ./DirectionsFeatureSet".split(" "),
function(m,n,v,b,p,f,d){m=m(null,{declaredClass:"esri.tasks.RouteResult",constructor:function(a){var c=a.spatialReference,h=a.route;if(a.directions){var l=[],k=[],g=[];v.forEach(a.directions.features,function(q,u){k[u]=q.compressedGeometry;l[u]=q.strings;g[u]=q.events});a.directions.strings=l;a.directions.events=g;this.directions=new d(a.directions,k)}this.routeName=a.routeName;h&&(h.geometry&&(h.geometry.spatialReference=c),this.route=new f(h));if(a.stops){var e=this.stops=[];v.forEach(a.stops,function(q,
u){q.geometry&&(q.geometry.spatialReference=c);e[q.attributes.Sequence-1]=new f(q)})}},routeName:null,directions:null,route:null,stops:null});n.setObject("tasks.RouteResult",m,p);return m})},"esri/tasks/DirectionsFeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/json ../kernel ../geometry/Extent ../geometry/Polyline ../geometry/Point ../graphic ./FeatureSet".split(" "),function(m,n,v,b,p,f,d,a,c,h,l){m=m(l,{declaredClass:"esri.tasks.DirectionsFeatureSet",
constructor:function(k,g){this.routeId=k.routeId;this.routeName=k.routeName;n.mixin(this,k.summary);this.extent=new d(this.envelope);var e=this._fromCompressedGeometry,q=this.features,u=this.extent.spatialReference,r=[];v.forEach(g,function(x,t){q[t].setGeometry(r[t]=x?e(x,u):q[t].geometry)});this.mergedGeometry=this._mergePolylinesToSinglePath(r,u);this.geometryType="esriGeometryPolyline";v.forEach(k.events,function(x,t){v.forEach(x,function(w,z){x[z]=new h(new c(w.point.x,w.point.y,u),null,{ETA:w.ETA,
strings:p.stringify(w.strings),arriveTimeUTC:w.arriveTimeUTC})});k.events[t]=x});delete this.envelope},_fromCompressedGeometry:function(k,g){var e=0,q=0,u=0,r=0,x=[],t,w=0,z=0,B=0;(t=k.match(/((\+|\-)[^\+\-\|]+|\|)/g))||(t=[]);if(0===parseInt(t[w],32)){w=2;var A=parseInt(t[w],32);w++;var y=parseInt(t[w],32);w++;if(A&1){z=v.indexOf(t,"|")+1;var E=parseInt(t[z],32);z++}if(A&2){B=v.indexOf(t,"|",z)+1;var G=parseInt(t[B],32);B++}}else y=parseInt(t[w],32),w++;for(;w<t.length&&"|"!==t[w];){A=parseInt(t[w],
32)+e;w++;e=A;var F=parseInt(t[w],32)+q;w++;q=F;A=[A/y,F/y];z&&(F=parseInt(t[z],32)+u,z++,u=F,A.push(F/E));B&&(F=parseInt(t[B],32)+r,B++,r=F,A.push(F/G));x.push(A)}e=new a({paths:[x],hasZ:0<z,hasM:0<B});e.setSpatialReference(g);return e},_mergePolylinesToSinglePath:function(k,g){var e=[],q=!1;v.forEach(k,function(x){v.forEach(x.paths,function(t){q=q||x.hasM;e=e.concat(t)})});var u=[],r=[0,0];v.forEach(e,function(x){if(x[0]!==r[0]||x[1]!==r[1])u.push(x),r=x});return new a({paths:[u],spatialReference:g,
hasM:q})}});n.setObject("tasks.DirectionsFeatureSet",m,f);return m})},"esri/tasks/NAMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(m,n,v,b){m=m(null,{declaredClass:"esri.tasks.NAMessage",constructor:function(p){n.mixin(this,p)}});n.mixin(m,{TYPE_INFORMATIVE:0,TYPE_PROCESS_DEFINITION:1,TYPE_PROCESS_START:2,TYPE_PROCESS_STOP:3,TYPE_WARNING:50,TYPE_ERROR:100,TYPE_EMPTY:101,TYPE_ABORT:200});n.setObject("tasks.NAMessage",m,b);return m})},"esri/tasks/NAServiceDescription":function(){define(["dojo/_base/declare",
"dojo/json","dojo/Deferred","dojo/_base/lang","../request"],function(m,n,v,b,p){return m(null,{declaredClass:"esri.tasks._NAServiceDescription",_sd:null,getServiceDescription:function(f,d){var a=new v;if(this._sd)a.resolve(this._sd);else if(this._url&&this._url.orig){var c=this._url.orig,h=(this._url.path.match(/\/solve$/)||[]).length?"Route":(this._url.path.match(/\/solveClosestFacility$/)||[]).length?"ClosestFacility":"ServiceAreas",l,k=function(g){p({url:g+("/"===g[g.length-1]?"":"/")+"GetTravelModes/execute",
content:{f:"json",serviceName:h},callbackParamName:"callback"}).then(function(e){var q=[],u=null;if(e&&e.results&&e.results.length)for(var r=0;r<e.results.length;r++)if("supportedTravelModes"===e.results[r].paramName){if(e.results[r].value&&e.results[r].value.features)for(var x=0;x<e.results[r].value.features.length;x++)if(e.results[r].value.features[x].attributes){var t=n.parse(e.results[r].value.features[x].attributes.TravelMode);q.push(t)}}else"defaultTravelMode"===e.results[r].paramName&&(u=e.results[r].value);
l.supportedTravelModes=q;l.defaultTravelMode=u;a.resolve(l)},function(e){a.reject(e)})};p({url:c,content:{f:"json"},callbackParamName:"callback"}).then(function(g){l=g;l.supportedTravelModes||(l.supportedTravelModes=[]);for(g=0;g<l.supportedTravelModes.length;g++)l.supportedTravelModes[g].id||(l.supportedTravelModes[g].id=l.supportedTravelModes[g].itemId);d?a.resolve(l):f?k(f):10.4<=l.currentVersion?p({url:c+("/"===c[c.length-1]?"":"/")+"retrieveTravelModes",content:{f:"json"},callbackParamName:"callback"}).then(function(e){l.supportedTravelModes=
e.supportedTravelModes;l.defaultTravelMode=e.defaultTravelMode;a.resolve(l)},function(e){a.reject(e)}):p({url:c.substring(0,c.indexOf("/rest/")+6)+"info",content:{f:"json"},callbackParamName:"callback"}).then(function(e){e.owningSystemUrl?(c=e.owningSystemUrl,p({url:c+("/"===c[c.length-1]?"":"/")+"sharing/rest/portals/self",content:{f:"json"},callbackParamName:"callback"}).then(function(q){q&&q.helperServices&&q.helperServices.routingUtilities&&q.helperServices.routingUtilities.url?k(q.helperServices.routingUtilities.url):
a.resolve(l)},function(q){a.reject(q)})):a.resolve(l)},function(e){a.reject(e)})},function(g){a.reject(g)})}else a.reject("NA Task has no URL specified.");a.then(b.hitch(this,function(g){this._sd=g}),b.hitch(this,function(){this._sd=null}));return a.promise},getOwningSystemUrl:function(){var f=new v;if(this._url&&this._url.orig){var d=this._url.orig;p({url:d.substring(0,d.indexOf("/rest/")+6)+"info",content:{f:"json"},callbackParamName:"callback"}).promise.always(function(a){f.resolve(a.owningSystemUrl)})}else f.resolve(void 0);
return f.promise}})})},"esri/tasks/RouteParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang ../graphicsUtils ./NATypes".split(" "),function(m,n,v,b,p,f,d,a){m=m(null,{declaredClass:"esri.tasks.RouteParameters",accumulateAttributes:null,attributeParameterValues:null,barriers:null,directionsLanguage:null,directionsLengthUnits:null,directionsOutputType:null,directionsStyleName:null,directionsTimeAttribute:null,doNotLocateOnRestrictedElements:!0,
findBestSequence:null,ignoreInvalidLocations:null,impedanceAttribute:null,outputLines:"esriNAOutputLineTrueShape",outputGeometryPrecision:null,outputGeometryPrecisionUnits:null,outSpatialReference:null,overrides:null,polygonBarriers:null,polylineBarriers:null,preserveFirstStop:null,preserveLastStop:null,restrictionAttributes:null,restrictUTurns:null,returnBarriers:!1,returnDirections:!1,returnPolygonBarriers:!1,returnPolylineBarriers:!1,returnRoutes:!0,returnStops:!1,returnZ:!0,startTime:null,startTimeIsUTC:null,
timeWindowsAreUTC:null,stops:null,useHierarchy:null,useTimeWindows:null,travelMode:null,toJson:function(c){var h={returnDirections:this.returnDirections,returnRoutes:this.returnRoutes,returnZ:this.returnZ,returnStops:this.returnStops,returnBarriers:this.returnBarriers,returnPolygonBarriers:this.returnPolygonBarriers,returnPolylineBarriers:this.returnPolylineBarriers,attributeParameterValues:this.attributeParameterValues&&v.toJson(this.attributeParameterValues),outSR:this.outSpatialReference?this.outSpatialReference.wkid||
v.toJson(this.outSpatialReference.toJson()):null,outputLines:this.outputLines,overrides:this.overrides,findBestSequence:this.findBestSequence,preserveFirstStop:this.preserveFirstStop,preserveLastStop:this.preserveLastStop,useTimeWindows:this.useTimeWindows,startTime:this.startTime?this.startTime.getTime():null,startTimeIsUTC:this.startTimeIsUTC,timeWindowsAreUTC:this.timeWindowsAreUTC,accumulateAttributeNames:this.accumulateAttributes?this.accumulateAttributes.join(","):null,ignoreInvalidLocations:this.ignoreInvalidLocations,
impedanceAttributeName:this.impedanceAttribute,restrictionAttributeNames:this.restrictionAttributes?this.restrictionAttributes.join(","):null,restrictUTurns:this.restrictUTurns,useHierarchy:this.useHierarchy,directionsLanguage:this.directionsLanguage,outputGeometryPrecision:this.outputGeometryPrecision,outputGeometryPrecisionUnits:this.outputGeometryPrecisionUnits,directionsLengthUnits:a.LengthUnit[this.directionsLengthUnits],directionsTimeAttributeName:this.directionsTimeAttribute,directionsStyleName:this.directionsStyleName,
travelMode:"object"===typeof this.travelMode?v.toJson(this.travelMode):this.travelMode},l=this.stops;"esri.tasks.FeatureSet"===l.declaredClass&&0<l.features.length?h.stops=v.toJson({type:"features",features:d._encodeGraphics(l.features,c&&c["stops.features"]),doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements}):"esri.tasks.DataLayer"===l.declaredClass?h.stops=l:"esri.tasks.DataFile"===l.declaredClass&&(h.stops=v.toJson({type:"features",url:l.url,doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements}));
if(this.directionsOutputType)switch(this.directionsOutputType.toLowerCase()){case "complete":h.directionsOutputType="esriDOTComplete";break;case "complete-no-events":h.directionsOutputType="esriDOTCompleteNoEvents";break;case "instructions-only":h.directionsOutputType="esriDOTInstructionsOnly";break;case "standard":h.directionsOutputType="esriDOTStandard";break;case "summary-only":h.directionsOutputType="esriDOTSummaryOnly";break;default:h.directionsOutputType=this.directionsOutputType}l=function(k,
g){return k?"esri.tasks.FeatureSet"===k.declaredClass?0<k.features.length?v.toJson({type:"features",features:d._encodeGraphics(k.features,c&&c[g])}):null:"esri.tasks.DataLayer"===k.declaredClass?k:"esri.tasks.DataFile"===k.declaredClass?v.toJson({type:"features",url:k.url}):v.toJson(k):null};this.barriers&&(h.barriers=l(this.barriers,"barriers.features"));this.polygonBarriers&&(h.polygonBarriers=l(this.polygonBarriers,"polygonBarriers.features"));this.polylineBarriers&&(h.polylineBarriers=l(this.polylineBarriers,
"polylineBarriers.features"));return f.filter(h,function(k){if(null!==k)return!0})}});n.setObject("tasks.RouteParameters",m,p);return m})},"esri/tasks/NATypes":function(){define(["dojo/_base/lang","dojo/has","../kernel"],function(m,n,v){n={esriFeet:"esriNAUFeet",esriKilometers:"esriNAUKilometers",esriMeters:"esriNAUMeters",esriMiles:"esriNAUMiles",esriNauticalMiles:"esriNAUNauticalMiles",esriYards:"esriNAUYards"};var b={NONE:"esriNAOutputLineNone",STRAIGHT:"esriNAOutputLineStraight",TRUE_SHAPE:"esriNAOutputLineTrueShape",
TRUE_SHAPE_WITH_MEASURE:"esriNAOutputLineTrueShapeWithMeasure"},p={ALLOW_BACKTRACK:"esriNFSBAllowBacktrack",AT_DEAD_ENDS_ONLY:"esriNFSBAtDeadEndsOnly",NO_BACKTRACK:"esriNFSBNoBacktrack",AT_DEAD_ENDS_AND_INTERSECTIONS:"esriNFSBAtDeadEndsAndIntersections"},f={NONE:"esriNAOutputPolygonNone",SIMPLIFIED:"esriNAOutputPolygonSimplified",DETAILED:"esriNAOutputPolygonDetailed"},d={FROM_FACILITY:"esriNATravelDirectionFromFacility",TO_FACILITY:"esriNATravelDirectionToFacility"},a={LengthUnit:n,OutputLine:b,
UTurn:p,OutputPolygon:f,TravelDirection:d};m.setObject("tasks._NALengthUnit",n,v);m.setObject("tasks.NAOutputLine",b,v);m.setObject("tasks.NAUTurn",p,v);m.setObject("tasks.NAOutputPolygon",f,v);m.setObject("tasks.NATravelDirection",d,v);return a})},"esri/layers/wmts":function(){define(["./agscommon","./tiled","./WMTSLayer"],function(){return{}})},"esri/layers/tiled":function(){define(["./TiledMapServiceLayer","./TileInfo","./LOD","../geometry","../utils"],function(){return{}})},"esri/layers/WMTSLayer":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/sniff dojox/xml/parser ../kernel ../lang ../request ../urlUtils ../WKIDUnitConversion ../SpatialReference ../geometry/Point ../geometry/Extent ../geometry/webMercatorUtils ./TiledMapServiceLayer ./TileInfo ./WMTSLayerInfo dojo/query".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x){n=n([u],{declaredClass:"esri.layers.WMTSLayer",copyright:null,extent:null,tileUrl:null,spatialReference:null,tileInfo:null,constructor:function(t,w){this.version="1.0.0";this.tileUrl=this._url=t;this.serviceMode="RESTful";this._parseCapabilities=v.hitch(this,this._parseCapabilities);this._getCapabilitiesError=v.hitch(this,this._getCapabilitiesError);this._formatDictionary={"image/png":".png","image/png8":".png","image/png24":".png","image/png32":".png",
"image/jpg":".jpg","image/jpeg":".jpeg","image/gif":".gif","image/bmp":".bmp","image/tiff":".tif","image/jpgpng":"","image/jpegpng":"","image/unknown":""};w||(w={});if(w.serviceMode)if("KVP"===w.serviceMode||"RESTful"===w.serviceMode)this.serviceMode=w.serviceMode;else return;this.customParameters=w.customParameters;this.customLayerParameters=w.customLayerParameters;this.layerInfo=new x;w.layerInfo&&(this.layerInfo=w.layerInfo,this._identifier=w.layerInfo.identifier,this._tileMatrixSetId=w.layerInfo.tileMatrixSet,
w.layerInfo.format&&(this.format="image/"+w.layerInfo.format),this._style=w.layerInfo.style,this.title=w.layerInfo.title,this._dimension=w.layerInfo.dimension,this._dimension2=w.layerInfo.dimension2);w.resourceInfo?(this.version=w.resourceInfo.version,w.resourceInfo.getTileUrl&&(this._url=this.tileUrl=w.resourceInfo.getTileUrl),this.copyright=w.resourceInfo.copyright,this.layerInfos=w.resourceInfo.layerInfos,this.customParameters=w.resourceInfo.customParameters||this.customParameters,this.customLayerParameters=
w.resourceInfo.customLayerParameters||this.customLayerParameters,this._parseResourceInfo(),this.loaded=!0,this.onLoad(this)):this._getCapabilities()},setActiveLayer:function(t){this.setVisibleLayer(t)},setVisibleLayer:function(t){this._setActiveLayer(t);this.refresh(!0)},setCustomParameters:function(t,w){this.customParameters=t;this.customLayerParameters=w;this.refresh(!0)},getTileUrl:function(t,w,z){t=this._levelToLevelValue[t];t=this.resourceUrls&&0<this.resourceUrls.length?this.resourceUrls[w%
this.resourceUrls.length].template.replace(/\{Style\}/gi,this._style).replace(/\{TileMatrixSet\}/gi,this._tileMatrixSetId).replace(/\{TileMatrix\}/gi,t).replace(/\{TileRow\}/gi,w).replace(/\{TileCol\}/gi,z).replace(/\{dimensionValue\}/gi,this._dimension).replace(/\{dimensionValue2\}/gi,this._dimension2):this.UrlTemplate.replace(/\{level\}/gi,t).replace(/\{row\}/gi,w).replace(/\{col\}/gi,z);t=this._appendCustomLayerParameters(t);t=this.addTimestampToURL(t);return h.addProxy(t)},getTileUrlTemplate:function(t){var w=
t.identifier,z=t.tileMatrixSet,B=t.format,A=t.style,y=t.dimension,E=t.dimension2;w?t=b.filter(this.layers,function(F){return F.identifier===w})[0]:(t=this.layers[0],w=this.layers[0].identifier);if(t){if(!B)B=t.formats[0];else if(!(-1===B.indexOf("image/")&&-1<b.indexOf(t.formats,B))&&(-1===B.indexOf("image/")&&(B="image/"+B),-1===b.indexOf(t.formats,B))){this.onError(Error("The layer doesn't support the format of "+B));return}if(!A)A=t.styles[0];else if(-1===b.indexOf(t.styles,A)){this.onError(Error("The layer doesn't support the style of "+
A));return}if(!y&&t.dimensions)y=t.dimensions[0];else if(-1===b.indexOf(t.dimensions,y)){this.onError(Error("The layer doesn't support the dimension of "+y));return}if(!E&&t.dimensions2)E=t.dimensions2[0];else if(-1===b.indexOf(t.dimensions2,E)){this.onError(Error("The layer doesn't support the dimension of "+E));return}if(z){var G=b.filter(t.tileMatrixSetInfos,function(F){return F.tileMatrixSet===z})[0];if(!G){this.onError(Error("The tileMatrixSetId "+z+" is not supported by the layer of "+w));return}}else(G=
b.filter(t.tileMatrixSetInfos,function(F){return"GoogleMapsCompatible"===F.tileMatrixSet})[0])||(G=t.tileMatrixSetInfos[0]),z=G.tileMatrixSet;return this._getTileUrlTemplate(w,z,B,A,y,E)}this.onError(Error("couldn't find the layer "+w))},_getTileUrlTemplate:function(t,w,z,B,A,y){t||(t=this._identifier);w||(w=this._tileMatrixSetId);z||(z=this.format);B||""===B||(B=this._style);if(this.resourceUrls&&0<this.resourceUrls.length){var E=this.resourceUrls[0].template;E.indexOf(".xxx")===E.length-4&&(E=E.slice(0,
E.length-4));E=E.replace(/\{Style\}/gi,B);E=E.replace(/\{TileMatrixSet\}/gi,w);E=E.replace(/\{TileMatrix\}/gi,"{level}");E=E.replace(/\{TileRow\}/gi,"{row}");E=E.replace(/\{TileCol\}/gi,"{col}");E=E.replace(/\{dimensionValue\}/gi,A);return E=E.replace(/\{dimensionValue2\}/gi,y)}"KVP"===this.serviceMode?E=this._url+"SERVICE\x3dWMTS\x26VERSION\x3d"+this.version+"\x26REQUEST\x3dGetTile\x26LAYER\x3d"+t+"\x26STYLE\x3d"+B+"\x26FORMAT\x3d"+z+"\x26TILEMATRIXSET\x3d"+w+"\x26TILEMATRIX\x3d{level}\x26TILEROW\x3d{row}\x26TILECOL\x3d{col}":
"RESTful"===this.serviceMode&&(A="",this._formatDictionary[z.toLowerCase()]&&(A=this._formatDictionary[z.toLowerCase()]),E=this._url+t+"/"+B+"/"+w+"/{level}/{row}/{col}"+A);return E},_parseResourceInfo:function(){var t=this.layerInfos,w;"KVP"===this.serviceMode&&(this._url+=-1<this._url.indexOf("?")?"":"?");for(w=0;w<t.length;w++)if(!(this._identifier&&t[w].identifier!==this._identifier||this.title&&t[w].title!==this.title||this._tileMatrixSetId&&t[w].tileMatrixSet!==this._tileMatrixSetId||this.format&&
"image/"+t[w].format!==this.format||this._style&&t[w].style!==this._style)){v.mixin(this,{description:t[w].description,tileInfo:t[w].tileInfo,spatialReference:t[w].tileInfo.spatialReference,fullExtent:t[w].fullExtent,initialExtent:t[w].initialExtent,_identifier:t[w].identifier,_tileMatrixSetId:t[w].tileMatrixSet,format:"image/"+t[w].format,_style:t[w].style});break}for(w=0;w<t.length;w++){var z=t[w].tileInfo;96!==z.dpi&&(b.forEach(z.lods,function(B){B.scale=96*B.scale/z.dpi}),z.dpi=96);b.forEach(z.lods,
function(B){B.resolution=this._getResolution(z.spatialReference.wkid,90.71428571428571*B.scale/96,t[w].tileMatrixSet)},this)}this._setActiveLayer();this.UrlTemplate=this._getTileUrlTemplate();this._levelToLevelValue=[];b.forEach(this.tileInfo.lods,function(B){this._levelToLevelValue[B.level]=B.levelValue?B.levelValue:B.level},this)},_getCapabilities:function(){var t;"KVP"===this.serviceMode?t=-1<this._url.indexOf("?")?this._url+"\x26request\x3dGetCapabilities\x26service\x3dWMTS\x26version\x3d"+this.version:
this._url+"?request\x3dGetCapabilities\x26service\x3dWMTS\x26version\x3d"+this.version:"RESTful"===this.serviceMode&&(t=this._url+"/"+this.version+"/WMTSCapabilities.xml");t=this._appendCustomParameters(t);c({url:t,handleAs:"text",load:this._parseCapabilities,error:this._getCapabilitiesError})},_parseCapabilities:function(t){t=t.replace(/ows:/gi,"");t=f.parse(t);var w=m.query("Contents",t)[0];if(w){var z=m.query("OperationsMetadata",t)[0],B=m.query("[name\x3d'GetTile']",z)[0];z=this._url;B=m.query("Get",
B);var A,y=!1;for(A=0;A<B.length;A++){var E=m.query("Constraint",B[A])[0];if(!E||this._getTagWithChildTagValue("AllowedValues","Value",this.serviceMode,E)){z=B[A].attributes[0].nodeValue;y=!0;break}else if(!E||this._getTagWithChildTagValue("AllowedValues","Value","RESTful",E))var G=B[A].attributes[0].nodeValue;else if(!E||this._getTagWithChildTagValue("AllowedValues","Value","KVP",E))var F=B[A].attributes[0].nodeValue}y||("KVP"===this.serviceMode&&G?(z=G,this.serviceMode="RESTful"):"RESTful"===this.serviceMode&&
F&&(z=F,this.serviceMode="KVP"));-1===z.indexOf("/1.0.0/")&&"RESTful"===this.serviceMode&&(z+="/");"KVP"===this.serviceMode&&(z+=-1<z.indexOf("?")?"":"?");this._url=z;this.copyright=this._getTagValues("Capabilities\x3eServiceIdentification\x3eAccessConstraints",t)[0];G=m.query("Layer",w);var D,L=[];this.layers=[];b.forEach(G,function(O){D=this._getTagValues("Identifier",O)[0];L.push(D);this.layers.push(this._getWMTSLayerInfo(D,O,w))},this);this._setActiveLayer();this.loaded=!0;this.onLoad(this)}else this.onError(Error("The WMTS capabilities XML is not valid"))},
_setActiveLayer:function(t){t||(t={});t.identifier&&(this._identifier=t.identifier);t.tileMatrixSet&&(this._tileMatrixSetId=t.tileMatrixSet);t.format&&(this.format=t.format);t.style&&(this._style=t.style);t.dimension&&(this._dimension=t.dimension);t.dimension2&&(this._dimension2=t.dimension2);if(this.layers)if(this._identifier?t=b.filter(this.layers,function(z){return z.identifier===this._identifier},this)[0]:(t=this.layers[0],this._identifier=this.layers[0].identifier),t){if(this.format){if(-1===
this.format.indexOf("image/")&&(this.format="image/"+this.format),-1===b.indexOf(t.formats,this.format)){this.onError(Error("The layer doesn't support the format of "+this.format));return}}else this.format=t.formats[0],-1===this.format.indexOf("image/")&&(this.format="image/"+this.format);if(!this._style)this._style=t.styles[0];else if(-1===b.indexOf(t.styles,this._style)){this.onError(Error("The layer doesn't support the style of "+this._style));return}if(!this._dimension&&t.dimensions)this._dimension=
t.dimensions[0];else if(-1===b.indexOf(t.dimensions,this._dimension)){this.onError(Error("The layer doesn't support the dimension of "+this._dimension));return}if(!this._dimension2&&t.dimensions2)this._dimension2=t.dimensions2[0];else if(-1===b.indexOf(t.dimensions2,this._dimension2)){this.onError(Error("The layer doesn't support the dimension of "+this._dimension2));return}if(this._tileMatrixSetId){var w=b.filter(t.tileMatrixSetInfos,function(z){return z.tileMatrixSet===this._tileMatrixSetId},this)[0];
if(!w){this.onError(Error("The tileMatrixSetId "+this._tileMatrixSetId+" is not supported by the layer of "+this._identifier));return}}else(w=b.filter(t.tileMatrixSetInfos,function(z){return"GoogleMapsCompatible"===z.tileMatrixSet})[0])||(w=t.tileMatrixSetInfos[0]),this._tileMatrixSetId=w.tileMatrixSet;this.description=t.description;this.title=t.title;this.spatialReference=w.tileInfo.spatialReference;this.tileInfo=w.tileInfo;this._levelToLevelValue=[];b.forEach(this.tileInfo.lods,function(z){this._levelToLevelValue[z.level]=
z.levelValue?z.levelValue:z.level},this);102100===this.spatialReference.wkid||102113===this.spatialReference.wkid?this.fullExtent=this.initialExtent=q.geographicToWebMercator(t.gcsExtent):4326===this.spatialReference.wkid?this.fullExtent=this.initialExtent=t.gcsExtent:(this.fullExtent=w.fullExtent,this.initialExtent=w.initialExtent);this.resourceUrls=t.resourceUrls;this.UrlTemplate=this._getTileUrlTemplate();this.layerInfo={identifier:this._identifier,tileMatrixSet:this._tileMatrixSetId,format:this.format,
style:this._style,fullExtent:this.fullExtent,initialExtent:this.initialExtent,tileInfo:this.tileInfo,title:this.title,description:this.description}}else this.onError(Error("couldn't find the layer "+this._identifier))},_getWMTSLayerInfo:function(t,w,z){var B=this._getTagValues("Abstract",w)[0],A=this._getTagValues("Title",w)[0],y=m.query("WGS84BoundingBox",w)[0],E=y?this._getTagValues("LowerCorner",y)[0].split(" "):["-180","-90"],G=y?this._getTagValues("UpperCorner",y)[0].split(" "):["180","90"];
y=parseFloat(E[0]);E=parseFloat(E[1]);var F=parseFloat(G[0]);G=parseFloat(G[1]);y=new e(y,E,F,G,new k({wkid:4326}));G=this._getTagValues("Identifier",m.query("Style",w)[0]);var D=this._getTagValues("Identifier",m.query("Dimension",w)[0]),L=this._getTagValues("Default",m.query("Dimension",w)[0])||this._getTagValues("Value",m.query("Dimension",w)[0]),O=1<m.query("Dimension",w).length?this._getTagValues("Identifier",m.query("Dimension",w)[1]):[],S=1<m.query("Dimension",w).length?this._getTagValues("Default",
m.query("Dimension",w)[1])||this._getTagValues("Value",m.query("Dimension",w)[1]):[];E=this._getTagValues("Format",w);z=this._getLayerMatrixInfos(w,z);t={identifier:t,tileMatrixSetInfos:z,formats:E,styles:G,title:A,description:B,gcsExtent:y,dimensions:L,dimensions2:S};w=m.query("ResourceURL",w);var Z=[],I;b.forEach(w,function(N){I=N.getAttribute("template");if(D&&L&&D[0]&&L[0])if(-1<I.indexOf("{"+D+"}"))I=I.replace("{"+D+"}","{dimensionValue}");else{var K=I.toLowerCase().indexOf("{"+D[0].toLowerCase()+
"}");-1<K&&(I=I.substring(0,K)+"{dimensionValue}"+I.substring(K+D[0].length+2))}O&&S&&O[0]&&S[0]&&(-1<I.indexOf("{"+O+"}")?I=I.replace("{"+O+"}","{dimensionValue2}"):(K=I.toLowerCase().indexOf("{"+O[0].toLowerCase()+"}"),-1<K&&(I=I.substring(0,K)+"{dimensionValue2}"+I.substring(K+O[0].length+2))));Z.push({template:I,format:N.getAttribute("format"),resourceType:N.getAttribute("resourceType")})});Z&&0<Z.length&&(t.resourceUrls=Z);return t},_getLayerMatrixInfos:function(t,w){var z=[],B=this._getTagValues("TileMatrixSet",
t);if(B&&0!==B.length)return b.forEach(B,function(A){A=this._getLayerMatrixInfo(A,t,w);z.push(A)},this),z},_getLayerMatrixInfo:function(t,w,z){var B=[];w=this._getTagWithChildTagValue("TileMatrixSetLink","TileMatrixSet",t,w);var A=this._getTagValues("TileMatrix",w),y=this._getTagWithChildTagValue("TileMatrixSet","Identifier",t,z),E=this._getTagValues("SupportedCRS",y)[0];var G=parseInt(E.split(":").pop(),10);if(900913==G||3857==G)G=102100;if(-1<E.toLowerCase().indexOf("crs84")||-1<E.toLowerCase().indexOf("crs:84")){G=
4326;var F=!0}else if(-1<E.toLowerCase().indexOf("crs83")||-1<E.toLowerCase().indexOf("crs:83"))G=4269,F=!0;else if(-1<E.toLowerCase().indexOf("crs27")||-1<E.toLowerCase().indexOf("crs:27"))G=4267,F=!0;var D=new k({wkid:G}),L=m.query("TileMatrix",y)[0];z=parseInt(this._getTagValues("TileWidth",L)[0],10);w=parseInt(this._getTagValues("TileHeight",L)[0],10);var O=this._getTagValues("TopLeftCorner",L)[0].split(" ");var S=O[0],Z=O[1];1<S.split("E").length&&(O=S.split("E"),S=O[0]*Math.pow(10,O[1]));1<
Z.split("E").length&&(O=Z.split("E"),Z=O[0]*Math.pow(10,O[1]));S=parseFloat(S);Z=parseFloat(Z);var I=F&&4326===G&&90===S&&-180===Z;for(O=0;O<this._flippingAxisForWkids.length;O++)if(E.split(":").pop()>=this._flippingAxisForWkids[O][0]&&E.split(":").pop()<=this._flippingAxisForWkids[O][1]||4326===G&&(!F||I)){4326===G&&90<S&&(S="90");var N=new g(Z,S,D);break}O===this._flippingAxisForWkids.length&&(N=new g(S,Z,D));if(0===A.length)for(A=m.query("TileMatrix",y),O=0;O<A.length;O++)F=this._getLodFromTileMatrix(A[O],
G,O,t),B.push(F);else for(O=0;O<A.length;O++)F=this._getTagWithChildTagValue("TileMatrix","Identifier",A[O],y),F=this._getLodFromTileMatrix(F,G,O,t),B.push(F);G=m.query("BoundingBox",y)[0];if(G){var K=this._getTagValues("LowerCorner",G)[0].split(" ");var Q=this._getTagValues("UpperCorner",G)[0].split(" ")}K&&1<K.length&&Q&&1<Q.length?(L=parseFloat(K[0]),G=parseFloat(K[1]),K=parseFloat(Q[0]),Q=parseFloat(Q[1])):(K=this._getTagValues("MatrixWidth",L)[0],G=this._getTagValues("MatrixHeight",L)[0],L=N.x,
Q=N.y,K=L+K*w*B[0].resolution,G=Q-G*z*B[0].resolution);Q=K=new e(L,G,K,Q,D);N=new r({dpi:96,spatialReference:D,format:this.format,rows:z,cols:w,origin:N,lods:B});return{tileMatrixSet:t,fullExtent:Q,initialExtent:K,tileInfo:N}},_getCapabilitiesError:function(t){this.onError(t)},_getLodFromTileMatrix:function(t,w,z,B){var A=this._getTagValues("Identifier",t)[0];t=this._getTagValues("ScaleDenominator",t)[0];1<t.split("E").length?(t=t.split("E"),t=t[0]*Math.pow(10,t[1])):t=parseFloat(t);w=this._getResolution(w,
t,B);return{level:z,levelValue:A,scale:1.058267716535433*t,resolution:w}},_getResolution:function(t,w,z){t=a.isDefined(l[t])?l.values[l[t]]:"default028mm"===z?6370997*Math.PI/180:6378137*Math.PI/180;return 7*w/25E3/t},_getTag:function(t,w){var z=m.query(t,w);return z&&0<z.length?z[0]:null},_getTagValues:function(t,w){var z=[],B=t.split("\x3e"),A;var y=m.query(B[0],w)[0];if(1<B.length){for(A=1;A<B.length-1;A++)y=m.query(B[A],y)[0];B=m.query(B[B.length-1],y)}else B=m.query(B[0],w);B&&0<B.length&&b.forEach(B,
function(E){9>p("ie")?z.push(E.childNodes.length?E.childNodes[0].nodeValue:""):z.push(E.textContent)});return z},_getAttributeValues:function(t,w,z){t=m.query(t,z);var B=[];t&&0<t.length&&b.forEach(t,function(A){B.push(A.getAttribute(w))});return B},_getTagWithChildTagValue:function(t,w,z,B){B=B.childNodes;var A;for(A=0;A<B.length;A++)if(-1<B[A].nodeName.indexOf(t)){if(9>p("ie")){if(a.isDefined(m.query(w,B[A])[0]))var y=m.query(w,B[A])[0].childNodes[0].nodeValue}else a.isDefined(m.query(w,B[A])[0])&&
(y=m.query(w,B[A])[0].textContent);if(y===z||z.split(":")&&y===z.split(":")[1])return B[A]}},_appendCustomParameters:function(t){var w;if(this.customParameters)for(w in this.customParameters)t+=(-1===t.indexOf("?")?"?":"\x26")+w+"\x3d"+encodeURIComponent(this.customParameters[w]);return t},_appendCustomLayerParameters:function(t){var w;if(this.customLayerParameters||this.customParameters){var z=v.clone(this.customParameters||{});v.mixin(z,this.customLayerParameters||{});for(w in z)t+=(-1===t.indexOf("?")?
"?":"\x26")+w+"\x3d"+encodeURIComponent(z[w])}return t},_flippingAxisForWkids:[[3819,3819],[3821,3824],[3889,3889],[3906,3906],[4001,4025],[4027,4036],[4039,4047],[4052,4055],[4074,4075],[4080,4081],[4120,4176],[4178,4185],[4188,4216],[4218,4289],[4291,4304],[4306,4319],[4322,4326],[4463,4463],[4470,4470],[4475,4475],[4483,4483],[4490,4490],[4555,4558],[4600,4646],[4657,4765],[4801,4811],[4813,4821],[4823,4824],[4901,4904],[5013,5013],[5132,5132],[5228,5229],[5233,5233],[5246,5246],[5252,5252],[5264,
5264],[5324,5340],[5354,5354],[5360,5360],[5365,5365],[5370,5373],[5381,5381],[5393,5393],[5451,5451],[5464,5464],[5467,5467],[5489,5489],[5524,5524],[5527,5527],[5546,5546],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3038,3051],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3150,3151],[3300,3301],[3328,
3335],[3346,3346],[3350,3352],[3366,3366],[3389,3390],[3416,3417],[3833,3841],[3844,3850],[3854,3854],[3873,3885],[3907,3910],[4026,4026],[4037,4038],[4417,4417],[4434,4434],[4491,4554],[4839,4839],[5048,5048],[5105,5130],[5253,5259],[5269,5275],[5343,5349],[5479,5482],[5518,5519],[5520,5520],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],
[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]]});v.setObject("layers.WMTSLayer",n,d);return n})},"esri/layers/WMTSLayerInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(m,n,v,b){m=m(null,{declaredClass:"esri.layers.WMTSLayerInfo",identifier:null,tileMatrixSet:null,format:null,style:null,tileInfo:null,title:null,fullExtent:null,initialExtent:null,description:null,dimension:null,constructor:function(p){p&&(this.title=p.title,this.tileMatrixSet=
p.tileMatrixSet,this.format=p.format,this.style=p.style,this.tileInfo=p.tileInfo,this.fullExtent=p.fullExtent,this.initialExtent=p.initialExtent,this.identifier=p.identifier,this.description=p.description,this.dimension=p.dimension)}});n.setObject("layers.WMTSLayerInfo",m,b);return m})},"esri/dijit/Directions":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/_base/array dojo/_base/Color dijit/a11yclick dijit/_TemplatedMixin dijit/form/Select dijit/form/ValidationTextBox dijit/form/DateTextBox dijit/form/TimeTextBox dojo/store/Memory dojo/data/ObjectStore dojo/keys dojo/has dojo/on dojo/mouse dojo/dom dojo/dom-geometry dojo/dom-style dojo/dom-class dojo/dom-attr dojo/query dojo/number dojo/i18n!../nls/jsapi dojo/text!./templates/Directions.html ./Search dojo/dom-construct dojo/promise/all dojo/Deferred dojo/dnd/Source dojo/json ../kernel ../urlUtils ../graphic ../units ../TimeExtent ../InfoTemplate ../SpatialReference ../layers/ArcGISDynamicMapServiceLayer ../layers/GraphicsLayer ../geometry/webMercatorUtils ../geometry/geodesicUtils ../arcgis/utils ../geometry/Point ../geometry/Extent ../geometry/Polyline ../geometry/mathUtils ../symbols/SimpleMarkerSymbol ../symbols/PictureMarkerSymbol ../symbols/CartographicLineSymbol ../symbols/TextSymbol ../renderers/UniqueValueRenderer ../symbols/Font ./_EventedWidget ../tasks/FeatureSet ../tasks/RouteTask ../tasks/RouteParameters ../tasks/GeometryService ../tasks/DistanceParameters ../tasks/PrintTask ../tasks/PrintParameters ../tasks/PrintTemplate ../toolbars/edit ../toolbars/draw ../config ../tasks/ProjectParameters dojo/uacss".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x,t,w,z,B,A,y,E,G,F,D,L,O,S,Z,I,N,K,Q,da,U,aa,J,T,Y,W,R,X,ia,ka,ca,la,oa,wa,za,Fa,Ba,Ca,va,Va,Sa,Ra,Ta,Wa,La,$a,ya,Xa,bb,cb,ab){var Ua=K.getProtocolForWebResource(),db=D.createSubclass({_setSourcesAttr:function(C){C&&(C=C.map(function(H){H.locator&&null==H.locationType&&(H=v.mixin({locationType:"street"},H));return H}));this.inherited(arguments,[C])}});n=n("esri.dijit.Directions",[va,a],{templateString:F,mapClickActive:!1,barrierToolActive:!1,_eventMap:{activate:!0,
deactivate:!1,load:!0,"directions-start":!0,"directions-finish":["result"],"directions-clear":!0,"segment-select":["graphic"],"segment-highlight":["graphic"],error:["error"],"stops-update":["stops"],"route-item-created":!0,"route-item-updated":!0,"feature-collection-created":!0},_emptyStop:{name:""},constructor:function(C,H){if(!C.map)throw Error('Required "map" parameter is missing. Cannot instantiate Directions Widget.');if(!H)throw Error('Required "srcNodeRef" parameter is missing. Cannot instantiate Directions Widget.');
this._i18n=G;this._css={widgetContainerClass:"esriDirectionsContainer",searchSourceContainerClass:"esriSearchSourceContainer",stopsContainerClass:"esriStopsContainer",stopsTableContainerClass:"esriStopsTableContainer",stopsTableCoverClass:"esriStopsTableCover",reverseStopsClass:"esriStopsReverse",addStopsClass:"esriStopsAdd",stopsClass:"esriStops",stopsRemovableClass:"esriStopsRemovable",stopsButtonContainerClass:"esriStopsButtons",stopsOptionsButtonClass:"esriStopsOptionsButton",stopsAddDestinationClass:"esriStopsAddDestination",
stopsAddDestinationBtnClass:"esriStopsAddDestinationBtn",stopsGetDirectionsContainerClass:"esriStopsGetDirectionsContainer",stopsGetDirectionsClass:"esriStopsGetDirections",stopsClearDirectionsClass:"esriStopsClearDirections",stopsInnerGeocoderClass:"esriInnerGeocoder",stopsOptionsOptionsEnabledClass:"esriStopsOptionsEnabled",stopsOptionsMenuClass:"esriStopsOptionsMenu",stopsFindOptimalOrderClass:"esriFindOptimalOrderOption",stopsUseTrafficClass:"esriUseTrafficOption",stopsReturnToStartClass:"esriReturnToStartOption",
stopsOptionsCheckboxesClass:"esriOptionsCheckboxes",stopsOptionsToggleContainerClass:"esriOptionsToggleContainer",stopsOptionsUnitsContainerClass:"esriOptionsUnitsContainer",stopsOptionsUnitsMiClass:"esriOptionsUnitsMi",stopsOptionsUnitsKmClass:"esriOptionsUnitsKm",stopsOptionsImpedanceContainerClass:"esriOptionsImpedanceContainer",stopsOptionsImpedanceTimeClass:"esriOptionsImpedanceTime",stopsOptionsImpedanceDistanceClass:"esriOptionsImpedanceDistance",stopClass:"esriStop",stopOriginClass:"esriStopOrigin",
stopDestinationClass:"esriStopDestination",stopUnreachedFirstOrLastClass:"esriStopUnreachedFirstOrLast",stopUnreachedClass:"esriStopUnreached",esriStopGeocoderColumnClass:"esriStopGeocoderColumn",esriStopReverseColumnClass:"esriStopReverseColumn",stopDnDHandleClass:"esriStopDnDHandle",stopDnDHandleClassHidden:"esriStopDnDHandleHidden",stopIconColumnClass:"esriStopIconColumn",stopIconClass:"esriStopIcon",stopIconRemoveColumnClass:"esriStopIconRemoveColumn",stopIconRemoveClass:"esriStopIconRemove",
stopIconRemoveClassHidden:"esriStopIconRemoveHidden",resultsContainerClass:"esriResultsContainer",resultsLoadingClass:"esriResultsLoading",resultsPrintClass:"esriResultsPrint",resultsSaveClass:"esriResultsSave",resultsSummaryClass:"esriResultsSummary",routesContainerClass:"esriRoutesContainer",routesClass:"esriRoutes",routesErrorClass:"esriRoutesError",routesInfoClass:"esriRoutesInfo",routeClass:"esriRoute",routeTextColumnClass:"esriRouteTextColumn",routeTextClass:"esriRouteText",routeLengthClass:"esriRouteLength",
routeOriginClass:"esriDMTStopOrigin",routeDestinationClass:"esriDMTStopDestination",routeInfoClass:"esriRouteInfo",routeIconColumnClass:"esriRouteIconColumn",routeIconClass:"esriRouteIcon",infoWindowRouteClass:"esriInfoWindowRoute",routeZoomClass:"esriRouteZoom",esriPrintPageClass:"esriPrintPage",esriPrintBarClass:"esriPrintBar",esriPrintButtonClass:"esriPrintButton",esriCloseButtonClass:"esriCloseButton",esriPrintMainClass:"esriPrintMain",esriPrintHeaderClass:"esriPrintHeader",esriPrintLogoClass:"esriPrintLogo",
esriPrintMapClass:"esriPrintMap",esriPrintNameClass:"esriPrintName",esriPrintNotesClass:"esriPrintNotes",esriPrintLengthClass:"esriPrintLength",esriPrintDirectionsClass:"esriPrintDirections",esriPrintFooterClass:"esriPrintFooter",esriPrintStopLabelClass:"esriPrintStopLabel",clearClass:"esriClear",dndDragBodyClass:"esriDndDragDirection",stopsButtonClass:"esriDirectionsButton",stopsButtonTabClass:"esriDirectionsTabButton",stopsButtonTabLastClass:"esriDirectionsTabLastButton",stopsPressedButtonClass:"esriDirectionsPressedButton",
linkButtonClass:"esriLinkButton",activateButtonClass:"esriActivateButton",lineBarrierButtonClass:"esriLineBarrierButton",travelModesContainerClass:"esriTravelModesContainer"};this.options={map:null,autoSolve:!0,minStops:2,maxStops:20,theme:"simpleDirections",alphabet:"1234567890",directions:null,returnToStart:!1,optimalRoute:!1,routeTaskUrl:Ua+"//route.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",printTaskUrl:Ua+"//utility.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task",
geometryTaskUrl:Ua+"//utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",routeParams:{},stops:["",""],searchOptions:{},stopsInfoTemplate:new aa(G.widgets.directions.stop,"${address}${error}"),waypointInfoTemplate:new aa(G.widgets.directions.maneuver,G.widgets.directions.waypoint),segmentInfoTemplate:new aa(G.widgets.directions.maneuver,'\x3cdiv class\x3d"${maneuverType}"\x3e\x3cdiv class\x3d"'+this._css.routeIconClass+" "+this._css.infoWindowRouteClass+'"\x3e\x3cstrong\x3e${step}.\x3c/strong\x3e ${formattedText}\x3c/div\x3e\x3c/div\x3e'),
textSymbolFont:new Ca("11px",Ca.STYLE_NORMAL,Ca.VARIANT_NORMAL,Ca.WEIGHT_NORMAL,"Arial, Helvetica, sans-serif"),textSymbolColor:new f([255,255,255]),textSymbolOffset:{x:0,y:10.875},fromSymbol:(new wa({url:m.toUrl("./images/Directions/greenPoint.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),fromSymbolDrag:(new wa({url:m.toUrl("./images/Directions/greenPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbol:(new wa({url:m.toUrl("./images/Directions/bluePoint.png"),
height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbolDrag:(new wa({url:m.toUrl("./images/Directions/bluePointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),toSymbol:(new wa({url:m.toUrl("./images/Directions/redPoint.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),toSymbolDrag:(new wa({url:m.toUrl("./images/Directions/redPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbol:(new wa({url:m.toUrl("./images/Directions/grayPoint.png"),
height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbolDrag:(new wa({url:m.toUrl("./images/Directions/grayPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),waypointSymbol:new oa({color:[255,255,255,255],size:10,type:"esriSMS",style:"esriSMSCircle",outline:{color:[20,89,127,255],width:2.5,type:"esriSLS",style:"esriSLSSolid"}}),maneuverSymbol:new oa({color:[255,255,255,255],size:4,type:"esriSMS",style:"esriSMSCircle",outline:{color:[30,99,137,255],
width:1,type:"esriSLS",style:"esriSLSSolid"}}),routeSymbol:(new za).setColor(new f([20,89,127,.75])).setWidth(10).setCap(za.CAP_ROUND).setJoin(za.JOIN_ROUND),segmentSymbol:(new za).setColor(new f([255,255,255,1])).setWidth(6).setCap(za.CAP_ROUND).setJoin(za.JOIN_ROUND),barrierRenderer:new Ba({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{type:"esriPMS",imageData:"PHN2ZyB3aWR0aD0iMjIyIiBoZWlnaHQ9IjIyMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGc+CjxlbGxpcHNlIGZpbGw9IiNmZjAwMDAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyMCIgY3g9IjExMiIgY3k9IjExMSIgaWQ9InN2Z181IiByeD0iMTAwIiByeT0iMTAwIi8+CjxlbGxpcHNlIGZpbGw9IiNmZjAwMDAiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIyMCIgY3g9IjExMiIgY3k9IjExMSIgaWQ9InN2Z182IiByeD0iOTUiIHJ5PSI5NSIvPgo8cmVjdCBmaWxsPSIjZmYwMDAwIiBzdHJva2Utd2lkdGg9IjIwIiB4PSI2NC41IiB5PSIxMDIiIHdpZHRoPSI5NSIgaGVpZ2h0PSIxOCIgaWQ9InN2Z183IiBzdHJva2U9IiNmZmZmZmYiLz4KPC9nPgo8L3N2Zz4\x3d",
contentType:"image/svg+xml",width:18,height:18},uniqueValueInfos:[{value:"2",symbol:{type:"esriPMS",imageData:"PHN2ZyB3aWR0aD0iMjg2IiBoZWlnaHQ9IjI1NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGc+CjxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZS13aWR0aD0iMTAiIGQ9Im04Ljc0OTk5MiwyNTEuNzQ5OTk3bDEzNC45OTk5OTgsLTI0MS45OTk5OThsMTM0Ljk5OTk5OCwyNDEuOTk5OTk4bC0yNjkuOTk5OTk1LDBsLTAuMDAwMDAxLDB6IiBpZD0ic3ZnXzEiIHN0cm9rZT0iIzAwMCIvPgo8cGF0aCBzdHJva2U9IiNmZmYiIGZpbGw9IiNmZjAwMDAiIHN0cm9rZS13aWR0aD0iMTUiIGQ9Im0yMy41MDAwMDQsMjQyLjUwMDAwNWwxMTkuOTk5OTkyLC0yMTUuOTk5OTk5bDExOS45OTk5OTIsMjE1Ljk5OTk5OWwtMjM5Ljk5OTk4MywwbC0wLjAwMDAwMSwweiIgaWQ9InN2Z18yIi8+Cjx0ZXh0IGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSIjZmZmZmZmIiBzdHJva2U9IiNmZjAwMDAiIHN0cm9rZS13aWR0aD0iMCIgeD0iMTA5IiB5PSIyMjIuNzUiIGlkPSJzdmdfNSIgZm9udC1zaXplPSIxODAiIGZvbnQtZmFtaWx5PSJHZW9yZ2lhLCBUaW1lcywgJ1RpbWVzIE5ldyBSb21hbicsIHNlcmlmIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHhtbDpzcGFjZT0icHJlc2VydmUiPiE8L3RleHQ+CjwvZz4KPC9zdmc+",
contentType:"image/svg+xml",width:19,height:18}}]}),polylineBarrierRenderer:new Ba({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{color:[255,0,0,184],width:7.5,type:"esriSLS",style:"esriSLSSolid"},uniqueValueInfos:[{value:"1",symbol:{color:[255,85,0,184],width:7.5,type:"esriSLS",style:"esriSLSSolid"}}]}),polygonBarrierRenderer:new Ba({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{color:[255,0,0,156],outline:{color:[255,0,0,153],width:2.4,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",
style:"esriSFSSolid"},uniqueValueInfos:[{value:"1",symbol:{color:[255,170,0,156],outline:{color:[255,0,0,153],width:7.5,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"}}]}),printPage:"",printTemplate:"",focusOnNewStop:!0,dragging:!0,canModifyStops:!0,canModifyWaypoints:!0,directionsLengthUnits:null,directionsLanguage:null,traffic:!1,trafficLayer:null,showPrintPage:!0,showSaveButton:!1,showSegmentPopup:!1,showSegmentHighlight:!0,showReverseStopsButton:!0,showReturnToStartOption:!0,
showOptimalRouteOption:!0,showTravelModesOption:!0,showMilesKilometersOption:!0,showClearButton:!1,showActivateButton:!0,showBarriersButton:!0,loaded:!1,routeLayer:{itemId:null,title:null,isItemOwner:!0,ownerFolder:null},startTime:"now"};this.userOptions=C;this.defaults=v.mixin({},this.options,C,{_waypointName:"DWWP",_userDefinedStopName:"UserDefinedStopName",_solveInProgress:!1,_moveInProgress:!1,_stopSequence:1E3});if(!this.defaults.minStops||2>this.defaults.minStops)this.defaults.minStops=2;if(2<
this.defaults.minStops&&this.defaults.stops&&","===this.defaults.stops.toString())for(var M=2;M<this.defaults.minStops;M++)this.defaults.stops.splice(0,0,"");this.domNode=H},postCreate:function(){this.inherited(arguments);this.own(r(this._activateButtonNode,d,v.hitch(this,function(){this.mapClickActive?this.deactivate():this.activate()})));this.own(r(this._lineBarrierButtonNode,d,v.hitch(this,function(){this.barrierToolActive?this.deactivateBarrierTool():this.activateBarrierTool()})));this.own(r(this._addDestinationNode,
d,v.hitch(this,this._addStopButton)));this.own(r(this._optionsButtonNode,d,v.hitch(this,this._toggleOptionsMenu)));this.own(r(this._saveMenuButton,d,v.hitch(this,this._toggleSaveMenu)));this.own(r(this._saveButton,d,v.hitch(this,function(){this._saveButton._enabled&&this._storeRouteUI()})));this.own(r(this._saveAsButton,d,v.hitch(this,function(){v.mixin(this.routeLayer,{itemId:null,title:null,ownerFolder:null});this._storeRouteUI()})));this.own(r(this._findOptimalOrderNode,d,v.hitch(this,this._toggleCheckbox)));
this.own(r(this._returnToStartNode,d,v.hitch(this,this._toggleCheckbox)));this.own(r(this._useTrafficNode,d,v.hitch(this,this._toggleCheckbox)));this.own(r(this._useMilesNode,d,v.hitch(this,this._toggleUnits)));this.own(r(this._useKilometersNode,d,v.hitch(this,this._toggleUnits)));this.own(r(this._getDirectionsButtonNode,d,v.hitch(this,this.getDirections)));this.own(r(this._clearDirectionsButtonNode,d,v.hitch(this,function(){this.clearDirections()})));var C=v.hitch(this,function(){clearTimeout(this._startTimeMenu._hideTimer);
this._startTimeMenu._hideTimer=setTimeout(v.hitch(this,function(){z.set(this._startTimeMenu,"display","none")}),100)});this.own(r(this._startTimeButtonNode,d,v.hitch(this,function(){this._startTimeButtonNode.disabled||"block"===z.get(this._startTimeMenu,"display")?z.set(this._startTimeMenu,"display","none"):(z.set(this._startTimeMenu,"display","block"),this["now"===this.startTime?"_startTimeMenuLeaveNow":"none"===this.startTime?"_startTimeMenuNone":"_startTimeMenuDepartAt"].focus())})));this.own(r(this._startTimeMenuLeaveNow,
"blur",C));this.own(r(this._startTimeMenuDepartAt,"blur",C));this.own(r(this._startTimeMenuNone,"blur",C));this.own(r(this._startTimeMenuLeaveNow,"mousedown",v.hitch(this,function(){this.startTime="now";this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this.own(r(this._startTimeMenuDepartAt,"mousedown",v.hitch(this,function(){this.startTime=(new Date).getTime();this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this.own(r(this._startTimeMenuNone,"mousedown",v.hitch(this,function(){this.startTime=
"none";this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this._symbolEventPaddingDirections=(new za).setColor(new f([0,255,0,0])).setWidth(20).setCap(za.CAP_ROUND);this._stopLayer=new Y({id:"directions_stopLayer_"+this.id,displayOnPan:!0});this._routeLayer=new Y({id:"directions_routeLayer_"+this.id,displayOnPan:!0});this._waypointsEventLayer=new Y({id:"directions_waypointsEventLayer_"+this.id,displayOnPan:!0});this._barriersLayer=new Y({id:"directions_barriersLayer_"+this.id,displayOnPan:!0});
this._polylineBarriersLayer=new Y({id:"directions_polylineBarriersLayer_"+this.id,displayOnPan:!0});this._polygonBarriersLayer=new Y({id:"directions_polygonBarriersLayer_"+this.id,displayOnPan:!0});this._barriersLayer.setRenderer(this.defaults.barrierRenderer);this._polylineBarriersLayer.setRenderer(this.defaults.polylineBarrierRenderer);this._polygonBarriersLayer.setRenderer(this.defaults.polygonBarrierRenderer);this.map&&(this.map.addLayer(this._routeLayer),this.map.addLayer(this._polygonBarriersLayer),
this.map.addLayer(this._polylineBarriersLayer),this.map.addLayer(this._barriersLayer),this.map.addLayer(this._stopLayer),this._externalTimeExtent=this.map.timeExtent);this._snappingManager=this.map.enableSnapping({layerInfos:[{layer:this._waypointsEventLayer,snapToVertex:!1,snapToPoint:!0,snapToEdge:!0}],tolerance:15});this._setWidgetProperties();var H=new Q(null,this.waypointSymbol,{});C=v.hitch(this,function(){this._moveInProgress||this._solveInProgress||!H._isShown()||(this.editToolbar.deactivate(),
this._stopLayer.remove(H),clearTimeout(H._solveTimeout),H._solveTimeout=null,H.attributes.isWaypoint=!0,H._isStopIcon&&this.stopGraphics[H._index]&&(this._stopLayer.add(this.stopGraphics[H._index]),this._stopLayer.add(this.textGraphics[H._index])));H._showTooltip()});this._handle=v.mixin(H,{_isHandle:!0,_tooltip:L.create("div",{className:this.theme+" esriDirectionsRouteTooltip",onmouseover:C},this.map.container),_showTooltip:v.hitch(this,function(M){H._tooltip.style.display=!M||M instanceof MouseEvent?
"none":"inline";M&&(M="string"===typeof M?M:"\x3ctable class\x3d'esriRoutesTooltip'\x3e"+this._renderDirectionsItemTR(M)+"\x3c/table\x3e",H._tooltip.innerHTML!==M&&(H._tooltip.innerHTML=M))}),_isShown:v.hitch(this,function(){return-1<p.indexOf(this._stopLayer.graphics,H)}),_remove:C});this._activate(this.mapClickActive)},startup:function(){this.inherited(arguments);return this._enqueue(this._init)},destroy:function(){this.deactivate();this.map.removeLayer(this._barriersLayer);this.map.removeLayer(this._polylineBarriersLayer);
this.map.removeLayer(this._polygonBarriersLayer);this.map.removeLayer(this._routeLayer);this.map.removeLayer(this._stopLayer);this.map.removeLayer(this._waypointsEventLayer);this._disconnectEvents();L.empty(this.domNode);this.inherited(arguments)},activate:function(){return this._enqueue(function(){this.deactivateBarrierTool().then(v.hitch(this,function(){this.set("mapClickActive",!0)}))})},deactivate:function(){return this._enqueue(function(){this.deactivateBarrierTool().then(v.hitch(this,function(){this.set("mapClickActive",
!1)}))})},activateBarrierTool:function(){return this._enqueue(function(){this.set("mapClickActive",!1);this.set("barrierToolActive",!0)})},deactivateBarrierTool:function(){return this._enqueue(function(){this.set("mapClickActive",!1);this.set("barrierToolActive",!1)})},clearDirections:function(){return this._enqueue(function(){this.clearMessages();return this._clearDirections()})},reset:function(){return this._enqueue(this._reset)},modifyStopSequence:function(C,H){return this._enqueue(function(){return this._modifyStopSequence(C,
H)})},onActivate:function(){},onDeactivate:function(){},onActivateBarrierTool:function(){},onDeactivateBarrierTool:function(){},onLoad:function(){this._enableButton(this._getDirectionsButtonNode)},onDirectionsStart:function(){this._clearDisplayBeforeSolve();this.set("solving",!0);this._showLoadingSpinner(!0)},onDirectionsFinish:function(){this._showLoadingSpinner(!1);this.set("solving",!1)},onDirectionsClear:function(){},onSegmentSelect:function(){},onSegmentHighlight:function(){},onStopsUpdate:function(){},
onRouteItemCreated:function(){},onRouteItemUpdated:function(){},onFeatureCollectionCreated:function(){},onError:function(){},removeStops:function(){return this.reset()},removeStop:function(C,H,M){return this._enqueue(function(){this.clearMessages();return this._removeStop(C,H,M)})},updateStops:function(C){return this._enqueue(function(){return this._updateStops(C)})},addStops:function(C,H){return this._enqueue(function(){return this._addStops(C,H)}).then(v.hitch(this,this.zoomToFullRoute))},addStop:function(C,
H){return this._enqueue(function(){return this._addStop(C,H)},{_incrementalSolveStopRange:this._incrementalSolveStopRange})},updateStop:function(C,H,M){return this._enqueue(function(){return this._updateStop(C,H,M)},{_incrementalSolveStopRange:this._incrementalSolveStopRange})},setBarriers:function(C){this.routeParams.barriers=C;return this._getDirections().then(v.hitch(this,function(){this.zoomToFullRoute()}))},setPolylineBarriers:function(C){this.routeParams.polylineBarriers=C;return this._getDirections().then(v.hitch(this,
function(){this.zoomToFullRoute()}))},setPolygonBarriers:function(C){this.routeParams.polygonBarriers=C;return this._getDirections().then(v.hitch(this,function(){this.zoomToFullRoute()}))},clearMessages:function(){this.messages=[];this._msgNode&&(this._msgNode.innerHTML="")},getDirections:function(C){return this._enqueue(function(){return this._getDirections().then(v.hitch(this,function(){!0!==C&&this.zoomToFullRoute()}))})},selectSegment:function(C){if(!(!this.directions||!this.directions.features||
0>C||C>=this.directions.features.length))for(var H=y("[data-segment]",this._resultsNode),M=0;M<H.length;M++){var V=parseInt(A.get(H[M],"data-segment"),10);if(C===V&&H[M]!==this._focusedDirectionsItem){this._focusedDirectionsItem=H[M];this.centerAtSegmentStart(C);this.onSegmentSelect(this.directions.features[C]);H[M].focus();break}}},unhighlightSegment:function(C){var H=this._segmentGraphics;if(H&&(!this._focusedDirectionsItem||C)){for(C=0;C<H.length;C++)this._routeLayer.remove(H[C]);this._segmentGraphics=
[]}},highlightSegment:function(C,H){if(!(this._focusedDirectionsItem&&!H||C>=this.directions.features.length)){C=C||0;var M=v.hitch(this,function(ta){var ua=this.map.toMap({x:0,y:0});return this.map.toScreen(ua.offset(ta,0)).x}),V=v.hitch(this,function(ta){for(var ua=0,Da=0;Da<ta.length;Da++)for(var Ma=1;Ma<ta[Da].length;Ma++){var Ha=ta[Da][Ma-1],Ia=ta[Da][Ma];ua+=M(Math.sqrt((Ha[0]-Ia[0])*(Ha[0]-Ia[0])+(Ha[1]-Ia[1])*(Ha[1]-Ia[1])))}return ua}),P=v.hitch(this,function(ta){var ua=this.map.toMap({x:0,
y:0});return this.map.toMap({x:ta,y:0}).x-ua.x}),ba=function(ta,ua,Da){ua=Math.max(1,ua);for(var Ma=Da?ta[0].length-1:0,Ha=0,Ia,Aa,ra,sa=[[ta[0][Da?Ma:0]]];Da&&0<Ma||!Da&&Ma<ta[0].length-1;){Aa=ta[0][Da?Ma-1:Ma];ra=ta[0][Da?Ma:Ma+1];if(Ia=M(Math.sqrt((Aa[0]-ra[0])*(Aa[0]-ra[0])+(Aa[1]-ra[1])*(Aa[1]-ra[1]))))if(Ha+Ia<ua)Da?sa[0].splice(0,0,Aa):sa[0].push(ra),Ha+=Ia;else{ua=(ua-Ha)/Ia;Da?sa[0].splice(0,0,[ra[0]-(ra[0]-Aa[0])*ua,ra[1]-(ra[1]-Aa[1])*ua]):sa[0].push([Aa[0]+(ra[0]-Aa[0])*ua,Aa[1]+(ra[1]-
Aa[1])*ua]);break}Ma+=Da?-1:1}return 0<Ha+Ia?sa:ta},ea=this.get("directions").features[C],ha=new ca(ea.geometry),fa=40*Math.PI/180;v.mixin(ea.attributes,{_index:C});if(C){var ja=ba(this.get("directions").features[C-1].geometry.paths,25,!0),ma="esriDMTStop"!==ea.attributes.maneuverType?ba(ha.paths,25,!1):ja;ja=ma!==ja?[ja[0].concat(ma[0])]:ma;var na=(new ca(ma)).getExtent();if(1<ma[0].length&&15<=M(Math.max(na.getWidth(),na.getHeight()))){ba=15*Math.cos(fa/2);V=15*Math.sin(fa/2);var qa=ma[0].length-
2;fa=ma[0][qa+1];for(na=0;0<=qa&&!na;){var xa=ma[0][qa];na=M(Math.sqrt((xa[0]-fa[0])*(xa[0]-fa[0])+(xa[1]-fa[1])*(xa[1]-fa[1])));qa--}22>na&&(ma=na+(22-na)/3,qa=na+2*(22-na)/3,qa=[xa[0]+qa/na*(fa[0]-xa[0]),xa[1]+qa/na*(fa[1]-xa[1])],xa=[fa[0]-ma/na*(fa[0]-xa[0]),fa[1]-ma/na*(fa[1]-xa[1])],fa=qa,na=22);ba/=na;ma=[fa[0]-(fa[0]-xa[0])*ba,fa[1]-(fa[1]-xa[1])*ba];xa[1]!==fa[1]?(ba=(fa[0]-xa[0])/(fa[1]-xa[1]),xa=P(V/Math.sqrt(1+ba*ba)),P=ba*xa):(xa=0,P=P(V));Infinity===Math.abs(xa)||Infinity===Math.abs(P)||
isNaN(xa)||isNaN(P)||(ja[0].push(fa),ja[0].push([ma[0]-xa,ma[1]+P]),ja[0].push([ma[0]+xa,ma[1]-P]),ja[0].push(fa))}else ja=ba(ja,2*V(ma),!0);ha.paths=ja}this.unhighlightSegment(this._segmentGraphics&&this._segmentGraphics.length);P=v.clone(this.routeSymbol).setWidth(this.segmentSymbol.width).setColor(new f([parseInt(.9*this.segmentSymbol.color.r),parseInt(.9*this.segmentSymbol.color.g),parseInt(.9*this.segmentSymbol.color.b)]));this._segmentGraphics=[new Q(ea.geometry,P,ea.attributes,this.get("segmentInfoTemplate")),
new Q(ha,this.routeSymbol,ea.attributes,this.get("segmentInfoTemplate")),new Q(ha,this.segmentSymbol,ea.attributes,this.get("segmentInfoTemplate"))];this.get("showSegmentHighlight")&&(this._routeLayer.add(this._segmentGraphics[0]),this._routeLayer.add(this._segmentGraphics[1]),this._routeLayer.add(this._segmentGraphics[2]));ea=v.hitch(this,function(ta){if(0<ta&&ta<this.directions.features.length){ta=this.directions.features[ta]._associatedFeaturesWithWaypoints;for(var ua=0;ua<ta.length;ua++)ta[ua]._associatedSnapFeature&&
ta[ua]._associatedSnapFeature.getDojoShape()&&ta[ua]._associatedSnapFeature.getDojoShape().moveToFront()}});ea(C-1);ea(C);this.onSegmentHighlight(this.directions.features[C])}},zoomToSegment:function(C){var H=new S;if(this.directions&&this.directions.features){var M=Math.max(0,Math.min(this.directions.features.length-1,C||0));this.map.setExtent(this.get("directions").features[M].geometry.getExtent(),!0).promise.always(v.hitch(this,function(){this.highlightSegment(M);H.resolve()}))}else H.reject(Error("No directions."));
return H.promise},centerAtSegmentStart:function(C){var H=new S;if(this.directions&&this.directions.features){var M=Math.max(0,Math.min(this.directions.features.length-1,C||0));var V=this.directions.features[M];this.map.centerAt(V.geometry.getPoint(0,0)).promise.always(v.hitch(this,function(){this.highlightSegment(M,!0);this._showSegmentPopup(V,M);H.resolve()}))}else H.reject(Error("No directions."));return H.promise},zoomToFullRoute:function(){var C=new S;this.directions&&this.directions.features?
(this._clearInfoWindow(),this.unhighlightSegment(),this.get("map").setExtent(this.get("directions").extent,!0).promise.always(C.resolve)):C.resolve();return C.promise},setListIcons:function(){var C,H=this._dnd.getAllNodes();for(C=0;C<H.length;C++){var M=y("."+this._css.stopIconClass,H[C])[0];M&&(M.innerHTML=this._getLetter(C));B.remove(H[C],this._css.stopOriginClass+" "+this._css.stopDestinationClass+" "+this._css.stopUnreachedClass+" "+this._css.stopUnreachedFirstOrLastClass);M=this._getStopSymbol(this.stops[C]);
M===this.fromSymbol?B.add(H[C],this._css.stopOriginClass):M===this.toSymbol?B.add(H[C],this._css.stopDestinationClass):M===this.unreachedSymbol&&B.add(H[C],this._css.stopUnreachedClass)}C=y("[data-reverse-td]",this._dndNode)[0];L.destroy(C);this.get("showReverseStopsButton")&&L.create("td",{"data-reverse-td":"true",rowspan:H.length,className:this._css.esriStopReverseColumnClass,innerHTML:'\x3cdiv role\x3d"button" class\x3d"'+this._css.reverseStopsClass+'" data-reverse-stops\x3d"true" title\x3d"'+
G.widgets.directions.reverseDirections+'"\x3e\x3c/div\x3e',onmouseover:function(V){V.stopPropagation()},onmouseout:function(V){V.stopPropagation()}},H[0])},addRouteSymbols:function(){if(this.stopGraphics.length){this._moveLayersToFront();for(var C=0;C<this.stopGraphics.length;C++)if(this.stopGraphics[C]&&(!this._handle._isShown()||this._handle._isShown()&&this._handle._index!==C)){this._stopLayer.add(this.stopGraphics[C]);var H=this.stopGraphics[C].getDojoShape();H&&H.moveToFront();this._stopLayer.add(this.textGraphics[C]);
(H=this.textGraphics[C].getDojoShape())&&H.moveToFront()}this._moveInProgress&&!this._handle.attributes.isWaypoint&&this._handle.getDojoShape()&&this._handle.getDojoShape().moveToFront()}},createRouteSymbols:function(){this._clearStopGraphics();for(var C=this.stops,H=function(ha){var fa={},ja;for(ja in ha)ha.hasOwnProperty(ja)&&0===ja.indexOf("Attr_")&&(fa[ja]=ha[ja]);return fa},M=0;M<C.length;M++){var V=C[M];if(V&&V.feature){var P=V.feature.attributes,ba=P?P.Status:void 0,ea=null;this._isStopAWaypoint(V)||
(ea=new Fa(this._getLetter(M),this.get("textSymbolFont"),this.get("textSymbolColor")),this.get("textSymbolOffset")&&ea.setOffset(this.get("textSymbolOffset").x,this.get("textSymbolOffset").y));ea=new Q(V.feature.geometry,ea,{address:V.name},this.get("stopsInfoTemplate"));ea._isStopLabel=!0;ea._index=M;V=new Q(V.feature.geometry,this._getStopSymbol(V),v.mixin({address:V.name,Status:void 0===ba?0:ba,CurbApproach:P&&P.CurbApproach?P.CurbApproach:null,TimeWindowStart:P&&P.TimeWindowStart?P.TimeWindowStart:
null,TimeWindowEnd:P&&P.TimeWindowEnd?P.TimeWindowEnd:null,isWaypoint:this._isStopAWaypoint(V)},H(P)),this.get(this._isStopAWaypoint(V)?"waypointInfoTemplate":"stopsInfoTemplate"));V._isStopIcon=!0;V._index=M;this.stopGraphics[M]=V;this.textGraphics[M]=ea}}this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);this._showBarriers();this.addRouteSymbols();this.setListIcons()},setTravelMode:function(C){return this._enqueue(function(){this.clearMessages();this._travelModeSelector.setValue(C);
return this._setTravelMode(C)})},getSupportedTravelModeNames:function(){var C=[],H=this.serviceDescription;if(H&&H.supportedTravelModes&&H.supportedTravelModes.length){H=H.supportedTravelModes;for(var M=0;M<H.length;M++)C.push(H[M].name)}return C},setDirectionsLengthUnits:function(){var C=1===arguments.length?arguments[0]:this.get("directionsLengthUnits");return this._enqueue(function(){this.clearMessages();return this._setDirectionsLengthUnits(C)})},setDirectionsLanguage:function(){var C=1===arguments.length?
arguments[0]:this.get("directionsLanguage");return this._enqueue(function(){this.clearMessages();return this._setDirectionsLanguage(C)})},useMyCurrentLocation:function(C){this.clearMessages();return this._createLocateButton(this.geocoders[C],!0,!0)},loadRoute:function(C){return this._enqueue(v.hitch(this,function(){return this._loadRoute(C)}))},_getStopsAttr:function(){return this.returnToStart&&this._returnToStartStop?this.stops.concat(this._returnToStartStop):this.stops},_getTravelModeNameAttr:function(){return this.routeParams&&
this.routeParams.travelMode&&this.routeParams.travelMode.name},_reset:function(){var C=this.mapClickActive||this.barrierToolActive;this._clearBarriersGraphics();this._setWidgetProperties();return this._init().then(v.hitch(this,function(){this.mapClickActive=!C;this.set("mapClickActive",C);this._searchSourceSelector&&this._searchSourceSelector.setValue("all")}))},_activate:function(){var C=this.get("mapClickActive"),H=v.hitch(this,function(M){for(var V=M?[this.textGraphics,this.stopGraphics,this.displayedManeuverPointGraphics,
this.displayedRouteGraphics]:[this.displayedRouteGraphics,this.displayedManeuverPointGraphics,this.stopGraphics,this.textGraphics],P=0;P<V.length;P++)for(var ba=V[P],ea=0;ea<ba.length;ea++){var ha=ba[ea].getDojoShape();ha&&ha[M?"moveToBack":"moveToFront"].call(ha)}});this.drawToolbar&&(this.barrierToolActive=!1,this.drawToolbar.deactivate(),B.remove(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass));this._addStopOnMapClickListener&&this._addStopOnMapClickListener.remove();C?(this.map.activeDirectionsWidget&&
this.map.activeDirectionsWidget!==this&&this.map.activeDirectionsWidget.deactivate(),this.map.activeDirectionsWidget=this,this._addStopOnMapClickListener=r(this.map,"click",v.hitch(this,function(M){this.canModifyStops&&!this._solveInProgress&&(this.map.infoWindow.hide(),this.addStop(new Q(M.mapPoint)))})),this.map.addLayer(this._waypointsEventLayer),this._moveLayersToFront(),B.add(this._activateButtonNode,this._css.stopsPressedButtonClass),this.onActivate()):(this.map.removeLayer(this._waypointsEventLayer),
B.remove(this._activateButtonNode,this._css.stopsPressedButtonClass),this.onDeactivate());H(!C);this.emit("map-click-active",{mapClickActive:this.mapClickActive})},_activateBarrierTool:function(){this.get("barrierToolActive")?(this.map.activeDirectionsWidget&&this.map.activeDirectionsWidget!==this&&this.map.activeDirectionsWidget.deactivate(),this.map.activeDirectionsWidget=this,this.drawToolbar.activate(bb.FREEHAND_POLYLINE),B.add(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass),this.onActivateBarrierTool()):
(this.drawToolbar.deactivate(),B.remove(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass),this.onDeactivateBarrierTool());this.emit("barrier-tool-active",{barrierToolActive:this.barrierToolActive})},_moveLayersToFront:function(){var C=this.get("map"),H=C.graphicsLayerIds.length-1;C.reorderLayer(this._routeLayer,H);C.reorderLayer(this._polygonBarriersLayer,H);C.reorderLayer(this._polylineBarriersLayer,H);C.reorderLayer(this._barriersLayer,H);C.reorderLayer(this._waypointsEventLayer,H);
C.reorderLayer(this._stopLayer,H)},_destroyGeocoders:function(){for(;this.geocoders&&this.geocoders.length;){if(this.geocoders[0])try{this.geocoders[0].destroy()}catch(C){}this.geocoders.splice(0,1)}this.geocoders=[]},_disconnectEvents:function(){var C=this._clearDirections(!0),H;if(this._watchEvents&&this._watchEvents.length)for(H=0;H<this._watchEvents.length;H++)this._watchEvents[H].unwatch();if(this._onEvents&&this._onEvents.length)for(H=0;H<this._onEvents.length;H++)this._onEvents[H].remove();
if(this._geocoderEvents)for(H=0;H<this._geocoderEvents.length;H++)this._geocoderEvents[H].value.unwatch(),this._geocoderEvents[H].blur.remove(),this._geocoderEvents[H].select.remove(),this._geocoderEvents[H].suggest.remove();this._onEvents=[];this._watchEvents=[];this._geocoderEvents=[];this._disconnectResults();this._destroyGeocoders();this._destroyGlobalGeocoder();this._destroyDnD();return C},_getDirections:function(){var C=new S;this._removeEmptyStops();1<this._getStopCount()+this._getWaypointCount()&&
this.loaded?(this.onDirectionsStart(),this.clearMessages(),this._dnd.sync(),this._sortGeocoders(),this._getCandidates(this.stops).then(v.hitch(this,function(H){this.stops=H;this._setStops();this._configureRoute().always(v.hitch(this,function(M){C.resolve(M)}))}),v.hitch(this,function(H){this.set("directions",null);this._clearRouteGraphics();C.reject(H);this.onDirectionsFinish(H)}))):this._clearDirections(!0).always(v.hitch(this,function(){this.createRouteSymbols();C.resolve()}));return C.promise},
_clearDirections:function(){var C=new S;this._handle&&this._handle._remove();this.get("routeParams")&&this.get("routeParams").stops?this.get("routeParams").stops.features.length?(this.get("routeParams").stops.features=[],this.onDirectionsClear(),C.resolve()):arguments.length?C.resolve():this._reset().then(C.resolve,C.reject):C.resolve();this.set("directions",null);this._clearDisplayBeforeSolve();this._clearDisplayAfterSolve();this._routeLayer.clear();this._waypointsEventLayer.clear();this._stopLayer.clear();
return C.promise},_setTravelMode:function(C){var H=new S,M=this.serviceDescription,V=function(){H.resolve(C)};if(M&&M.supportedTravelModes&&M.supportedTravelModes.length){var P=M.supportedTravelModes,ba=!1;for(M=0;M<P.length;M++)if(P[M].name===C){ba=!0;!this.routeParams.travelMode||this.routeParams.travelMode&&this.routeParams.travelMode.name!==C?(this.routeParams.travelMode=P[M].impedanceAttributeName?P[M]:P[M].itemId,this._checkStartTimeUIAvailability(),this._solveAndZoom().always(V)):V();this._travelModeSelector&&
this._travelModeSelector.domNode&&(this._travelModeSelector.domNode.title=P[M].description);break}ba||H.reject(C)}else H.reject(C);return H.promise},_setDirectionsLengthUnits:function(C){this._clearDisplayBeforeSolve();var H=new S;B.remove(this._useMilesNode,this._css.stopsPressedButtonClass);B.remove(this._useKilometersNode,this._css.stopsPressedButtonClass);C===da.KILOMETERS?B.add(this._useKilometersNode,this._css.stopsPressedButtonClass):C===da.MILES&&B.add(this._useMilesNode,this._css.stopsPressedButtonClass);
C===da.KILOMETERS||C===da.METERS||C===da.MILES||C===da.FEET||C===da.YARDS||C===da.NAUTICAL_MILES?(this.directionsLengthUnits=C,H.resolve(C)):H.reject(C);return H.promise},_setDirectionsLanguage:function(C){this._clearDisplayBeforeSolve();var H=new S;C=this._setDirectionsLanguageByLocale(C);this._solveAndZoom().always(function(){H.resolve(C)},H.reject);return H.promise},_showLoadingSpinner:function(C){void 0===C&&(C=this._requestQueueTail&&!this._requestQueueTail.isFulfilled()||this._moveInProgress);
C?(B.add(this._widgetContainer,this._css.resultsLoadingClass),B.add(this._resultsNode,"esriRoutesContainerBusy")):(B.remove(this._widgetContainer,this._css.resultsLoadingClass),B.remove(this._resultsNode,"esriRoutesContainerBusy"))},_enqueue:function(C,H){var M=new S;this._requestQueueTail||(this._requestQueueTail=new S,this._requestQueueTail.resolve());this._requestQueueTail.promise.always(v.hitch(this,function(){try{v.mixin(this,{_incrementalSolveStopRange:null},H);var V=C.call(this);V&&"object"===
typeof V&&V.hasOwnProperty("isFulfilled")?V.then(v.hitch(this,function(P){M.resolve(P);this._showLoadingSpinner()}),v.hitch(this,function(P){M.reject(P);this._showLoadingSpinner()})):(M.resolve(V),this._showLoadingSpinner())}catch(P){M.reject(P),this._showLoadingSpinner()}}));this._requestQueueTail=M;this._showLoadingSpinner();return M.promise},_createDnD:function(){this._dnd=new Z(this._dndNode,{skipForm:!0,withHandles:!0})},_destroyDnD:function(){L.empty(this._dndNode);this._dnd&&(this._dnd.destroy(),
this._dnd=null)},_createDepartAtControls:function(){if(this._departAtTime)this.map&&this._restoreMapTimeExtent(),this._useTrafficItemNode.title=G.widgets.directions.trafficLabelLive,B.remove(this._departAtContainer,"departAtContainerVisible"),this.startTime="now",this._updateStartTimeUI();else{var C=this,H=function(){this._keepDirections||C._clearDisplayBeforeSolve();this._keepDirections=!1},M=v.hitch(this,function(){this.map&&this.map.disableKeyboardNavigation()}),V=v.hitch(this,function(){this.map&&
this.map.enableKeyboardNavigation()});this._departAtTime=new k({required:!0,value:new Date,onChange:H,onFocus:M,onBlur:V},this._departAtTimeContainer);this._departAtDate=new l({required:!0,value:new Date,onChange:H,onFocus:M,onBlur:V,constraints:{min:new Date(864E5)}},this._departAtDateContainer)}},_setStartTime:function(C,H,M){if(isNaN(M))this.startTime="now"===M?M:"none";else{H=M instanceof Date?M:new Date(M);M=this.directions&&this.directions.features&&this.directions.features[0]&&this.directions.features[0].attributes;
var V=6E4*-H.getTimezoneOffset();H=new Date(H-V+(M&&M.arriveTimeUTC?M.ETA-M.arriveTimeUTC:V));this._departAtTime._keepDirections=!C;this._departAtDate._keepDirections=!C;this._departAtTime.setValue(H);this._departAtDate.setValue(H)}this._updateStartTimeUI()},_checkStartTimeUIAvailability:function(){var C=this._getImpedanceAttribute();C=this._isTimeUnits(C?C.units:"")||this.serviceDescription&&10.6<=this.serviceDescription.currentVersion;this._startTimeButtonNode.disabled=!C;B[C?"remove":"add"].apply(this,
[this._startTimeButtonNodeContainer,"esriLinkButtonDisabled"]);B[C?"remove":"add"].apply(this,[this._startTimeDDLArrow,"esriDirectionsDDLArrowDisabled"]);C||this.set("startTime","now")},_usingAGOL:function(C){C||(C=this.routeTaskUrl);return-1<C.search(/^(https?:)*\/\/*[^.]*\.arcgis\.com.*$/i)},_usingRouteAGOL:function(){return-1<this.get("routeTaskUrl").search(/^(https?:)*\/\/route*[^.]*\.arcgis\.com.*$/i)},_setSearchOptions:function(){var C={map:this.get("map"),autoNavigate:!1,enableInfoWindow:!1,
enableHighlight:!1,enableSourcesMenu:!1};this.searchOptions=v.mixin({maxResults:1,locationToAddressDistance:100},this.defaults.searchOptions,C)},_setDefaultUnits:function(){if(!this.get("directionsLengthUnits")){var C="EN-US"===b.locale.toUpperCase()?da.MILES:da.KILOMETERS;this.defaults.directionsLengthUnits?C=this.defaults.directionsLengthUnits:this.userOptions.routeParams&&this.userOptions.routeParams.directionsLengthUnits&&(C=this.userOptions.routeParams.directionsLengthUnits);this.set("directionsLengthUnits",
C)}this._setDirectionsLengthUnits(this.directionsLengthUnits)},_setTrafficOptions:function(){this._usingRouteAGOL()&&!this.trafficLayer&&(this.trafficLayer=new T(Ua+"//traffic.arcgis.com/arcgis/rest/services/World/Traffic/MapServer",{opacity:.4}));this.trafficLayer&&this.trafficLayer.url&&this._usingAGOL(this.trafficLayer.url)&&(this._trafficAvailabilityButton.style.display="inline-block");this.set("showTrafficOption",(this.defaults.showTrafficOption||!this.defaults.hasOwnProperty("showTrafficOption"))&&
!!this.trafficLayer);this._optionsMenu()},_updateCanModifyStops:function(C,H){this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!1);H||!this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!0);this._showAddDestination();this._showMapClickActiveButton();this._stopsTableCover.style.display=this.canModifyStops?"none":"inline"},_updateCanAddWaypoints:function(C,H){this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!1);H||this.canModifyStops||
!this.canModifyWaypoints||this.set("mapClickActive",!0);this._showMapClickActiveButton();this._handle._remove()},_updateStartTimeUI:function(){isNaN(this.startTime)?(this._startTimeButtonLabel.innerHTML="now"==this.startTime?this._i18n.widgets.directions.leaveNow:this._i18n.widgets.directions.noStartTime,B.remove(this._startTimeButtonNodeContainer,"departAtButton"),B.remove(this._departAtContainer,"departAtContainerVisible")):(B.add(this._startTimeButtonNodeContainer,"departAtButton"),B.add(this._departAtContainer,
"departAtContainerVisible"),this._startTimeButtonLabel.innerHTML=this._i18n.widgets.directions.departAt)},_setWidgetProperties:function(){this._disconnectEvents();this.set(this.defaults);this.routeLayer=v.clone(this.defaults.routeLayer);this._folderSelector&&(this._outputLayer.setValue(""),this._outputLayer.set("disabled",!0),this._folderSelector.set("disabled",!0));this.set("stops",[]);this._updateCanModifyStops()},_updateStops:function(C){var H=new S;C?this.get("loaded")?this._reset().then(v.hitch(this,
function(){this._addStops(C).then(H.resolve,H.reject)}),H.reject):this._addStops(C).then(H.resolve,H.reject):H.reject();return H.promise},_removeStop:function(C,H,M,V){var P=new S,ba=v.hitch(this,function(ha){this.stops.splice(ha,1);var fa=this._dnd.getAllNodes()[ha],ja=this.get("geocoders");this._geocoderEvents[fa.id]&&(this._geocoderEvents[fa.id].blur.remove(),this._geocoderEvents[fa.id].select.remove(),this._geocoderEvents[fa.id].suggest.remove(),this._geocoderEvents[fa.id].value.unwatch());ja[ha].destroy();
ja.splice(ha,1);this.set("geocoders",ja);L.destroy(fa);this._dnd.sync();this._stopsRemovable();this._optionsMenu();this._checkMaxStops();this.setListIcons();this._sortGeocoders()});if(0>C||C>=this.stops.length||void 0===C)C=this.stops.length-1;var ea=!1;for(V=this.stopGraphics[C]&&this._isStopAWaypoint(this.stops[C])||V;!ea;)ba(C),V?ea=!0:(C-=0>=C||C<this.stops.length&&this._isStopAWaypoint(this.stops[C])?0:1,ea=!this._isStopAWaypoint(this.stops[C]));for(;this.stops.length-this._getWaypointCount()<
this.minStops;)this._addStop();this._clearStopsStatusAttr();this._setStops();this.createRouteSymbols();M?(this._clearDisplayBeforeSolve(),this._clearDisplayAfterSolve(),this.createRouteSymbols(),P.resolve()):this._solveAndZoom(H).then(P.resolve,P.reject);return P.promise},_removeTrafficLayer:function(){this.trafficLayer&&this.map&&this.map.removeLayer(this.trafficLayer);this._trafficLayerAdded=!1},_addStops:function(C,H){var M=new S,V=[],P=this.autoSolve;this.autoSolve=!1;void 0===H&&(H=this._getStopCount());
for(var ba=0;ba<Math.min(C.length,this.maxStops-this._getStopCount());ba++){var ea=new S;this._addStop(C[ba],H+ba,!0).always(ea.resolve);V.push(ea)}O(V).always(v.hitch(this,function(){this.autoSolve=P;this._getDirections().always(function(){M.resolve(C)})}));return M.promise},_addStop:function(C,H,M){var V=new S;this._checkMaxStops();this.maxStopsReached?(this._showMessage(G.widgets.directions.error.maximumStops),V.reject(Error(G.widgets.directions.error.maximumStops))):(void 0===C&&void 0===H&&(H=
this.stops.length),C instanceof Q&&C.attributes&&C.attributes.isWaypoint&&(!H||H===this.stops.length||2>this._getStopCount())&&!M?(this._showMessage(G.widgets.directions.error.waypointShouldBeInBetweenStops),V.reject(Error(G.widgets.directions.error.waypointShouldBeInBetweenStops))):this._getCandidate(C).then(v.hitch(this,function(P){this._isStopAWaypoint(P)&&P&&P.feature&&(P.feature.attributes=v.mixin({},P.feature.attributes,{isWaypoint:!0,CurbApproach:3}));this._insertStop(P,H);this.autoSolve&&
""!==P.name?this._getDirections().always(function(){V.resolve(P,H)}):V.resolve(P,H)}),v.hitch(this,function(P){V.reject(P)})));return V.promise},_removeEmptyStops:function(){for(var C=0,H=this.stops.length-this._getWaypointCount()-this.minStops;C<this.stops.length&&0<H;)this.stops[C]&&this.stops[C].name?C++:(this._removeStop(C,!0,!0,!0),H--,this._moveInProgress&&this._handle._index>=C&&this._handle._isStopIcon&&this._handle._index--)},_setReverseGeocode:function(C,H,M){if(C.feature.geometry&&-1<M){var V=
{address:C.name};this.stopGraphics[M]&&(v.mixin(this.stopGraphics[M].attributes,V),this.stopGraphics[M].setGeometry(H));this.textGraphics[M]&&(v.mixin(this.textGraphics[M].attributes,V),this.textGraphics[M].setGeometry(H));this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);(V=this.geocoders[M])&&V.inputNode&&(V.value=C.name,V.inputNode.value=C.name);v.mixin(C.feature.attributes,this.stops[M].feature.attributes);this.stops[M]=C;this.stops[M].feature.setGeometry(H);
this._setStops();return this._enqueue(function(){return this._getDirections()})}},_insertStop:function(C,H){var M;if(void 0===H)for(M=0;M<this.geocoders.length;M++){if(!this.geocoders[M].get("value")){var V=this.geocoders[M];break}}else M=H,this.geocoders[M]&&!this.geocoders[M].get("value")&&(V=this.geocoders[M]);!V||void 0!==H&&H!==M||this._isStopAWaypoint(C)?(void 0===H&&(H=this.geocoders.length),this.stops.splice(H,0,C),this._createGeocoder(C,H)):(this.stops[M]=C,V.set("value",C.name),V._stopReference=
C);this._optionsMenu()},_createGeocoder:function(C,H){var M=this._dnd.getAllNodes(),V=!1,P=!1,ba=M.length;M[H]?(P=M[H],V=!0):V=P=!1;var ea=v.hitch(this,function(ma,na){var qa=na?this._css.stopDnDHandleClass:this._css.stopDnDHandleClassHidden,xa=na?this._css.stopDnDHandleClassHidden:this._css.stopDnDHandleClass;B.replace(ma.children[0],qa,xa);2<this.geocoders.length&&(qa=na?this._css.stopIconRemoveClass:this._css.stopIconRemoveClassHidden,xa=na?this._css.stopIconRemoveClassHidden:this._css.stopIconRemoveClass,
B.replace(ma.children[3].children[0],qa,xa))}),ha=L.create("tr",{className:this._css.stopClass,style:this._isStopAWaypoint(C)?"display:none;":"",onmouseover:function(){ea(this,!0)},onmouseout:function(){ea(this,!1)}});L.create("td",{className:this._css.stopDnDHandleClassHidden+" dojoDndHandle"},ha);M=L.create("td",{className:this._css.stopIconColumnClass},ha);L.create("div",{className:this._css.stopIconClass+" dojoDndHandle",innerHTML:this._getLetter(ba),"data-center-at":"true"},M);ba=L.create("td",
{className:this._css.esriStopGeocoderColumnClass},ha);ba=L.create("div",{},ba);M=L.create("td",{className:this._css.stopIconRemoveColumnClass},ha);L.create("div",{className:this._css.stopIconRemoveClassHidden,role:"button","data-remove":"true"},M);this._dnd.insertNodes(!1,[ha],V,P);V=v.mixin({},this.get("searchOptions"),{value:C.name,activeSourceIndex:this._globalGeocoder.activeSourceIndex});var fa=new db(V,ba),ja=v.hitch(this,function(ma,na){this._enqueue(function(){if(na!==ma&&fa._stopReference&&
fa._stopReference.name!==na){var qa=p.indexOf(this.stops,fa._stopReference);this.stops[qa]={name:na};this._handle._remove();this._removeSomeWaypoints(this._markWPsForRemovalAfterUserChangedStopSequence(qa));this._setStops();this._clearDisplayBeforeSolve();this._clearDisplayAfterSolve();this.createRouteSymbols()}})});fa._tr=ha;fa._stopReference=C;fa.startup();this.geocoders.splice(H,0,fa);this._geocoderEvents[ha.id]={blur:fa.on("blur",function(){""!==this.value&&this._stopReference&&!this._stopReference.feature&&
this.search()}),select:fa.on("select-result",v.hitch(this,function(ma){var na=!0;if(ma&&(ma.results||ma.result)){var qa=this._dnd.getAllNodes();qa=p.indexOf(qa,ha);var xa=fa.value,ta=ma.results&&ma.results.results&&ma.results.results.length?ma.results.results[0]:ma.result;ta?(ta.name=xa,this.stops[qa]=this._toPointGeometry(ta),this.geocoders[qa]._stopReference=this.stops[qa],ja("",xa)):(this.removeStop(qa),this.set("directions",null),this._showMessage(G.widgets.directions.error.unknownStop.replace("\x3cname\x3e",
ma.target.get("value"))),this._clearRouteGraphics(),na=!1);na&&this.getDirections()}})),suggest:fa.on("suggest-results",function(){if(document.activeElement===this.inputNode)for(var ma=y("LI[role\x3d'menuitem']",this.suggestionsNode),na=0;na<ma.length;na++)A.set(ma[na],"tabindex",-1);else this._hideSuggestionsMenu()}),value:fa.watch("value",function(ma,na,qa){ja(na,qa)})};this._checkMaxStops();this.setListIcons();this._stopsRemovable();this._optionsMenu();this._sortGeocoders()},_blurGeocoders:function(){if(document.activeElement)for(var C=
0;C<this.geocoders.length;C++)if(this.geocoders[C].inputNode===document.activeElement){this.geocoders[C]._hideSuggestionsMenu();this.geocoders[C].inputNode.blur();1<this._getStopCount()+this._getWaypointCount()&&this.getDirections(!0);break}},_decorateEmptyAGOLGeocoderResponse:function(C){C&&", , "===C.name&&(C.name=C.feature&&C.feature.attributes&&C.feature.attributes.Match_addr?C.feature.attributes.Match_addr+("POI"===C.feature.attributes.Addr_type&&C.feature.attributes.City&&-1===C.feature.attributes.Match_addr.indexOf(C.feature.attributes.City)?
", "+C.feature.attributes.City:""):"");return C},_toPointGeometry:function(C){var H=C.feature.geometry;H&&(H.getCentroid?C.feature.geometry=H.getCentroid():H.getExtent&&(H=H.getExtent())&&(C.feature.geometry=H.getCenter()));return C},_removeLocateButtonVisibilityEvents:function(){for(var C=0;C<this.geocoders.length;C++){var H=this.geocoders[C];H._onMouseEnter&&H._onMouseEnter.remove();H._onMouseOut&&H._onMouseOut.remove();H._onKeyPress&&H._onKeyPress.remove();H._locateButton&&(H._locateButton._onMouseEnter&&
H._locateButton._onMouseEnter.remove(),H._locateButton._onMouseOut&&H._locateButton._onMouseOut.remove())}},_setLocateButtonVisibilityEvents:function(){this._removeLocateButtonVisibilityEvents();for(var C=this,H=function(fa){fa instanceof FocusEvent?this._geocoder._lbShown_f=!0:this._geocoder._lbShown_g=!0;C._createLocateButton(this._geocoder,!0)},M=function(fa){fa instanceof FocusEvent?this._geocoder._lbShown_f=!1:this._geocoder._lbShown_g=!1;clearTimeout(this._destroyTimeout);this._destroyTimeout=
setTimeout(v.hitch(this,function(){this._geocoder._lbShown_lb||this._geocoder._lbShown_f||C._destroyLocateButton(this._locateButton)}),400)},V=function(){this._geocoder._lbShown_g=!0;clearTimeout(this._destroyTimeout);this._destroyTimeout=setTimeout(v.hitch(this,function(){""===this.value?C._createLocateButton(this._geocoder,!0):C._destroyLocateButton(this._locateButton)}),400)},P=function(){this._geocoder._lbShown_lb=!0;clearTimeout(this._geocoder._destroyTimeout)},ba=function(){this._geocoder._lbShown_lb=
!1;clearTimeout(this._geocoder._destroyTimeout);this._geocoder._destroyTimeout=setTimeout(v.hitch(this,function(){this._geocoder._lbShown_g||this._geocoder._lbShown_f||C._destroyLocateButton(this._geocoder.inputNode._locateButton)}),400)},ea=0;ea<this.geocoders.length;ea++){var ha=this.geocoders[ea];ha&&ha.inputNode&&(ha.inputNode._geocoder=ha,ha._onMouseEnter=r(ha.inputNode,x.enter,H),ha._onMouseOut=r(ha.inputNode,[x.leave,"blur"],M),ha._onKeyPress=r(ha.inputNode,"keydown",V),ha.inputNode._locateButton&&
(ha=ha.inputNode._locateButton,ha._onMouseEnter=r(ha.domNode,x.enter,P),ha._onMouseOut=r(ha.domNode,x.leave,ba)))}},_createLocateButton:function(C,H,M){var V=new S;C.inputNode._locateButton&&C.inputNode._locateButton._locating?V.resolve():m(["./LocateButton"],v.hitch(this,function(P){this._destroyLocateButton(C.inputNode._locateButton);if(C&&!this._solveInProgress){var ba=L.create("div",{},C.domNode);B.add(C.domNode,this._css.stopsInnerGeocoderClass);var ea=new P({map:this.map,highlightLocation:!1,
centerAt:!1,setScale:!1,useTracking:!1},ba);ea.startup();C.inputNode._locateButton=ea;ea.domNode._geocoder=C;this._setLocateButtonVisibilityEvents();P=v.hitch(this,function(){ea._locating=!0;C.set("value","");C.inputNode.placeholder=G.widgets.directions.retrievingMyLocation.toUpperCase()});ea._onBeforeLocate=r(ea._locateNode,d,P);ea._onLocate=r(ea,"locate",v.hitch(this,function(ha){ea._locating=!1;ha.graphic?(H&&this._destroyLocateButton(C.inputNode._locateButton),this.updateStop(new Q(ha.graphic.geometry),
p.indexOf(this.geocoders,C)).then(v.hitch(this,function(){1<this.stopGraphics.length?this.getDirections().always(function(){V.resolve(ha)}):V.resolve(ha)}))):(C.set("value",""),C.inputNode.placeholder=G.widgets.directions.myLocationError.toUpperCase(),V.reject(ha.error))}));M?(P(),ea.locate().then(null,V.reject)):V.resolve()}else V.resolve()}));return V.promise},_destroyLocateButton:function(C){if(C){var H=C.domNode._geocoder;clearTimeout(H._destroyTimeout);C._locating?H._destroyTimeout=setTimeout(v.hitch(this,
function(){H._lbShown_lb||H._lbShown_f||this._destroyLocateButton(C)}),100):(C.clear(),C._onBeforeLocate.remove(),C._onLocate.remove(),C._onMouseEnter&&C._onMouseEnter.remove(),C._onMouseOut&&C._onMouseOut.remove(),C.destroy(),H.inputNode&&(H.inputNode._locateButton=null,H._setPlaceholder(H.activeSourceIndex)))}},_sortStops:function(){this.stops.length&&(this.stops.sort(v.hitch(this,function(C,H){for(var M,V,P=0;P<this.get("geocoders").length;P++)this.geocoders[P]._stopReference===C?M=P:this.geocoders[P]._stopReference===
H&&(V=P);return M>V?1:V>M?-1:0})),this._setStops())},_getCandidate:function(C){var H=new S,M=typeof C;C?"object"===M&&C.hasOwnProperty("feature")&&C.hasOwnProperty("name")?(C.feature.attributes&&void 0!==C.feature.attributes.displayName&&!this._isStopAWaypoint(C)&&(C.name=C.feature.attributes.displayName,C.feature.attributes.Name=this._userDefinedStopName),C.name=this._isStopAWaypoint(C)?this._waypointName:String(C.name),"point"!==C.feature.geometry.type&&(C.feature.geometry=new ia([C.feature.geometry.x,
C.feature.geometry.y],this.map.spatialReference)),H.resolve(C)):"object"===M&&C.hasOwnProperty("address")&&C.hasOwnProperty("location")?(C=this._globalGeocoder._hydrateResult(C),H.resolve(C)):"object"!==M||!C.hasOwnProperty("name")||null!==C.name&&""!==C.name?C instanceof Q&&C.attributes&&(void 0!==C.attributes.Name||C.attributes.isWaypoint)?(M=this._addStopWrapperToGraphic(C,C.attributes.isWaypoint?this._waypointName:String(C.attributes.Name)),String(C.attributes.Name)&&(M.feature.attributes.Name=
this._userDefinedStopName),H.resolve(M)):("object"===M&&C.hasOwnProperty("name")&&(C=String(C.name)),this._reverseGeocode(C).then(H.resolve,H.reject)):H.resolve(v.clone(this._emptyStop)):H.resolve(v.clone(this._emptyStop));return H.promise},_reverseGeocode:function(C){var H=new S,M,V=C.geometry?C.geometry:C;if(this._globalGeocoder){var P=v.hitch(this,function(fa){var ja=new S,ma=500;if(this.map){var na=this.map.toScreen(V);na.x+=X._calculateClickTolerance([fa]);this.map.spatialReference.isWebMercator()?
(ma=Math.abs(this.map.toMap(na).x-V.x),ja.resolve(ma)):4326===this.map.spatialReference.wkid?(ma=Math.abs(W.geographicToWebMercator(this.map.toMap(na)).x-W.geographicToWebMercator(V).x),ja.resolve(ma)):this._geometryService&&(fa=new Wa,fa.distanceUnit=Ta.UNIT_METER,fa.geometry1=V,fa.geometry2=this.map.toMap(na),this._geometryService.distance(fa,function(qa){ma=qa;ja.resolve(ma)},function(){ja.resolve(ma)}))}return ja.promise}),ba=[],ea=this._globalGeocoder.sources,ha=function(){ea[M].featureLayer&&
ba.push(P(ea[M].featureLayer).then(v.hitch(ea[M],function(fa){this.searchQueryParams=v.mixin(this.searchQueryParams,{distance:fa})})))};if("all"===this._globalGeocoder.activeSourceIndex)for(M=0;M<ea.length;M++)ha();else M=this._globalGeocoder.activeSourceIndex,ha();O(ba).always(v.hitch(this,function(){this._globalGeocoder.search(V).then(v.hitch(this,function(fa){var ja=!1;if(fa){var ma=null;for(M=0;M<this._globalGeocoder.sources.length;M++)if(fa[M]&&fa[M].length){var na=fa[M];break}if(na.length&&
(ja=!0,ma=na[0],this._globalGeocoder.sources[M].featureLayer))for(fa=Number.POSITIVE_INFINITY,M=0;M<na.length;M++){na[M]=this._toPointGeometry(na[M]);var qa=R.geodesicLengths([new ca({paths:[[W.xyToLngLat(V.x,V.y),W.xyToLngLat(na[M].feature.geometry.x,na[M].feature.geometry.y)]],spatialReference:{wkid:this.map.spatialReference.wkid}})],"esriMeters")[0];fa>qa&&(fa=qa,ma=na[M])}(ma=this._decorateEmptyAGOLGeocoderResponse(ma))&&""!==ma.name&&null!==ma.name&&void 0!==ma.name?(ma.name=String(ma.name),
isNaN(V.x)||isNaN(V.y)||this.map.spatialReference.wkid!==V.spatialReference.wkid?!ma.feature.geometry||isNaN(ma.feature.geometry.x)||isNaN(ma.feature.geometry.y)?(this._showMessage(G.widgets.directions.error.locator),H.reject(Error(G.widgets.directions.error.locator))):H.resolve(ma):(ma.feature.geometry=V,H.resolve(ma))):ja=!1}ja||(C instanceof ia?C=new Q(C):C instanceof Array&&(C=new Q(new ia(C[0],C[1]))),C instanceof Q?this._decorateUngeocodedStop(C).then(H.resolve,H.reject):(this._showMessage(G.widgets.directions.error.unknownStop.replace("\x3cname\x3e",
C.toString())),H.reject(Error(G.widgets.directions.error.unknownStop.replace("\x3cname\x3e",C.toString())))))}))}))}else this._showMessage(G.widgets.directions.error.locatorUndefined),H.reject(Error(G.widgets.directions.error.locatorUndefined));return H.promise},_updateStop:function(C,H,M){var V=new S;this.stops&&this.stops[H]?C instanceof Q&&C.attributes&&C.attributes.isWaypoint&&(!H||H===this.stops.length-1||2>this._getStopCount())?(this._showMessage(G.widgets.directions.error.waypointShouldBeInBetweenStops),
V.reject(Error(G.widgets.directions.error.waypointShouldBeInBetweenStops))):this._getCandidate(C).then(v.hitch(this,function(P){var ba=P.feature;ba=ba?ba.geometry:null;var ea=this.stops[H].feature;ea=ea?ea.geometry:null;ba=ba&&ea&&(ba.x!==ea.x||ba.y!==ea.y)||!ba&&ea;this.stops[H]=P;this.geocoders[H]||this._createGeocoder(P,H);ea=this.geocoders[H];ea._stopReference=P;ea._tr.style.display=this._isStopAWaypoint(P)?"none":"";ea.value=P.name;ea.inputNode&&(ea.inputNode.value=P.name);ba&&this.autoSolve&&
1<this._getStopCount()+this._getWaypointCount()||M?this._getDirections().then(V.resolve,V.reject):(this._setStops(),V.resolve(P))}),v.hitch(this,function(P){V.reject(P)})):(this._showMessage(G.widgets.directions.error.couldNotUpdateStop),V.reject(Error(G.widgets.directions.error.couldNotUpdateStop)));this._optionsMenu();return V.promise},_renderDirections:function(){var C=this.get("directions");if(this._resultsNode){var H='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';H+=this._renderDirectionsSummary(C);
H+='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';H+='\x3cdiv class\x3d"'+this._css.routesClass+'"\x3e';H+=this._renderDirectionsTable(C);H+="\x3cdiv class\x3d'esriPrintFooter'\x3e"+G.widgets.directions.printDisclaimer+"\x3c/div\x3e";H+="\x3c/div\x3e";this._resultsNode&&(this._resultsNode.innerHTML=H);this._disconnectResults();(C=y("[data-segment]",this._resultsNode))&&C.length&&p.forEach(C,v.hitch(this,function(M){this._resultEvents.push(r(M,x.enter,v.hitch(this,function(){if(!this._focusedDirectionsItem){var V=
parseInt(A.get(M,"data-segment"),10);this.highlightSegment(V)}})));this._resultEvents.push(r(M,"focusout",v.hitch(this,function(){this._focusedDirectionsItem=null;this.unhighlightSegment(!0)})));this._resultEvents.push(r(M,x.leave,this.unhighlightSegment));this._resultEvents.push(r(M,"click, keydown",v.hitch(this,function(V){V&&("click"===V.type||"keydown"===V.type&&V.keyCode===q.ENTER)&&(this._focusedDirectionsItem!==M?this.selectSegment(parseInt(A.get(M,"data-segment"),10)):(M.blur(),this.map.infoWindow.hide(),
this._focusedDirectionsItem=null,this.unhighlightSegment(!0)))})))}))}},_renderDirectionsSummary:function(C){var H="",M=v.hitch(this,function(){for(var ea={},ha=this._getDirectionsTimeAttribute()||{},fa=this._getTimeNeutralAttribute()||{},ja=0,ma=0,na=this.get("stops"),qa=na.length-1;0<=qa;qa--)if(null!==na[qa].feature.attributes.ArriveCurbApproach){ea=na[qa].feature.attributes;break}for(var xa in ea)ea.hasOwnProperty(xa)&&(xa==="Cumul_"+ha.name&&(ja=ea[xa]),xa==="Cumul_"+fa.name&&(ma=ea[xa]));ea=
"esriTrafficLabelHidden";na=G.widgets.directions.noTraffic;qa=C.totalTime-C.totalDriveTime;qa=(ma-this._convertCostValue(qa,ha.units,fa.units))/(ja-qa||1);0<qa&&.8>qa?(ea="esriTrafficLabelHeavy",na=G.widgets.directions.heavyTraffic):1===qa?(ea="esriTrafficLabelNone",na=G.widgets.directions.noTraffic):1.25<qa&&(ea="esriTrafficLabelLight",na=G.widgets.directions.ligthTraffic);fa=this._formatTime(ma,!1,fa.units);return{label:na,labelClass:ea,ratio:qa,noTrafficCostStr:1!==qa&&fa?fa+" "+G.widgets.directions.onAverage+
"\x3cbr\x3e":"",trafficCost:ja,noTrafficCost:ma,timeAtt:ha}});if(C.totalLength||C.totalTime){M=M();var V=this._getImpedanceAttribute();H+="\x3cdiv class\x3d'"+this._css.resultsSummaryClass+"' data-full-route\x3d'true'\x3e\x3cdiv class\x3d'esriImpedanceCost'\x3e";if(this._isTimeUnits(V.units))H+=this._formatTime(M.trafficCost,!0,M.timeAtt.units)+"\x3cdiv class\x3d'esriImpedanceCostHrMin'\x3e\x3cdiv class\x3d'esriImpedanceCostHr'\x3e"+G.widgets.directions.time.hr+"\x3c/div\x3e\x3cdiv class\x3d'esriImpedanceCostMin'\x3e"+
G.widgets.directions.time.min+"\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'esriOtherCosts'\x3e"+(M.noTrafficCost?"\x3cdiv class\x3d'esriTrafficLabel "+M.labelClass+"'\x3e"+M.label+"\x3c/div\x3e"+M.noTrafficCostStr:"")+this._formatDistance(C.totalLength);else{V=(V=G.widgets.directions.units[this.directionsLengthUnits])?V.name:"";var P=this.serviceDescription&&10.6<=this.serviceDescription.currentVersion,ba=this.directions.features[0].attributes;H+=E.format(C.totalLength,{places:1})+"\x3cdiv class\x3d'esriImpedanceCostDist'\x3e"+
V+"\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'esriOtherCosts'\x3e"+(M.noTrafficCost&&P?"\x3cdiv class\x3d'esriTrafficLabel "+M.labelClass+"'\x3e"+M.label+"\x3c/div\x3e"+M.noTrafficCostStr:"")+this._formatTime(C.totalTime)+" "+("none"!==this.startTime&&M.noTrafficCost&&P?G.widgets.directions.atTheMoment+" "+this._toSpatiallyLocalTimeString(ba.arriveTimeUTC,ba.ETA):"")}H+="\x3c/div\x3e\x3c/div\x3e"}return H},_renderDirectionsTable:function(C){for(var H=0,M=0,V=0,P='\x3ctable summary\x3d"'+C.routeName+
'"\x3e\x3ctbody role\x3d"menu"\x3e',ba=0;ba<C.features.length;ba++){var ea=C.features[ba].attributes;"esriDMTDepart"===ea.maneuverType&&(M=V=0);V+=ea.length;M+=ea.time;H+=ea.time;P+=this._renderDirectionsItemTR(C.features[ba],V,M,H)}return P+"\x3c/tbody\x3e\x3c/table\x3e"},_renderDirectionsItemTR:function(C,H,M,V){var P=this.directions,ba=P?p.indexOf(P.features,C):-1;V="";var ea=this._css.routeClass,ha=C._associatedStopWithReturnToStart&&C._associatedStopWithReturnToStart.attributes,fa=C.attributes;
if(-1<ba){fa&&(fa.step=ba+1);fa.maneuverType&&(ea+=" "+fa.maneuverType);ha&&null===ha.ArriveCurbApproach&&null!==ha.DepartCurbApproach?ea+=" "+this._css.routeOriginClass:ha&&null!==ha.ArriveCurbApproach&&null===ha.DepartCurbApproach&&(ea+=" "+this._css.routeDestinationClass+" "+this._css.routeLastClass);V+='\x3ctr tabindex\x3d"0" role\x3d"menuitem" class\x3d"'+ea+" "+this._css.routeZoomClass+'" data-segment\x3d"'+ba+'"\x3e';V+='\x3ctd class\x3d"'+this._css.routeIconColumnClass+'"\x3e';V+='\x3cdiv class\x3d"'+
this._css.routeIconClass+'"\x3e';V+=this._getLetter(C._associatedStop);V=V+'\x3c/div\x3e\x3c/td\x3e\x3ctd class\x3d"'+(this._css.routeTextColumnClass+'"\x3e');V+='\x3cdiv class\x3d"'+this._css.routeInfoClass+'"\x3e';V+='\x3cdiv class\x3d"'+this._css.routeTextClass+'"\x3e';C=(P.strings[ba]||[]).slice();if("esriDMTDepart"===fa.maneuverType||"esriDMTStop"===fa.maneuverType)for(P=0;P<this.stops.length;P++)this.stops[P]&&this.stops[P].name&&C.push({string:this.stops[P].name});if(C){ea=fa.text;for(P=0;P<
C.length;P++)ea=this._boldText(ea,C[P].string);fa.formattedText=ea}else fa.formattedText=fa.text;if("esriDMTStop"===fa.maneuverType&&(H||M)||"esriDMTDepart"===fa.maneuverType&&0===ba)H=this._formatDistance(H-fa.length,!0),M=this._formatTime(M-fa.time),ba=this._formatTime(fa.time),C=this._formatDistance(fa.length,!0),fa.formattedText+="\x3cdiv class\x3d'esriRouteTextColumnCumulative'\x3e"+H+(H&&M?" \x26middot; ":"")+M+(H||M?"\x3cbr\x3e":"")+(ba?G.widgets.directions.serviceTime+":\x26nbsp;"+ba:"")+
(ba&&C?"\x3cbr\x3e":"")+(C?G.widgets.directions.serviceDistance+":\x26nbsp;"+C:"")+"\x3c/div\x3e";V+="\x3cstrong\x3e"+E.format(fa.step)+".\x3c/strong\x3e "+fa.formattedText;V+="\x3c/div\x3e";H=this._formatDistance(fa.length,!0);M=this._formatTime(fa.time);"esriDMTStop"!==fa.maneuverType&&"esriDMTDepart"!==fa.maneuverType||!this.routeParams.startTime||-22091616E5===fa.ETA?H&&(V+='\x3cdiv class\x3d"'+this._css.routeLengthClass+'"\x3e',V+=H,M&&(V+="\x26nbsp;\x26middot;\x3cwbr\x3e\x26nbsp;"+M),V+="\x3c/div\x3e"):
V+='\x3cdiv class\x3d"'+this._css.routeLengthClass+'"\x3e'+this._toSpatiallyLocalTimeString(fa.arriveTimeUTC,fa.ETA)+"\x3c/div\x3e";V+="\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e"}return V},_toSpatiallyLocalTimeString:function(C,H){var M=new Date(H),V=new Date(M.getTime()+6E4*M.getTimezoneOffset());V=b.date.locale.format(V,{selector:"time"});var P="";C?(P=(H-C)/1E3/60/60,M=Math.floor(P),P=60*(P-M),M=G.widgets.directions.GMT+(0>M?"":"+")+E.format(M,{pattern:"00"})+E.format(P,{pattern:"00"}),P=V+" "+M):P="now"===
this.startTime?b.date.locale.format(M,{selector:"time"}):V;return P},_addStopWrapperToGraphic:function(C,H){return{extent:new ka({xmin:C.geometry.x-.25,ymin:C.geometry.y-.25,xmax:C.geometry.x+.25,ymax:C.geometry.y+.25,spatialReference:C.geometry.spatialReference}),feature:C,name:H}},_clearBarriersGraphics:function(){this._barriersLayer.clear();this._polylineBarriersLayer.clear();this._polygonBarriersLayer.clear()},_showBarriers:function(){this._clearBarriersGraphics();var C=this.routeParams,H=C.polylineBarriers&&
C.polylineBarriers.features||[],M=C.polygonBarriers&&C.polygonBarriers.features||[];p.forEach(C.barriers&&C.barriers.features||[],v.hitch(this,function(V){this._barriersLayer.add(V)}));p.forEach(H,v.hitch(this,function(V){this._polylineBarriersLayer.add(V)}));p.forEach(M,v.hitch(this,function(V){this._polygonBarriersLayer.add(V)}));this._barriersLayer.refresh();this._polylineBarriersLayer.refresh();this._polygonBarriersLayer.refresh()},_showRoute:function(C){this._clearDisplayAfterSolve();var H=C.routeResults[0].directions,
M=new S;if(H){this.set("solveResult",C);this.set("directions",H);var V=C.routeResults[0].stops,P,ba;if(V&&V.length){var ea=[];for(P=0;P<V.length;P++){var ha=V[P];ha.attributes.isWaypoint=ha.attributes.Name===this._waypointName||ha.attributes.isWaypoint;ha=this._addStopWrapperToGraphic(ha,ha.attributes.Name);this.stops[P]&&this.stops[P].feature&&this.stops[P].feature.attributes&&this.stops[P].feature.attributes.Name===this._userDefinedStopName&&(ha.feature.attributes.Name=this._userDefinedStopName);
this._returnToStartStop&&this._returnToStartStop._resultsStopIndex===P?this._returnToStartStop=ha:ea.push(ha)}if(this.stops.length>ea.length)for(P=0;P<this.stops.length;P++)this.stops[P].feature||""!==this.stops[P].name||ea.splice(P,0,this._emptyStop);this.stops=ea;for(P=0;P<this.stops.length;P++)this._updateStop(this.stops[P],P);this._setStops();this._setMenuNodeValues()}this.set("mergedRouteGraphic",new Q(H.mergedGeometry,this.get("routeSymbol")));V=[];ea=[];for(P=ha=0;P<H.featuresWithWaypoints.length;P++){var fa=
H.featuresWithWaypoints[P];if("esriDMTDepart"===fa.attributes.maneuverType)for(ba=0;ba<this.stops.length;ba++)if(this.stops[ba].feature===fa._associatedStop){ha=ba+1;break}fa.setSymbol(this.get("routeSymbol"));this._routeLayer.add(fa);V.push(fa);(ba=fa.getDojoShape())&&ba.moveToBack();ba=new Q(fa.geometry,this._symbolEventPaddingDirections,fa.attributes);ba._nextStopIndex=ha-.5;ba._isSnapFeature=!0;fa._associatedSnapFeature=ba;this._waypointsEventLayer.add(ba);"esriDMTDepart"!==fa.attributes.maneuverType&&
(ba=fa.geometry.getPoint(0,0))&&(ba=new Q(ba,this.maneuverSymbol),ba._directionsFeature=fa._associatedFeatureNoWaypoints,ea.push(ba),this._waypointsEventLayer.add(ea[ea.length-1]))}this.set("displayedRouteGraphics",V);this.set("displayedManeuverPointGraphics",ea);this._renderDirections();for(P=0;P<this.stops.length;P++)if(this._isStopAWaypoint(this.stops[P])&&this._modifiedWaypointIndex===P){for(ba=0;ba<H.featuresWithWaypoints.length;ba++)if(V=H.featuresWithWaypoints[ba],V._associatedStop===this.stops[P].feature){if("esriDMTStop"===
V.attributes.maneuverType||"esriDMTDepart"===V.attributes.maneuverType)this.stops[P].feature.geometry.x=V.geometry.paths[0][0][0],this.stops[P].feature.geometry.y=V.geometry.paths[0][0][1];break}this._modifiedWaypointIndex=null;break}z.set(this._savePrintBtnContainer,"display","inline-block");this.onDirectionsFinish(C)}else C=C.routeResults[0].route,C.setSymbol(this.routeSymbol),this._routeLayer.add(C),this._incrementalRouteSegment=C;M.resolve();this._moveLayersToFront();this.createRouteSymbols();
return M.promise},_setGeocodersStopReference:function(){if(this.geocoders)for(var C=0;C<this.geocoders.length;C++)this.geocoders[C]&&this.stops[C]&&(this.geocoders[C]._stopReference=this.stops[C])},_setStops:function(){this._setGeocodersStopReference();this.createRouteSymbols();this._set("stops",this.stops);this.onStopsUpdate(this.stops)},_getCandidates:function(C){var H=[];if(C&&C.length){for(var M=0;M<C.length;M++)H.push(this._getCandidate(C[M]));return O(H)}C=new S;C.resolve([]);return C.promise},
_clearResultsHTML:function(){this._resultsNode.innerHTML="";z.set(this._savePrintBtnContainer,"display","none")},_showSegmentPopup:function(C){if(C&&this.get("showSegmentPopup")&&this.get("map").infoWindow){var H=C.geometry.getPoint(0,0);C=new Q(H,null,C.attributes,this.get("segmentInfoTemplate"));var M=this.get("map").infoWindow;M.setFeatures([C]);M.show(H)}},_addStopButton:function(){this.addStop().then(v.hitch(this,function(){this.get("focusOnNewStop")&&this.geocoders[this.stops.length-1].focus()}))},
_sortGeocoders:function(){var C=this._dnd.getAllNodes();this.geocoders.sort(v.hitch(this,function(M,V){return M.domNode&&M.domNode.parentNode&&M.domNode.parentNode.parentNode&&V.domNode&&V.domNode.parentNode&&V.domNode.parentNode.parentNode?p.indexOf(C,M.domNode.parentNode.parentNode)>p.indexOf(C,V.domNode.parentNode.parentNode)?1:-1:0}));this.stops.length===this.geocoders.length&&this._sortStops();for(var H=0;H<this.geocoders.length;H++)this.geocoders[H]&&this.geocoders[H].inputNode&&(this.geocoders[H].inputNode.title=
G.widgets.directions.stopNoTitle+(H+1));this._setLocateButtonVisibilityEvents()},_disconnectResults:function(){if(this._resultEvents&&this._resultEvents.length)for(var C=0;C<this._resultEvents.length;C++)this._resultEvents[C]&&this._resultEvents[C].remove();this._resultEvents=[]},_formatArbitraryCostsForRouteTooltip:function(C){var H="",M;for(M in C)if(0===M.indexOf("Total_")&&C.hasOwnProperty(M)){var V=this._getCostAttribute(M.substr(6));V&&(H+=this._isTimeUnits(V.units)?this._formatTime(C[M],!1,
V.units):this._formatDistance(C[M],!0,V.units),H+=H?" \x26middot; ":"")}H&&(H=G.widgets.directions.toNearbyStops+": \x3cb\x3e"+H.substr(0,H.length-10)+"\x3c/b\x3e");return H},_formatTime:function(C,H,M){M||(M=(this._getDirectionsTimeAttribute()||{}).units);var V="";M=Math.round(this._convertCostValue(C,M,"esriNAUMinutes"));C=Math.floor(M/60);M=Math.floor(M%60);H?V=E.format(C,{pattern:100>C?"00":"000"})+":"+E.format(M,{pattern:"00"}):(C&&(V+=C+" "+G.widgets.directions.time.hr+" "),V+=C||M?M+" "+G.widgets.directions.time.min:
"");return V},_formatDistance:function(C,H,M){M||(M=this.directionsLengthUnits);var V=this.directionsLengthUnits,P=G.widgets.directions.units[V],ba=V.replace("esri","").toLowerCase();C=this._convertCostValue(C,M,V);P&&(ba=H?P.abbr:P.name);return C?E.format(C,{locale:"root",places:2})+" "+ba:""},_projectToGeographic:function(C){var H=new S;if(!C)return H.reject("Directions:: 'geometry' is not defined.",{geometry:C}),H.promise;if(4326==C.spatialReference.wkid)return H.resolve(C),H.promise;if(!this._geometryService)return H.reject("Directions:: Geometry service is not defined."),
H.promise;var M=new ab;M.outSR=new J(4326);M.geometries=[C];this._geometryService.project(M).then(function(V){H.resolve(V&&V[0])},H.reject);return H.promise},_createToolbars:function(){this.editToolbar||(this.editToolbar=new Xa(this.map));this.drawToolbar||(this.drawToolbar=new bb(this.map),G.toolbars.draw.freehand=G.widgets.directions.lineBarrierFreehand,this.drawToolbar.onDrawComplete=v.hitch(this,function(C){var H=new Q(C.geometry,null,{BarrierType:0});this._projectToGeographic(C.geographicGeometry||
C.geometry).then(v.hitch(this,function(M){1<R.geodesicLengths([M],da.METERS)[0]&&(this._polylineBarriersLayer.add(H),this.routeParams.polylineBarriers||(this.routeParams.polylineBarriers=new Va),this.routeParams.polylineBarriers.features.push(H),this._clearStopsStatusAttr(),this.getDirections(!0))}))}))},_destroyGlobalGeocoder:function(){this._globalGeocoder&&(this._globalGeocoder.destroy(),this._globalGeocoder=null)},_createGlobalGeocoder:function(){var C=new S;this._globalGeocoder=new db(this.get("searchOptions"));
r.once(this._globalGeocoder,"load",C.resolve,C.reject);this._globalGeocoder.startup();return C.promise},_init:function(){var C=new S;this.set("loaded",!1);this._enableButton(this._getDirectionsButtonNode,!1);z.set(this._saveAsButton,"display","none");this.clearMessages();if(this.get("map").loaded)this._configure().always(C.resolve);else r.once(this.get("map"),"load",v.hitch(this,function(){this._configure().always(C.resolve)}));return C.promise},_setDefaultStops:function(){var C=new S;this.defaults.stops&&
this.defaults.stops.length?this._updateStops(this.defaults.stops).then(v.hitch(this,function(){this._removeEmptyStops();C.resolve()}),C.reject):C.resolve();return C.promise},_configure:function(){var C=new S;this._handle&&this._handle._remove();this._createDnD();this._createDepartAtControls();this._setSearchOptions();this._createGlobalGeocoder().then(v.hitch(this,function(){this._createToolbars();this._usingAGOL()||(this.printTaskUrl=this.geometryTaskUrl=null);this._createGeometryTask();this._createPrintTask();
this._showActivateButton();this._showBarriersButton();this._createTravelModesDDL();this._createSearchSourceDDL();var H=[this._createRouteTask(),this._setDefaultStops()];O(H).then(v.hitch(this,function(){this._setDefaultUnits();this._setTrafficOptions();this._setMenuNodeValues();this._setupEvents();var M=this.directionsLanguage||this.userOptions.routeParams&&this.userOptions.routeParams.directionsLanguage||b.locale.toLowerCase();this._setDirectionsLanguageByLocale(M);this._setupTravelModes().then(v.hitch(this,
function(){this.set("loaded",!0);this.onLoad();C.resolve(!0)}),function(V){C.reject(V)})}),function(M){C.reject(M)})}),function(H){C.reject(H)});this._naRouteSharing=null;return C.promise},_setDirectionsLanguageByLocale:function(C){var H=this.serviceDescription.directionsSupportedLanguages,M=function(P){if(H)for(var ba=0;ba<H.length;ba++)if(H[ba].toLowerCase().substr(0,2)===P)return H[ba];return null},V=M(C);V||(C=C.substr(0,2),V=M(C));this.directionsLanguage=V;return this.routeParams.directionsLanguage=
V},_getStopSymbol:function(C,H){var M=C&&(C.feature&&C.feature.attributes||C.attributes),V=this.stopSymbol;M&&(V=this._isStopAWaypoint(C)?this.waypointSymbol:void 0===M.Status||0===M.Status||6===M.Status?null===M.ArriveCurbApproach&&null!==M.DepartCurbApproach?this.get(H?"fromSymbolDrag":"fromSymbol"):null!==M.ArriveCurbApproach&&null===M.DepartCurbApproach?this.get(H?"toSymbolDrag":"toSymbol"):this.get(H?"stopSymbolDrag":"stopSymbol"):this.get(H?"unreachedSymbolDrag":"unreachedSymbol"));return V},
_addTrafficLayer:function(){this.trafficLayer&&!this._trafficLayerAdded&&this.map&&(this.map.addLayer(this.trafficLayer),this.trafficLayer.show(),this._trafficLayerAdded=!0)},_toggleUnits:function(C){C.target===this._useMilesNode?this.setDirectionsLengthUnits(da.MILES):C.target===this._useKilometersNode&&this.setDirectionsLengthUnits(da.KILOMETERS)},_toggleCheckbox:function(C){var H=A.get(C.target,"checked");C.target===this._findOptimalOrderNode?this.set("optimalRoute",H):C.target===this._useTrafficNode?
this.set("traffic",H):C.target===this._returnToStartNode&&this.set("returnToStart",H)},_isStopLocated:function(C){return C&&C.feature&&C.feature.attributes&&(!C.feature.attributes.Status||6===C.feature.attributes.Status)},_configureRouteOptions:function(){var C=this.get("routeParams"),H;this.get("directionsLengthUnits")?C.directionsLengthUnits=this.get("directionsLengthUnits"):this.set("directionsLengthUnits",C.directionsLengthUnits);C.findBestSequence=this.get("optimalRoute");if(C.findBestSequence)for(C.preserveFirstStop=
this._isStopLocated(this.stops[0]),C.preserveLastStop=!this.returnToStart&&this._isStopLocated(this.stops[this.stops.length-1])||this.returnToStart&&this._isStopLocated(this.stops[0]),H=0;H<this.stops.length;)this._isStopAWaypoint(this.stops[H])?this._removeStop(H,!0,!0):H++;if(!this.returnToStart&&this.stops.length&&this._isStopAWaypoint(this.stops[this.stops.length-1]))for(H=this.stops.length-1;0<H;)this._isStopAWaypoint(this.stops[H])&&this._removeStop(H,!0,!0),H--;if(this._isTimeUnits(this._getImpedanceAttribute().units)||
this.serviceDescription&&10.6<=this.serviceDescription.currentVersion)if(C.useTimeWindows=!0,"now"===this.startTime)C.timeWindowsAreUTC=!0,C.startTimeIsUTC=!0,C.startTime=new Date;else if("none"===this.startTime)C.startTime=null;else{C.timeWindowsAreUTC=!1;C.startTimeIsUTC=!1;var M=this._departAtTime,V=6E4*M.getValue().getTimezoneOffset();M=new Date(M.getValue().getTime()+this._departAtDate.getValue().getTime()-V);M=new Date(M.getTime()-6E4*M.getTimezoneOffset());C.startTime=M}else C.startTime=null,
C.useTimeWindows=!1;M=this._getImpedanceAttribute();V=this._getTimeNeutralAttribute();var P=this._getDirectionsTimeAttribute();H=this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames;V&&-1===p.indexOf(H,V.name)&&H.push(V.name);!this._isTimeUnits(M.units)&&this.serviceDescription&&10.6<=this.serviceDescription.currentVersion&&P&&-1===p.indexOf(H,P.name)&&H.push(P.name);this.routeParams.accumulateAttributes=H;C.returnStops=!0;P=[];for(H=0;H<this.stopGraphics.length;H++)if(this.stopGraphics[H]&&
(P.push(new Q(this.stopGraphics[H].toJson())),H)){var ba=P[0].attributes,ea=P[H].attributes;for(ha in ea)ea.hasOwnProperty(ha)&&!ba.hasOwnProperty(ha)&&(ba[ha]=null)}if(this.get("returnToStart")&&this.stopGraphics.length&&this._isStopLocated(this.stops[0])){var ha=new Q(this.stopGraphics[0].toJson());this._returnToStartStop=this._addStopWrapperToGraphic(ha,ha.attributes.Name);P.push(ha)}else this._returnToStartStop=null;C.stops.features=P;if(V)for(H=0;H<P.length;H++)P[H].attributes["Attr_"+V.name]=
this._convertCostValue(P[H].attributes["Attr_"+M.name],M.units,V.units);this.set("routeParams",C)},_configureRoute:function(){var C=new S;C.promise.always(v.hitch(this,function(){this._checkMaxStops()}));this.createRouteSymbols();this._configureRouteOptions();if(this.routeParams.returnRoutes&&this._incrementalSolveStopRange){var H=this._incrementalSolveStopRange;H.start<H.end?this.routeParams.stops.features=this.routeParams.stops.features.slice(H.start,H.end+1):H.start>H.end&&(this.routeParams.stops.features=
this.routeParams.stops.features.slice(H.start,this.routeParams.stops.features.length-1).concat(this.routeParams.stops.features.slice(0,H.end+1)))}else this._incrementalSolveStopRange=null;var M={},V=this.routeParams.stops.features;for(H=0;H<V.length;H++){var P=V[H].attributes.address;var ba=(H===this._handle._index&&!this._handle.attributes.isWaypoint&&this._incrementalSolveStopRange?this._waypointName:P)+"_"+this._stopSequence++;V[H].attributes.Name=ba;M[ba]=P;delete V[H].attributes.address;delete V[H].attributes.isWaypoint;
delete V[H].attributes.Status}this._solveInProgress=!0;var ea={_incrementalSolveStopRange:this._incrementalSolveStopRange};this.routeTask.solve(this.routeParams,v.hitch(this,function(ha){this._solveResultProcessing(ha,M,ea).then(C.resolve,C.reject)}),v.hitch(this,function(ha){v.mixin(this,ea);this._solveInProgress=!1;for(var fa=0;fa<this.stops.length;fa++)this.stops[fa].feature&&(this.stops[fa].feature.attributes=v.mixin(this.stops[fa].feature.attributes,{Status:5}));this.set("directions",null);this._clearDisplayAfterSolve();
this.createRouteSymbols();this._routeTaskError(ha);C.reject(ha)}));return C.promise},_solveResultProcessing:function(C,H,M){var V=new S;v.mixin(this,M);this._solveInProgress=!1;M=C.routeResults[0];var P=M.directions;M=M.stops;if(P){this._solverMessages=C.messages;var ba=function(ma){for(var na in H)if(ma&&0===P.routeName.indexOf(na)||!ma&&0<P.routeName.indexOf(na))return H[na];return""};var ea=ba(!0);ba=ba(!1);P.routeName=(ea!==this._waypointName?ea:G.widgets.directions.waypoint)+" \u2014 "+(ba!==
this._waypointName?ba:G.widgets.directions.waypoint);for(ea=0;ea<P.features.length;ea++)if(ba=P.features[ea].attributes,"esriDMTDepart"===ba.maneuverType||"esriDMTStop"===ba.maneuverType)for(var ha in H)if(H.hasOwnProperty(ha)&&-1<ba.text.indexOf(ha)){ba.text=ba.text.replace(ha,H[ha]);for(var fa=0;fa<M.length;fa++){var ja=M[fa].attributes;if(ja.Name===ha){v.mixin(P.features[ea],{_associatedStop:M[this.returnToStart&&fa===M.length-1?0:fa],_associatedStopWithReturnToStart:M[fa]});if(!ja.ArriveTime&&
!ja.ArriveTimeUTC&&ba.ETA&&ba.arriveTimeUTC){ja.ArriveTime=ba.ETA;ja.ArriveTimeUTC=ba.arriveTimeUTC;fa=0;if(0==ea&&"esriDMTDepart"===ba.maneuverType||0<ea&&"esriDMTStop"===ba.maneuverType)fa=this._convertCostValue(ba.time,(this._getDirectionsTimeAttribute()||{}).units,"milliseconds");ja.DepartTime=ja.ArriveTime+fa;ja.DepartTimeUTC=ja.ArriveTimeUTC+fa}break}}}for(ea=0;ea<M.length;ea++)this._returnToStartStop&&M[ea].attributes.Name===this._returnToStartStop.feature.attributes.Name&&(this._returnToStartStop._resultsStopIndex=
ea),M[ea].attributes.Name=H[M[ea].attributes.Name];this._directionsPostprocessing(P);this.traffic&&this._updateMapTimeExtent()}this._showRoute(C).always(v.hitch(this,function(){this._incrementalSolveStopRange=null;V.resolve(C)}));return V.promise},_directionsPostprocessing:function(C){var H,M=function(ba,ea){var ha=C.features[ba]._associatedFeaturesWithWaypoints||[];ha.push(C.featuresWithWaypoints[ea]);C.features[ba]._associatedFeaturesWithWaypoints=ha;C.featuresWithWaypoints[ea]._associatedFeatureNoWaypoints=
C.features[ba]};var V=v.hitch(this,function(ba){return"\x3cdiv class\x3d'"+this.theme+"'\x3e\x3ctable class\x3d'esriRoutesTooltip'\x3e"+this._renderDirectionsItemTR(ba._associatedFeatureNoWaypoints)+"\x3c/table\x3e\x3c/div\x3e"});C.featuresWithWaypoints=[];for(H=0;H<C.features.length;H++){var P=new Q(C.features[H].toJson());P.setInfoTemplate(new aa({title:this._i18n.widgets.directions.maneuver,content:V}));C.featuresWithWaypoints.push(P);C.featuresWithWaypoints[H]._associatedStop=C.features[H]._associatedStop;
C.featuresWithWaypoints[H]._associatedStopWithReturnToStart=C.features[H]._associatedStopWithReturnToStart}C.stringsWithWaypoints=v.mixin([],C.strings);C.eventsWithWaypoints=v.mixin([],C.events);for(V=H=0;H<C.features.length;)C.features[H]._associatedStop&&C.features[H]._associatedStop.attributes.Name===this._waypointName?(C.features.splice(H,H?2:1),C.strings.splice(H,H?2:1),C.events.splice(H,H?2:1),H&&C.features[H]&&"esriDMTStraight"===C.features[H].attributes.maneuverType?(P=C.features.splice(H,
1)[0],C.strings[H-1]=(C.strings[H-1]||[]).concat(C.strings.splice(H,1)[0]||[]),C.strings[H-1].length||(C.strings[H-1]=void 0),C.events[H-1]=(C.events[H-1]||[]).concat(C.events.splice(H,1)[0]||[]),C.events[H-1].length||(C.events[H-1]=void 0),C.features[H-1].attributes.length+=P.attributes.length,C.features[H-1].attributes.time+=P.attributes.time,C.features[H-1].geometry.paths[0]=C.features[H-1].geometry.paths[0].concat(P.geometry.paths[0]),M(H-1,V++),M(H-1,V++),M(H-1,V++)):(H&&M(H-1,V++),H<C.features.length&&
M(H,V++))):(M(H,V++),H++)},_boldText:function(C,H){var M=C;try{var V=new RegExp("[^\x3cstrong\x3e\x26nbsp;]"+H.replace(/(\||\$|\^|\(|\)|\[|\]|\{|\}|\/|\.|\+|\*|\?|\?)/g,"\\$1")+"[^\x26nbsp;\x3c/strong\x3e]","g");M=(" "+M+" ").replace(V,"\x3cstrong\x3e\x26nbsp;"+H+"\x26nbsp;\x3c/strong\x3e");M=M.trim()}catch(P){}return M},_clearStopGraphics:function(){if(this.stopGraphics&&this.stopGraphics.length)for(var C=0;C<this.stopGraphics.length;C++)this._stopLayer.remove(this.stopGraphics[C]),this._stopLayer.remove(this.textGraphics[C]);
this.set("stopGraphics",[]);this.set("textGraphics",[])},_updateMapTimeExtent:function(){if(this.map){var C=this.directions&&this.directions.features[0]&&this.directions.features[0].attributes||{},H=(new Date).getTime();H="none"==this.startTime?H:C.arriveTimeUTC||H;this._useTrafficItemNode.title="none"!==this.startTime&&C.arriveTimeUTC?G.widgets.directions.trafficLabelDepartAt+": "+this._toSpatiallyLocalTimeString(C.arriveTimeUTC,C.ETA):"";this._myTimeExtentUpdate=!0;C=new Date(H);this.map.setTimeExtent(new U(C,
C))}},_restoreMapTimeExtent:function(){this.map&&(this._myTimeExtentUpdate=!0,this.map.setTimeExtent(this._externalTimeExtent))},_clearRouteGraphics:function(){for(var C=this.displayedRouteGraphics,H=this.displayedManeuverPointGraphics,M=this._routeLayer,V=this._waypointsEventLayer,P=0,ba=0,ea=this._incrementalSolveStopRange?this._incrementalSolveStopRange:{start:0,end:this.stops?this.stops.length:-1};C&&ba<C.length;){if(C[ba]._associatedStop)for(var ha=0;ha<this.stops.length;ha++)if(this.stops[ha].feature===
C[ba]._associatedStop){P=ha;break}P>=ea.start&&P<ea.end||ea.start>=ea.end&&(P>=ea.start||P<ea.end)?(M.remove(C[ba]),C.splice(ba,1)):ba++}M.remove(this._incrementalRouteSegment);this.set("displayedRouteGraphics",C?C:[]);H&&H.length&&p.forEach(H,function(fa){V.remove(fa)});this.set("displayedManeuverPointGraphics",[]);this._waypointsEventLayer.clear();this.unhighlightSegment(!0)},_clearInfoWindow:function(){var C=this.get("map").infoWindow;C&&(C.hide(),C.clearFeatures())},_clearDisplayBeforeSolve:function(){this._toggleSaveMenu(!1);
this._clearInfoWindow();this._clearResultsHTML()},_clearDisplayAfterSolve:function(){this._clearStopGraphics();this._clearRouteGraphics();this._clearBarriersGraphics();this.clearMessages()},_getLetter:function(C){var H=this.alphabet,M="",V=function(ea){var ha="";"0123456789"===H||"1234567890"===H?ha=String(ea+1):(ea=ea||0,ea>=H.length&&(ha=V(Math.floor(ea/H.length)-1),ea%=H.length),ha+=H[ea]);return ha},P=C instanceof Q?v.hitch(this,function(){for(var ea=this.get("returnToStart")?0:-1,ha=0;ha<this.stops.length;ha++)if(this.stops[ha].feature===
C){ea=ha;break}return ea})():C;if(-1<P&&H&&H.length){H instanceof Array&&(H=H.toString().replace(/,/g,""));M=-1;for(var ba=0;ba<=P;ba++)M+=this._isStopAWaypoint(this.stops[ba])?0:1;M=V(M)}return M},_solveAndZoom:function(C){if(this.autoSolve)return this._getDirections().then(v.hitch(this,function(){C||this.zoomToFullRoute()}));var H=new S;H.resolve();return H.promise},_setupEvents:function(){this._onEvents.push(r(this.domNode,"[data-blur-on-click]:click",function(){this.blur()}));this._onEvents.push(r(this._dndNode,
"[data-reverse-stops]:click, [data-reverse-stops]:keydown",v.hitch(this,function(P){P&&("click"===P.type||"keydown"===P.type&&P.keyCode===q.ENTER)&&this.modifyStopSequence()})));this._onEvents.push(r(this._printButton,"click, keydown",v.hitch(this,function(P){P&&("click"===P.type||"keydown"===P.type&&P.keyCode===q.ENTER)&&this._printDirections()})));this._onEvents.push(r(this._resultsNode,"[data-full-route]:click, [data-full-route]:keydown",v.hitch(this,function(P){P&&("click"===P.type||"keydown"===
P.type&&P.keyCode===q.ENTER)&&this.zoomToFullRoute()})));this._onEvents.push(r(this._dndNode,"[data-remove]:click, [data-remove]:keydown",v.hitch(this,function(P){if(P&&("click"===P.type||"keydown"===P.type&&P.keyCode===q.ENTER)){var ba=y("[data-remove]",this._dndNode);P=p.indexOf(ba,P.target);this.removeStop(P)}})));this._onEvents.push(r(this._dndNode,"[data-center-at]:click, [data-center-at]:keydown",v.hitch(this,function(P){if(P&&("click"===P.type||"keydown"===P.type&&P.keyCode===q.ENTER)){var ba=
y("[data-center-at]",this._dndNode);P=p.indexOf(ba,P.target);this.stops[P]&&this.stops[P].feature&&this.stops[P].feature.geometry&&this.map.centerAndZoom(this.stops[P].feature.geometry)}})));this._onEvents.push(r(this.map,"zoom-end",v.hitch(this,function(){var P=this._segmentGraphics;P&&P[0]&&void 0!==P[0].attributes._index&&this.highlightSegment(P[0].attributes._index,!0)})));this._onEvents.push(r(this._dnd,"Drop",v.hitch(this,function(){this._dnd.sync();this.set("optimalRoute",!1);var P,ba=!1,ea=
[],ha=this._dnd.getAllNodes();for(P=0;P<this.geocoders.length;P++){var fa=p.indexOf(ha,this.geocoders[P]._tr);if(-1<fa&&P!==fa&&P!==fa-1){for(;0<fa&&this._isStopAWaypoint(this.stops[fa]);)fa--;ba=!0;break}}ba&&(ea=this._markWPsForRemovalAfterUserChangedStopSequence(P,fa));this._sortGeocoders();this.setListIcons();this._removeSomeWaypoints(ea);this.stops[fa].name&&this.getDirections()})));this._onEvents.push(r(this._dnd,"DndStart",v.hitch(this,function(){var P=y("body")[0];B.add(P,this._css.dndDragBodyClass);
this._removeLocateButtonVisibilityEvents()})));this._onEvents.push(r(this._dnd,"DndDrop, DndCancel",v.hitch(this,function(){var P=y("body")[0];B.remove(P,this._css.dndDragBodyClass);this._setLocateButtonVisibilityEvents()})));var C=this._handle,H=v.hitch(this,function(P){var ba=v.hitch(this,function(ha,fa,ja,ma,na){var qa=C._isShown();C.setGeometry(ha);C._tooltip.style.left=P.screenPoint.x+"px";C._tooltip.style.top=P.screenPoint.y+"px";!qa||C._index===ja&&C.attributes.isWaypoint===ma||(C._remove(),
qa=!1);C.setSymbol(fa);C._index=ja;C._isStopIcon=C._index===Math.floor(C._index);C.attributes.isWaypoint=ma;C._isStopIcon&&(C.attributes.address=this.stopGraphics[ja].attributes.address,C.setInfoTemplate(this.stopGraphics[ja].infoTemplate));if(this.canModifyWaypoints||C._isStopIcon)qa||(this._stopLayer.add(C),(ha=C.getDojoShape())&&ha[ma?"moveToBack":"moveToFront"].call(ha)),this.editToolbar.activate(Xa.MOVE,C);ma=ma?C._isStopIcon?G.widgets.directions.dragWaypoint:this.canModifyWaypoints?G.widgets.directions.dragRoute:
"":G.widgets.directions.dragStop;C._showTooltip(na||ma)});this.unhighlightSegment();if(this.mapClickActive&&this.dragging&&!this._solveInProgress&&!this._moveInProgress&&!C._solveTimeout)if(clearTimeout(C._removeTimeout),(P.graphic._isStopIcon||P.graphic._isStopLabel)&&!P.graphic.attributes.isWaypoint&&this.canModifyStops||P.graphic._isStopIcon&&P.graphic.attributes.isWaypoint&&this.canModifyWaypoints){var ea=P.graphic._isStopLabel?this.stopGraphics[P.graphic._index]:P.graphic;ba(ea.geometry,this._getStopSymbol(this.stops[ea._index],
!0),ea._index,!0===ea.attributes.isWaypoint);this._stopLayer.remove(this.stopGraphics[ea._index]);this._stopLayer.remove(this.textGraphics[ea._index])}else if(P.graphic._isSnapFeature||P.graphic._isHandle&&!P.graphic._isStopIcon)this._snappingManager||(this._snappingManager=this.map.snappingManager),this._snappingManager.getSnappingPoint(P.screenPoint).then(v.hitch(this,function(ha){if(!this.maxStopsReached&&!this._moveInProgress&&ha){for(var fa=this.displayedManeuverPointGraphics,ja=null,ma=0;ma<
fa.length;ma++)if(fa[ma].geometry.x===ha.x&&fa[ma].geometry.y===ha.y){ja=fa[ma]._directionsFeature;fa=p.indexOf(this.directions.features,ja);-1<fa&&this.highlightSegment(fa);break}ba(ha,P.graphic._isHandle?C.symbol:this.waypointSymbol,P.graphic._isHandle?C._index:P.graphic._nextStopIndex,P.graphic._isHandle?C.attributes.isWaypoint:!0,ja)}}))}),M=v.hitch(this,function(){clearTimeout(C._removeTimeout);C._removeTimeout=setTimeout(C._remove,100);this.unhighlightSegment()}),V=v.hitch(this,function(P){if(this.barrierToolActive){P=
P.graphic;var ba=this.routeParams,ea=ba.barriers?p.indexOf(ba.barriers.features,P):-1,ha=ba.polygonBarriers?p.indexOf(ba.polygonBarriers.features,P):-1,fa=ba.polylineBarriers?p.indexOf(ba.polylineBarriers.features,P):-1;-1<ea&&ba.barriers.features.splice(ea,1);-1<ha&&ba.polygonBarriers.features.splice(ha,1);-1<fa&&ba.polylineBarriers.features.splice(fa,1);this._barriersLayer.remove(P);this._polygonBarriersLayer.remove(P);this._polylineBarriersLayer.remove(P);this._clearStopsStatusAttr();this.getDirections(!0)}});
this._onEvents.push(this._waypointsEventLayer.on("mouse-move",H));this._onEvents.push(this._waypointsEventLayer.on("mouse-out",M));this._onEvents.push(this._stopLayer.on("mouse-move",H));this._onEvents.push(this._stopLayer.on("mouse-out",M));this._onEvents.push(this._barriersLayer.on("click",V));this._onEvents.push(this._polylineBarriersLayer.on("click",V));this._onEvents.push(this._polygonBarriersLayer.on("click",V));this._editToolbarEvents();this._watchEvents.push(this.watch("theme",this._updateThemeWatch));
this._watchEvents.push(this.watch("canModifyStops",this._updateCanModifyStops));this._watchEvents.push(this.watch("canModifyWaypoints",this._updateCanAddWaypoints));this._watchEvents.push(this.watch("showReturnToStartOption",this._optionsMenu));this._watchEvents.push(this.watch("showOptimalRouteOption",this._optionsMenu));this._watchEvents.push(this.watch("returnToStart",this._setMenuNodeValues));this._watchEvents.push(this.watch("optimalRoute",this._setMenuNodeValues));this._watchEvents.push(this.watch("startTime",
this._setStartTime));this._watchEvents.push(this.watch("traffic",this._setMenuNodeValues));this._watchEvents.push(this.watch("trafficLayer",this._trafficLayerUpdate));this._watchEvents.push(this.watch("routeTaskUrl",v.hitch(this,function(){this._createRouteTask();this._setTrafficOptions()})));this._watchEvents.push(this.watch("printTaskUrl",v.hitch(this,function(){this._createPrintTask()})));this._watchEvents.push(this.watch("geometryTaskUrl",v.hitch(this,function(){this._createGeometryTask()})));
this._watchEvents.push(this.watch("routeParams",v.hitch(this,function(){this._createRouteParams();this._setDefaultUnits()})));this._watchEvents.push(this.watch("searchOptions",v.hitch(this,function(){this._setSearchOptions();this._createGlobalGeocoder();var P=this.get("searchOptions").sources;if(P)for(var ba=0;ba<this.geocoders.length;ba++)this.geocoders[ba].set("sources",P)})));this._watchEvents.push(this.watch("showReverseStopsButton",this.setListIcons));this._watchEvents.push(this.watch("editToolbar",
this._editToolbarEvents));this._watchEvents.push(this.watch("showTravelModesOption",this._showTravelModesOption));this._watchEvents.push(this.watch("showMilesKilometersOption",this._showMilesKilometersOption));this._watchEvents.push(this.watch("showClearButton",this._showClearButton));this._watchEvents.push(this.watch("directionsLengthUnits",this.setDirectionsLengthUnits));this._watchEvents.push(this.watch("directionsLanguage",this.setDirectionsLanguage));this._watchEvents.push(this.watch("mapClickActive",
this._activate));this._watchEvents.push(this.watch("barrierToolActive",this._activateBarrierTool));this._watchEvents.push(this.watch("showActivateButton",this._showActivateButton));this._watchEvents.push(this.watch("showBarriersButton",this._showBarriersButton));this._watchEvents.push(this.watch("showPrintPage",function(){z.set(this._printButton,"display",this.showPrintPage?"inline-block":"none")}));this._watchEvents.push(this.watch("showSaveButton",function(){z.set(this._saveMenuButton,"display",
this.showSaveButton&&this.owningSystemUrl?"inline-block":"none")}))},_editToolbarEvents:function(){var C=v.hitch(this,function(M){var V="";if((M=M.routeResults?M.routeResults[0]:null)&&M.route){M=M.route.attributes;var P=this.routeParams.travelMode;if(P){V+="\x3cb\x3e"+P.name+"\x3c/b\x3e "+G.widgets.directions.toNearbyStops+": ";var ba=void 0!==M["Total_"+P.timeAttributeName]?this._formatTime(M["Total_"+P.timeAttributeName],!1,(this._getCostAttribute(P.timeAttributeName)||{}).units):"";V+=(void 0!==
M["Total_"+P.distanceAttributeName]?this._formatDistance(M["Total_"+P.distanceAttributeName],!0,(this._getCostAttribute(P.distanceAttributeName)||{}).units):"")+(ba?" \x26middot; "+ba:"")}else V=this._formatArbitraryCostsForRouteTooltip(M)}this._handle._showTooltip(V)}),H=v.hitch(this,function(M,V){var P=new S,ba=this._handle,ea=this.map.toScreen(ba._origPoint).offset(M.transform.dx+ba.symbol.xoffset,M.transform.dy+ba.symbol.yoffset);M.origMapPoint||(M.origMapPoint=this.map.toMap(ea));z.set(ba._tooltip,
"left",ea.x+"px");z.set(ba._tooltip,"top",ea.y+"px");clearTimeout(ba._solveTimeout);if(this._solveInProgress||!this._requestQueueTail.isFulfilled())ba._solveTimeout=setTimeout(function(){H(M,V).always(P.resolve)},100);else if(ba._isStopIcon){ea=M.graphic._index;var ha=this.stops[ea];(ha=ha?{name:ha.name,extent:ha.extent,feature:new Q(ha.feature.toJson())}:null)?(ha.feature.setGeometry(M.origMapPoint),this._modifiedWaypointIndex=this._isStopAWaypoint(this.stops[ea])?ea:null,this._incrementalSolveStopRange=
{start:this.returnToStart?(this.stops.length+ea-1)%this.stops.length:Math.max(0,ea-1),end:this.returnToStart?(ea+1)%this.stops.length:Math.min(this.stops.length-1,ea+1)},this.updateStop(ha,ea,V).always(v.hitch(this,function(fa){ba._solveTimeout=null;fa.routeResults&&C(fa);P.resolve()}))):P.resolve()}else P.resolve();return P.promise});this._onEvents.push(r(this.editToolbar,"graphic-click",v.hitch(this,function(M){if(M.graphic.attributes.isWaypoint)!M.graphic._isStopIcon||this._moveInProgress||this._solveInProgress||
(this._handle._remove(),this._moveInProgress=!0,this.removeStop(M.graphic._index,!0).always(v.hitch(this,function(){this._moveInProgress=!1})));else{var V=this.get("map").infoWindow;V&&(V.setFeatures([M.graphic]),V.show(M.graphic.geometry))}})));this._onEvents.push(r(this.editToolbar,"graphic-move-start",v.hitch(this,function(M){this._blurGeocoders();this._moveInProgress=!0;this._removeEmptyStops();this.routeParams.returnDirections=!1;this.routeParams.returnRoutes=!0;M=M.graphic;M._origPoint=new ia(M.geometry.toJson());
M._maxDeviation=0;M._solveHasHappened=!1;this.map.disableMapNavigation()})));this._onEvents.push(r(this.editToolbar,"graphic-move-stop",v.hitch(this,function(M){this.map.enableMapNavigation();this.routeParams.returnDirections=!0;this.routeParams.returnRoutes=!1;if(this._handle._isStopIcon)if(this._handle._solveHasHappened)if(this._handle.attributes.isWaypoint)H(M,!0).always(v.hitch(this,function(){this._moveInProgress=!1;this._handle._isStopIcon=!0;this._handle._remove();this._showLoadingSpinner()}));
else{clearTimeout(this._handle._solveTimeout);this._handle._solveTimeout=null;var V=this.stops[M.graphic._index],P=(V&&V.feature&&V.feature.attributes&&V.feature.attributes.Name)===this._userDefinedStopName,ba=V&&V.name;this._reverseGeocode(new Q(M.graphic.toJson())).then(v.hitch(this,function(ea){P&&(ea.name=ba,ea.feature.attributes.Name=this._userDefinedStopName);this._setReverseGeocode(ea,ea.feature.geometry,M.graphic._index).always(v.hitch(this,function(){this._moveInProgress=!1;this._handle._remove();
this._showLoadingSpinner()}))}))}else this._moveInProgress=!1;else this._moveInProgress=!1})));this._onEvents.push(r(this.editToolbar,"graphic-move",v.hitch(this,function(M){var V=this._handle,P=M.transform;P.dx&&P.dy&&(M.graphic._maxDeviation=Math.max(V._maxDeviation,Math.sqrt(P.dx*P.dx+P.dy*P.dy)));10<V._maxDeviation&&(V._solveHasHappened=!0,M.graphic===V&&V.attributes.isWaypoint&&!V._isStopIcon?(this.set("optimalRoute",!1),V._index+=.5,V._isStopIcon=!0,M.graphic._stopIndex=V._index,this._incrementalSolveStopRange=
{start:this.returnToStart?(this.stops.length+V._index-1)%this.stops.length:Math.max(0,V._index-1),end:this.returnToStart?(V._index+1)%(this.stops.length+1):Math.min(this.stops.length,V._index+1)},this.addStop({name:this._waypointName,feature:new Q(V.geometry,V.symbol,{isWaypoint:!0,CurbApproach:3})},M.graphic._stopIndex)):((V=M.graphic.getDojoShape())&&V.moveToFront(),H(M)))})))},_isStopAWaypoint:function(C){return C&&C.feature&&C.feature.attributes&&C.feature.attributes.isWaypoint},_getStopCount:function(){var C=
0,H;for(H=0;H<this.stops.length;H++)C+=!this._isStopAWaypoint(this.stops[H])&&this.stops[H].name?1:0;return C},_getWaypointCount:function(){var C=0,H;for(H=0;H<this.stops.length;H++)C+=this._isStopAWaypoint(this.stops[H])?1:0;return C},_decorateUngeocodedStop:function(C){var H=new S,M=function(P,ba){H.resolve({name:void 0===P?G.widgets.directions.unlocatedStop:P.toFixed(6)+" "+ba.toFixed(6),feature:C})};if(C.geometry)if(C.geometry.spatialReference&&4326!==C.geometry.spatialReference.wkid)if(this.map&&
this.map.spatialReference&&this.map.spatialReference.isWebMercator()){var V=W.xyToLngLat(C.geometry.x,C.geometry.y);M(V[0],V[1])}else this._geometryService?(V=new ab,V.outSR=new J(4326),V.geometries=[C.geometry],this._geometryService.project(V).then(v.hitch(this,function(P){P&&P.length?M(P[0].x,P[0].y):M(C.geometry.x,C.geometry.y)}),v.hitch(this,function(){M()}))):M(C.geometry.x,C.geometry.y);else M(C.geometry.x,C.geometry.y);else M();return H.promise},_trafficLayerUpdate:function(C,H,M){C=this.get("map");
H&&this._trafficLayerAdded&&(C.removeLayer(H),this._trafficLayerAdded=!1);M&&this.get("traffic")&&!this._trafficLayerAdded&&(C.addLayer(M),M.show(),this._trafficLayerAdded=!0)},_routeTaskError:function(C){var H=G.widgets.directions.error.routeTask,M=C.details,V=function(P){return(res=P.match(/(\d+)/))?": "+res[0]:"."};M&&1===M.length&&("The distance between any inputs must be less than 50 miles (80 kilometers) when walking."===M[0]?H=G.widgets.directions.error.maxWalkingDistance:"Driving a truck is currently not supported outside of North America and Central America."===
M[0]?H=G.widgets.directions.error.nonNAmTruckingMode:0===M[0].indexOf("The number of input locations loaded into Barriers")?H=G.widgets.directions.error.tooManyBarriers+V(M[0]):0===M[0].indexOf("The number of input locations loaded into PolygonBarriers")?H=G.widgets.directions.error.tooManyPolygonBarriers+V(M[0]):0===M[0].indexOf("The number of input locations loaded into PolylineBarriers")&&(H=G.widgets.directions.error.tooManyPolylineBarriers+V(M[0])));this._showMessage(H);this.onDirectionsFinish(C)},
_showMessage:function(C,H){var M="";this.messages.push({msg:C,error:!H});if(this.messages.length){M+="\x3cul\x3e";for(var V=0;V<this.messages.length;V++)M+='\x3cli class\x3d"'+(this.messages[V].error?this._css.routesErrorClass:this._css.routesInfoClass)+'"\x3e'+this.messages[V].msg+"\x3c/li\x3e";M+="\x3c/ul\x3e"}this._msgNode&&(this._msgNode.innerHTML=M);if(!H)this.onError(C)},_isTimeUnits:function(C){return"milliseconds"===C||"esriNAUSeconds"===C||"esriNAUMinutes"===C||"esriNAUHours"===C||"esriNAUDays"===
C},_getImpedanceAttribute:function(){return this._getCostAttribute(this.routeParams&&this.routeParams.travelMode&&this.routeParams.travelMode.impedanceAttributeName||this.routeParams.impedanceAttribute||this.serviceDescription.impedance)},_getDirectionsTimeAttribute:function(){return this._getCostAttribute(this.routeParams&&this.routeParams.travelMode&&this.routeParams.travelMode.timeAttributeName||this.routeParams.directionsTimeAttribute||this.serviceDescription.directionsTimeAttribute)},_getTimeNeutralAttribute:function(){var C=
(this._getDirectionsTimeAttribute()||{}).timeNeutralAttributeName;return this._getCostAttribute(C)},_getCostAttribute:function(C){for(var H=this.serviceDescription&&this.serviceDescription.networkDataset.networkAttributes||[],M,V=0;V<H.length;V++)if(H[V].name===C&&"esriNAUTCost"===H[V].usageType){M=H[V];break}return M},_convertCostValue:function(C,H,M){var V=this._isTimeUnits(H),P=this._isTimeUnits(M);H=V?this._toMinutes(C,H):this._toMeters(C,H);return V===P?P?this._fromMinutes(H,M):this._fromMeters(H,
M):C},_toMinutes:function(C,H,M){C=C||0;switch(H){case "milliseconds":C/=Math.pow(6E4,M?-1:1);break;case "esriNAUSeconds":C/=Math.pow(60,M?-1:1);break;case "esriNAUHours":C*=Math.pow(60,M?-1:1);break;case "esriNAUDays":C*=Math.pow(1440,M?-1:1)}return C},_fromMinutes:function(C,H){return this._toMinutes(C,H,!0)},_toMeters:function(C,H,M){C=C||0;switch((H||"").replace("esriNAU","esri")){case "esriInches":C*=Math.pow(.0254,M?-1:1);break;case "esriFeet":C*=Math.pow(.3048,M?-1:1);break;case "esriYards":C*=
Math.pow(.9144,M?-1:1);break;case "esriMiles":C*=Math.pow(1609.344,M?-1:1);break;case "esriNauticalMiles":C*=Math.pow(1851.995396854,M?-1:1);break;case "esriMillimeters":C/=Math.pow(1E3,M?-1:1);break;case "esriCentimeters":C/=Math.pow(100,M?-1:1);break;case "esriKilometers":C*=Math.pow(1E3,M?-1:1);break;case "esriDecimeters":C/=Math.pow(10,M?-1:1)}return C},_fromMeters:function(C,H){return this._toMeters(C,H,!0)},_createRouteTask:function(){var C=new S;this.set("routeTask",new Sa(this.get("routeTaskUrl")));
this._createRouteParams();this.routeTask.getServiceDescription(this.travelModesServiceUrl,this.doNotFetchTravelModesFromOwningSystem).then(v.hitch(this,function(H){H.networkDataset?(this.set("serviceDescription",H),this.set("maxStops",parseInt(this.userOptions.maxStops||H.serviceLimits&&H.serviceLimits.Route_MaxStops||this.defaults.maxStops)),this.defaults.portalUrl?(this.owningSystemUrl=this.defaults.portalUrl,C.resolve()):this.routeTask.getOwningSystemUrl().then(v.hitch(this,function(M){this.owningSystemUrl=
M;C.resolve()}),C.reject)):(this._showMessage(G.widgets.directions.error.cantFindRouteServiceDescription),C.reject(Error(G.widgets.directions.error.cantFindRouteServiceDescription)))}),v.hitch(this,function(){this._showMessage(G.widgets.directions.error.cantFindRouteServiceDescription);C.reject(Error(G.widgets.directions.error.cantFindRouteServiceDescription));this.mapClickActive=!1;this._activate()}));return C.promise},_createSearchSourceDDL:function(){if(this._globalGeocoder&&this._globalGeocoder.sources&&
1<this._globalGeocoder.sources.length){var C=v.hitch(this,function(V){this._searchSourceSelector.domNode.blur();this._globalGeocoder.set("activeSourceIndex",V);for(var P=0;P<this.geocoders.length;P++)this.geocoders[P].set("activeSourceIndex",V);this._truncateSearchSourceIfNeeded()});if(!this._searchSourceSelector){for(var H=[{value:"all",label:G.widgets.Search.main.all,selected:!0}],M=0;M<this._globalGeocoder.sources.length;M++)H.push({value:String(M),label:this._globalGeocoder.sources[M].name});
this._searchSourceSelector=new c({className:"esriSearchSourcesDDL",style:"width:100%;",options:H},this._searchSourceSelectorContainer);this._searchSourceSelector.startup();this._searchSourceSelector.on("change",C);this._searchSourceSelector.domNode.style.width=""}C("all")}else 2>this._globalGeocoder.sources.length&&(this._searchSourceContainerNode.style.display="none")},_createTravelModesDDL:function(){this._travelModeSelector||(this._travelModeSelector=new c({className:"esriTravelModesDDL",style:"width:100%;"},
this._travelModeSelectorContainer),this._travelModeSelector.startup(),this._travelModeSelector._interractive=!0,this._travelModeSelector.on("change",v.hitch(this,function(C){this._travelModeSelector._interractive?this._enqueue(function(){return this._setTravelMode(C).always(v.hitch(this,function(){this._travelModeSelector._interractive=!0}))}):this._travelModeSelector._interractive=!0})))},_setupTravelModes:function(){var C=this.get("serviceDescription"),H=C.supportedTravelModes,M=new S;if(H&&H.length&&
this._travelModeSelector){for(var V=H[0].name,P=[],ba=0;ba<H.length;ba++){for(var ea="AUTOMOBILE"===H[ba].type?"Driving":"TRUCK"===H[ba].type?"Trucking":"WALK"===H[ba].type?"Walking":"Other",ha="",fa=C.networkDataset.networkAttributes,ja=0;ja<fa.length;ja++){var ma=fa[ja];if(ma.name===H[ba].impedanceAttributeName){if("esriNAUCentimeters"===ma.units||"esriNAUDecimalDegrees"===ma.units||"esriNAUDecimeters"===ma.units||"esriNAUFeet"===ma.units||"esriNAUInches"===ma.units||"esriNAUKilometers"===ma.units||
"esriNAUMeters"===ma.units||"esriNAUMiles"===ma.units||"esriNAUMillimeters"===ma.units||"esriNAUNauticalMiles"===ma.units||"esriNAUYards"===ma.units)ha="Distance";else if("esriNAUDays"===ma.units||"esriNAUHours"===ma.units||"esriNAUMinutes"===ma.units||"esriNAUSeconds"===ma.units)ha="Time";break}}P.push({id:H[ba].name,label:'\x3cdiv class\x3d"esriTravelModesDirectionsIcon esriTravelModesType'+ea+ha+'"\x3e\x26nbsp;\x3c/div\x3e\x3cdiv class\x3d"esriTravelModesTypeName" title\x3d"'+H[ba].description+
'"\x3e'+H[ba].name+"\x3c/div\x3e"});!C.defaultTravelMode||H[ba].id!==C.defaultTravelMode&&H[ba].itemId!==C.defaultTravelMode||(V=H[ba].name)}this._showTravelModesOption();this._travelModeSelector.setStore(new e({objectStore:new g({data:P})}));this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(V);this._setTravelMode(V).always(M.resolve)}else this._checkStartTimeUIAvailability(),this.set("showTravelModesOption",!1),M.resolve();return M.promise},_createPrintTask:function(){this._printService=
(this.printTaskUrl=this._usingAGOL()?this.printTaskUrl:this.defaults.printTaskUrl)?new La(this.printTaskUrl,{async:!1}):null;var C=new ya;C.exportOptions={width:670,height:750,dpi:96};C.format="PNG32";C.layout="MAP_ONLY";C.preserveScale=!1;C.showAttribution=!1;var H=new $a;H.map=this.map;H.outSpatialReference=this.map.spatialReference;H.template=C;this._printParams=H},_createGeometryTask:function(){this._geometryService=null;this._usingAGOL()?this._geometryService=new Ta(this.geometryTaskUrl):this.geometryTaskUrl=
(this._geometryService=this.defaults.geometryTaskUrl?new Ta(this.defaults.geometryTaskUrl):cb.defaults.geometryService)?this._geometryService.url:null},_showTravelModesOption:function(){var C=this.get("serviceDescription");z.set(this._travelModeContainerNode,"display",this.showTravelModesOption&&C&&C.supportedTravelModes&&C.supportedTravelModes.length&&!this.doNotFetchTravelModesFromOwningSystem?"block":"none")},_showMilesKilometersOption:function(){z.set(this._agolDistanceUnitsNode,"display",this.showMilesKilometersOption?
"block":"none")},_showClearButton:function(){z.set(this._clearDirectionsButtonNode,"display",this.showClearButton?"inline-block":"none")},_showActivateButton:function(){z.set(this._activateButtonNode,"display",this.showActivateButton?"inline-block":"none");this.showActivateButton||this.deactivate()},_showBarriersButton:function(){z.set(this._lineBarrierButtonNode,"display",this.showBarriersButton?"inline-block":"none");this.showBarriersButton||this.deactivateBarrierTool()},_createRouteParams:function(){var C=
{returnDirections:!0,returnRoutes:!1,outputLines:"esriNAOutputLineTrueShape",preserveFirstStop:!0,preserveLastStop:!0,directionsOutputType:"complete",stops:new Va,ignoreInvalidLocations:!0,doNotLocateOnRestrictedElements:!0,outSpatialReference:this.get("map").spatialReference};this.get("routeParams")||(this.routeParams={});var H=new Ra;this.routeParams=v.mixin(H,{outputGeometryPrecision:0,outputGeometryPrecisionUnits:"esriMeters",restrictUTurns:"esriNFSBAtDeadEndsOnly"},this.get("routeParams"),C)},
_markWPsForRemovalAfterUserChangedStopSequence:function(C,H){for(var M=C-1,V=[];0<=M&&this._isStopAWaypoint(this.stops[M]);)V.push(this.stops[M]),M--;for(M=C+1;M<this.stops.length&&this._isStopAWaypoint(this.stops[M]);)V.push(this.stops[M]),M++;if(H>C)for(M=H+1;M<this.stops.length&&this._isStopAWaypoint(this.stops[M]);)V.push(this.stops[M]),M++;else if(void 0!==H)for(M=H-1;0<=M&&this._isStopAWaypoint(this.stops[M]);)V.push(this.stops[M]),M--;else if(this.returnToStart&&0===C)for(M=this.stops.length-
1;0<=M&&this._isStopAWaypoint(this.stops[M]);)V.push(this.stops[M]),M--;return V},_removeSomeWaypoints:function(C){for(var H=new S,M=[],V=0;V<C.length;V++){var P=p.indexOf(this.stops,C[V]);-1<P&&M.push(this._removeStop(P,!0,!0))}O(M).always(H.resolve);return H.promise},_modifyStopSequence:function(C,H){var M=this._dnd.getAllNodes(),V=new S,P,ba=[];if(M.length)if(this._removeLocateButtonVisibilityEvents(),arguments.length&&void 0!==C)if(0<=C&&0<=H&&C<this.stops.length&&H<this.stops.length&&C!==H){M=
this._markWPsForRemovalAfterUserChangedStopSequence(C,H);var ea=this.stops.splice(C,1);this.stops.splice(H,0,ea[0]);for(P=0;P<this.stops.length;P++)ba.push(this._updateStop(this.stops[P],P));ba.push(this._removeSomeWaypoints(M));O(ba).always(v.hitch(this,function(){this._solveAndZoom().always(V.resolve)}))}else V.reject("Invalid From and To values.");else{for(P=0;P<this.stops.length;)this._isStopAWaypoint(this.stops[P])?ba.push(this._removeStop(P,!0,!0)):P++;O(ba).always(v.hitch(this,function(){ba=
[];this.stops.reverse();for(P=0;P<this.stops.length;P++)ba.push(this._updateStop(this.stops[P],P));O(ba).always(v.hitch(this,function(){this._solveAndZoom().always(V.resolve)}))}))}else V.resolve();return V.promise},_setMenuNodeValues:function(C){"traffic"!==C&&this._clearDisplayBeforeSolve();C=this.get("optimalRoute");this._findOptimalOrderNode&&A.set(this._findOptimalOrderNode,"checked",C);this._returnToStartNode&&(C=this.returnToStart&&!this.maxStopsReached&&this.stops[0]&&(!this.stops[0].feature||
this._isStopLocated(this.stops[0])),A.set(this._returnToStartNode,"checked",C),this.set("returnToStart",C),this.maxStopsReached&&this.returnToStart&&this._showMessage(G.widgets.directions.error.maximumStops));if(!this.returnToStart&&!this._incrementalSolveStopRange&&this.directions)for(this._incrementalSolveStopRange={start:this.stops.length-1,end:this.stops.length},this._clearRouteGraphics(),this._incrementalSolveStopRange=null,C=this.stops.length;0<C--&&this._isStopAWaypoint(this.stops[C]);)this._removeSomeWaypoints([this.stops[C]]);
this._useTrafficNode&&(A.set(this._useTrafficNode,"checked",this.traffic),this.traffic?(this._updateMapTimeExtent(),this._addTrafficLayer()):(this._removeTrafficLayer(),this._restoreMapTimeExtent()));switch(this.get("directionsLengthUnits")){case da.KILOMETERS:A.set(this._useKilometersNode,"checked",!0);A.set(this._useMilesNode,"checked",!1);break;case da.MILES:A.set(this._useKilometersNode,"checked",!1),A.set(this._useMilesNode,"checked",!0)}z.set(this._printButton,"display",this.showPrintPage?"inline-block":
"none");z.set(this._saveMenuButton,"display",this.showSaveButton&&this.owningSystemUrl?"inline-block":"none");this._showMilesKilometersOption();this._showClearButton()},_optionsMenu:function(){this._useTrafficItemNode&&z.set(this._useTrafficItemNode,"display",this.get("showTrafficOption")?"block":"none");this._returnToStartItemNode&&z.set(this._returnToStartItemNode,"display",this.get("showReturnToStartOption")?"block":"none");this._findOptimalOrderItemNode&&z.set(this._findOptimalOrderItemNode,"display",
this.get("showOptimalRouteOption")&&3<this._getStopCount()?"block":"none");this.stops.length>=this.get("minStops")?B.add(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass):(B.remove(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass),this._optionsMenuNode&&"block"===z.get(this._optionsMenuNode,"display")&&this._toggleOptionsMenu())},_stopsRemovable:function(){2<this._dnd.getAllNodes().length-this._getWaypointCount()?B.add(this._widgetContainer,this._css.stopsRemovableClass):
B.remove(this._widgetContainer,this._css.stopsRemovableClass)},_checkMaxStops:function(){this.set("maxStopsReached",this._getStopCount()+this._getWaypointCount()+(this.returnToStart?1:0)>=this.maxStops);this._showAddDestination()},_updateThemeWatch:function(C,H,M){B.remove(this.domNode,H);B.add(this.domNode,M)},_toggleOptionsMenu:function(){"block"===z.get(this._optionsMenuNode,"display")?(z.set(this._optionsMenuNode,"display","none"),B.remove(this._optionsButtonNode,"esriStopsOptionsOpen"),this._optionsButtonNode.innerHTML=
G.widgets.directions.showOptions):(z.set(this._optionsMenuNode,"display","block"),B.add(this._optionsButtonNode,"esriStopsOptionsOpen"),this._optionsButtonNode.innerHTML=G.widgets.directions.hideOptions)},_toggleSaveMenu:function(C){"block"===z.get(this._saveMenuNode,"display")||!1===C?(z.set(this._saveMenuNode,"display","none"),B.remove(this._saveMenuButton,this._css.stopsPressedButtonClass)):(this.clearMessages(),z.set(this._saveMenuNode,"display","block"),B.add(this._saveMenuButton,this._css.stopsPressedButtonClass),
this._enableSharing().then(v.hitch(this,function(){this._outputLayer.setValue(this.routeLayer.title?this.routeLayer.title:this.directions&&this.directions.routeName);if(this.routeLayer.ownerFolder)for(var H=this._folderSelector.store.objectStore.data,M=0;M<H.length;M++)if(H[M].folderId===this.routeLayer.ownerFolder){this._folderSelector.getValue()!==H[M].id&&(this._folderSelector._interractive=!1,this._folderSelector.setValue(H[M].id));break}this._enableButton(this._saveButton,this.routeLayer.isItemOwner||
!this._userCanCreatePortalItem);this._outputLayer.set("disabled",!1)})))},_showToolbar:function(){B[this.stops.length<this.maxStops&&this.canModifyStops||this.canModifyWaypoints?"add":"remove"].call(L,this._widgetContainer,this._css.addStopsClass)},_showAddDestination:function(){this._showToolbar();this._addDestinationNode.style.display=this.stops.length<this.maxStops&&this.canModifyStops?"inline":"none"},_showMapClickActiveButton:function(){this._showToolbar();this._activateButtonNode.style.display=
this.canModifyStops||this.canModifyWaypoints?"inline-block":"none"},_getAbsoluteUrl:function(C){C=m.toUrl(C);return/^https?:/i.test(C)?C:/^\/\//i.test(C)?Ua+C:/^\//i.test(C)?Ua+"//"+window.location.host+C:C},_getManeuverImage:function(C){return C?"esriDMTStop"===C||"esriDMTDepart"===C?"":this._getAbsoluteUrl("./images/Directions/maneuvers/"+C+".png"):""},_loadPrintDirections:function(C){var H=this.get("printTemplate"),M=new S;this.directionsLengthUnits!==this.routeParams.directionsLengthUnits?this.getDirections().then(M.resolve,
M.reject):M.resolve();M.then(v.hitch(this,function(){if(!H&&this.directions){var V=this._getAbsoluteUrl("./css/Directions.css"),P=this._getAbsoluteUrl("./css/DirectionsPrint.css"),ba=this._getAbsoluteUrl("./images/Directions/print-logo.png");var ea=w.isBodyLtr()?"ltr":"rtl";H="";H+="\x3c!DOCTYPE HTML\x3e";H+='\x3chtml lang\x3d"en" class\x3d"'+this.get("theme")+'" dir\x3d"'+ea+'"\x3e';H+="\x3chead\x3e";H+='\x3cmeta charset\x3d"utf-8"\x3e';H+='\x3cmeta http-equiv\x3d"X-UA-Compatible" content\x3d"IE\x3dEdge,chrome\x3d1"\x3e';
H+="\x3ctitle\x3e"+this.get("directions").routeName+"\x3c/title\x3e";H+='\x3clink rel\x3d"stylesheet" media\x3d"screen" type\x3d"text/css" href\x3d"'+V+'" /\x3e';H+='\x3clink rel\x3d"stylesheet" media\x3d"print" type\x3d"text/css" href\x3d"'+P+'" /\x3e';H+="\x3c/head\x3e";H+='\x3cbody class\x3d"'+this._css.esriPrintPageClass+'"\x3e';H+='\x3cdiv class\x3d"'+this._css.esriPrintBarClass+'"\x3e';H+='\x3cdiv class\x3d"'+this._css.esriCloseButtonClass+'" title\x3d"'+G.common.close+'" onclick\x3d"window.close();"\x3e'+
G.common.close+"\x3c/div\x3e";H+='\x3cdiv id\x3d"printButton" class\x3d"'+this._css.esriPrintButtonClass+'" title\x3d"'+G.widgets.directions.print+'" onclick\x3d"window.print();"\x3e'+G.widgets.directions.print+"\x3c/div\x3e";H+="\x3c/div\x3e";H+='\x3cdiv class\x3d"'+this._css.esriPrintMainClass+'"\x3e';H+='\x3cdiv class\x3d"'+this._css.esriPrintHeaderClass+'"\x3e';H+='\x3cimg class\x3d"'+this._css.esriPrintLogoClass+'" src\x3d"'+ba+'" /\x3e';H+='\x3cdiv class\x3d"'+this._css.esriPrintNameClass+'"\x3e'+
this.get("directions").routeName+"\x3c/div\x3e";H+=this._renderDirectionsSummary(this.directions);C&&(H+='\x3cdiv id\x3d"divMap" class\x3d"esriPrintMap esriPrintWait"\x3e\x3c/div\x3e',H+='\x3chr class\x3d"esriNoPrint"/\x3e');H+='\x3cdiv id\x3d"print_helper"\x3e\x3c/div\x3e';H+='\x3ctextarea onkeyup\x3d"document.getElementById(\'print_helper\').innerHTML\x3dthis.value;" id\x3d"print_area" class\x3d"'+this._css.esriPrintNotesClass+'" placeholder\x3d"'+G.widgets.directions.printNotes+'"\x3e\x3c/textarea\x3e';
H+='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';H+="\x3c/div\x3e";H+='\x3cdiv class\x3d"'+this._css.esriPrintDirectionsClass+'"\x3e';H+=this._renderDirectionsTable(this.directions);H+="\x3c/div\x3e";H+='\x3cdiv class\x3d"'+this._css.esriPrintFooterClass+'"\x3e';H+="\x3cp\x3e"+G.widgets.directions.printDisclaimer+"\x3c/p\x3e";H+="\x3c/div\x3e";H+="\x3c/div\x3e";H+="\x3c/body\x3e";H+="\x3c/html\x3e"}this._printWindow.document.open("text/html","replace");this._printWindow.document.write(H);
this._printWindow.document.close()}))},resize:function(){this._truncateSearchSourceIfNeeded()},_truncateSearchSourceIfNeeded:function(){var C=this._searchSourceSelector,H=C.containerNode.firstChild;C.domNode.clientWidth>this.domNode.clientWidth?z.set(H,"width",this._searchSourceContainerNode.clientWidth-20+"px"):z.set(H,"width","")},_printDirections:function(){if(this.directions){var C=screen.width/2,H=screen.height/1.5;C="toolbar\x3dno, location\x3dno, directories\x3dno, status\x3dyes, menubar\x3dno, scrollbars\x3dyes, resizable\x3dyes, width\x3d"+
C+", height\x3d"+H+", top\x3d"+(screen.height/2-H/2)+", left\x3d"+(screen.width/2-C/2);this.get("printPage")?(window.directions=this.get("directions"),window.open(this.get("printPage"),"directions_widget_print",C,!0)):(this._printWindow=window.open("","directions_widget_print",C,!0),this._loadPrintDirections(!!this._printService),this._printService&&m(["dojo/_base/window"],v.hitch(this,function(M){this.zoomToFullRoute().then(v.hitch(this,function(){this._printService.execute(this._printParams,v.hitch(this,
function(V){M.withDoc(this._printWindow.document,function(){var P=t.byId("divMap");P&&(B.remove(P,"esriPrintWait"),B.add(P,"esriPageBreak"),L.create("img",{src:V.url,"class":"esriPrintMapImg"},P))})}),v.hitch(this,function(V){M.withDoc(this._printWindow.document,function(){var P=t.byId("divMap");P&&B.remove(P,"esriPrintWait")})}))}))})))}},_enableButton:function(C,H){var M=H||void 0===H;B[M?"remove":"add"].apply(this,[C,"esriDisabledDirectionsButton"]);C._enabled=M},_clearStopsStatusAttr:function(){for(var C=
0;C<this.stops.length;C++)this.stops[C].feature&&this.stops[C].feature.attributes&&(this.stops[C].feature.attributes.Status=void 0)},_enableSharing:function(){var C=new S;!this._naRouteSharing&&this.owningSystemUrl?m(["../tasks/NARouteSharing"],v.hitch(this,function(H){this._naRouteSharing=new H(this.owningSystemUrl,this.map.spatialReference);this._folderSelector||(this._folderSelector=new c({className:"esriFoldersDDL",style:"width: 100%;",sortByLabel:!1,disabled:!0,_interractive:!0,onChange:v.hitch(this,
function(){this._folderSelector._interractive?this._enableButton(this._saveButton,!this.routeLayer.itemId):this._folderSelector._interractive=!0})},this._folderSelectorContainer),this._folderSelector.startup(),this._outputLayer=new h({style:"width: 100%",required:!0,trim:!0,regExp:'[^\x26|\x3c|\x3e|%|#|?|\\|"|/|+]+',maxLength:98,disabled:!0,onKeyPress:v.hitch(this,function(){this._enableButton(this._saveButton,!this.routeLayer.itemId||!this._userCanCreatePortalItem)}),onFocus:v.hitch(this,function(){this.map&&
this.map.disableKeyboardNavigation()}),onBlur:v.hitch(this,function(){this.map&&this.map.enableKeyboardNavigation()})},this._outputLayerContainer),this._outputLayer.startup());this._naRouteSharing.getFolders().then(v.hitch(this,function(M){for(var V=[],P=0;P<M.length;P++)V.push({id:M[P].url,folderId:M[P].id,label:M[P].title});this._folderSelector.setStore(new e({objectStore:new g({data:V})}));this._naRouteSharing.canCreateItem().then(v.hitch(this,function(ba){this._folderSelector.set("disabled",!ba);
this._userCanCreatePortalItem=ba}));this._enableButton(this._saveButton);C.resolve()}),v.hitch(this,function(M){this._naRouteSharing=null;this._toggleSaveMenu(!1);C.reject(M)}))})):this.owningSystemUrl?C.resolve():(C.reject(Error("Owning system is not defined, or the Directions widget is not done initializing.")),this._naRouteSharing=null);return C.promise},_storeRouteUI:function(){var C=new S;this._outputLayer&&this._outputLayer.isValid()?this._storeRoute(this._outputLayer.getValue(),this._folderSelector.getValue(),
this._folderSelector.store.objectStore.get(this._folderSelector.getValue()).folderId).then(C.resolve,C.reject):(this._outputLayer&&this._outputLayer.focus(),C.reject(Error("Need result layer name specified.")));return C.promise},_storeRoute:function(C,H,M){var V=new S,P=this.directions;if(this._savingRoute||!this._naRouteSharing)return this._saveButton.blur(),V.reject(Error("Not ready to store route.")),V.promise;this.clearMessages();V.then(null,v.hitch(this,function(pa){this._showMessage(G.widgets.directions.error.cantSaveRoute)}));
V.promise.always(v.hitch(this,function(){this._enableButton(this._saveButton);z.set(this._saveAsButton,"display",this.routeLayer.itemId&&this._userCanCreatePortalItem?"inline-block":"none");this._showLoadingSpinner();this._savingRoute=!1}));if(P&&P.features&&P.features.length&&this.stops&&this.stops.length)if(this.owningSystemUrl)if(this.routeParams&&this.routeParams.travelMode)if(C&&H){var ba=v.hitch(this,function(pa){return this._naRouteSharing.getAttributeUnits(pa,this.serviceDescription)});var ea=
this.routeParams.travelMode.timeAttributeName;var ha=this.routeParams.travelMode.distanceAttributeName,fa=ba(ea),ja=ba(ha),ma=this.routeParams.directionsLengthUnits||this.serviceDescription.directionsLengthUnits,na=this._naRouteSharing.toMeters,qa=this._naRouteSharing.toMinutes,xa=function(pa,Ea,Ja){var Ga;for(Ga in pa)if(pa.hasOwnProperty(Ga)&&0===Ga.indexOf(Ea)&&-1===p.indexOf(Ja,Ga.substr(Ea.length))){var fb=fb||{};fb[Ga.substr(Ea.length)]=pa[Ga]}return fb},ta=[],ua=[],Da=[];if(ea&&fa&&ha&&ja){var Ma=
[],Ha=this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames||[],Ia=this.serviceDescription.networkDataset.networkAttributes;for(ba=0;ba<Ia.length;ba++)"esriNAUTCost"===Ia[ba].usageType&&-1===p.indexOf(Ha,Ia[ba].name)&&Ia[ba].name!==ea&&Ia[ba].name!==ha&&Ma.push(Ia[ba].name);Ha=this.get("stops");var Aa={xmin:Infinity,ymin:Infinity,xmax:-Infinity,ymax:-Infinity};for(ba=0;ba<Ha.length;ba++)if(Ha[ba].feature&&Ha[ba].feature.toJson){Ia=Ha[ba].feature.toJson();var ra=Ia.attributes;
var sa=Ia.geometry,Ka=this._naRouteSharing.getUTCOffset(ra.ArriveTime,ra.ArriveTimeUTC),Pa=this._naRouteSharing.getUTCOffset(ra.DepartTime,ra.DepartTimeUTC);v.mixin(Aa,{xmin:Aa.xmin>sa.x?sa.x:Aa.xmin,ymin:Aa.ymin>sa.y?sa.y:Aa.ymin,xmax:Aa.xmax<sa.x?sa.x:Aa.xmax,ymax:Aa.ymax<sa.y?sa.y:Aa.ymax});Ia.attributes={__OBJECTID:ba+1,CurbApproach:ra.CurbApproach,ArrivalCurbApproach:ra.ArriveCurbApproach,DepartureCurbApproach:ra.DepartCurbApproach,Name:ra.Name===this._waypointName?G.widgets.directions.waypoint:
ra.Name===this._userDefinedStopName?Ha[ba].name:ra.Name,RouteName:P.routeName,Sequence:ra.Sequence,Status:ra.Status,LocationType:ra.isWaypoint?1:0,TimeWindowStart:ra.TimeWindowStart,TimeWindowEnd:ra.TimeWindowEnd,TimeWindowStartUTCOffset:Ka,TimeWindowEndUTCOffset:Ka,ServiceMinutes:qa(ra["Attr_"+ea],fa),ServiceMeters:na(ra["Attr_"+ha],ja),ServiceCosts:I.stringify(xa(ra,"Attr_",Ma)),CumulativeMinutes:qa(ra["Cumul_"+ea],fa),CumulativeMeters:na(ra["Cumul_"+ha],ja),CumulativeCosts:I.stringify(xa(ra,"Cumul_",
Ma)),LateMinutes:qa(ra["Violation_"+ea],fa),WaitMinutes:qa(ra["Wait_"+ea],fa),ArrivalTime:this._naRouteSharing.toUTCTime(ra.ArriveTime,Ka),DepartureTime:this._naRouteSharing.toUTCTime(ra.DepartTime,Pa),ArrivalUTCOffset:Ka,DepartureUTCOffset:Pa};ta.push(Ia)}ha=0;ja=function(pa){try{pa.strings=I.parse(pa.strings)}catch(Ja){Za.strings=void 0}if(pa.strings&&pa.strings.length)for(var Ea=0;Ea<pa.strings.length;Ea++)if("esriDSTGeneral"===pa.strings[Ea].stringType)return pa.strings[Ea].string};Ha=function(pa,
Ea){for(var Ja=[],Ga=0;Ga<(pa||[]).length;Ga++)pa[Ga].stringType!==Ea&&Ea||Ja.push(pa[Ga].string);return Ja.length?Ja.toString():void 0};Ia=function(pa){switch(pa){case "esriDMTStop":return"esriDPTManeuverArrive";case "esriDMTDepart":return"esriDPTManeuverDepart";case "esriDMTDoorPassage":return"esriDPTManeuverDoor";case "esriDMTBearLeft":return"esriDPTManeuverBearLeft";case "esriDMTBearRight":return"esriDPTManeuverBearRight";case "esriDMTElevator":return"esriDPTManeuverElevator";case "esriDMTEscalator":return"esriDPTManeuverEscalator";
case "esriDMTFerry":return"esriDPTManeuverFerryOn";case "esriDMTEndOfFerry":return"esriDPTManeuverFerryOff";case "esriDMTForkCenter":return"esriDPTManeuverForkCenter";case "esriDMTForkLeft":return"esriDPTManeuverForkLeft";case "esriDMTForkRight":return"esriDPTManeuverForkRight";case "esriDMTPedestrianRamp":return"esriDPTManeuverPedestrianRamp";case "esriDMTRampLeft":return"esriDPTManeuverRampLeft";case "esriDMTRampRight":return"esriDPTManeuverRampRight";case "esriDMTRoundabout":return"esriDPTManeuverRoundabout";
case "esriDMTTurnLeft":return"esriDPTManeuverTurnLeft";case "esriDMTLeftLeft":return"esriDPTManeuverTurnLeftLeft";case "esriDMTLeftRight":return"esriDPTManeuverTurnLeftRight";case "esriDMTTurnRight":return"esriDPTManeuverTurnRight";case "esriDMTRightLeft":return"esriDPTManeuverTurnRightLeft";case "esriDMTRightRight":return"esriDPTManeuverTurnRightRight";case "esriDMTSharpLeft":return"esriDPTManeuverSharpLeft";case "esriDMTSharpRight":return"esriDPTManeuverSharpRight";case "esriDMTStraight":return"esriDPTManeuverStraight";
case "esriDMTStrairs":return"esriDPTManeuverStairs";case "esriDMTUTurn":return"esriDPTManeuverUTurn"}return"esriDPTUnknown"};for(ba=0;ba<P.featuresWithWaypoints.length;ba++){var Qa=P.featuresWithWaypoints[ba];sa=Qa.toJson();Ka=sa.attributes;Pa=sa.geometry&&sa.geometry.paths&&sa.geometry.paths[0]||[];var Ya=sa.geometry.hasM||Pa[0]&&3===Pa[0].length;ra=this._naRouteSharing.getUTCOffset(Ka.ETA,Ka.arriveTimeUTC);sa.attributes={__OBJECTID:ba+1,Sequence:++ha,StopID:function(){var pa=void 0,Ea=Qa._associatedStopWithReturnToStart&&
Qa._associatedStopWithReturnToStart.attributes.Sequence;if(Ea)for(var Ja=0;Ja<ta.length;Ja++)if(ta[Ja].attributes.Sequence===Ea){pa=ta[Ja].attributes.__OBJECTID;break}return pa}(),DirectionPointType:Ia(Ka.maneuverType),DisplayText:Qa._associatedStopWithReturnToStart&&Qa._associatedStopWithReturnToStart.attributes.isWaypoint?Ka.text.replace(this._waypointName,G.widgets.directions.waypoint):Ka.text,ArrivalTime:this._naRouteSharing.toUTCTime(Ka.ETA,ra),ArrivalUTCOffset:ra,Azimuth:void 0,Name:Ha(P.stringsWithWaypoints[ba],
"esriDSTStreetName"),AlternateName:Ha(P.stringsWithWaypoints[ba],"esriDSTAltName"),ExitName:Ha(P.stringsWithWaypoints[ba],"esriDSTExit"),IntersectingName:Ha(P.stringsWithWaypoints[ba],"esriDSTCrossStreet"),BranchName:Ha(P.stringsWithWaypoints[ba],"esriDSTBranch"),TowardName:Ha(P.stringsWithWaypoints[ba],"esriDSTToward"),ShortVoiceInstruction:void 0,VoiceInstruction:void 0,Level:void 0};delete sa.symbol;delete sa.infoTemplate;Pa.length?(sa.geometry={x:Pa[0][0],y:Pa[0][1],spatialReference:sa.geometry.spatialReference},
Ya&&v.mixin(sa.geometry,{m:Pa[0][2]})):delete sa.geometry;ua.push(sa);sa=Qa.toJson();Ka=sa.attributes;Pa=sa.geometry&&sa.geometry.paths&&sa.geometry.paths[0]||[];ra=!0;for(ea=0;ea<Pa.length-1;ea++)if(Pa[ea][0]!==Pa[ea+1][0]||Pa[ea][1]!==Pa[ea+1][1]){ra=!1;break}ra||(sa.attributes={DirectionPointID:ba+1,DirectionLineType:"esriDLTSegment",Meters:na(Ka.length,ma),Minutes:qa(Ka.time,fa),FromLevel:void 0,ToLevel:void 0},sa.geometry.hasM=Ya,delete sa.symbol,delete sa.infoTemplate,Da.push(sa));var Za=P.eventsWithWaypoints[sa.attributes.Sequence]||
[];for(ea=0;ea<Za.length;ea++)sa=Za[ea].toJson(),Ka=sa.attributes,ra=this._naRouteSharing.getUTCOffset(Ka.ETA,Ka.arriveTimeUTC),sa.attributes={Sequence:++ha,DirectionPointType:"esriDPTEvent",DisplayText:ja(Ka),ArrivalTime:this._naRouteSharing.toUTCTime(Ka.ETA,ra),ArrivalUTCOffset:ra,Name:Ka.strings},ua.push(sa)}ea=this.routeParams.barriers&&this.routeParams.barriers.features||[];var Na=[];for(ba=0;ba<ea.length;ba++)ha=ea[ba].toJson(),ja=ha.attributes,ha.attributes={BarrierType:ja.BarrierType||0,FullEdge:ja.FullEdge||
!1,AddedCost:ja["Attr_"+this._getImpedanceAttribute().name]||0,Costs:I.stringify(xa(ja,"Attr_",Ma)),CurbApproach:ja.CurbApproach||0,Name:ja.Name},Na.push(ha);ea=this.routeParams.polylineBarriers&&this.routeParams.polylineBarriers.features||[];var eb=[];for(ba=0;ba<ea.length;ba++)ha=ea[ba].toJson(),ja=ha.attributes,ha.attributes={BarrierType:ja.BarrierType||0,ScaleFactor:ja["Attr_"+this._getImpedanceAttribute().name]||1,Costs:I.stringify(xa(ja,"Attr_",Ma)),Name:ja.Name},eb.push(ha);ea=this.routeParams.polygonBarriers&&
this.routeParams.polygonBarriers.features||[];var Oa=[];for(ba=0;ba<ea.length;ba++)ha=ea[ba].toJson(),ja=ha.attributes,ha.attributes={BarrierType:ja.BarrierType||0,ScaleFactor:ja["Attr_"+this._getImpedanceAttribute().name]||1,Costs:I.stringify(xa(ja,"Attr_",Ma)),Name:ja.Name},Oa.push(ha);var ib={geometry:P.mergedGeometry,attributes:{RouteName:P.routeName,TotalMinutes:qa(P.totalTime,fa),TotalMeters:na(P.totalLength,ma),TotalLateMinutes:function(){for(var pa=0,Ea=0;Ea<ta.length;Ea++)pa+=ta[Ea].attributes.LateMinutes||
0;return pa}(),TotalWaitMinutes:function(){for(var pa=0,Ea=0;Ea<ta.length;Ea++)pa+=ta[Ea].attributes.WaitMinutes||0;return pa}(),TotalCosts:ta[ta.length-1].attributes.CumulativeCosts,StartTime:"none"!==this.startTime?ta[0].attributes.ArrivalTime:null,EndTime:"none"!==this.startTime?ta[ta.length-1].attributes.DepartureTime:null,StartUTCOffset:ta[0].attributes.ArrivalUTCOffset,EndUTCOffset:ta[ta.length-1].attributes.DepartureUTCOffset,Messages:I.stringify(this._solverMessages),AnalysisSettings:I.stringify({travelMode:v.hitch(this,
function(){var pa=v.clone(this.routeParams.travelMode);"\x26lt;"===pa.name.substr(0,4)&&"\x26gt;"===pa.name.substr(pa.name.length-4,4)&&(pa.name=pa.name.substr(4,pa.name.length-8));return pa})(),directionsLanguage:this.routeParams.directionsLanguage||this.serviceDescription.directionsLanguage,startTimeIsUTC:this.routeParams.startTimeIsUTC,timeWindowsAreUTC:this.routeParams.timeWindowsAreUTC,findBestSequence:this.routeParams.findBestSequence,preserveFirstStop:this.routeParams.preserveFirstStop,preserveLastStop:this.routeParams.preserveLastStop,
accumulateAttributeNames:this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames})}};this._enableButton(this._saveButton,!1);this._savingRoute=!0;this._showLoadingSpinner(!0);v.hitch(this,function(){var pa=new S;this._printService?this.zoomToFullRoute().then(v.hitch(this,function(){var Ea=this._printParams.template,Ja=Ea.exportOptions;Ea.exportOptions={width:200,height:133,dpi:96};this._printService.execute(this._printParams,function(Ga){Ea.exportOptions=Ja;pa.resolve(Ga.url)},
function(Ga){Ea.exportOptions=Ja;pa.resolve()})})):pa.resolve();return pa.promise})().then(v.hitch(this,function(pa){var Ea={folder:H,name:C,stops:ta,directionPoints:ua,directionLines:Da,barriers:Na,polylineBarriers:eb,polygonBarriers:Oa,extent:v.mixin(v.clone(P.extent),{xmin:Aa.xmin>P.extent.xmin?P.extent.xmin:Aa.xmin,ymin:Aa.ymin>P.extent.ymin?P.extent.ymin:Aa.ymin,xmax:Aa.xmax<P.extent.xmax?P.extent.xmax:Aa.xmax,ymax:Aa.ymax<P.extent.ymax?P.extent.ymax:Aa.ymax}),routeInfo:ib,thumbnail:pa};this._userCanCreatePortalItem?
this._naRouteSharing.store(Ea,this.routeLayer.itemId,"1.0.0").then(v.hitch(this,function(Ja){if(Ja.success){var Ga=this._naRouteSharing.portal;Ga="//"+(Ga.isPortal?Ga.portalHostname:Ga.urlKey+"."+Ga.customBaseUrl);this._toggleSaveMenu();this._showMessage(G.widgets.directions.routeIsSaved+"\x3cbr/\x3e\x3ca class\x3d'esriLinkButton' target\x3d'_blank' href\x3d'"+Ga+"/home/item.html?id\x3d"+Ja.id+"'\x3e"+G.widgets.directions.share+"\x3c/a\x3e",!0);if(this.routeLayer.itemId)this.onRouteItemUpdated(Ja.id);
else this.onRouteItemCreated(Ja.id);v.mixin(this.routeLayer,{itemId:Ja.id,title:Ea.name,isItemOwner:!0,ownerFolder:M});V.resolve(Ja)}else V.reject(Ja)}),V.reject):this._naRouteSharing.createFeatureCollection(Ea,"1.0.0").then(v.hitch(this,function(Ja){V.resolve(Ja);this._toggleSaveMenu();this.onFeatureCollectionCreated(Ja)}),V.reject)}))}else V.reject(Error("Cannot deduce the impedance used."))}else V.reject(Error("Missing required parameter: layerName, folder must be specified."));else V.reject(Error("Shared route must be built using a Travel Mode."));
else V.reject(Error("Cannot store route: owning system to store routes is not defined. Please specify Portal or ArcGIS Online Url in constructor."));else V.reject(Error("No route to share. Build a route first."));return V.promise},_loadRoute:function(C){var H=new S;H.promise.always(v.hitch(this,function(){this._showLoadingSpinner(!1);z.set(this._saveAsButton,"display",this.routeLayer.itemId&&this._userCanCreatePortalItem?"inline-block":"none");this._enableButton(this._saveButton,this.routeLayer.isItemOwner)}));
this._reset().then(v.hitch(this,function(){this._showLoadingSpinner(!0);this._enableSharing().then(v.hitch(this,function(){var M=v.clone(this.serviceDescription),V=v.hitch(this,function(fa){v.mixin(this.routeLayer,{itemId:C,title:fa.title,isItemOwner:fa.isItemOwner,ownerFolder:fa.ownerFolder})}),P,ba,ea,ha;M.directionsLengthUnits=this.directionsLengthUnits;this._naRouteSharing.load(C,M).then(v.hitch(this,function(fa){if(fa.routeParameters){v.mixin(this.routeParams,fa.routeParameters);this.routeParams.accumulateAttributes=
fa.routeParameters.accumulateAttributeNames;this.set("optimalRoute",this.routeParams.findBestSequence);this.startTime=this.routeParams.startTime?this.routeParams.startTime:"none";this._setStartTime(void 0,void 0,this.startTime);var ja=fa.routeParameters.travelMode,ma=ja?this._getCostAttribute(ja.impedanceAttributeName):void 0;ma=ma?this._isTimeUnits(ma.units)?"Time":"Distance":"";ha=M.supportedTravelModes&&M.supportedTravelModes.length?this._travelModeSelector.store.objectStore.data.slice():[];if(canUseRouteLayerTM=
1!==fa.successCode&&ma){var na="AUTOMOBILE"===ja.type?"Driving":"TRUCK"===ja.type?"Trucking":"WALK"===ja.type?"Walking":"Other";ja.name="\x26lt;"+ja.name+"\x26gt;";this.serviceDescription.supportedTravelModes=(M.supportedTravelModes||[]).concat(ja);ha.push({id:ja.name,label:'\x3cdiv class\x3d"esriTravelModesDirectionsIcon esriTravelModesType'+na+ma+'"\x3e\x26nbsp;\x3c/div\x3e\x3cdiv class\x3d"esriTravelModesTypeName"\x3e'+ja.name+"\x3c/div\x3e"});this._travelModeSelector.setStore(new e({objectStore:new g({data:ha})}));
this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(ja.name)}else{ma=!1;if(ja&&ja.name)for(ha=M.supportedTravelModes||[],P=0;P<ha.length;P++)if(ha[P].name===ja.name){ma=!0;this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(ja.name);this.routeParams.travelMode=ha[P].impedanceAttributeName?ha[P]:ha[P].itemId;fa.loadMessages.push({message:G.widgets.directions.error.tmFromPortalSameName+" "+ja.name,messageType:"Warning"});break}if(!ma)if((ja=M.defaultTravelMode)&&
ha)for(P=0;P<ha.length;P++){if(ha[P].id===ja){this.routeParams.travelMode=ha[P].impedanceAttributeName?ha[P]:ha[P].itemId;fa.loadMessages.push({message:G.widgets.directions.error.tmFromPortalDefault+" "+(ha[P].name?ha[P].name:ha[P].itemId),messageType:"Warning"});break}}else this.routeParams.travelMode=null}this._checkStartTimeUIAvailability()}if(fa.solveResult&&fa.solveResult.routeResults){var qa=Infinity,xa=-Infinity;ja=fa.solveResult.routeResults[0].stops;var ta=fa.solveResult.routeResults[0].directions.features;
ma={};for(P=0;P<ja.length;P++){var ua=ja[P].attributes;if(ua.isWaypoint)for(ba=0;ba<ta.length;ba++)na=ta[ba].attributes,na._stopSequence===ua.Sequence&&(na.text=na.text.replace(ua.Name,this._waypointName));ea=ua.Name+"_"+this._stopSequence++;ma[ea]=ua.isWaypoint?this._waypointName:ua.Name;ua.Name=ea;if(ua.Sequence<qa&&(null!==ua.ArriveCurbApproach||null!==ua.DepartCurbApproach)){var Da=ua.Name;qa=ua.Sequence}if(ua.Sequence>xa&&(null!==ua.ArriveCurbApproach||null!==ua.DepartCurbApproach)){var Ma=ua.Name;
xa=ua.Sequence}}ea=Da+" - "+Ma;fa.solveResult.routeResults[0].routeName=ea;fa.solveResult.routeResults[0].directions.routeName=ea;for(P=0;P<ta.length;P++)if(na=ta[P].attributes,void 0!==na._stopSequence)for(ba=0;ba<ja.length;ba++)if(na._stopSequence===ja[ba].attributes.Sequence){ea=ja[ba].attributes.Name;na.text=(na.text||"").replace(ma[ea],ea);delete na._stopSequence;break}Da=ja[ja.length-1];ja[0].geometry.x===Da.geometry.x&&ja[0].geometry.y===Da.geometry.y&&(this._returnToStartStop=this._addStopWrapperToGraphic(new Q(Da.geometry,
null,Da.attributes),ma[Da.attributes.Name]),this.set("returnToStart",!0));this._solveResultProcessing(fa.solveResult,ma).then(v.hitch(this,function(){this._setStartTime(void 0,void 0,this.startTime);V(fa);this.zoomToFullRoute();H.resolve(fa)}),H.reject)}else{if(fa.routeParameters){Da=fa.routeParameters.stops.features;this.stops=[];for(P=0;P<Da.length;P++)this.stops.push(this._addStopWrapperToGraphic(Da[P],Da[P].attributes.Name)),this._updateStop(this.stops[P],P);this._setStops();fa.loadMessages.push({message:G.widgets.directions.routeLayerStopsOnly,
messageType:"Warning"})}else fa.loadMessages.push({message:G.widgets.directions.routeLayerEmpty,messageType:"Warning"});V(fa);H.resolve(fa)}for(P=0;P<fa.loadMessages.length;P++)this._showMessage(fa.loadMessages[P].message)}),v.hitch(this,function(fa){H.reject(fa);this._showMessage("GWM_0003"===fa.messageCode?G.widgets.directions.error.accessDenied+this._naRouteSharing.portal.getPortalUser().username:G.widgets.directions.error.loadError)}))}),H.reject)}),H.reject);return H.promise}});v.setObject("dijit.Directions",
n,N);return n})},"dijit/layout/AccordionPane":function(){define(["dojo/_base/declare","dojo/_base/kernel","./ContentPane"],function(m,n,v){return m("dijit.layout.AccordionPane",v,{constructor:function(){n.deprecated("dijit.layout.AccordionPane deprecated, use ContentPane instead","","2.0")},onSelected:function(){}})})},"arcgisonline/sharing/geow/MemberReadStore":function(){define(["dojo","dijit","dojox","dojo/require!dojox/data/QueryReadStore,arcgisonline/sharing/geow/Content"],function(m,n,v){m.provide("arcgisonline.sharing.geow.MemberReadStore");
m.require("dojox.data.QueryReadStore");m.require("arcgisonline.sharing.geow.Content");m.declare("arcgisonline.sharing.geow.MemberReadStore",v.data.QueryReadStore,{_fetchItems:function(b,p,f){var d=b.serverQuery||b.query||{};d.start=b.start||0;d.start++;b.count&&(d.num=b.count);arcgisonline.sharing.util.getJson(this.url,m.hitch(this,function(a){this._items=[];var c=null,h="";if(a.users){h="groupMembers";this._total=a.users.length+a.admins.length;m.publish("onMemberCount",[this._total]);var l={name:a.owner,
memberType:"owner",requestType:h,groupowner:a.owner||"",groupadmins:a.admins||[]};this._items.push({i:l,r:this});m.forEach(a.admins,function(k,g){k!=a.owner&&(l={name:k,memberType:"admin",requestType:h,groupowner:a.owner||"",groupadmins:a.admins||[]},this._items.push({i:l,r:this}))},this);m.forEach(a.users,function(k,g){l={name:k,memberType:"member",requestType:h,groupowner:a.owner||"",groupadmins:a.admins||[]};this._items.push({i:l,r:this})},this)}else c=a.applications,h="groupApplications",m.publish("onAppCount",
[a.applications.length]),this._total=c.length,m.forEach(c,function(k,g){this._items.push({i:{name:k.username,fullname:k.fullname,requestType:h,groupowner:a.owner||"",groupadmins:a.admins||[],received:k.received||-1},r:this})},this);this._itemsByIdentity={};this._identifier="name";for(i=0;i<this._items.length;++i)l=this._items[i].i,c=l.name,this._itemsByIdentity.name||(this._itemsByIdentity[c]=l);p(this._items,b,this._total);this.lastRequestHash=(new Date).getTime()+"-"+String(Math.random()).substring(2);
this._lastServerQuery=m.mixin({},d)}))}})})},"arcgisonline/sharing/dijit/DataGrid":function(){define(["dojo","dijit","dojox","dojo/require!dojox/grid/DataGrid"],function(m,n,v){m.provide("arcgisonline.sharing.dijit.DataGrid");m.require("dojox.grid.DataGrid");m.declare("arcgisonline.sharing.dijit.DataGrid",v.grid.DataGrid,{sort:function(){this.inherited(arguments);setTimeout(m.hitch(this,"update"),300)},_onFetchComplete:function(b,p){var f=!this._isLoaded;this.inherited(arguments);f&&this.update()}})})},
"arcgisonline/sharing/dijit/FeatureLayerQueryResult":function(){define("esri/main dojo/_base/declare dojo/Evented dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/DeferredList dojo/_base/array esri/IdentityManager".split(" "),function(m,n,v,b,p,f,d,a){var c=function(h){function l(k){h[k]||(h[k]=function(){var g=arguments;return f.when(h,function(e){Array.prototype.unshift.call(g,e.features||e);return c(p[k].apply(p,g))})})}if(!h)return h;h.then&&(h=b.delegate(h));h.total||(h.total=f.when(h,
function(k){return m._isDefined(k.total)?k.total:k.length||0}));l("forEach");l("filter");l("map");l("some");l("every");return h};b.setObject("arcgisonline.sharing.dijit.FeatureLayerQueryResult",c);return c})},"arcgisonline/sharing/dijit/FeatureLayerQueryStore":function(){define(["dojo","dijit","dojox","dojo/require!arcgisonline/sharing/dijit/FeatureLayerQueryResult"],function(m,n,v){m.provide("arcgisonline.sharing.dijit.FeatureLayerQueryStore");m.require("arcgisonline.sharing.dijit.FeatureLayerQueryResult");
m.declare("arcgisonline.sharing.dijit.FeatureLayerQueryStore",null,{queryUrl:"",idProperty:"id",data:[],constructor:function(b){m.mixin(this,b);this.layer=b.layer;this.objectIds=b.objectIds;this.where=b.where;this.orderByFields=b.orderByFields;this.totalCount=b.totalCount;this.batchCount=b.batchCount||25;this.idProperty=this.layer.objectIdField},get:function(b,p){return this.data[b]},getIdentity:function(b){return b[this.idProperty]},query:function(b,p){var f=new esri.tasks.Query,d=p.start||0,a=this.batchCount;
this.objectIds?f.objectIds=this.objectIds.length>=d+this.batchCount?this.objectIds.slice(d,d+a):this.objectIds.slice(d):(f.start=d,f.num=a,f.where=this.where,f.orderByFields=this.orderByFields);f.returnGeometry=!1;f.outFields=["*"];var c=this.totalCount;d=this.layer.queryFeatures(f);d.total=d.then(m.hitch(this,function(h){if(this.objectIds){var l=h.objectIdFieldName;if(!l)for(var k=0;k<h.fields.length;k++)if("esriFieldTypeOID"==h.fields[k].type){l=h.fields[k].name;break}var g={};for(k=0;k<h.features.length;k++)g[h.features[k].attributes[l]]=
h.features[k];h.features=m.map(f.objectIds,function(e){return g[e]})}for(k=0;k<h.features.length;k++)h.features[k]=h.features[k].attributes,this.data[h.features[k][l]]=h.features[k];h=h.features;return c}),function(){return 0});return arcgisonline.sharing.dijit.FeatureLayerQueryResult(d)}})})},"arcgisonline/sharing/dijit/OrganizationSetup":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/cookie dojo/debounce dojo/dom-attr dojo/dom-class dojo/dom-style dojo/on dijit/a11yclick dojo/string dojo/when dojox/html/entities dojo/io-query dojo/Deferred dojo/data/ItemFileReadStore dojo/store/Memory dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/form/Button dijit/form/CheckBox dijit/form/FilteringSelect dijit/form/TextBox dijit/layout/ContentPane dijit/Tooltip esri/lang esri/request esri/IdentityManager esri/arcgis/OAuthInfo ../../esriGeowConfig ../util ../../pages/pageUtil ../../pages/utils/culture ../../pages/utils/dom ../../pages/utils/signin ../../pages/utils/tooltips ../geow/Account ../geow/Geow ./dialog/GeneralDlg dojo/i18n!../../nls/arcgisonline dojo/text!./templates/OrganizationSetup.html".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x,t,w,z,B,A,y,E,G,F,D,L,O,S,Z,I,N,K,Q,da,U,aa,J,T,Y){return m("arcgisonline.sharing.dijit.OrganizationSetup",[x,t,w],{declaredClass:"arcgisonline.sharing.dijit.OrganizationSetup",templateString:Y,widgetsInTemplate:!0,DEFAULT_ACCOUNT_NAME:"My Account",ACCOUNT_ADMIN_ROLE:"account_admin",BROWSER_DEFAULT:"browser",ACCESS_DENIED_ERROR_PATH:"error.html?c\x3dAccessDenied",_user:null,_onlineDefaults:null,_settings:null,_validUrlKey:!1,_urlKeyAlreadySet:!1,_tooltips:[],
postMixInProperties:function(){this.inherited(arguments);this.i18n=n.mixin(T.common,T.organizationSetup);n.mixin(this.i18n,{usageTrackingDesc:T.myOrganization.generalTab.usageTrackingDesc,usageTrackingSetting:T.myOrganization.generalTab.usageTrackingSetting,allowArcgisOnlineToCollectInfo:T.usageTracking.allowArcgisOnlineToCollectInfo})},destroy:function(){this.inherited(arguments);this._tooltips.forEach(function(W){W&&W.destroyRecursive&&W.destroyRecursive()})},startup:function(){this.inherited(arguments);
var W=new q;Q.checkSignInStatus().then(function(R){R&&(S.userInfo={username:R.userId,credential:R,token:R.token});this._checkAccess(R);this._initHandlers();this._initImages();this._initRedirects();this._initLocalization();this._initTooltips();U.getSupportedLanguagesAndRegions().then(function(X){X&&(this._initLanguage(X.languages),this._initRegion(X.regions),this._loadOrganization())}.bind(this),this._handleError.bind(this));W.resolve()}.bind(this));return W},_handleError:function(W){},_showAlert:function(W,
R){var X=new J;c.once(X._dialog,"hide",function(){X._dialog.destroyRecursive();X.destroyRecursive()});X.show({title:W,message:R})},_urlContainsInvalidChars:function(W){return!W.match(/^[a-zA-Z0-9\-]*$/)},_handleUrlKeyCheck:function(W){!W||W.code||W.message?(this._validUrlKey=!1,this._clearUrlKeyStatus()):W.available?this._setGoodUrlKeyStatus(this.i18n.available):this._setBadUrlKeyStatus(this.i18n.unavailable)},_initHandlers:function(){var W=this.checkUrlKey.bind(this);this.own(h(this._sslCheckBox,
this.onSSLCheck.bind(this)),h(this._saveBtn,this.onSave.bind(this)),h(this._signOutBtn,this.onSignOut.bind(this)),c(this._urlKeyTextBox,"change",W),I.registerKeystrokeHandler(this._urlKeyTextBox,p(W,500)),c(this._languageSelect,"change",this.onLanguageChange.bind(this)))},_initImages:function(){this._orgNameImg&&f.set(this._orgNameImg,"src",Z.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-general-logo-name.png"));this._orgAbbrImg&&f.set(this._orgAbbrImg,"src",Z.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-general-logo-name.png"));
this._languageImg&&f.set(this._languageImg,"src",Z.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-language.png"));this._languageFormatImg&&f.set(this._languageFormatImg,"src",Z.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/helpIcon.png"));this._regionImg&&f.set(this._regionImg,"src",Z.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-region.png"));this._securityImg&&f.set(this._securityImg,"src",Z.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-security-https.png"));
this._linkImg&&f.set(this._linkImg,"src",Z.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb-links.png"));this._usageTrackingImg&&f.set(this._usageTrackingImg,"src",Z.relativeToExplicitUrl("js/arcgisonline/sharing/dijit/css/images/thumb_euei.png"))},_checkAccess:function(W){W?U.getSelf(function(R){S.userInfo&&(S.userInfo.credential=W,S.userInfo.token=W.token);this._user=R.user;this._user.orgId||this._user.role===this.ACCOUNT_ADMIN_ROLE||(window.location=S.baseUrl+this.ACCESS_DENIED_ERROR_PATH)}.bind(this),
function(R){}.bind(this)):this._showUser||Z.requireAuthentication()},_initRedirects:function(){this.redirectUrl=S.baseUrl+"index.html";this.orgRedirectUrl=S.baseUrl+"organization.html"},_initLocalization:function(){f.set(dojo.byId("item-title"),"innerHTML",this.i18n.setupYourOrg);this._sslCheckBoxLabel.innerHTML=l.substitute(this.i18n.securityDesc,{span:'\x3cspan id\x3d"sslTooltip" style\x3d"border-bottom: 1px dotted #487696;"\x3e',spanEnd:"\x3c/span\x3e"});f.set(this._linkTooltip,"innerHTML",l.substitute(this.i18n.contactUs,
{startSpan:'\x3cspan class\x3d"orgSettingTooltip"\x3e',endSpan:"\x3c/span\x3e"}));this._link.set("placeholder",this.i18n.contactUsExample)},_initTooltips:function(){this._tooltips.push(da.createTooltip("linkTooltip",this.i18n.contactUsTooltip));this._tooltips.push(da.createTooltip("sslTooltip",this.i18n.sslTooltip));this._tooltips.push(da.createTooltip("languageFormatTooltip",this.i18n.learnNumDateFormat))},_initLanguage:function(W){if(W){var R=[{culture:this.BROWSER_DEFAULT,displayName:this.i18n.browserDefaultSelection,
language:this.i18n.browserDefaultSelection,localizedName:this.i18n.browserDefaultSelection}];W.forEach(function(X){X=n.mixin({displayName:g.decode((X.localizedName?X.localizedName+" - ":"")+X.language+"\x26lrm;")},X);X.cultureFormats&&X.cultureFormats.length&&X.cultureFormats.forEach(function(ia){ia.displayName=g.decode((ia.localizedName?ia.localizedName+" - ":"")+ia.name+"\x26lrm;")});R.push(X)});W=new r({idProperty:"culture",label:"displayName",data:R});this._languageSelect.set("store",W);this._languageSelect.set("searchAttr",
"displayName")}},_initLanguageFormat:function(W,R){if(W&&W!==this.BROWSER_DEFAULT&&R&&R.length){var X=N.getSelectedFormat(this._settings.cultureFormat,R||[]),ia=new r({idProperty:"format",label:"displayName",data:R});this._languageFormatSelect.set("store",ia);this._languageFormatSelect.set("searchAttr","displayName");X?this._languageFormatSelect.set("displayedValue",X.displayName):this._languageFormatSelect.set("displayedValue",R[0].displayName);K.showNode(this._languageFormatContainer)}else K.hideNode(this._languageFormatContainer)},
_initRegion:function(W){W&&(W=new r({idProperty:"region",label:"localizedName",data:W}),this._regionSelect.set("store",W),this._regionSelect.set("searchAttr","localizedName"))},_loadOrganization:function(){D({url:Z.getSecureUrl(S.restBaseUrl)+"portals/self",content:{f:"json"}}).then(function(W){this._onlineDefaults=W;U.getSelf(function(R){if(!R||R.code||R.message)this._handleError(R);else{this._settings=R;this._settings.customBaseUrl=this._settings.customBaseUrl||this._onlineDefaults.customBaseUrl;
this._sslCheckBox.set("checked",!0);this._settings.name&&this.DEFAULT_ACCOUNT_NAME!==this._settings.name&&this._nameTextBox.set("value",this._settings.name);this._settings.urlKey?(this._urlKeyAlreadySet=this._validUrlKey=!0,this._settings.customBaseUrl?f.set(this._sampleUrlTextBox,"innerHTML","https://"+this._settings.urlKey+"."+this._settings.customBaseUrl):f.set(this._sampleUrlTextBox,"innerHTML",Z.getSecureUrl(S.baseUrl)),this._urlKeyTextBox.set("disabled",!0),this._urlKeyTextBox.set("value",this._settings.urlKey)):
(this._validUrlKey=!1,f.set(this._sampleUrlTextBox,"innerHTML",""));var X=this._languageSelect.get("store");this._settings.culture=N.getActualCulture(R.culture,X.query());X=(X=X.query({culture:R.culture||this.BROWSER_DEFAULT}).shift())?X.displayName:this.i18n.browserDefaultSelection;this._languageSelect.set("displayedValue",X);f.set(this._languageFormatHelpLink,"href",S.self.helpBase+(S.self.helpMap.m["120001487"]||""));(R=this._regionSelect.get("store").query({region:R.region}).shift())&&R.localizedName?
this._regionSelect.set("displayedValue",R.localizedName):this._regionSelect.set("value",S.self&&S.self.ipCntryCode||"WO");this._settings.portalProperties&&this._settings.portalProperties.links&&this._settings.portalProperties.links.contactUs&&(this._linkCheckBox.set("checked",!!this._settings.portalProperties.links.contactUs.visible),this._link.set("value",this._settings.portalProperties.links.contactUs.url));R=S.restBaseUrl.replace("http:","https:").replace("/rest/","/geoip.jsp");Z.getJson(R,this._setUsageTrackingCheckbox.bind(this),
this._setUsageTrackingCheckbox.bind(this))}}.bind(this))}.bind(this))},_setUsageTrackingCheckbox:function(W){this._usageTrackingCheckBox.set("checked",S.urlKey?!!this._settings.eueiEnabled:"US"===W.country)},_makeAuthorizeRequest:function(W){W={portalUrl:Q.getPortalUrl(),returnUrl:W,useLandingPage:!1,initialAdmin:!0};W={client_id:S.clientId||"arcgisonline",display:"default",response_type:"token",state:JSON.stringify(W),expiration:S.expiration||20160,locale:this._settings.culture?this._settings.culture.toLowerCase():
v.locale,redirect_uri:S.baseUrl.replace("http:","https:")+"accountswitcher-callback.html",force_login:!1,hideCancel:!0,showSignupOption:!1,canHandleCrossOrgSignIn:!0,signuptype:"esri",redirectToUserOrgUrl:!0};W=S.restBaseUrl.replace(/^http:/i,"https:")+"oauth2/authorize?"+e.objectToQuery(W);document.location.replace(W)},_handleUpdateAccount:function(W){if(!W||W.code||W.message)this._handleError(W),this._showAlert(this.i18n.errorTitle,this.i18n.errors.unableToSave),this._saveBtn.set("disabled",!1),
this._saveBtn.set("label",this.i18n.saveContinue);else if(this._settings.urlKey&&this._settings.customBaseUrl){W="https://"+this._settings.urlKey+"."+this._settings.customBaseUrl;var R=S.baseUrl.indexOf(location.host);W=-1<R?S.isDebug?S.baseUrl.replace("http:","https:")+"organization.html":W+(S.baseUrl.substring(R+location.host.length).replace("http:","https:")+"organization.html"):this.redirectUrl.replace("http:","https:");this._makeAuthorizeRequest(W)}else window.location="account_admin"!==user.role||
this._settings.urlKey?this.redirectUrl.replace("http:","https:"):this.orgRedirectUrl.replace("http:","https:")},_validates:function(){var W=this._nameTextBox.getValue(),R=this._link.get("value"),X=this._linkCheckBox.get("checked"),ia=this.i18n.errors.pleaseCorrect,ka=!1;W?(W=l.trim(W),0<W.length?-1<W.indexOf("\x3c")||-1<W.indexOf("\x3e")||-1<W.indexOf("%")?(ka=!0,ia+="\x3cbr\x3e"+this.i18n.errors.orgNameInvalidChars):55<W.length&&(ka=!0,ia+="\x3cbr\x3e"+this.i18n.errors.orgNameTooLong):(ka=!0,ia+=
"\x3cbr\x3e"+this.i18n.errors.orgNameRequired)):(ka=!0,ia+="\x3cbr\x3e"+this.i18n.errors.orgNameRequired);this._validUrlKey||(ka=!0,ia+="\x3cbr\x3e"+this.i18n.errors.urlKeyRequired);!X||esri.isDefined(R)&&0!==R.length||(ka=!0,ia+="\x3cbr\x3e"+this.i18n.errors.finishContactUsSetup);ka&&this._showAlert(this.i18n.errorTitle,ia);return!ka},_setGoodUrlKeyStatus:function(W){this._validUrlKey=!0;this._urlKeyStatusLabel.innerHTML=W;d.remove(this._urlKeyStatusLabel,"statusBad");d.add(this._urlKeyStatusLabel,
"statusGood")},_setBadUrlKeyStatus:function(W){this._validUrlKey=!1;this._urlKeyStatusLabel.innerHTML=W;d.remove(this._urlKeyStatusLabel,"statusGood");d.add(this._urlKeyStatusLabel,"statusBad")},_clearUrlKeyStatus:function(){this._urlKeyStatusLabel.innerHTML="";d.remove(this._urlKeyStatusLabel,"statusGood");d.remove(this._urlKeyStatusLabel,"statusBad")},checkUrlKey:function(){if(!this._urlKeyAlreadySet){var W=this._urlKeyTextBox.getValue(),R=this._handleUrlKeyCheck.bind(this);W&&(W=l.trim(W));W&&
0<W.length&&17>W.length?this._urlContainsInvalidChars(W)?this._setBadUrlKeyStatus(this.i18n.errors.urlKeyInvalidChars):"-"===W[0]||"-"===W[W.length-1]?this._setBadUrlKeyStatus(this.i18n.errors.urlKeyEndHyphen):(f.set(this._sampleUrlTextBox,"innerHTML","https://"+W+"."+this._settings.customBaseUrl),Z.getJson(S.restBaseUrl+"portals/isUrlKeyAvailable?urlKey\x3d"+W,R,R)):(this._validUrlKey=!1,f.set(this._sampleUrlTextBox,"innerHTML",""),W&&16<W.length?this._setBadUrlKeyStatus(this.i18n.urlKeyTooLong):
this._clearUrlKeyStatus())}},onLanguageChange:function(){var W=this._languageSelect.get("store").query({displayName:this._languageSelect.get("displayedValue")}).shift();W&&this._initLanguageFormat(W.culture,W.cultureFormats)},onSSLCheck:function(){var W=this._sslCheckBox.attr("checked");this._showAlert(this.i18n.warning,W?this.i18n.sslOnWarning:this.i18n.sslOffWarning)},onSave:function(){this._saveBtn.set("disabled",!0);this._saveBtn.set("label",this.i18n.saving);if(this._validates()){var W=this._handleUpdateAccount.bind(this),
R=this._nameTextBox.getValue(),X=this._urlKeyTextBox.getValue(),ia=this._sslCheckBox.attr("checked");this._settings.name=l.trim(R);this._settings.urlKey=l.trim(X);this._settings.allSSL=ia;R=(X=this._languageSelect.get("store").query({displayName:this._languageSelect.get("displayedValue")}).shift())&&X.culture?X.culture:this.BROWSER_DEFAULT;this._settings.culture=R===this.BROWSER_DEFAULT?"":R;X&&X.cultureFormats?(X=(X=this._languageFormatSelect.get("store").query({displayName:this._languageFormatSelect.get("displayedValue")}).shift())&&
X.format?X.format:void 0)?(this._settings.culture=R+"-"+X,this._settings.cultureFormat=X):this._settings.cultureFormat="":this._settings.cultureFormat="";R=this._regionSelect.get("store").query({localizedName:this._regionSelect.get("displayedValue")}).shift();this._settings.region=R&&R.region||"";this._settings.portalProperties=this._settings.portalProperties||{};this._settings.portalProperties.mustWelcome=!0;this._settings.portalProperties.links=this._settings.portalProperties.links||{};R=this._link.get("value");
F.isDefined(R)&&0<R.length?(0!==R.indexOf("http")&&0!==R.indexOf("mailto:")&&0<R.indexOf("@")?R="mailto:"+R:0!==R.indexOf("http")&&0>R.indexOf("mailto:")&&0>R.indexOf("@")&&(R="http://"+R),this._settings.portalProperties.links.contactUs={url:R,visible:!!this._linkCheckBox.get("checked")}):delete this._settings.portalProperties.links.contactUs;this._settings.eueiEnabled=this._usageTrackingCheckBox.checked;this._settings.basemapGalleryGroupQuery=null;this._settings.colorSetsGroupQuery=null;this._settings.defaultBasemap=
null;this._settings.defaultExtent=null;this._settings.featuredGroups=null;this._settings.featuredGroupsId=null;this._settings.featuredItemsGroupQuery=null;this._settings.homePageFeaturedContent=null;this._settings.layerTemplatesGroupQuery=null;this._settings.rotatorPanels=null;this._settings.symbolSetsGroupQuery=null;this._settings.templatesGroupQuery=null;this._settings.contacts=this._settings.contacts||[];U.updateAccount(this._settings,W,W)}else this._saveBtn.set("disabled",!1),this._saveBtn.set("label",
this.i18n.saveContinue)},onSignOut:function(){b("esri_webmap","",{expires:-1,path:"/"});var W=this.allSSL?Z.getSecureUrl():Z.getHttpUrl();aa.signout(W+"index.html")}})})},"arcgisonline/pages/utils/culture":function(){define(["require","exports","tslib","dojo/string","dojo/_base/kernel"],function(m,n,v,b,p){b=v.__importDefault(b);p=v.__importDefault(p);return function(){function f(){}f.getString=function(d,a,c){var h,l="id ja ko th vi zh-cn zh-hk zh-tw".split(" "),k="en ca da de el es et fi hi hu it nb nl pt-pt sv tr".split(" "),
g=null!==(h=f.getRootLocale(p["default"].locale))&&void 0!==h?h:"en";c?c.number=a:c={number:a};return 1===a||-1<l.indexOf(g)?b["default"].substitute(d.single,c):1!==a&&-1<k.indexOf(g)?b["default"].substitute(d.multiple,c):b["default"].substitute(d.unknown,c)};f.stripCultureFormat=function(d,a){if((null===d||void 0===d?0:d.length)&&(null===a||void 0===a?0:a.length)){var c=d.indexOf("-"+a);if(-1<c)return d.substring(0,c)}return d};f.getRootLocale=function(d){if(null===d||void 0===d?0:d.length){d=d.split("-")[0];
if(null===d||void 0===d?0:d.length)d=d.toLowerCase();return d}return d};f.getLocaleFormat=function(d){if(null===d||void 0===d?0:d.length)if(d=d.split("-"),1<d.length)return d[1].toLowerCase()};f.getTrialLocale=function(d){var a=["pt-br","pt-pt","zh-cn","zh-hk","zh-tw"];return-1<(null===d||void 0===d?void 0:d.indexOf("-"))&&-1===a.indexOf(d)?this.getRootLocale(d):d};f.getActualCulture=function(d,a){var c,h=null!==(c=null===d||void 0===d?void 0:d.toLowerCase())&&void 0!==c?c:"",l=h.split("-");if(1<
l.length){var k=a.filter(function(g){return g.culture===h}).shift();if(k)return h;k=a.filter(function(g){return g.culture===l[0]}).shift();if(null===k||void 0===k?0:k.cultureFormats){if(c=k.cultureFormats.filter(function(g){return g.format===l[1]}).shift())return k.culture}else if(k)return k.culture}return d};f.getSelectedFormat=function(d,a){return a.filter(function(c){return c.format===d}).shift()};f.getPercentString=function(d){var a=p["default"].locale.toLowerCase();return"ar"===a?"%"+100*d:d.toLocaleString(a,
{style:"percent"})};return f}()})},"arcgisonline/sharing/dijit/Troubleshoot":function(){define(["dojo","dijit","dojox","dojo/i18n!arcgisonline/nls/arcgisonline","dojo/require!dijit/_Widget,dijit/_Templated,dijit/layout/ContentPane,arcgisonline/sharing/util,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/pages/dijit/PasswordStrength"],function(m,n,v){m.provide("arcgisonline.sharing.dijit.Troubleshoot");m.require("dijit._Widget");m.require("dijit._Templated");m.require("dijit.layout.ContentPane");
m.require("arcgisonline.sharing.util");m.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");m.require("arcgisonline.pages.dijit.PasswordStrength");m.requireLocalization("arcgisonline","arcgisonline");m.declare("arcgisonline.sharing.dijit.Troubleshoot",[n._Widget,n._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv dojoAttachPoint\x3d"containerNode" class\x3d"esriItemLinks troubleshoot"\x3e\r\n        \x3cdiv class\x3d"subnav"\x3e\r\n          \x3cdiv class\x3d"container"\x3e\r\n            \x3ch1 class\x3d"padding-leader-half padding-trailer-half text-white"\x3e${i18n.troubleshootTitle}\x3c/h1\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"respond"\x3e\r\n        \x3cp id\x3d"instructions"\x3e${i18n.instructions}\x3c/p\x3e\r\n         \x3cdiv data-dojo-attach-point\x3d"_stackContainer" class\x3d"newStyles"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"forgotUsername" class\x3d"contentPane"\x3e\r\n              \x3ch2\x3e${i18n.forgotUsername}\x3c/h2\x3e\r\n              \x3cp\x3e${!i18n.forgotUsernameInstructions}\x3c/p\x3e\r\n              \x3clabel class\x3d"esriFloatLeading" for\x3d"email"\x3e${i18n.emailLabel}\x26nbsp;\x3c/label\x3e\r\n              \x3cinput id\x3d"email" data-dojo-attach-point\x3d"_email" name\x3d"email" data-dojo-type\x3d"dijit/form/ValidationTextBox" trim\x3d"true"/\x3e\r\n              \x3cbr /\x3e\r\n              \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-attach-event\x3d"onClick:_submitEmail" class\x3d"esriFloatLeading calcite blue"\x3e${i18n.send}\x3c/button\x3e\r\n              \x3cbr/\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"forgotPassword" class\x3d"contentPane"\x3e\r\n              \x3ch2\x3e${i18n.forgotPassword}\x3c/h2\x3e\r\n              \x3cp\x3e${!i18n.forgotPasswordInstructions}\x3c/p\x3e\r\n              \x3clabel class\x3d"esriFloatLeading" for\x3d"username"\x3e${i18n.usernameLabel}\x26nbsp;\x3c/label\x3e\r\n              \x3cinput id\x3d"username" name\x3d"userName" data-dojo-attach-point\x3d"_userName" data-dojo-type\x3d"dijit/form/ValidationTextBox" trim\x3d"true"/\x3e\r\n              \x3cbr /\x3e\r\n              \x3cbutton data-dojo-attach-event\x3d"onClick:_submitUsername" data-dojo-type\x3d"dijit/form/Button" class\x3d"esriFloatLeading calcite blue"\x3e${i18n.customRoles.continueLabel}\x3c/button\x3e\r\n              \x3cbr /\x3e\r\n          \x3c/div\x3e\r\n         \x3cdiv class\x3d"contentPane newStyles" dojoAttachPoint\x3d"changePassword" style\x3d"display:none;"\x3e\r\n             \x3ch2\x3e${i18n.resetPassword}\x3c/h2\x3e\r\n             \x3cp dojoAttachPoint\x3d"_securityQuestionInstructions" class\x3d"securityQuestion"\x3e${i18n.securityQuestionInstructions}\x3c/p\x3e\r\n             \x3clabel class\x3d"securityQuestion esriFloatLeading" dojoAttachPoint\x3d"_securityQuestion"\x3e\x3c/label\x3e\r\n             \x3cinput dojoAttachPoint\x3d"_securityAnswer" name\x3d"answer" dojoType\x3d"dijit.form.ValidationTextBox" trim\x3d"true" class\x3d"ieFix securityQuestion" /\x3e\r\n             \x3cdiv class\x3d"prompt securityQuestion"\x3e${i18n.securityQuestionPrompt}\x3c/div\x3e\r\n             \x3cdiv class\x3d"portal-only" style\x3d"display:none;"\x3e\r\n                 \x3cbr/\x3e\r\n                 \x3cp\x3e${i18n.enterNewPassword}\x3c/p\x3e\r\n                 \x3cdiv class\x3d"password-1"\x3e\r\n                     \x3cspan\x3e\x3clabel for\x3d"password"\x3e${i18n.newPasswordLabel}\x3c/label\x3e\r\n                      \x3cinput id\x3d"password" dojoAttachPoint\x3d"_newPassword" name\x3d"password" dojoAttachEvent\x3d"onKeyUp:isValidPassword" class\x3d"required" dojoType\x3d"dijit.form.TextBox" type\x3d"password" trim\x3d"true"\x3e\r\n                      \x3cdiv class\x3d"strength-meter"\x3e\r\n                        \x3cdiv data-dojo-attach-point\x3d"_strengthMeter"\x3e\x3c/div\x3e\r\n                        \x3cdiv class\x3d"input-error-message" data-dojo-attach-point\x3d"_passwordError"\x3e\x3c/div\x3e\r\n                      \x3c/div\x3e\r\n                    \x3c/span\x3e\r\n                 \x3c/div\x3e\r\n                 \x3cbr /\x3e\r\n                 \x3cdiv class\x3d"password-2"\x3e\r\n                     \x3clabel class\x3d"left"\x3e${i18n.reenterPasswordLabel}\x3c/label\x3e\r\n                     \x3cinput name\x3d"verify" dojoAttachPoint\x3d"_verifyPassword" type\x3d"password" dojotype\x3d"dijit.form.ValidationTextBox" trim\x3d"true"/\x3e\r\n                 \x3c/div\x3e\r\n             \x3c/div\x3e\r\n             \x3cbutton dojoAttachEvent\x3d"onClick:_submitReset" dojoType\x3d"dijit.form.Button" class\x3d"calcite blue esriFloatLeading indentBtn" style\x3d"margin-left: 205px;"\x3e${i18n.mosaicRulePanel.resetLabel}\x3c/button\x3e\r\n         \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"mfaHelp" class\x3d"contentPane"\x3e\r\n             \x3cbr /\x3e\r\n             \x3ch2\x3e${i18n.mfaHelpMsg}\x3c/h2\x3e\r\n             \x3cp\x3e${!i18n.mfaHelpInstructions}\x3c/p\x3e\r\n             \x3clabel class\x3d"esriFloatLeading" for\x3d"username"\x3e${i18n.usernameLabel}\x26nbsp;\x3c/label\x3e\r\n             \x3cinput id\x3d"mfa_username" name\x3d"userName" data-dojo-attach-point\x3d"_mfaUserName" data-dojo-type\x3d"dijit/form/ValidationTextBox" trim\x3d"true"/\x3e\r\n             \x3cbr /\x3e\r\n             \x3cbutton data-dojo-attach-event\x3d"onClick:_submitMfaUsername" data-dojo-type\x3d"dijit/form/Button" class\x3d"esriFloatLeading calcite blue"\x3e${i18n.customRoles.continueLabel}\x3c/button\x3e\r\n             \x3cbr /\x3e\r\n          \x3c/div\x3e\r\n         \x3cdiv class\x3d"contentPane newStyles" dojoAttachPoint\x3d"disableMfa" style\x3d"display:none;clear:both;"\x3e\r\n             \x3cbr /\x3e\r\n             \x3ch2\x3e${i18n.mfaSecurityQuestionTitle}\x3c/h2\x3e\r\n             \x3cp class\x3d"securityQuestion"\x3e${i18n.mfaSecurityQuestionMsg}\x3c/p\x3e\r\n             \x3clabel class\x3d"mfaSecurityQuestion esriFloatLeading" dojoAttachPoint\x3d"_mfaSecurityQuestion"\x3e\x3c/label\x3e\r\n             \x3cinput dojoAttachPoint\x3d"_mfaSecurityAnswer" name\x3d"answer" dojoType\x3d"dijit.form.ValidationTextBox" trim\x3d"true" class\x3d"ieFix securityQuestion" /\x3e\r\n             \x3cdiv class\x3d"prompt mfaSecurityQuestion"\x3e${i18n.securityQuestionPrompt}\x3c/div\x3e\r\n             \x3cbutton dojoAttachEvent\x3d"onClick:_submitMfaReset" dojoType\x3d"dijit.form.Button" class\x3d"calcite blue esriFloatLeading indentBtn" style\x3d"margin-left: 205px;"\x3e${i18n.send}\x3c/button\x3e\r\n         \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"register" title\x3d"${i18n.links.register}" style\x3d"display:none;"\x3e\r\n            \x3cp class\x3d"marginless"\x3e\x3cb\x3e${i18n.signInWidget.agsTrial}\x3c/b\x3e\x3c/p\x3e\r\n            \x3cp\x3e${i18n.signInWidget.agsSubscriptionInfo}\x3c/p\x3e\r\n            \x3ca class\x3d"calcite btn small blue" href\x3d"/about/free-trial.html?origin\x3darcgis"\x3e${i18n.signInWidget.ags30DayTrial}\x3c/a\x3e\x3cbr/\x3e\r\n            \x3cp\x3e\x3cb\x3e${i18n.signInWidget.agsNoTrial}\x3c/b\x3e\x3c/p\x3e\r\n            \x3cp\x3e${i18n.signInWidget.agsCreatePersonalMsg}.\x3c/p\x3e\r\n            \x3cp\x3e${i18n.signInWidget.agsHavePersonal}\x3c/p\x3e\r\n            \x3ca id\x3d"registerBtn" class\x3d"calcite btn small light"\x3e${i18n.signInWidget.agsRegisterPersonalBtn}\x3c/a\x3e\x3cbr/\x3e\r\n            \x3cp\x3e${i18n.signInWidget.agsCreatePersonal}\x3c/p\x3e\r\n            \x3ca id\x3d"createBtn" class\x3d"calcite btn small light"\x3e${i18n.signInWidget.agsCreatePersonalBtn}\x3c/a\x3e\r\n          \x3c/div\x3e\r\n          \x3cbr /\x3e\r\n          \x3cp data-dojo-attach-point\x3d"gotoStart" class\x3d"indent notstart" style\x3d"display:none;"\x3e${i18n.otherQuestions}\x26nbsp;\x26nbsp;\x3ca target\x3d"_blank" data-dojo-attach-event\x3d"onclick:_troubleshoot"\x3e${i18n.seeTroubleshooting}\x3c/a\x3e\x3c/p\x3e\r\n      \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cbr /\x3e\r\n      \x3cbr /\x3e\r\n\x3c/div\x3e\r\n',
baseClass:"esriTroubleshoot",_util:arcgisonline.sharing.util,_account:arcgisonline.sharing.geow.Account,postMixInProperties:function(){this.inherited(arguments);m.mixin(this,m.queryToObject(window.location.search.slice(1)));if(this.returnUrl){var b=window.location.host.split(".").slice(-2).join(".")+"/";-1===this.returnUrl.indexOf(b)&&-1===this.returnUrl.indexOf("arcgis.com/")&&-1===this.returnUrl.indexOf("esri.com/")&&(this.returnUrl=null)}this.i18n=m.mixin({},m.i18n.getLocalization("arcgisonline",
"arcgisonline").common);m.mixin(this.i18n,m.i18n.getLocalization("arcgisonline","arcgisonline").troubleshoot);m.mixin(this.i18n,{customRoles:m.i18n.getLocalization("arcgisonline","arcgisonline").customRoles});m.mixin(this.i18n,{mosaicRulePanel:m.i18n.getLocalization("arcgisonline","arcgisonline").mosaicRulePanel});m.mixin(this.i18n,m.i18n.getLocalization("arcgisonline","arcgisonline").newUser);m.mixin(this.i18n,{signInWidget:m.i18n.getLocalization("arcgisonline","arcgisonline").signInWidget});this.i18n.errors=
m.mixin(m.i18n.getLocalization("arcgisonline","arcgisonline").common.errors,m.i18n.getLocalization("arcgisonline","arcgisonline").troubleshoot.errors,m.i18n.getLocalization("arcgisonline","arcgisonline").newUser.errors);this.i18n.questions=m.mixin(m.i18n.getLocalization("arcgisonline","arcgisonline").securityQuestions,{0:this.i18n.questions.question0})},startup:function(){this.inherited(arguments);this._connects=[];esri.config.defaults.io.proxyUrl=esriGeowConfig.proxyServer;this._errorDlg=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();
this._svcUrl=esriGeowConfig.restBaseUrl+(esriGeowConfig.restBaseUrl.lastIndexOf("/")===esriGeowConfig.restBaseUrl.length-1?"":"/");this._communityUrl=this._svcUrl+"community/";this._userUrl=this._communityUrl+"users/";this._requestParams={f:"json"};this._createStrengthMeter();this.connect(m.byId("registerBtn"),"onclick",m.hitch(this,function(){window.location=esriGeowConfig.signup}));this.connect(m.byId("createBtn"),"onclick",m.hitch(this,function(){window.location=esriGeowConfig.createAccount}));
this.connect(this._stackContainer,"onClick",m.hitch(this,function(){m.style(this.changePassword,"display","none")}));this._account.getSelf(m.hitch(this,function(b){this.portalSelf=b;this._initHelpMgr();this._troubleshoot()}))},destroy:function(){this.inherited(arguments);m.forEach(this._connects,m.disconnect)},_initHelpMgr:function(){var b=arcgisonline.sharing.dijit.HelpManager.prototype.statics.getInstance(),p=setInterval(m.hitch(this,function(){if(b.isLoaded())if(clearInterval(p),esriGeowConfig&&
esriGeowConfig.self&&esriGeowConfig.self.isPortal)m.query(".helpLink").forEach(esri.hide),m.query("#instructions").forEach(function(d){m.style(d,"visibility","hidden")});else{var f=b.getHelpUrl("120000466");m.query(".helpLink").attr("href",f)}}),200)},_createStrengthMeter:function(){this._account.getSelf(function(b){this._strengthMeter=new arcgisonline.pages.dijit.PasswordStrength({portal:esriGeowConfig.self},this._strengthMeter);this._strengthMeter.update()}.bind(this))},isValidPassword:function(){var b=
this._newPassword.get("value");return this._strengthMeter.update(b).then(function(p){p=p.isValid;this._showInvalidPasswordError(p);return p}.bind(this))},_showInvalidPasswordError:function(b){b?m.addClass(this._passwordError,"hide"):(m.attr(this._passwordError,"innerHTML",this.i18n.passwordHintText),m.removeClass(this._passwordError,"hide"))},_switchPane:function(b){},_forgotPassword:function(){m.attr(this._forgotPasswordTitle,"innerHTML",this.i18n.forgotPassword);this._switchPane(this.forgotPassword);
this._userName.focus()},_changePassword:function(){m.attr(this._forgotPasswordTitle,"innerHTML",this.i18n.resetPassword);this._switchPane(this.forgotPassword);this._userName.focus()},_forgotUsername:function(){this._switchPane(this.forgotUsername);this._email.focus()},_troubleshoot:function(){var b=this.portalSelf||{};!1===esriGeowConfig.showForgotUsername&&this._stackContainer.removeChild(this.forgotUsername);this.isPortal=b&&b.isPortal;b&&(b.isPortal||b.urlKey)&&(this._stackContainer.removeChild(this.register),
this.isPortal&&(m.query(".portal-only").forEach(esri.show),m.attr(this._securityQuestionInstructions,"innerHTML",this.i18n.securityQuestionInstructionsNoEmail),this._stackContainer.removeChild(this.mfaHelp)));this._clear();this._securityQuestionIdx=-1;this._switchPane(this._start)},_redirectToSignin:function(){window.location=this.returnUrl||"signin.html"},_submitEmail:function(b){b.preventDefault();if(!this._checkRequired([this._email]))return b=this._communityUrl+"forgotUsername",this._disable(!0),
this._request(b,{email:this._getCleanString(this._email)}).then(m.hitch(this,function(){this._redirectToSignin()}))},_submitUsername:function(b){b.preventDefault();this._newPassword.set("value","");this._verifyPassword.set("value","");if(!this._checkRequired([this._userName]))return b=this._userUrl+this._getCleanString(this._userName)+"/forgotPassword",this._disable(!0),this._request(b,{}).then(m.hitch(this,function(p){p=p||{};"arcgis"===p.provider?(this._securityQuestionIdx=(-1===p.securityQuestionIdx?
0:p.securityQuestionIdx)||0,m.attr(this._securityQuestion,"innerHTML",this.i18n.questions[p.securityQuestionIdx]),this._securityQuestionIdx||this._showError(this.i18n.errors[this.isPortal?"noSecurityPortal":"noSecurity"]),m.query(".securityQuestion",this.domNode).style("display",""),m.style(this.changePassword,"display",this._securityQuestionIdx?"":"none"),this._securityAnswer.focus()):"enterprise"===p.provider?this._showError(this.i18n.errors.administrator):(this._isEcas=!0,m.query(".securityQuestion",
this.domNode).style("display","none"),m.style(this.changePassword,"display",""))}))},_getCleanString:function(b){b=b.get("value")||"";return(new DOMParser).parseFromString(b,"text/html").body.textContent||""},_submitMfaUsername:function(b){b.preventDefault();if(!this._checkRequired([this._mfaUserName]))return b=this._userUrl+this._getCleanString(this._mfaUserName)+"/forgotPassword",this._disable(!0),this._mfaUserNameCheck=!0,this._request(b,{}).then(m.hitch(this,function(p){p=p||{};this._securityQuestionIdx=
(-1===p.securityQuestionIdx?0:p.securityQuestionIdx)||0;m.attr(this._mfaSecurityQuestion,"innerHTML",this.i18n.questions[p.securityQuestionIdx]);this._securityQuestionIdx||this._showError(this.i18n.errors.noSecurity);m.query(".disableMfa",this.domNode).style("display","");m.style(this.disableMfa,"display",this._securityQuestionIdx?"":"none");this._mfaSecurityAnswer.focus()}))},_submitMfaReset:function(b){b.preventDefault();b={securityAnswer:this._getCleanString(this._mfaSecurityAnswer),securityQuestionIdx:this._securityQuestionIdx};
if(!this._checkRequired([this._mfaSecurityAnswer])){var p=this._util.getSecureUrl(this._userUrl)+this._mfaUserName.get("value")+"/disableMfaRequest";this._disable(!0);return this._request(p,b).then(m.hitch(this,function(f){var d=m.connect(this._errorDlg,"onHide",m.hitch(this,function(){d.remove();this._redirectToSignin()}));this._showError(this.i18n.errors.mfaEmailSent)}))}},_submitReset:function(b){b.preventDefault();var p={securityAnswer:this._getCleanString(this._securityAnswer),securityQuestionIdx:this._securityQuestionIdx};
if(this.isPortal){b=[this._newPassword,this._verifyPassword];this._isEcas||b.unshift(this._securityAnswer);if(this._checkRequired(b))return;if(this._newPassword.get("value")!==this._verifyPassword.get("value"))return this._verifyPassword.focus(),this._showError(this.i18n.errors.passwordsNotMatch);p.newPassword=this._newPassword.get("value")}else{b=[this._securityAnswer];if(this._checkRequired(b))return;p.email=!0}if(this.isPortal)this.isValidPassword().then(function(f){if(f)return this._makeResetRequest(p);
this._newPassword.focus();return!this._showError(m.mixin(this.i18n.errors.invalidPassword,{message:this.i18n.passwordHintText}))}.bind(this));else return this._makeResetRequest(p)},_makeResetRequest:function(b){var p=this._util.getSecureUrl(this._userUrl)+this._userName.get("value")+"/reset";this._disable(!0);return this._request(p,b).then(m.hitch(this,function(f){if(this.isPortal)this._redirectToSignin();else{var d=m.connect(this._errorDlg,"onHide",m.hitch(this,function(){d.remove();this._redirectToSignin()}));
this._showError(this.i18n.errors.emailSent)}}))},_disable:function(b){m.query(".esriTroubleshoot .dijitTextBox, .esriTroubleshoot .dijitButton").map(n.byNode).forEach(function(p){p.set("disabled",b)})},_clear:function(){m.query(".esriTroubleshoot .dijitTextBox").map(n.byNode).forEach(function(b){b.set("value","")})},_checkRequired:function(b){return(b=m.filter(b,m.hitch(this,function(p){return this._isEmpty(p)})))&&b.length?(b[0].focus(),this._showError(this.i18n.errors.required[b[0].name])):!1},
_isEmpty:function(b){b=b.get("value");return(this.trim?/^\s*$/:/^$/).test(b)},_request:function(b,p){return this._util.request({url:b,content:p},{usePost:!0}).then(m.hitch(this,function(f){this._mfaUserNameCheck=!1;this._disable(!1);return f.error?this._showError(f.error):f}),m.hitch(this,function(f){this._disable(!1);f&&"COM_0018"===f.messageCode&&this._userName?(f=this._mfaUserNameCheck?this._getCleanString(this._mfaUserName):this._getCleanString(this._userName),f={message:esri.substitute({username:f},
this.i18n.errors.COM_0018)}):f&&"COM_0049"===f.messageCode?f={message:this.i18n.errors.COM_0049.message}:f&&"COM_1037"===f.messageCode?f={message:this.i18n.errors.COM_1037}:f&&"COM_1059"===f.messageCode?f={message:this.i18n.errors.COM_1059}:f&&"COM_1055"===f.messageCode?f={message:this.i18n.errors.COM_1055}:f&&"DB_0003"===f.messageCode?f={message:this.i18n.errors.DB_0003}:f&&"DB_0002"===f.messageCode&&(f={message:this.i18n.errors.DB_0002});this._showError(f);this._mfaUserNameCheck=!1;throw f;}))},
_showError:function(b){b.message=b.message&&b.message.replace(/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi,"")||"";b.message=this._util.stripHTML(b.message);b=b.error||b||{};b.code=b.code||0;b=m.mixin(m.mixin({},this.i18n.errors.error),b);this._errorDlg.show(b);return!0}})})},"arcgisonline/sharing/dijit/dialog/ExportDlg":function(){define("require exports tslib ../../../esriGeowConfig ../../../pages/pageUtil ../../../pages/utils/categories ../../../pages/utils/dom ../../util ../SaveItem ./GeneralDlg ../../../tsutils/declareDecorator dijit/a11yclick dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Deferred dojo/promise/all dojo/string dojo/on dojo/topic esri/config esri/lang esri/Evented dojo/i18n!../../../nls/arcgisonline dojo/text!./templates/ExportDlg.html ../ComboBox".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x,t,w,z,B,A,y,E){b=v.__importDefault(b);p=v.__importDefault(p);f=v.__importDefault(f);d=v.__importDefault(d);a=v.__importDefault(a);c=v.__importDefault(c);h=v.__importDefault(h);l=v.__importDefault(l);k=v.__importDefault(k);g=v.__importDefault(g);e=v.__importDefault(e);q=v.__importDefault(q);u=v.__importDefault(u);r=v.__importDefault(r);x=v.__importDefault(x);t=v.__importDefault(t);w=v.__importDefault(w);z=v.__importDefault(z);B=v.__importDefault(B);A=v.__importDefault(A);
y=v.__importDefault(y);E=v.__importDefault(E);var G;(function(F){F.ShapeFile="Shapefile";F.CSV="CSV";F.FileGDB="File Geodatabase";F.GeoJson="GeoJson";F.FeatureCollection="Feature Collection";F.KML="KML";F.Excel="Excel"})(G||(G={}));return function(){function F(){this.declaredClass="arcgisonline.sharing.dijit.dialog.ExportDlg";this.widgetsInTemplate=!0;this.templateString=E["default"];this.layerId=-1;this.init=!1;this.checkStatusInterval=null;this.checkingStatus=!1;this.statusCheckIntervalTime=4E3;
this.typeLookup={shapefileType:G.ShapeFile,csvType:G.CSV,fileGDB:G.FileGDB,geoJson:G.GeoJson,featureCollection:G.FeatureCollection,kmlType:G.KML,excelType:G.Excel,CSV:"CSV Collection",KML:"KML Collection",Excel:"Microsoft Excel"};this.requiredBorder="1px dotted orangered";this.normalBorder="1px solid #bbb"}F.prototype.onDone=function(D){};F.prototype.postMixInProperties=function(){this.inherited(arguments);this.i18n=v.__assign(v.__assign(v.__assign({},y["default"].common),y["default"].exportDlg),
{generalize:y["default"].addLayerFromFileDlg.generalize,keepOrig:y["default"].addLayerFromFileDlg.keepOrig});this._webMercatorValues={3857:1,102113:1,102100:1,900913:1}};F.prototype.postCreate=function(){this.inherited(arguments);this.init||(this.init=!0,this.saveItem=new c["default"]({},this.saveItemForm))};F.prototype.startup=function(){this.inherited(arguments);z["default"].defaults.io.proxyUrl=b["default"].proxyServer;b["default"].proxyUrl&&(z["default"].defaults.io.proxyUrl=b["default"].proxyUrl)};
F.prototype.destroy=function(){this._onSaveItemValidateHandle&&(this._onSaveItemValidateHandle.remove(),this._onSaveItemValidateHandle=null);this.exportDialog.destroyRecursive();this.exportDialog=null;this.inherited(arguments)};F.prototype.show=function(D,L,O){this.showDlg(D,L,O)};F.prototype.showShapefile=function(D,L){this.showDlg(D,L,G.ShapeFile)};F.prototype.showCSV=function(D,L){this.showDlg(D,L,G.CSV)};F.prototype.showFileGDB=function(D,L){this.showDlg(D,L,G.FileGDB)};F.prototype.showGeoJson=
function(D,L){this.showDlg(D,L,G.GeoJson)};F.prototype.showFeatureCollection=function(D,L){this.showDlg(D,L,G.FeatureCollection)};F.prototype.showDlg=function(D,L,O){this.clear();this.item=D;this.setDialogTitle(O);this.setLayerDetails(L);this.checkForStaleData(D,L);this.initTags();this.initCategories();this.exportDialog.show();D=this.onCancel.bind(this);this.own(k["default"](this.exportDialog.closeButtonNode,D),t["default"](this.cancelBtn,"click",D),t["default"](this.exportBtn,"click",this.onExport.bind(this)));
this.exportDialog.closeButtonNode.tabIndex=0};F.prototype.checkForStaleData=function(D,L){var O,S,Z,I;(null===(O=D.layers)||void 0===O?0:O.length)&&"Feature Service"===D.type&&-1<D.typeKeywords.indexOf("Hosted Service")&&(L&&!L.length?I=null===(S=L.editingInfo)||void 0===S?void 0:S.lastEditDate:D.layers.forEach(function(N){var K;(Z=null===(K=N.editingInfo)||void 0===K?void 0:K.lastEditDate)&&(!I||I<Z)&&(I=Z)}))};F.prototype.initTags=function(){var D=this;this.saveItem.loadTags().then(function(){D.saveItem.set("tags",
[])})};F.prototype.initCategories=function(){this.saveItem.loadCategories(this.item.categories)};F.prototype.setDialogTitle=function(D){this.exportType=D;D=this.i18n.exportDialogTitle;G.ShapeFile===this.exportType?D=D+" "+this.i18n.toShapefile:G.CSV===this.exportType?D=D+" "+this.i18n.toCSV:G.FileGDB===this.exportType?D=D+" "+this.i18n.toFileGDB:G.GeoJson===this.exportType?D=D+" "+this.i18n.toGeoJson:G.FeatureCollection===this.exportType?D=D+" "+this.i18n.toFeatureCollection:G.KML===this.exportType?
D=D+" "+this.i18n.toKML:G.Excel===this.exportType&&(D=D+" "+this.i18n.toExcel);this.exportDialog.set("title",D)};F.prototype.setLayerDetails=function(D){var L,O,S,Z;this._isTableLayer=this._isWebMercator=!1;D&&B["default"].isDefined(D.id)?(this.layerId=D.id,this._layers=[D],this.saveItem.set("title",D.name),this._isWebMercator=(null===(O=null===(L=D.extent)||void 0===L?void 0:L.spatialReference)||void 0===O?void 0:O.wkid)in this._webMercatorValues,this._extent=D.extent):D&&D.length&&(this._layers=
D,this._isWebMercator=(null===(Z=null===(S=D[0].extent)||void 0===S?void 0:S.spatialReference)||void 0===Z?void 0:Z.wkid)in this._webMercatorValues,this._isTableLayer=D.every(function(I){return"Table"===I.type}),this._extent=D[0].extent,this.saveItem.set("title",1===D.length?D[0].name:this.item.title));this._isWebMercator&&!this._isTableLayer&&this.exportType===G.FeatureCollection&&(this.featureCollectionDiv.classList.remove("hide"),this.generalizeChk.checked=!0)};F.prototype.clear=function(){this.exportDialog.set("title",
this.i18n.exportDialogTitle);this.item=null;this.layerId=-1;this.checkStatusInterval=this.exportResponse=this.exportType=null;this.checkingStatus=!1;this.saveItem.set("title","");this.saveItem.set("tags",[]);this.saveItem.set("summary","");this.saveItem.set("requires",["title"]);this.exportingLabel.style.visibility="hidden";this.exportBtn.disabled=!0;this._onSaveItemValidateHandle=w["default"].subscribe("onSaveItemValidate",this.validate.bind(this));this.saveItem.hideRow("folder");d["default"].forEachNode(this.saveItem.domNode.querySelectorAll(".select2-container.select2-container-multi"),
function(D){D.style.minWidth="33px"});this.featureCollectionDiv.classList.add("hide");this.generalizeChk.checked=!1};F.prototype.hide=function(){return this.exportDialog.hide()};F.prototype.validate=function(D){D=this.saveItem.get("title");this.exportBtn.disabled=!D};F.prototype.validates=function(){return!!this.saveItem.get("title")};F.prototype.setWait=function(){this.exportDialog.domNode.style.cursor="wait";this.exportingLabel.style.visibility="visible";this.exportBtn.disabled=!0};F.prototype.unsetWait=
function(){this.exportDialog.domNode.style.cursor="default";this.exportingLabel.style.visibility="hidden";this.exportBtn.disabled=!1};F.prototype.exportItem=function(){var D=this;if(this._moveFailed)this.updateItem(this._moveFailed.itemId,"/").then(function(N){D.unsetWait();D.onDone(N)});else{this.setWait();var L=this.saveItem.get("title"),O=this.generalizeChk.checked,S={maxAllowableOffset:1,quantizationParameters:{tolerance:1}},Z=G.ShapeFile;G.CSV===this.exportType?Z=G.CSV:G.FileGDB===this.exportType?
Z=G.FileGDB:G.GeoJson===this.exportType?Z=G.GeoJson:G.FeatureCollection===this.exportType?Z=G.FeatureCollection:G.KML===this.exportType?Z="kml":G.Excel===this.exportType&&(Z="excel");var I=this._layers.map(function(N){return O?v.__assign({id:N.id},S):{id:N.id}});L={itemId:this.item.id,title:L,exportFormat:Z,exportParameters:-1<this.layerId?{layers:I}:O?S:null};this.item.isOwner&&this.item.isDataView&&(L.exportParameters=v.__assign(v.__assign({},L.exportParameters||{}),{enforceFieldVisibility:!0}));
L.exportParameters&&(L.exportParameters=JSON.stringify(L.exportParameters));Z=a["default"].getUser();a["default"].request({url:b["default"].restBaseUrl+"content/users/"+Z.username+"/export",content:L},{usePost:!0}).then(this.handleExport.bind(this),this.displayError.bind(this))}};F.prototype.handleExport=function(D){!D||D.code||D.message?this.displayError(D):(this.exportResponse=D,this.checkStatusInterval=setInterval(this.checkStatus.bind(this),this.statusCheckIntervalTime))};F.prototype.checkStatus=
function(){var D=this;if(this.exportResponse&&!this.checkingStatus){var L={jobId:this.exportResponse.jobId,jobType:"export"},O=a["default"].getUser();O=b["default"].restBaseUrl+"content/users/"+O.username+"/items/"+this.exportResponse.exportItemId+"/status";this.checkingStatus=!0;a["default"].request({url:O,content:L}).then(function(S){D.handleStatusCheck(S);D.checkingStatus=!1},function(S){D.displayError(S);D.checkingStatus=!1})}};F.prototype.handleStatusCheck=function(D){"completed"===(null===D||
void 0===D?void 0:D.status)?(clearInterval(this.checkStatusInterval),this.updateExportedItemDetails(D)):"failed"===D.status&&(clearInterval(this.checkStatusInterval),this.updateExportedItemDetailsAndFail(D))};F.prototype.updateExportedItemDetailsAndFail=function(D){var L=this;this.getItemDetails(this.exportResponse.exportItemId).then(function(O){var S=[],Z=b["default"].self.hasCategorySchema&&L.saveItem.get("categories")||[];0<Z.length&&S.push(f["default"].setItemCategories([O.id],Z));S.push(L.updateItem(O.id,
O.ownerFolder));r["default"](S).then(function(){L.unsetWait();L.displayFailure(D.statusMessage)})})};F.prototype.updateExportedItemDetails=function(D){var L=this;this.getItemDetails(D.itemId).then(function(O){var S=[],Z=b["default"].self.hasCategorySchema&&L.saveItem.get("categories")||[];0<Z.length&&S.push(f["default"].setItemCategories([O.id],Z));S.push(L.updateItem(O.id,O.ownerFolder));r["default"](S).then(function(){L.unsetWait();L.onDone(D)})})};F.prototype.moveItem=function(D,L){var O=this,
S=new u["default"],Z=a["default"].getUser();Z=b["default"].restBaseUrl+"content/users/"+Z.username+"/items/"+D+"/move";var I={folder:L||"/"};this._moveFailed=null;L&&"/"!==L&&""!==L?a["default"].request({url:Z,content:I},{usePost:!0}).then(function(N){S.resolve(N)},function(N){if(N&&"CONT_0011"===N.messageCode){var K=O.saveItem.get("title");K=x["default"].substitute(O.i18n.duplicateFound,{type:O.exportType,title:K});p["default"].createSpecifiedDialog(h["default"]).show({title:O.i18n.errorTitle,message:K});
O._moveFailed=v.__assign(v.__assign({},N),{itemId:D,folderId:L});O.unsetWait()}}):S.resolve({itemId:D});return S};F.prototype.updateItem=function(D,L){var O=this.saveItem.get("title"),S=this.saveItem.get("tags"),Z=this.saveItem.get("summary"),I=this.saveItem.get("folderId"),N=b["default"].restBaseUrl+"content/items/"+this.exportResponse.exportItemId+"/data",K=a["default"].getUser();K=b["default"].restBaseUrl+"content/users/"+K.username;L&&0<L.length&&(K+="/"+L);K+="/items/"+this.exportResponse.exportItemId+
"/update";O={title:O,tags:S,snippet:Z};this._moveFailed||(O.folderId=I);G.KML===this.exportType&&(O.url=N);return a["default"].request({url:K,content:O},{usePost:!0}).then(this.moveItem.bind(this,D,I))};F.prototype.getItemDetails=function(D){return a["default"].request({url:b["default"].restBaseUrl+"content/items/"+D})};F.prototype.goToItem=function(D){var L=this;this.hide().then(function(){L.unsetWait();window.location.href=b["default"].baseUrl+"item.html?id\x3d"+D})};F.prototype.checkTitle=function(){var D=
this.saveItem.get("title"),L=this.saveItem.get("folderId"),O=this.typeLookup[this.exportType]||this.exportType,S=a["default"].getUser().username;return a["default"].request({url:b["default"].restBaseUrl+"search",content:{q:'title:"'+D+'" AND type:"'+O+'" AND owner:"'+S+'" AND ownerfolder:"'+(L&&"/"!==L?L:"root")+'"'}})};F.prototype.displayFailure=function(D){var L=this;if(D)try{var O=JSON.parse(D)}catch(I){O=D}var S=p["default"].createSpecifiedDialog(h["default"]);S.onOkClick=function(){S.hide();
L.onCancel()};var Z=this.i18n.errorTitle;O.message&&(D=O.message);S.show({title:Z,message:D})};F.prototype.displayError=function(D){var L=this,O=this.i18n.errorTitle;if(D){var S=p["default"].createSpecifiedDialog(h["default"]);S.onOkClick=function(){S.hide();L.onCancel()};S.show({title:O,message:(null===D||void 0===D?0:D.code)&&D.message?D.message:D})}};F.prototype.onExport=function(){var D=this;this.validates()&&this.checkTitle().then(function(L){0<L.total?(L=D.saveItem.get("title"),L=x["default"].substitute(D.i18n.duplicateFound,
{type:D.typeLookup[D.exportType]||D.exportType,title:L}),p["default"].createSpecifiedDialog(h["default"]).show({title:D.i18n.errorTitle,message:L})):D.exportItem()})};F.prototype.onCancel=function(D){var L;null===(L=null===D||void 0===D?void 0:D.preventDefault)||void 0===L?void 0:L.call(D);this.hide();this.destroy()};return F=v.__decorate([l["default"](g["default"],e["default"],q["default"],A["default"])],F)}()})},"arcgisonline/sharing/dijit/SaveItem":function(){define("require exports tslib ../../esriGeowConfig ../../pages/pageUtil ../../pages/dijit/CategoryPicker ../../pages/utils/arrays ../../pages/utils/dom ../../pages/utils/storage ../util ../geow/Folder ../../tsutils/declareDecorator arcgis-components/wrappers/Tags dijit/_TemplatedMixin dijit/_WidgetBase dijit/_WidgetsInTemplateMixin dojo/Deferred dojo/on dojo/topic dojo/data/ItemFileWriteStore dojo/i18n!../../nls/arcgisonline dojo/text!./templates/SaveItem.html".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x,t,w,z,B){b=v.__importDefault(b);p=v.__importDefault(p);f=v.__importDefault(f);d=v.__importDefault(d);a=v.__importDefault(a);c=v.__importDefault(c);h=v.__importDefault(h);l=v.__importDefault(l);k=v.__importDefault(k);e=v.__importDefault(e);q=v.__importDefault(q);u=v.__importDefault(u);r=v.__importDefault(r);x=v.__importDefault(x);t=v.__importDefault(t);w=v.__importDefault(w);z=v.__importDefault(z);B=v.__importDefault(B);return function(){function A(y,E){this.declaredClass=
"arcgisonline.sharing.dijit.SaveItem";this.widgetsInTemplate=!0;this.templateString=B["default"];this.baseClass="esriAGOSaveItemForm";this.init=!1;this.folders={}}A.prototype.postMixInProperties=function(){this.i18n=v.__assign(v.__assign(v.__assign({},z["default"].common),z["default"].saveItem),{addTags:z["default"].itemCompleteness.addTags})};A.prototype.postCreate=function(){this.inherited(arguments);this.init||(this.saveItemTags=new g.TagsWrapper(this.saveItemTagsContainer,{activeTags:[],knownTags:[],
maxWidth:"100%",minWidth:"100%"}),this.getFolders(),this.init=!0)};A.prototype.startup=function(){this.inherited(arguments);this.initHandlers()};A.prototype.hideRow=function(y){a["default"].hideNodes(this.domNode.querySelectorAll(".save-item-"+y+"-row"))};A.prototype.loadTags=function(y){var E=h["default"].getUser();y&&(E=y);return h["default"].loadUserTags(E.username)};A.prototype.loadCategories=function(y){var E=this,G=new r["default"],F=this.domNode.querySelectorAll(".categories-container");b["default"].self.hasCategorySchema?
h["default"].request({url:b["default"].restBaseUrl+"portals/self/categorySchema"}).then(function(D){E.categories=new f["default"]({categories:y||[],schema:D.categorySchema},E.saveItemCategories);E.categories.startup();a["default"].showNodes(F);G.resolve()},function(){a["default"].hideNodes(F);G.resolve()}):(a["default"].hideNodes(F),G.resolve());return G};A.prototype.initHandlers=function(){var y=this.validate.bind(this);this.own(x["default"](this.saveItemFolder,"change",this.onFolderChange.bind(this)),
x["default"](this.saveItemTitle,"change",y),x["default"](this.saveItemSummary,"change",y),p["default"].registerKeystrokeHandler(this.saveItemTitle,y),p["default"].registerKeystrokeHandler(this.saveItemSummary,y))};A.prototype.validate=function(){var y,E;if(!this.beingDestroyed){var G=!0,F=this.saveItemTitle.get("value"),D=(null===(E=null===(y=this.saveItemTags)||void 0===y?void 0:y.getTags())||void 0===E?void 0:E.join(","))||"";y=this.saveItemSummary.get("value");null===this.requires?G=!!(F&&D&&y):
(d["default"].includes(this.requires,"title")&&(G=G&&!!F),d["default"].includes(this.requires,"tags")&&(G=G&&0!==D.length),d["default"].includes(this.requires,"summary")&&(G=G&&!!y));t["default"].publish("onSaveItemValidate",[G])}};A.prototype.getFolders=function(){var y=this,E=h["default"].getUser();if(null!==E){var G=new w["default"]({url:null,data:{identifier:"name",items:[]}});G.newItem({name:E.username,id:""});this.saveItemFolder.set("store",G);this.saveItemFolder.set("value",E.username);l["default"].getFolders(function(F){var D=
null,L=c["default"].getCookie("ESRI_Content");L&&L.folderId&&(D=L.folderId);y.foldersJson=F.folders;F.folders.forEach(function(O,S){G.newItem({name:O.title,id:O.id});y.folders["id"+O.id]=O.title.replace(/"/g,'\\"');D===O.id&&(y.saveItemFolder.set("value",O.title),y.folderId=D,y.folderName=O.title)});G.save({})},function(F){})}};A.prototype.onFolderChange=function(y){var E=this;this.saveItemFolder.get("store").fetch({onComplete:function(G){G.forEach(function(F){F.name[0]===y&&(E.folderId=F.id[0],E.folderName=
F.name[0])})}})};A.prototype._setTitleAttr=function(y){this.saveItemTitle.set("value",y)};A.prototype._getTitleAttr=function(){return this.saveItemTitle.get("value")};A.prototype._setTagsAttr=function(y){this.saveItemTags.setTags(y)};A.prototype._getTagsAttr=function(){return this.saveItemTags.getTags()};A.prototype._setCategoriesAttr=function(y){var E=this;y&&y.forEach(function(G){E.categories.addCategory(G)})};A.prototype._getCategoriesAttr=function(){return this.categories.getCategories(!0)};A.prototype._setSummaryAttr=
function(y){this.saveItemSummary.set("value",y)};A.prototype._getSummaryAttr=function(){return this.saveItemSummary.get("value")};A.prototype._setFolderAttr=function(y){var E=this;this.saveItemFolder.get("store").fetch({onComplete:function(G){G.forEach(function(F){F.name[0]===y&&(E.folderId=F.id[0],E.folderName=F.name[0],E.saveItemFolder.set("value",E.folderName))})}})};A.prototype._getFolderAttr=function(){return this.folderName};A.prototype._setFolderIdAttr=function(y){var E=this;this.saveItemFolder.get("store").fetch({onComplete:function(G){G.forEach(function(F){F.id[0]===
y&&(E.folderId=F.id[0],E.folderName=F.name[0],E.saveItemFolder.set("value",F.name[0]))})}})};A.prototype._getFolderIdAttr=function(){return this.folderId};A.prototype._setRequiresAttr=function(y){this.requires=y?y:null};A.prototype._setTitlePlaceHolderAttr=function(y){this.saveItemTitle.set("placeHolder",y)};A.prototype._setTagsPlaceHolderAttr=function(y){this.saveItemTitle.set("placeHolder",y)};A.prototype._setSummaryPlaceHolderAttr=function(y){this.saveItemSummary.set("placeHolder",y)};return A=
v.__decorate([k["default"](q["default"],e["default"],u["default"])],A)}()})},"arcgis-components/wrappers/Tags":function(){define(["../Component","../Inputs/Tags/index"],function(m,n){return function(v){function b(f){if(p[f])return p[f].exports;var d=p[f]={i:f,l:!1,exports:{}};return v[f].call(d.exports,d,d.exports,b),d.l=!0,d.exports}var p={};return b.m=v,b.c=p,b.d=function(f,d,a){b.o(f,d)||Object.defineProperty(f,d,{enumerable:!0,get:a})},b.r=function(f){"undefined"!=typeof Symbol&&Symbol.toStringTag&&
Object.defineProperty(f,Symbol.toStringTag,{value:"Module"});Object.defineProperty(f,"__esModule",{value:!0})},b.t=function(f,d){if((1&d&&(f=b(f)),8&d)||4&d&&"object"==typeof f&&f&&f.__esModule)return f;var a=Object.create(null);if(b.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:f}),2&d&&"string"!=typeof f)for(var c in f)b.d(a,c,function(h){return f[h]}.bind(null,c));return a},b.n=function(f){var d=f&&f.__esModule?function(){return f["default"]}:function(){return f};return b.d(d,"a",
d),d},b.o=function(f,d){return Object.prototype.hasOwnProperty.call(f,d)},b.p="",b(b.s=945)}({0:function(v,b,p){function f(e,q){function u(){this.constructor=e}k(e,q);e.prototype=null===q?Object.create(q):(u.prototype=q.prototype,new u)}function d(e,q){var u={},r;for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>q.indexOf(r)&&(u[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var x=0;for(r=Object.getOwnPropertySymbols(e);x<r.length;x++)0>q.indexOf(r[x])&&Object.prototype.propertyIsEnumerable.call(e,
r[x])&&(u[r[x]]=e[r[x]])}return u}function a(e,q,u,r){var x,t=arguments.length,w=3>t?q:null===r?r=Object.getOwnPropertyDescriptor(q,u):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(e,q,u,r);else for(var z=e.length-1;0<=z;z--)(x=e[z])&&(w=(3>t?x(w):3<t?x(q,u,w):x(q,u))||w);return 3<t&&w&&Object.defineProperty(q,u,w),w}function c(e,q,u,r){return new (u||(u=Promise))(function(x,t){function w(A){try{B(r.next(A))}catch(y){t(y)}}function z(A){try{B(r["throw"](A))}catch(y){t(y)}}
function B(A){var y;A.done?x(A.value):(y=A.value,y instanceof u?y:new u(function(E){E(y)})).then(w,z)}B((r=r.apply(e,q||[])).next())})}function h(e,q){function u(B){return function(A){return function(y){if(r)throw new TypeError("Generator is already executing.");for(;z;)try{if(r=1,x&&(t=2&y[0]?x["return"]:y[0]?x["throw"]||((t=x["return"])&&t.call(x),0):x.next)&&!(t=t.call(x,y[1])).done)return t;switch(x=0,t&&(y=[2&y[0],t.value]),y[0]){case 0:case 1:t=y;break;case 4:return z.label++,{value:y[1],done:!1};
case 5:z.label++;x=y[1];y=[0];continue;case 7:y=z.ops.pop();z.trys.pop();continue;default:if(!(t=z.trys,(t=0<t.length&&t[t.length-1])||6!==y[0]&&2!==y[0])){z=0;continue}if(3===y[0]&&(!t||y[1]>t[0]&&y[1]<t[3]))z.label=y[1];else if(6===y[0]&&z.label<t[1])z.label=t[1],t=y;else if(t&&z.label<t[2])z.label=t[2],z.ops.push(y);else{t[2]&&z.ops.pop();z.trys.pop();continue}}y=q.call(e,z)}catch(E){y=[6,E],x=0}finally{r=t=0}if(5&y[0])throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}([B,A])}}var r,x,t,w,z={label:0,
sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return w={next:u(0),"throw":u(1),"return":u(2)},"function"==typeof Symbol&&(w[Symbol.iterator]=function(){return this}),w}function l(){for(var e=0,q=0,u=arguments.length;q<u;q++)e+=arguments[q].length;e=Array(e);var r=0;for(q=0;q<u;q++)for(var x=arguments[q],t=0,w=x.length;t<w;t++,r++)e[r]=x[t];return e}p.d(b,"d",function(){return f});p.d(b,"a",function(){return g});p.d(b,"f",function(){return d});p.d(b,"c",function(){return a});p.d(b,
"b",function(){return c});p.d(b,"e",function(){return h});p.d(b,"g",function(){return l});var k=function(e,q){return(k=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,r){u.__proto__=r}||function(u,r){for(var x in r)r.hasOwnProperty(x)&&(u[x]=r[x])})(e,q)},g=function(){return(g=Object.assign||function(e){for(var q,u=1,r=arguments.length;u<r;u++)for(var x in q=arguments[u])Object.prototype.hasOwnProperty.call(q,x)&&(e[x]=q[x]);return e}).apply(this,arguments)}},15:function(v,b){v.exports=
m},686:function(v,b){v.exports=n},945:function(v,b,p){p.r(b);p.d(b,"TagsWrapper",function(){return h});var f=p(0),d=p(15);v=p(686);p=p.n(v);var a=function(l,k){switch(k.type){case "UPDATE_ACTIVE_TAGS":return Object(f.a)(Object(f.a)({},l),{activeTags:k.payload});case "UPDATE_KNOWN_TAGS":return Object(f.a)(Object(f.a)({},l),{knownTags:k.payload});default:return l}},c=Object(d.connect)(function(l){return{activeTags:l.activeTags,knownTags:l.knownTags}},function(l){return{onChange:function(k){l({type:"UPDATE_ACTIVE_TAGS",
payload:k})}}})(p.a),h=function(){function l(k,g){this.renderContainer=k;this.store=Object(d.createStore)(a,{activeTags:g.activeTags,knownTags:g.knownTags});this.projector=Object(d.createProjector)(this.store,function(e){return e(c,Object(f.a)({key:"wrapped-tags"},g))},this.renderContainer)}return l.prototype.destroy=function(){this.projector.stop();this.renderContainer.remove?this.renderContainer.remove():this.renderContainer.parentNode&&this.renderContainer.parentNode.removeChild(this.renderContainer)},
l.prototype.focus=function(){var k=this.renderContainer.querySelector("input");k&&k.focus()},l.prototype.getTags=function(){return this.store.getState().activeTags},l.prototype.setTags=function(k){this.store.dispatch({type:"UPDATE_ACTIVE_TAGS",payload:k})},l.prototype.getKnownTags=function(){return this.store.getState().knownTags},l.prototype.setKnownTags=function(k){this.store.dispatch({type:"UPDATE_KNOWN_TAGS",payload:k})},l.prototype.watchTags=function(k){var g=this,e=this.store.getState().activeTags;
return this.store.subscribe(function(){var q=g.store.getState().activeTags;q!==e&&k(e=q)})},l}()}})})},"arcgis-components/Inputs/Tags/index":function(){define(["../../Component","dojo/i18n!../../Inputs/Tags/nls/resources"],function(m,n){return function(v){function b(f){if(p[f])return p[f].exports;var d=p[f]={i:f,l:!1,exports:{}};return v[f].call(d.exports,d,d.exports,b),d.l=!0,d.exports}var p={};return b.m=v,b.c=p,b.d=function(f,d,a){b.o(f,d)||Object.defineProperty(f,d,{enumerable:!0,get:a})},b.r=
function(f){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(f,Symbol.toStringTag,{value:"Module"});Object.defineProperty(f,"__esModule",{value:!0})},b.t=function(f,d){if((1&d&&(f=b(f)),8&d)||4&d&&"object"==typeof f&&f&&f.__esModule)return f;var a=Object.create(null);if(b.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:f}),2&d&&"string"!=typeof f)for(var c in f)b.d(a,c,function(h){return f[h]}.bind(null,c));return a},b.n=function(f){var d=f&&f.__esModule?function(){return f["default"]}:
function(){return f};return b.d(d,"a",d),d},b.o=function(f,d){return Object.prototype.hasOwnProperty.call(f,d)},b.p="",b(b.s=823)}({0:function(v,b,p){function f(e,q){function u(){this.constructor=e}k(e,q);e.prototype=null===q?Object.create(q):(u.prototype=q.prototype,new u)}function d(e,q){var u={},r;for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>q.indexOf(r)&&(u[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var x=0;for(r=Object.getOwnPropertySymbols(e);x<r.length;x++)0>
q.indexOf(r[x])&&Object.prototype.propertyIsEnumerable.call(e,r[x])&&(u[r[x]]=e[r[x]])}return u}function a(e,q,u,r){var x,t=arguments.length,w=3>t?q:null===r?r=Object.getOwnPropertyDescriptor(q,u):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)w=Reflect.decorate(e,q,u,r);else for(var z=e.length-1;0<=z;z--)(x=e[z])&&(w=(3>t?x(w):3<t?x(q,u,w):x(q,u))||w);return 3<t&&w&&Object.defineProperty(q,u,w),w}function c(e,q,u,r){return new (u||(u=Promise))(function(x,t){function w(A){try{B(r.next(A))}catch(y){t(y)}}
function z(A){try{B(r["throw"](A))}catch(y){t(y)}}function B(A){var y;A.done?x(A.value):(y=A.value,y instanceof u?y:new u(function(E){E(y)})).then(w,z)}B((r=r.apply(e,q||[])).next())})}function h(e,q){function u(B){return function(A){return function(y){if(r)throw new TypeError("Generator is already executing.");for(;z;)try{if(r=1,x&&(t=2&y[0]?x["return"]:y[0]?x["throw"]||((t=x["return"])&&t.call(x),0):x.next)&&!(t=t.call(x,y[1])).done)return t;switch(x=0,t&&(y=[2&y[0],t.value]),y[0]){case 0:case 1:t=
y;break;case 4:return z.label++,{value:y[1],done:!1};case 5:z.label++;x=y[1];y=[0];continue;case 7:y=z.ops.pop();z.trys.pop();continue;default:if(!(t=z.trys,(t=0<t.length&&t[t.length-1])||6!==y[0]&&2!==y[0])){z=0;continue}if(3===y[0]&&(!t||y[1]>t[0]&&y[1]<t[3]))z.label=y[1];else if(6===y[0]&&z.label<t[1])z.label=t[1],t=y;else if(t&&z.label<t[2])z.label=t[2],z.ops.push(y);else{t[2]&&z.ops.pop();z.trys.pop();continue}}y=q.call(e,z)}catch(E){y=[6,E],x=0}finally{r=t=0}if(5&y[0])throw y[1];return{value:y[0]?
y[1]:void 0,done:!0}}([B,A])}}var r,x,t,w,z={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return w={next:u(0),"throw":u(1),"return":u(2)},"function"==typeof Symbol&&(w[Symbol.iterator]=function(){return this}),w}function l(){for(var e=0,q=0,u=arguments.length;q<u;q++)e+=arguments[q].length;e=Array(e);var r=0;for(q=0;q<u;q++)for(var x=arguments[q],t=0,w=x.length;t<w;t++,r++)e[r]=x[t];return e}p.d(b,"d",function(){return f});p.d(b,"a",function(){return g});p.d(b,"f",function(){return d});
p.d(b,"c",function(){return a});p.d(b,"b",function(){return c});p.d(b,"e",function(){return h});p.d(b,"g",function(){return l});var k=function(e,q){return(k=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,r){u.__proto__=r}||function(u,r){for(var x in r)r.hasOwnProperty(x)&&(u[x]=r[x])})(e,q)},g=function(){return(g=Object.assign||function(e){for(var q,u=1,r=arguments.length;u<r;u++)for(var x in q=arguments[u])Object.prototype.hasOwnProperty.call(q,x)&&(e[x]=q[x]);return e}).apply(this,
arguments)}},19:function(v,b){v.exports=m},394:function(v,b){v.exports=n},521:function(v,b,p){b.a=function(f,d){var a=f.name;return d("li",{"class":"inp-tags__tag",key:a},d("span",{title:a,"class":"inp-tags__tag-innards",onkeydown:f.onKeyDown,id:"tag-"+a,tabindex:"-1"},a,d("button",{"class":"inp-tags__tag-remove-btn","data-value":a,onclick:f.onRemove,tabindex:"-1",type:"button"},d("svg",{role:"img",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 32 32"},d("path",{d:"M18.404 16l9.9 9.9-2.404 2.404-9.9-9.9-9.9 9.9L3.696 25.9l9.9-9.9-9.9-9.898L6.1 3.698l9.9 9.899 9.9-9.9 2.404 2.406-9.9 9.898z"})))))}},
522:function(v,b,p){var f=p(394);b.a=function(d,a){var c=d.onSuggestionFocus,h=d.onSuggestionBlur,l=d.onSuggestionClick,k=d.onSuggestionKeyDown;if(!d.visible)return null;var g=d.matchingTags.map(function(q,u){return a("li",{id:"suggestion-"+u,classes:{"inp-tags__suggestion":!0,"inp-tags__suggestion--grey":0==u%2,"inp-tags__suggestion--white":0!=u%2},"data-value":q,"data-index":u,key:q,title:q,onfocus:c,onblur:h,onmousedown:l,onkeydown:k,tabindex:"0"},q)}),e=a("div",{"class":"inp-tags__no-suggestions",
id:"no-matching-div"},a("div",{"class":"inp-tags__no-suggestions-text",id:"no-matching-text"},f.noTagsFound));return a("ul",{id:"tag-suggestions","class":"inp-tags__suggestions",key:"tag-suggestions"},g[0]?g:e)}},823:function(v,b,p){p.r(b);var f=p(0);v=p(19);var d=p(394),a=p(521),c=p(522);p=function(h){function l(k){k=h.call(this,k)||this;return k.state={value:"",isFocused:!1,isTyping:!1,hasBeenFocused:!1},k.handleInputBlur=k.handleInputBlur.bind(k),k.handleInputChange=k.handleInputChange.bind(k),
k.handleInputFocus=k.handleInputFocus.bind(k),k.handleInputKeyDown=k.handleInputKeyDown.bind(k),k.handleSuggestionBlur=k.handleSuggestionBlur.bind(k),k.handleSuggestionClick=k.handleSuggestionClick.bind(k),k.handleSuggestionFocus=k.handleSuggestionFocus.bind(k),k.handleSuggestionKeyDown=k.handleSuggestionKeyDown.bind(k),k.handleWidgetClick=k.handleWidgetClick.bind(k),k.spliceTag=k.spliceTag.bind(k),k.handleTagInputKeyDown=k.handleTagInputKeyDown.bind(k),k}return Object(f.d)(l,h),l.prototype.render=
function(k){var g=this,e={"inp-tags__active-tags":!0,"inp-tags__active-tags--focused":this.state.isFocused},q=this.props.knownTags.filter(function(u){return-1!==u.toLowerCase().indexOf(g.state.value.toLowerCase())&&-1===g.props.activeTags.indexOf(u)});return k("div",{id:"tags-container",classes:{"inp-tags__container":!0},style:"\n                        min-width: "+(this.props.minWidth?this.props.minWidth:"auto")+";\n                        max-width: "+(this.props.maxWidth?this.props.maxWidth:"auto")+
";\n                    "},k("ul",{classes:e,key:"active-tags",id:"active-tags"},this.props.activeTags.filter(function(u){return u}).map(function(u){return k(a.a,{name:u,onRemove:g.spliceTag,onKeyDown:g.handleTagInputKeyDown})}),k("input",{id:"tags-input","class":"inp-tags__input",placeholder:d.addTags,value:this.state.value,onkeydown:this.handleInputKeyDown,onfocus:this.handleInputFocus,onblur:this.handleInputBlur,oninput:this.handleInputChange,afterCreate:this.handler})),k(c.a,{matchingTags:q,onSuggestionBlur:this.handleSuggestionBlur,
onSuggestionClick:this.handleSuggestionClick,onSuggestionFocus:this.handleSuggestionFocus,onSuggestionKeyDown:this.handleSuggestionKeyDown,visible:this.state.isTyping}))},l.prototype.handler=function(k){},l.prototype.addTag=function(k,g){var e=this;void 0===g&&(g=!0);var q=[];k.split(",").forEach(function(r){(r=e.stripHTML(r.trim()))&&-1===e.props.activeTags.indexOf(r)&&-1===q.indexOf(r)&&q.push(r)});this.props.onChange(this.props.activeTags.concat(q));var u=document.getElementById("tags-input");
u&&g&&u.focus()},l.prototype.spliceTag=function(k){k=k.currentTarget||k.target;var g=Object(f.g)(this.props.activeTags);g.splice(this.props.activeTags.indexOf(k.dataset.value),1);this.props.onChange(g)},l.prototype.handleInputBlur=function(k){var g=this;setTimeout(function(){var e=document.getElementById("tags-container");(null==e?0:e.contains(document.activeElement))||(g.addTag(k.target.value,!1),g.setState({value:"",hasBeenFocused:!0,isFocused:!1,isTyping:!1}))})},l.prototype.handleInputChange=
function(k){this.setState({value:k.target.value})},l.prototype.handleInputFocus=function(){this.setState({isFocused:!0})},l.prototype.handleInputKeyDown=function(k){switch(k.key){case "Enter":k.target.value&&(this.addTag(k.target.value),this.setState({value:"",isTyping:!1}),(g=document.getElementById("tags-input"))&&(g.focus(),g.value=""));break;case "Tab":var g;k.target.value&&(k.preventDefault(),this.addTag(k.target.value),this.setState({value:"",isTyping:!1}),(g=document.getElementById("tags-input"))&&
(g.focus(),g.value=""));break;case "Backspace":k.target.value||(k=Object(f.g)(this.props.activeTags),k.pop(),this.props.onChange(k),this.setState({value:"",isTyping:!1}));break;case "Down":case "ArrowDown":g=document.getElementById("suggestion-0");this.state.isTyping&&g?(k.preventDefault(),g.focus()):this.setState({isTyping:!0});break;case "Up":case "ArrowUp":case "Left":case "ArrowLeft":this.focusElement(document.getElementById("tag-"+this.props.activeTags[this.props.activeTags.length-1]));break;
default:this.setState({isTyping:!0})}},l.prototype.handleSuggestionBlur=function(k){k.preventDefault();this.setState({isFocused:!1,isTyping:!1})},l.prototype.handleSuggestionClick=function(k){k.preventDefault();this.addTag(k.target.dataset.value);this.setState({value:"",isFocused:!0,isTyping:!1});(k=document.getElementById("tags-input"))&&(k.focus(),k.value="")},l.prototype.handleSuggestionFocus=function(k){k.preventDefault();this.setState({isFocused:!0,isTyping:!0})},l.prototype.handleSuggestionKeyDown=
function(k){switch(k.preventDefault(),k.key){case "Up":case "ArrowUp":0===k.target["data-index"]?this.focusElement(document.getElementById("tags-input")):this.focusElement(document.getElementById("suggestion-"+(k.target["data-index"]-1)));break;case "Down":case "ArrowDown":(k=document.getElementById("suggestion-"+(k.target["data-index"]+1)))?k.focus():this.focusElement(document.getElementById("suggestion-0"));break;case "Tab":case "Enter":this.handleSuggestionClick(k);break;case "Escape":k.preventDefault(),
this.focusElement(document.getElementById("tags-input"))}},l.prototype.handleWidgetClick=function(k){(k=document.getElementById("tags-input"))&&k.focus()},l.prototype.handleTagInputKeyDown=function(k){var g=document.activeElement.getAttribute("title");if(g){var e=this.props.activeTags.indexOf(g);switch(k.key){case "Left":case "ArrowLeft":this.focusElement(document.getElementById(0<e?"tag-"+this.props.activeTags[e-1]:"tag-"+this.props.activeTags[this.props.activeTags.length-1]));break;case "Right":case "ArrowRight":this.focusElement(document.getElementById(e<
this.props.activeTags.length-1?"tag-"+this.props.activeTags[e+1]:"tag-"+this.props.activeTags[0]));break;case "Down":case "ArrowDown":this.focusElement(document.getElementById("tags-input"));break;case "Backspace":case "Delete":k=Object(f.g)(this.props.activeTags),k.splice(this.props.activeTags.indexOf(g),1),this.props.onChange(k),this.focusElement(document.getElementById("tag-"+this.props.activeTags[e<this.props.activeTags.length-1?e+1:e-1]))}}},l.prototype.focusElement=function(k){k&&k.focus()},
l.prototype.stripHTML=function(k){return k&&k.replace(/<(?:.|\s)*?>/g,"")},l}(v.Component);b["default"]=p}})})},"arcgisonline/sharing/dijit/dialog/InvitationsDlg":function(){define("require esri/declare esri/Evented esri/lang dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/on dojo/query dojo/string dojo/topic dojo/mouse dijit/a11yclick dojo/promise/all dojo/date/locale dojo/store/Memory dijit/Tooltip dijit/Dialog dijit/form/Button dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin ../../util ../../../pages/pageUtil ../../../pages/utils/formatters ../../../pages/utils/icons ../Grid ./ConfirmDialog ./GeneralDlg dojo/i18n!../../../nls/arcgisonline dojo/text!./templates/InvitationsDlg.html dojo/text!./templates/InvitationsDlgGroup.html".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x,t,w,z,B,A,y,E,G,F,D,L,O,S,Z){var I=n("arcgisonline.sharing.dijit.dialog.InvitationsDlg",[w,z,B,v],{basePath:m.toUrl("arcgisonline/sharing/dijit/dialog"),baseClass:"esriInvitationsDlg",widgetsInTemplate:!0,templateString:S,invitations:null,groupsUser:null,postMixInProperties:function(){this.inherited(arguments);this.i18n=p.mixin({},O.common);p.mixin(this.i18n,O.invitationsDlg);p.mixin(this.i18n,O.invitationsGrid)},postCreate:function(){this.loadConnections()},
show:function(N,K){this.clearStore();K&&(K.username||K.email)&&(this.groupsUser=K);this.invitations=N;this.getGroupInfos();this._dialog.show()},update:function(N){this.clearStore();this.invitations=N;this.getGroupInfos();this._dialog.show()},getGroupInfos:function(){var N=A.getUser(),K=[];if(null!==N){var Q=this.groupsUser&&this.groupsUser.username?this.groupsUser.username:this.groupsUser&&this.groupsUser.email?this.groupsUser.email:N.username;for(N=0;N<this.invitations.length;N++)K.push(A.request({url:esriGeowConfig.restBaseUrl+
"community/users/"+Q+"/invitations/"+this.invitations[N].groupId}));e(K).then(function(da){f.forEach(da,function(aa,J){this.invitations[J].fromUsername=aa.fromUsername.username;this.invitations[J].fromUserFullname=aa.fromUsername.fullname;this.invitations[J].groupTitle=aa.group.title;this.invitations[J].groupOwner=aa.group.owner;this.invitations[J].groupIsPrivate="private"===aa.group.access;this.invitations[J].groupAccess=aa.group.access;this.invitations[J].groupDescription=aa.group.description;this.invitations[J].groupThumbnail=
aa.group.thumbnail;this.invitations[J].leavingDisallowed=aa.group.leavingDisallowed;this.groupsUser&&(this.invitations[J].asUser=Q)}.bind(this));var U=this._invitationsGrid._grid.store;f.forEach(this.invitations,function(aa){U.put(aa)}.bind(this));this.refresh()}.bind(this))}},loadConnections:function(){this.own(c(".jevent").on("click",function(N){N&&N instanceof Event&&N.preventDefault()}),a(this._closeBtn,"click",function(){this._dialog.hide()}.bind(this)),l.subscribe("onInvitationAccept",this.onInvitationAccept.bind(this)),
l.subscribe("onInvitationDecline",this.onInvitationDecline.bind(this)))},createGrid:function(){this._invitationsGrid=new F({id:"invitationsGrid",columns:this.getInvitationGridColumns(),noDataMessage:this.i18n.noGroupInvites,showLoadingMessage:!1,showHeader:!1,showFooter:!1,selectionMode:"none",rowsPerPage:5,className:"invitations-grid",store:new u({idProperty:"id",label:"groupTitle",data:[]}),sort:[{attribute:"received",descending:!1}]},this._invitationsGridContainer);this._invitationsGrid.startup()},
clearStore:function(){this._invitationsGrid||this.createGrid();var N=this._invitationsGrid&&this._invitationsGrid._grid&&this._invitationsGrid._grid.store||void 0;N&&f.forEach(p.clone(N.query()),function(K){N.remove(K.id)})},getInvitationGridColumns:function(){return{groupTitle:{label:this.i18n.groupName,sortable:!1,renderCell:function(N){var K=!1;this.groupsUser&&(this.groupsUser.privileges&&-1<this.groupsUser.privileges.indexOf("portal:admin:viewGroups")?K=!0:this.groupsUser.privileges&&-1<this.groupsUser.privileges.indexOf("portal:user:viewOrgGroups")&&
"private"!==N.groupAccess?K=!0:"public"===N.groupAccess&&(K=!0));var Q=N.groupThumbnail?esriGeowConfig.restBaseUrl+"community/groups/"+N.groupId+"/info/"+N.groupThumbnail+"?token\x3d"+A.getToken():"",da=q.format(new Date(N.received),{selector:"date",formatLength:"long"});da=h.substitute(O.GroupWidget.invitedEventDescription,{fullName:N.fromUserFullname,fullDate:da});K={i18n:O,icons:G,id:N.groupId,title:N.groupTitle,thumbnail:N.groupThumbnail,thumbnailUrl:Q,notificationSummary:da,fillColor:"#"+N.groupId.substr(N.groupId.length-
6),useLetter:N.groupTitle.charAt(0)&&N.groupTitle.charAt(0).match(/^\w+$/),isPrivate:!K};K=d.toDom(h.substitute(Z,K,null,{hide:E.hide,show:E.show,firstChar:E.firstChar,stripHTML:E.stripHTML}));Q=c(".js-accept-invitation",K).shift();da=c(".js-decline-invitation",K).shift();var U=N.asUser?N.asUser:null,aa=N.leavingDisallowed?this.confirmLeavingDisallowed.bind(this,N,U):this.acceptInvitation.bind(this,N,U);N=this.declineInvitation.bind(this,N,U);this.own(g(Q,aa),g(da,N));return K}.bind(this)}}},confirmLeavingDisallowed:function(N,
K){var Q=O.invitationsDlg.leavingDisabled,da=y.createSpecifiedDialog(D,{"class":"general-dialog",title:O.invitationsDlg.joinGroup,buttonOkLabel:O.invitationsDlg.joinGroup,style:{height:"auto"}});da.setContent(Q);da.show().then(function(U){"onOk"===U&&(this.acceptInvitation(N,K),da.hide())}.bind(this))},acceptInvitation:function(N,K){var Q=A.getUser(),da=this._invitationsGrid._grid.store,U=N.groupId;Q&&A.request({url:esriGeowConfig.restBaseUrl+"community/users/"+(K?K:Q.username)+"/invitations/"+U+
"/accept",content:{}},{usePost:!0}).then(function(aa){da.remove(N.id);l.publish("onInvitationAccept",{})}.bind(this),function(aa){var J=A.getUser();J=J&&J.orgId?this.i18n.acceptFailure:this.i18n.acceptFailurePublic;"COM_1050"===aa.messageCode?J=this.i18n.privilegeError:"ORG_3103"===aa.messageCode&&(J=this.i18n.maxExternalOrgs);y.createSpecifiedDialog(L).show({title:this.i18n.errorTitle,message:J})}.bind(this))},declineInvitation:function(N,K){var Q=A.getUser(),da=N.groupId,U=this._invitationsGrid._grid.store;
Q&&A.request({url:esriGeowConfig.restBaseUrl+"community/users/"+(K?K:Q.username)+"/invitations/"+da+"/decline"},{usePost:!0}).then(function(){U.remove(N.id);l.publish("onInvitationDecline",{})}.bind(this))},onInvitationAccept:function(){0===this._invitationsGrid._grid.store.query().length?this.hide():this.refresh()},onInvitationDecline:function(){0===this._invitationsGrid._grid.store.query().length?this.hide():this.refresh()},hide:function(){this._dialog.hide()},refresh:function(){if(this._invitationsGrid._grid&&
this._invitationsGrid._grid._started){var N=this._invitationsGrid._grid._currentPage||1,K=this._invitationsGrid._grid.store?this._invitationsGrid._grid.store.query().length:0;a.once(this._invitationsGrid._grid,"dgrid-refresh-complete",function(Q){Q.grid._currentPage!==N&&0<K&&Q.grid.gotoPage(N)});this._invitationsGrid._grid.resize();this._invitationsGrid._grid.refresh()}}});I.prototype.statics={getInstance:function(){this._instance||(this._instance=new I);return this._instance}};return I})},"arcgisonline/sharing/dijit/Grid":function(){define("dojo/_base/declare dojo/_base/lang dojo/string dojo/_base/array dojo/date/locale dojo/on dojo/dom esri/lang dojo/aspect dijit/_WidgetBase dojo/_base/window dijit/TooltipDialog dijit/popup dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/form/DropDownButton dijit/DropDownMenu dijit/MenuItem dgrid/Grid dgrid/extensions/Pagination dgrid/extensions/DijitRegistry dgrid/OnDemandGrid dgrid/extensions/ColumnResizer dgrid/Keyboard ./_RefreshMixin ./Rating dojo/query dojo/dom-class dojo/dom-style dojo/dom-geometry dojo/dom-construct dojo/when dojo/store/Memory dgrid/Selection dgrid/selector dojo/store/Observable put-selector/put dgrid/util/mouse dgrid/util/touch arcgisonline/sharing/util ../../pages/utils/keys arcgisonline/sharing/geow/Content dojo/i18n!arcgisonline/nls/arcgisonline".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x,t,w,z,B,A,y,E,G,F,D,L,O,S,Z,I,N,K,Q,da,U,aa,J,T,Y,W){esri.i18nBundle=W;return m("arcgisonline.sharing.dijit.Grid",[h],{postMixInProperties:function(){this.inherited(arguments);this._util=J;this._content=Y;this._supportedViews=["gallery","details","table"];this._favorites={};this._portalUser=this._util.getUser();this._galleryTemplate=this._galleryTemplate||"\x3cdiv style\x3d'opacity:0;' class\x3d'grid-item gallery-view'\x3e${item:_formatThumbnail}\x3ch5\x3e${item:_formatItemTitle}\x3c/h5\x3e${item:_formatItemTypeIcon}\x3c/div\x3e";
this._detailsTemplate=this._detailsTemplate||'\x3cdiv style\x3d\'opacity:0;\' class\x3d\'grid-item detail-view\'\x3e${item:_formatThumbnail}\x3ch5\x3e${item:_formatItemTitle}\x3c/h5\x3e\x3cdiv class\x3d"rating-system"\x3e\x3cdiv data-dojo-type\x3d\'arcgisonline/sharing/dijit/Rating\' data-dojo-props\x3d\'numStars:5,value:${item.avgRating},disabled:true\'\x3e\x3c/div\x3e\x26nbsp;\x3cspan\x3e(${item.numRatings})\x3c/span\x3e\x3c/div\x3e${item:_formatItemTypeIcon}\x3cp class\x3d"grid-item-type"\x3e${item:_formatType}\x3c/p\x3e\x3cp class\x3d"grid-item-desc"\x3e${item.snippet}\x3c/p\x3e${item:_formatPremiumContentIcon}\x3cspan class\x3d"openItem" id\x3d"openItem"\x3e\x3c/span\x3e\x3ca href\x3d"item.html?id\x3d${item.id}" class\x3d"calcite btn small primary details-button"\x3e${i18n.gallery.details}\x3c/a\x3e\x3c/div\x3e';
this._itemPopupTemplate=this._itemPopupTemplate||'\x3cdiv class\x3d"grid-item-hover"\x3e\x3ch5\x3e${item:_formatItemTitle}\x3c/h5\x3e\x3cspan id\x3d\'openItem\'\x3e\x3c/span\x3e\x3ca href\x3d"item.html?id\x3d${item.id}" class\x3d"calcite btn small primary details-button"\x3e${i18n.details}\x3c/a\x3e\x3cp class\x3d"item-hover-type"\x3e${item:_formatItemTypeIcon}${item:_formatType} by\x26nbsp;${item.owner:_formatOwnerLink}\x3c/p\x3e\x3cp class\x3d"item-hover-desc"\x3e${item.snippet}\x3c/p\x3e${item:_formatPremiumContentIcon}\x3cdiv class\x3d"rating-system"\x3e\x3cdiv data-dojo-type\x3d\'arcgisonline/sharing/dijit/Rating\' data-dojo-props\x3d\'numStars:5,value:${item.avgRating},disabled:true\'\x3e\x3c/div\x3e\x26nbsp;\x3cspan\x3e(${item.numRatings})\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e';
this._renderers=n.mixin(this._renderers||{},{gallery:n.hitch(this,function(R){R.snippet=R.snippet||"";var X=da("div"),ia=new (m([h,e,q],{templateString:v.substitute(this._galleryTemplate,{item:R,i18n:W.gallery},null,this)}));R.widget=ia;X.appendChild(ia.domNode);return X}),details:n.hitch(this,function(R){R.snippet=R.snippet||"";var X=da("div"),ia=new (m([h,e,q],{templateString:v.substitute(this._detailsTemplate,{item:R,i18n:W},null,this)})),ka=new u({label:W.gallery.open,className:"btn calcite primary",
dropDown:this._getOpenInMenu(R)},F(".openItem",X)[0]);R.widget=ia;X.appendChild(ia.domNode);F(".openItem",X).replaceWith(ka.domNode);0===ka.dropDown.getChildren().length&&ka.set("disabled",!0);return X}),table:function(){return da("div",t.prototype.renderRow.apply(this,arguments))}})},buildRendering:function(){this.inherited(arguments);var R=m([t,z,w,A,N,E]),X=this.columns||{title:{label:"title"},type:{label:"type"},modified:{label:"last modified"},access:{label:"sharing"}};this._view=this.view||
"table";this._query=this.query;this._sort=this.sort||[{attribute:"title",descending:!1}];this._queryOptions=this.queryOptions||{sort:this.sort};this._store=this.store||new I({data:[]});this._rowsPerPage=this.rowsPerPage||9;this._pagingLinks=this.pagingLinks?this.pagingLinks:3;this._showHeader=this.showHeader||!1;this._selectionMode=this.selectionMode||"extended";this._useTouchScroll=this.useTouchScroll||!1;this._grid=new R({columns:X,renderRow:this._renderers[this._view],noDataMessage:this.noDataMessage||
"",showHeader:this._showHeader,store:this._store,query:this._query,showLoadingMessage:!1,firstLastArrows:this._pagingLinks,previousNextArrows:this._pagingLinks,rowsPerPage:this._rowsPerPage,pagingLinks:this._pagingLinks,allowSelectAll:!0,selectionMode:this._selectionMode,sort:this._sort},this.domNode);this._grid.startup()},postCreate:function(){this.inherited(arguments);this.own(this._grid.on("refresh",n.hitch(this,function(){this._grid.showFooter=this._grid._total>this._grid.rowsPerPage;this._onGridRefresh()})),
c.before(this._grid,"removeRow",n.hitch(this,function(R){R&&(R=this._grid.row(R),(R=(R.data||R).widget)&&R.destroyRecursive())})),this._grid.on(".fav-icon a:click",n.hitch(this,function(R){R.preventDefault();var X=this._grid.row(R),ia=R.target.parentNode.parentNode.parentNode,ka=D.contains(R.target.parentNode,"fav-off");R=this._content[ka?"addToFavorites":"removeFromFavorites"](X.data).then(n.hitch(this,function(){this._favorites[X.data.id].id=ka?X.data.id:!1}));F(".fav-on",ia).style({display:ka?
"":"none"});F(".fav-off",ia).style({display:ka?"none":""});setTimeout(n.hitch(this,function(){F(".fav-on",ia).style({width:ka?"200px":"24px"});F(".fav-off",ia).style({width:ka?"24px":"200px"});setTimeout(n.hitch(this,function(){F(".fav-on, .fav-off").style({width:"24px"})}),2500)}),50);R.then(n.hitch(this,function(){}))})),this._grid.on(".fav-icon a:mouseout",n.hitch(this,function(R){L.set(R.target.parentNode,{width:"24px"})})));!esri.isTouchEnabled||"gallery"!==this._view&&"details"!==this._view?
"gallery"!==this._view&&"details"!==this._view||this.own(this._grid.on(U.enterRow,n.hitch(this,function(R){if(R.relatedTarget&&!1===D.contains(R.relatedTarget,"dijitMenu")&&!1===D.contains(R.relatedTarget,"dijitReset")){var X=this._grid.row(R),ia=F("img",X.element)[0];clearTimeout(this._showPopupTimeout);ia&&(this._showPopupTimeout=setTimeout(n.hitch(this,function(){this._portalUser?this._isFavorite(X.data.id).then(n.hitch(this,function(ka){this._showPopup(X.data,ia.parentNode)})):this._showPopup(X.data,
ia)}),400))}})),this._grid.on(U.leaveRow,n.hitch(this,function(R){R.relatedTarget&&!1===D.contains(R.relatedTarget,"dijitTooltipDialog")&&!1===D.contains(R.relatedTarget,"dijitTooltipConnector")&&(clearTimeout(this._showPopupTimeout),clearTimeout(this._closePopupTimeout),this._closePopupTimeout=setTimeout(n.hitch(this,function(){F(".fav-on, .fav-off",this.domNode).style("display","none").style("width","24px");this._closePopup()}),10))}))):this.own(this._grid.on(aa.selector(".dgrid-content .dgrid-row",
aa.tap),n.hitch(this,function(R){R.preventDefault();var X=this._grid.row(R);this._portalUser?this._isFavorite(X.data.id).then(n.hitch(this,function(ia){this._showPopup(X.data,F("img",X.element)[0].parentNode)})):this._showPopup(X.data,F("img",X.element)[0])})),this._grid.on(".dgrid-row:click",n.hitch(this,function(R){R.preventDefault();var X=this._grid.row(R);this._portalUser?this._isFavorite(X.data.id).then(n.hitch(this,function(ia){this._showPopup(X.data,F("img",X.element)[0].parentNode)})):this._showPopup(X.data,
F("img",X.element)[0])})))},_onGridRefresh:function(R){this.emit("onRefresh",{currentPage:this._grid._currentPage});this._pagingLinks&&(F(".dgrid-navigation",this._grid.domNode)[this._grid._total<=this._grid.rowsPerPage?"addClass":"removeClass"]("hide"),F(".dgrid-pagination",this._grid.domNode)[0===this._grid._total?"addClass":"removeClass"]("hide"))},_getGridAttr:function(){return this._grid},_showPopup:function(R,X){"details"===this._view?this._portalUser&&this._isFavorite(R.id).then(n.hitch(this,
function(ia){F(".fav-on",X.parentNode).style("display",ia.id?"":"none");F(".fav-off",X.parentNode).style("display",ia.id?"none":"")})):"gallery"===this._view&&R.id&&R.id!==this._popupId&&(this._portalUser&&this._isFavorite(R.id).then(n.hitch(this,function(ia){F(".fav-on",X.parentNode).style("display",ia.id?"":"none");F(".fav-off",X.parentNode).style("display",ia.id?"none":"")})),this._closePopup(),this._popupId=R.id,this._tooltip=new k({onMouseLeave:n.hitch(this,"_closePopup"),content:new (m([h,e,
q],{templateString:v.substitute(this._itemPopupTemplate,{item:R,i18n:W.gallery},null,this)}))}),g.open({popup:this._tooltip,around:X,orient:["after-centered","before-centered"]}),this._popupButton=new u({label:W.gallery.open,className:"calcite btn small primary",dropDown:this._getOpenInMenu(R)}),F("#openItem").replaceWith(this._popupButton.domNode),0===this._popupButton.dropDown.getChildren().length&&this._popupButton.set("disabled",!0))},_closePopup:function(R){R&&R.relatedTarget&&(!0===D.contains(R.relatedTarget,
"dijitBackgroundIframe")||!0===D.contains(R.relatedTarget,"dijitMenu")||!0===D.contains(R.relatedTarget,"dijitReset"))||!this._tooltip||(g.close(this._tooltip),this._popupConnect&&this._popupConnect.remove(),this._popupButton&&this._popupButton.destroyRecursive(),this._tooltip.destroyRecursive(),this._popupId=this._tooltip=null)},_isFavorite:function(R){return Z(this._favorites[R]||this._searchItems('(group:"'+this._portalUser.favGroupId+'" AND id:"'+R+'")').then(n.hitch(this,function(X){this._favorites[R]=
X.results[0]||{id:!1};return this._favorites[R]})))},_searchItems:function(R){return this._util.request({url:esriGeowConfig.restBaseUrl+"search",content:{q:R,f:"json"}})},refresh:function(){this._grid&&(this._grid.set("query",this._query,this._queryOptions),F(".dgrid-row",this._grid.domNode).attr("tabindex","0"),this.own(f(this._grid.domNode.querySelector(".dgrid-content"),"keyup",function(R){var X=R.target;X.classList.contains("dgrid-row")&&R.keyCode===T.ENTER&&("single"===this._grid.selectionMode&&
this._grid.clearSelection(),this._grid.select(X))}.bind(this))))},gotoPage:function(R){this._grid.query=this._query;this._grid.queryOptions=this._queryOptions;this._grid._sort=this._queryOptions.sort;this._grid.gotoPage(R)},_formatItemTitle:function(R){return R.title||R.name||""},_formatType:function(R){return this._content.changeTypename({type:R.type,typeKeywords:R.typeKeywords},!1)||R.type},_formatLargeThumbnail:function(R){return R?"\x3cimg class\x3d'grid-item-thumb' alt\x3d'' src\x3d'"+R+"'\x3e":
"\x3cimg class\x3d'grid-item-thumb' alt\x3d'' src\x3d'"+this._util.getStaticImagesUrl()+"/desktopapp.png'\x3e"},_getDefaultThumbnail:function(R){var X=this._util.getStaticImagesUrl();return"web mapping application"==R?X+"/webapp.png":"mobile application"==R?X+"/mobileapp.png":"workforce project"===R?X+"/workforceproject.png":"hub initiative"===R?X+"/hubinitiative.png":"hub page"===R?X+"/hubpage.png":"hub site application"===R?X+"/hubsite.png":"dashboard"===R?X+"/opsdashboard.png":"geoprocessing service"===
R&&esriGeowConfig.self&&esriGeowConfig.self.isPortal?X+"/webtool.png":"web scene"===R||"scene service"===R?X+"/scene.png":"ortho mapping project"===R?X+"/orthomappingproject.png":"ortho mapping template"===R?X+"/orthomappingtemplate.png":X+"/desktopapp.png"},_formatThumbnail:function(R){var X=R.thumbnailUrl||this._getDefaultThumbnail(R.type&&R.type.toLowerCase()),ia=this._util.getHomePageGalleryLinkInfo(R),ka=-1<dojo.indexOf(R.typeKeywords,"Web AppBuilder for ArcGIS");ka=esriGeowConfig.self&&esriGeowConfig.self.isPortal&&
ka||"Application"===R.type||"Web Mapping Application"===R.type&&!ka||"Mobile Application"===R.type||"Document Link"===R.type;var ca="Application"===R.type||"Web Mapping Application"===R.type||"Mobile Application"===R.type||"Document Link"===R.type||"CityEngine Web Scene"===R.type||"Dashboard"===R.type;R='\x3ca href\x3d"'+(esri.isTouchEnabled?"#":ka?R.url||"item.html?id\x3d"+R.id:ia&&ia.href&&ia.href.replace(/"/g,"'")||"item.html?id\x3d"+R.id)+'" target\x3d"'+(ca?"_blank":"")+'"\x3e\x3cimg class\x3d"grid-item-thumb" alt\x3d"" src\x3d"'+
X+'" /\x3e\x3c/a\x3e';X=esriGeowConfig.userRole&&esriGeowConfig.userRole.isCustom();X=!X||X&&esriGeowConfig.userRole.canShareItemToGroup();ia='\x3cdiv class\x3d"gallery-img"\x3e\x3cdiv class\x3d"fav-icon"\x3e\x3ca href\x3d"#"\x3e\x3cdiv class\x3d"fav-on" style\x3d"display:none;"\x3e\x3cdiv class\x3d"star-on"\x3e\x3c/div\x3e\x3cp id\x3d"addString"\x3e'+W.gallery.addFavorite+'\x3c/p\x3e\x3c/div\x3e\x3c/a\x3e\x3ca href\x3d"#"\x3e\x3cdiv class\x3d"fav-off" style\x3d"display:none;"\x3e\x3cdiv class\x3d"star-off"\x3e\x3c/div\x3e\x3cp id\x3d"remString"\x3e'+
W.gallery.removeFavorite+"\x3c/p\x3e\x3c/div\x3e\x3c/a\x3e\x3c/div\x3e"+R+"\x3c/div\x3e";return X&&this._portalUser?ia:R},_formatItemTypeIcon:function(R){return"\x3cimg class\x3d'grid-item-icon' alt\x3d'' src\x3d'"+this._content._getItemIconUrl(R)+"'\x3e"},_formatPremiumContentIcon:function(R){var X=R.isPremiumContent,ia=R.getTypeInfo(),ka=esriGeowConfig.self&&esriGeowConfig.self.isPortal?"portal":"";R=-1<b.indexOf(R.typeKeywords,"Requires Credits");return X?'\x3cp class\x3d"grid-item-type" title\x3d"'+
(R?W.common["premiumcontentcreditstitle"+ka]:W.common["premiumcontenttitle"+ka])+"\"\x3e\x3cimg class\x3d'grid-premium-icon' alt\x3d'' src\x3d'"+ia.premiumIconUrl+"'\x3e"+(R?W.common.premiumcontent:W.common.subscriptioncontent)+"\x3c/p\x3e":""},_formatDate:function(R){!1===R instanceof Date&&(R=new Date(R));return R?p.format(R,{selector:"date",datePattern:"MMMM yyy"}):""},_formatOwnerLink:function(R){return'\x3ca href\x3d"user.html?user\x3d'+R+'"\x3e'+R+"\x3c/a\x3e"},_getOpenInMenu:function(R){R=
this._util.getItemOpenLinkObjects(R);var X;var ia=new r({autoFocus:!0,_destroyOnRemove:!0,showTitle:!1});b.forEach(R,function(ka){X=new x({label:ka.label,onClick:function(){ka.onClick()}});ia.addChild(X)});ia.startup();return ia},_setViewAttr:function(R){this._view=R=-1===b.indexOf(this._supportedViews,R)?this._view:R;this._grid&&(this._grid.renderRow=this._renderers[R],da(this._grid.domNode,"!table!gallery!details."+R),this._grid.set("showHeader","table"===this._view))},_setStoreAttr:function(R){this._store=
R},_setQueryAttr:function(R,X){this._query=R||this._query;this._queryOptions=X||this._queryOptions},_setItemsAttr:function(R){(this._store=this._store||new Q(new I({data:R,identifier:"id",label:"id"})),this._store.setData)?this._store.setData(R):this._store=new Q(new I({data:R}));this.set("store",this._store);this.set("view",this._view)}})})},"arcgisonline/sharing/dijit/Rating":function(){define("dojo/_base/declare dojox/form/Rating dojo/dom-attr dojo/dom-construct dojo/string ../../pages/utils/icons dojo/i18n!../../nls/arcgisonline".split(" "),
function(m,n,v,b,p,f,d){return m([n],{constructor:function(a){m.safeMixin(this,a)},postCreate:function(){this.inherited(arguments);var a=p.substitute(d.common.ratingMsg2,{stars:this.params.value});v.set(this.domNode,"aria-label",a);v.set(this.domNode,"tabindex",0);[].slice.call(this.domNode.querySelectorAll(".dojoxRatingInput")).forEach(function(c){b.place(f["star-f"]["16"],c,"after");b.place(f.star["16"],c,"after")})},_onMouse:function(){this.get("disabled")||this.inherited(arguments)},onStarClick:function(){this.get("disabled")||
this.inherited(arguments)},_setValueAttr:function(a){a=Math.round(a);this.inherited(arguments)}})})},"dojox/form/Rating":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-attr dojo/dom-class dojo/mouse dojo/on dojo/string dojo/query dijit/form/_FormWidget".split(" "),function(m,n,v,b,p,f,d,a,c){return m("dojox.form.Rating",c,{templateString:null,numStars:3,value:0,buildRendering:function(h){for(var l='\x3clabel class\x3d"dojoxRatingStar dijitInline ${hidden}"\x3e\x3cspan class\x3d"dojoxRatingLabel"\x3e${value} stars\x3c/span\x3e\x3cinput type\x3d"radio" name\x3d"rating-'+
Math.random().toString(36).substring(2)+'" value\x3d"${value}" dojoAttachPoint\x3d"focusNode" class\x3d"dojoxRatingInput"\x3e\x3c/label\x3e',k='\x3cdiv dojoAttachPoint\x3d"domNode" class\x3d"dojoxRating dijitInline"\x3e\x3cdiv data-dojo-attach-point\x3d"list"\x3e'+d.substitute(l,{value:0,hidden:"dojoxRatingHidden"})+"${stars}\x3c/div\x3e\x3c/div\x3e",g="",e=0;e<this.numStars;e++)g+=d.substitute(l,{value:e+1,hidden:""});this.templateString=d.substitute(k,{stars:g});this.inherited(arguments)},postCreate:function(){this.inherited(arguments);
this._renderStars(this.value);this.own(f(this.list,f.selector(".dojoxRatingStar","mouseover"),n.hitch(this,"_onMouse")),f(this.list,f.selector(".dojoxRatingStar","click"),n.hitch(this,"_onClick")),f(this.list,f.selector(".dojoxRatingInput","change"),n.hitch(this,"onStarChange")),f(this.list,p.leave,n.hitch(this,function(){this._renderStars(this.value)})))},_onMouse:function(h){var l=+v.get(h.target.querySelector("input"),"value");this._renderStars(l,!0);this.onMouseOver(h,l)},_onClick:function(h){if("LABEL"===
h.target.tagName){var l=+v.get(h.target.querySelector("input"),"value");h.target.value=l;this.onStarClick(h,l);l==this.value&&(h.preventDefault(),this.onStarChange(h))}},_renderStars:function(h,l){a(".dojoxRatingStar",this.domNode).forEach(function(k,g){g>h?(b.remove(k,"dojoxRatingStarHover"),b.remove(k,"dojoxRatingStarChecked")):(b.remove(k,"dojoxRatingStar"+(l?"Checked":"Hover")),b.add(k,"dojoxRatingStar"+(l?"Hover":"Checked")))})},onStarChange:function(h){h=+v.get(h.target,"value");this.setAttribute("value",
h==this.value?0:h);this._renderStars(this.value);this.onChange(this.value)},onStarClick:function(h,l){},onMouseOver:function(){},setAttribute:function(h,l){this.set(h,l)},_setValueAttr:function(h){this._set("value",h);this._renderStars(h);var l=a("input[type\x3dradio]",this.domNode)[h];l&&(l.checked=!0);this.onChange(h)}})})},"arcgisonline/pages/utils/keys":function(){define(["require","exports"],function(m,n){Object.defineProperty(n,"__esModule",{value:!0});n.DOWN=n.RIGHT=n.UP=n.LEFT=n.TAB=n.SPACEBAR=
n.ENTER=n.ESCAPE=void 0;n.ESCAPE=27;n.ENTER=13;n.SPACEBAR=32;n.TAB=9;n.LEFT=37;n.UP=38;n.RIGHT=39;n.DOWN=40;n["default"]={ESCAPE:n.ESCAPE,ENTER:n.ENTER,TAB:n.TAB,UP:n.UP,DOWN:n.DOWN,LEFT:n.LEFT,RIGHT:n.RIGHT,SPACEBAR:n.SPACEBAR}})},"arcgisonline/sharing/dijit/dialog/JoinGroupDlg":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/on dijit/a11yclick dijit/Dialog dijit/form/Button dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin ../../util ../../../pages/utils/dom dojo/i18n!../../../nls/arcgisonline dojo/text!./templates/JoinGroupDlg.html".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q){var u=n("arcgisonline.sharing.dijit.dialog.JoinGroupDlg",[c,h,l],{declaredClass:"arcgisonline.sharing.dijit.dialog.JoinGroupDlg",basePath:m.toUrl("arcgisonline/sharing/dijit/dialog"),templateString:q,widgetsInTemplate:!0,postMixInProperties:function(){this.inherited(arguments);this.i18n=v.mixin(e.common,e.joinGroupDlg)},postCreate:function(){this.inherited(arguments);this._loadConnections()},show:function(r,x,t){this.groupId=r;this.leavingDisallowed=x;t&&(this.successHandler=
t);this.leavingDisallowed&&g.showNode(this._administrativeGroup);this._dialog.show()},hide:function(r){r&&r.preventDefault();this._dialog.hide()},_loadConnections:function(){this.own(f(this._okBtn,v.hitch(this,"_submitRequest")),f(this._cancelBtn,v.hitch(this,"hide")))},_submitRequest:function(r){r&&r.preventDefault();var x=k.request({url:esriGeowConfig.restBaseUrl+"community/groups/"+this.groupId+"/join"},{usePost:!0}).then(dojo.hitch(this,function(t,w){this.hide();this.successHandler&&this.successHandler(t,
w)}),dojo.hitch(this,function(t){if(!x.canceled){var w=t.message;t.messageCode&&"COM_1082"===t.messageCode?w=this.i18n.levelOneSharedUpdateCapabilities:-1<w.indexOf("You have already applied to join this group.")?w=this.i18n.alreadyRequested+"\x3cbr\x3e"+this.i18n.applicationConsidered:-1<w.indexOf("Unable to apply to join group:")?w=this.i18n.cannotAccept:-1<w.indexOf(" is by invitation only.")&&(w=this.i18n.byInviteOnly);arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.joinGroupError,
message:w})}this.hide()}))}});u.prototype.statics={_instance:null,getInstance:function(){null==this._instance&&(this._instance=new u);return this._instance}};return u})},"arcgisonline/sharing/dijit/dialog/ManageSubscriptionDlg":function(){define(["dojo","dijit","dojox","dojo/require!dijit/Dialog,dijit/_Widget,dijit/_Templated,dijit/form/Button,dijit/form/RadioButton,arcgisonline/sharing/util,arcgisonline/sharing/geow/Geow,arcgisonline/sharing/dijit/dialog/ChoiceDlg,arcgisonline/sharing/dijit/dialog/GeneralDlg"],
function(m,n,v){m.provide("arcgisonline.sharing.dijit.dialog.ManageSubscriptionDlg");m.require("dijit.Dialog");m.require("dijit._Widget");m.require("dijit._Templated");m.require("dijit.form.Button");m.require("dijit.form.RadioButton");m.require("arcgisonline.sharing.util");m.require("arcgisonline.sharing.geow.Geow");m.require("arcgisonline.sharing.dijit.dialog.ChoiceDlg");m.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");m.declare("arcgisonline.sharing.dijit.dialog.ManageSubscriptionDlg",
[n._Widget,n._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContent" \x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit.Dialog" id\x3d"manage-subscription-dialog" data-dojo-attach-point\x3d"_manageSubscriptionDlg" title\x3d"${i18n.manageSubscriptionTitle}" execute\x3d"" style\x3d"width:400px;"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_upgradeSubscriptionDiv" style\x3d"display:none;"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_inUSDiv"\x3e\x3c/div\x3e\x3cbr/\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_outsideUSDiv"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_manageSubscriptionDiv" style\x3d"display:none;"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_manageSubscriptionContainer"\x3e\r\n        \x3cp\x3e${i18n.manageSubscriptionDesc}\x3c/p\x3e\r\n        \x3cinput data-dojo-type\x3d"dijit.form.RadioButton" type\x3d"radio" name\x3d"manageOption" data-dojo-attach-point\x3d"_upgradeRadioBtn" id\x3d"upgrade-radio-button" value\x3d"upgrade" checked\x3d"true"\x3e\r\n        \x3cspan\x3e\x3clabel for\x3d"upgrade-radio-button"\x3e\x3cb\x3e${i18n.upgradeOption}\x3c/b\x3e\x3c/label\x3e\x3c/span\x3e\x3cbr/\x3e\r\n        \x3cdiv class\x3d"esriLeadingMargin15"\x3e${i18n.upgradeDesc}\x3c/div\x3e\x3cbr/\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_convertOptionDiv"\x3e\r\n          \x3cinput data-dojo-type\x3d"dijit.form.RadioButton" type\x3d"radio" name\x3d"manageOption" data-dojo-attach-point\x3d"_convertRadioBtn" id\x3d"convert-radio-button" value\x3d"convert"\x3e\r\n          \x3cspan\x3e\x3clabel for\x3d"convert-radio-button"\x3e\x3cb\x3e${i18n.convertOption}\x3c/b\x3e\x3c/label\x3e\x3c/span\x3e\x3cbr/\x3e\r\n          \x3cdiv class\x3d"esriLeadingMargin15"\x3e${i18n.convertDesc}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_evalSubscriptionContainer" style\x3d"display: none;"\x3e\r\n        \x3cp\x3e${i18n.upgradeOption} ${i18n.upgradeDesc}\x3c/p\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_purchaseInUSDiv"\x3e\x3c/div\x3e\x3cbr/\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_purchaseOutsideUSDiv"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_convertSubscriptionDiv" style\x3d"display:none;"\x3e\r\n      \x3cp\x3e${i18n.convertSubscriptionDesc}\x3c/p\x3e\r\n      \x3cp\x3e\x3cb\x3e${i18n.deleteHostedMsg}\x3c/b\x3e\x3cbr/\x3e${i18n.notAvailableMsg}\x3c/p\x3e\r\n      \x3cdiv\x3e\x3cb\x3e${i18n.importantMsg}\x3c/b\x3e\x3cdiv data-dojo-attach-point\x3d"_importantMsgDiv"\x3e\x3c/div\x3e\x3c/div\x3e\r\n      \x3cp\x3e\x3cb\x3e${i18n.intendToUpgradeMsg}\x3c/b\x3e\x3c/p\x3e\r\n    \x3c/div\x3e\r\n    \x3cbr/\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_buttonDiv" class\x3d"esriFloatTrailing"\x3e\r\n      \x3cbutton data-dojo-attach-point\x3d"_okBtn" data-dojo-attach-event\x3d"onClick:onCancel" class\x3d"jevent cancel" type\x3d"button" data-dojo-type\x3d"dijit.form.Button"\x3e${i18n.ok}\x3c/button\x3e\r\n      \x3cbutton data-dojo-attach-point\x3d"_nextBtn" data-dojo-attach-event\x3d"onClick:onNext" class\x3d"jevent primary" type\x3d"button" data-dojo-type\x3d"dijit.form.Button"\x3e${i18n.next}\x3c/button\x3e\r\n      \x3cbutton data-dojo-attach-point\x3d"_convertBtn" data-dojo-attach-event\x3d"onClick:onConvert" class\x3d"jevent primary" type\x3d"button" data-dojo-type\x3d"dijit.form.Button"\x3e${i18n.convertLabel}\x3c/button\x3e\r\n      \x3cbutton data-dojo-attach-point\x3d"_cancelBtn" data-dojo-attach-event\x3d"onClick:onCancel" class\x3d"jevent cancel" type\x3d"button" data-dojo-type\x3d"dijit.form.Button"\x3e${i18n.cancel}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n    \x3cbr style\x3d"clear:both;"/\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
util:arcgisonline.sharing.util,geow:arcgisonline.sharing.geow.Geow,statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.ManageSubscriptionDlg);return this._instance}},_converting:!1,_choiceDlg:null,_selfResource:null,postMixInProperties:function(){this.inherited(arguments);this.i18n=m.i18n.getLocalization("arcgisonline","arcgisonline").common;m.mixin(this.i18n,m.i18n.getLocalization("arcgisonline","arcgisonline").manageSubscriptionDlg)},
postCreate:function(){this.inherited(arguments);this._dialog=this._manageSubscriptionDlg;this.loadConnections()},show:function(b){this.selfResource=b;this._showManageView()},showManage:function(b){this.selfResource=b;this.clear();this._showManageView();this._manageSubscriptionDlg.show()},showUpgrade:function(b){this.selfResource=b;this.clear();this._showUpgradeView();this._manageSubscriptionDlg.show()},_showUpgradeView:function(){this._manageSubscriptionDlg.set("title",this.i18n.upgradeSubscriptionTitle);
"Trial"!==this.selfResource.subscriptionInfo.type&&"Trial Press"!==this.selfResource.subscriptionInfo.type&&"Evaluation"!==this.selfResource.subscriptionInfo.type||this._manageSubscriptionDlg.set("title",this.i18n.manageSubscriptionTitle);m.attr(this._inUSDiv,"innerHTML",esri.substitute({officeLinkStart:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca target\x3d"_blank" href\x3d"http://www.esri.com/about-esri/offices/"\x3e',officeLinkEnd:"\x3c/a\x3e\x3c/span\x3e"},this.i18n.upgradeInsideUS));m.attr(this._outsideUSDiv,
"innerHTML",esri.substitute({officeLinkStart:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca target\x3d"_blank" href\x3d"http://www.esri.com/about-esri/offices/"\x3e',officeLinkEnd:"\x3c/a\x3e\x3c/span\x3e"},this.i18n.upgradeOutsideUS));m.style(this._manageSubscriptionDiv,"display","none");m.style(this._convertSubscriptionDiv,"display","none");m.style(this._nextBtn.domNode,"display","none");m.style(this._convertBtn.domNode,"display","none");m.style(this._cancelBtn.domNode,"display","none");"active"!==
this.selfResource.subscriptionInfo.state||"Trial"!==this.selfResource.subscriptionInfo.type&&"Trial Press"!==this.selfResource.subscriptionInfo.type&&"Evaluation"!==this.selfResource.subscriptionInfo.type||this._manageSubscriptionDlg.set("title",this.i18n.manageSubscriptionTitle);m.style(this._upgradeSubscriptionDiv,"display","");m.style(this._okBtn.domNode,"display","")},_showManageView:function(){this._manageSubscriptionDlg.set("title",this.i18n.manageSubscriptionTitle);m.style(this._upgradeSubscriptionDiv,
"display","none");m.style(this._convertSubscriptionDiv,"display","none");m.style(this._okBtn.domNode,"display","none");m.style(this._convertBtn.domNode,"display","none");this.selfResource.subscriptionInfo&&"Evaluation"===this.selfResource.subscriptionInfo.type?(m.style(this._convertOptionDiv,"display","none"),m.style(this._manageSubscriptionContainer,"display","none"),m.style(this._evalSubscriptionContainer,"display",""),m.attr(this._purchaseInUSDiv,"innerHTML",esri.substitute({officeLinkStart:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca target\x3d"_blank" href\x3d"http://www.esri.com/about-esri/offices/"\x3e',
officeLinkEnd:"\x3c/a\x3e\x3c/span\x3e"},this.i18n.upgradeInsideUS)),m.attr(this._purchaseOutsideUSDiv,"innerHTML",esri.substitute({officeLinkStart:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca target\x3d"_blank" href\x3d"http://www.esri.com/about-esri/offices/"\x3e',officeLinkEnd:"\x3c/a\x3e\x3c/span\x3e"},this.i18n.upgradeOutsideUS)),m.style(this._okBtn.domNode,"display",""),m.style(this._nextBtn.domNode,"display","none"),m.style(this._cancelBtn.domNode,"display","none")):(m.style(this._nextBtn.domNode,
"display",""),m.style(this._cancelBtn.domNode,"display",""));m.style(this._manageSubscriptionDiv,"display","")},_showConvertView:function(){this._manageSubscriptionDlg.set("title",this.i18n.convertToPersonalTitle);m.attr(this._importantMsgDiv,"innerHTML",esri.substitute({helpLinkStart:'\x3cspan class\x3d"esriItemLinks"\x3e\x3ca target\x3d"_blank" href\x3d"'+(this.selfResource.helpBase+this.selfResource.helpMap.m["120000592"])+'"\x3e',helpLinkEnd:"\x3c/a\x3e"},this.i18n.completeDetailsWithLinkMsg));
m.style(this._upgradeSubscriptionDiv,"display","none");m.style(this._manageSubscriptionDiv,"display","none");m.style(this._okBtn.domNode,"display","none");m.style(this._nextBtn.domNode,"display","none");m.style(this._convertSubscriptionDiv,"display","");m.style(this._convertBtn.domNode,"display","");m.style(this._cancelBtn.domNode,"display","")},loadConnections:function(){m.query(".jevent").connect("onclick",function(b){b.preventDefault()})},clear:function(){this._converting=!1;this._choiceDlg=arcgisonline.sharing.dijit.dialog.ChoiceDlg.prototype.statics.getInstance();
this._manageSubscriptionDlg.set("title","");m.style(this._upgradeSubscriptionDiv,"display","none");m.style(this._manageSubscriptionDiv,"display","none");m.style(this._convertSubscriptionDiv,"display","none");m.style(this._convertOptionDiv,"display","");m.style(this._manageSubscriptionContainer,"display","");m.style(this._evalSubscriptionContainer,"display","none");this._upgradeRadioBtn.set("checked",!0)},hide:function(){this._manageSubscriptionDlg.hide()},onNext:function(b){this._convertRadioBtn.get("checked")?
this._showConvertView():this._showUpgradeView()},onConvert:function(b){this._converting||(b={title:this.i18n.convertToPersonalTitle,message:this.i18n.noReturnMsg,choiceOneTitle:this.i18n.yesLabel,choiceTwoTitle:this.i18n.noLabel,choiceOneHandler:m.hitch(this,this.doConvert)},this._choiceDlg.show(b))},doConvert:function(){if(!this._converting&&esriGeowConfig.self&&esriGeowConfig.self.id){this._converting=!0;this._convertBtn.set("disabled",!0);var b=esriGeowConfig.baseUrl.replace(location.host,esriGeowConfig.self.portalHostname)+
esriGeowConfig.signin;b=b.replace("http:","https:");this.util.request({url:esriGeowConfig.restBaseUrl+"portals/self/convert",content:{target:"personal",timeout:12E4}},{usePost:!0}).then(m.hitch(this,function(p){this.geow.signout(b)}),m.hitch(this,function(p){this._converting=!1;this._convertBtn.set("disabled",!1);var f=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance();f.onOkClick=m.hitch(this,function(){f.hide();this._manageSubscriptionDlg.hide()});f.show({title:this.i18n.errorTitle,
message:this.i18n.unableToConvert})}))}},onCancel:function(b){n.byId("manage-subscription-dialog").hide()},onHide:function(){}})})},"arcgisonline/sharing/dijit/dialog/ManageTilesDlg":function(){define("require esri/declare esri/Evented esri/config esri/lang esri/request dojo/_base/lang dojo/on dojo/query dojo/sniff dojo/topic dojo/json dijit/a11yclick dojo/number dojo/string dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/Dialog dojo/store/Memory dojo/store/Observable dgrid/OnDemandGrid dgrid/selector dgrid/Selection dgrid/extensions/DijitRegistry esri/geometry/Extent esri/geometry/webMercatorUtils ../../../map/core/projectExtent ../../../map/utils/clipOnHorizon ../DefineExtent ./GeneralDlg ./ChoiceDlg ../../../pages/pageUtil ../../../pages/utils/arrays ../../../pages/utils/dom ../../../pages/serviceUtil ../../util calcite-web/js/calcite-web dojo/i18n!../../../nls/arcgisonline dojo/text!./templates/ManageTilesDlg.html".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x,t,w,z,B,A,y,E,G,F,D,L,O,S,Z,I,N,K,Q,da,U,aa,J,T,Y,W,R,X){var ia=n(null,{showFooter:!0,buildRendering:function(){this.inherited(arguments);var ca=this.summaryAreaNode=t.create("div",{className:"summary-row",role:"row",style:{overflow:"hidden"}},this.footerNode);this.on("scroll",function(){ca.scrollLeft=this.getScrollPosition().x}.bind(this));this.summary&&this._setSummary(this.summary)},_updateColumns:function(){this.inherited(arguments);this.summary&&this._setSummary(this.summary)},
_renderSummaryCell:function(ca,la,oa){la.appendChild(document.createTextNode(ca[oa.field]||""))},_setSummary:function(ca){var la=this.summaryTableNode;this.summary=ca;la&&t.destroy(la);la=this.summaryTableNode=this.createRowCells("td",this._renderSummaryCell.bind(this,ca));this.summaryAreaNode.appendChild(la);this._started&&this.resize()}}),ka=n("arcgisonline.sharing.dijit.dialog.ManageTilesDlg",[z,B,A],{declaredClass:"arcgisonline.sharing.dijit.dialog.ManageTilesDlg",templateString:X,widgetsInTemplate:!0,
basePath:m.toUrl("arcgisonline/sharing/dijit/dialog"),baseClass:"esriManageTiles",PROCESSING:"PROCESSING",SUBMITTED:"SUBMITTED",DEFAULT_TILE_WIDTH:256,DEFAULT_TILE_HEIGHT:256,TIME_TO_NEXT_UPDATE:1E4,TABS:{LEVELS:"levels",EXTENT:"extent"},_noSourceData:!1,_isSourceTilePackage:!1,_isVisible:!1,_isProcessing:!1,_wasProcessing:!1,_allTilesComplete:!1,_createClicked:!1,_tab:"levels",postMixInProperties:function(){this.inherited(arguments);this.i18n=d.mixin({},R.common);this.i18n=d.mixin(this.i18n,R.manageTilesDlg)},
postCreate:function(){this.inherited(arguments);b.defaults.io.proxyUrl=esriGeowConfig.proxyServer;esriGeowConfig.proxyUrl&&(b.defaults.io.proxyUrl=esriGeowConfig.proxyUrl);var ca=this.hide.bind(this);this.own(g(this._buildButton,this._createClick.bind(this)),g(this._cancelButton,this._cancelClick.bind(this)),g(this._closeButton,ca),g(this.dialog.closeButtonNode,ca),g(this._levelsTab,this._levelsTabClick.bind(this)),g(this._extentTab,this._extentTabClick.bind(this)))},destroy:function(){this.inherited(arguments);
this._defineExtent&&this._defineExtent.destroy()},setServerTokens:function(ca,la,oa){this._hostedServer=ca;this._serverToken=la;this._adminServerToken=oa},displayTabs:function(ca){this._mustDisplayTabs=ca},show:function(ca,la,oa,wa){la=this._handleServiceInfo.bind(this,la);W.tabs();this._setFlags();this.item=ca;this._isSourceTilePackage=!(!oa||!oa.tilePackage);this._isSourceServiceDefinition=!(!oa||!oa.serviceDefinition);this._isSourceTilePackage?(r.set(this._buildButton,"innerHTML",this.i18n.publishButton),
r.set(this.dialog,"title",this.i18n.publishButton),this._canShowTabs=!1):this._isPortal?this._canShowTabs=!1:(r.set(this.dialog,"title",this.i18n.buildTitle),this._canShowTabs=!(!esriGeowConfig.tilesOnDemandEnabled||!this._mustDisplayTabs));this._showTabs(this._canShowTabs);wa?la(wa):(ca=this._isPortal?f({url:this.item.url,content:{f:"json",token:this._serverToken}}):Y.request({url:this.item.url}),ca.then(la,la))},showNoSource:function(ca,la){this._noSourceData=!0;this.show(ca,la,!1)},hide:function(){this._noSourceData=
!1;this.dialog.hide();(this._createClicked||this._wasProcessing)&&l.publish("manage-tiles/update",{tileInfoChanged:!0});this._isVisible=this._wasProcessing=this._createClicked=!1},_showTabs:function(ca){J.showHide(this._tabNav,ca);c(".tab-contents").forEach(function(la){x[ca?"remove":"add"](la,"no-border")})},_setFlags:function(){this._isPortal=Y.isPortal();this._roleCanPublishTiles=(this._roleCanCreateItem=esriGeowConfig.userRole.canCreateItem())&&esriGeowConfig.userRole.canPublishTiles();this._createClicked=
this._allTilesComplete=this._wasProcessing=this._isProcessing=this._isVisible=this._isSourceTilePackage=this._noSourceData=!1;this._refreshTilesEnabled=!this._isPortal&&esriGeowConfig.tilesOnDemandEnabled},_handleServiceInfo:function(ca,la){!la||la.code||la.message||(this._serviceFullExtent=la.fullExtent,this._serviceTileInfo=la.tileInfo,this._serviceTileInfo.width=this._serviceTileInfo.width||this.DEFAULT_TILE_WIDTH,this._serviceTileInfo.height=this._serviceTileInfo.height||this.DEFAULT_TILE_HEIGHT,
this.serviceMinScale=la.minScale?la.minScale:this._serviceTileInfo.lods[0].scale,this.serviceMaxScale=la.maxScale?la.maxScale:this._serviceTileInfo.lods[this._serviceTileInfo.lods.length-1].scale,this.serviceMinLOD=p.isDefined(la.minLOD)?la.minLOD:void 0,this.serviceMaxLOD=p.isDefined(la.maxLOD)?la.maxLOD:void 0,this.dialog.show(),this._isVisible=!0,this._updateStatus(ca))},_handleReportCacheStatus:function(ca){ca&&ca.results&&!ca.message?(ca=ca.results[0],ca.serviceName=this._lastTileStatus.serviceName,
ca.type=this._lastTileStatus.type,ca.lodInfos=ca.value.lodInfos,ca.cacheExecutionStatus=ca.value.cacheExecutionStatus,ca.minScale=this._lastTileStatus.minScale,ca.maxScale=this._lastTileStatus.maxScale,this._updateStatus(ca)):this._updateStatus(ca)},_getStatus:function(){var ca=this;if(this._isVisible)if(ca._isPortal){var la=ca._handleReportCacheStatus.bind(ca),oa=ca.item.url.indexOf("/services/")+10,wa=ca.item.url.indexOf("/"+ca._lastTileStatus.serviceName+"/")+1;oa=ca.item.url.substring(oa,wa)+
ca._lastTileStatus.serviceName+":"+ca._lastTileStatus.type;var za=T.adjustHostedServerForProtocol(ca._hostedServer.url)+"/rest/services/System/ReportingTools/GPServer/ReportCacheStatus/execute",Fa={service_url:oa,report_mode:"esriCacheStatus",f:"json",token:ca._serverToken,job_id:ca._jobId,ts:(new Date).getTime()};ca._jobId?f({url:za,content:Fa}).then(la,la):(oa={service_url:oa,report_mode:"esriJobSummary",f:"json",token:ca._serverToken,ts:(new Date).getTime()},f({url:za,content:oa}).then(function(Ba){Ba&&
Ba.results&&Ba.results[0]&&Ba.results[0].value.esriJobStatus&&Ba.results[0].value.esriJobStatus[0]&&(ca._jobId=Ba.results[0].value.esriJobStatus[0].cancelJobID,Fa.job_id=ca._jobId);f({url:za,content:Fa}).then(la,la)}))}else oa=ca.item.url.replace("/rest/","/rest/admin/"),wa=ca._updateStatus.bind(ca),Y.request({url:oa,content:{ts:(new Date).getTime()}}).then(wa,wa)},_updateStatus:function(ca){if(this._isVisible&&(!ca||"Error"!==ca.name||"Unknown runtime error"!==ca.message)){this._lastTileStatus=ca;
this._lastTileStatus.minScale=this._lastTileStatus.minScale||this.serviceMinScale;this._lastTileStatus.maxScale=this._lastTileStatus.maxScale||this.serviceMaxScale;this._lastTileStatus.minLOD=this._lastTileStatus.minLOD||this.serviceMinLOD||void 0;this._lastTileStatus.maxLOD=this._lastTileStatus.maxLOD||this.serviceMaxLOD||void 0;if(this._isProcessing=ca.cacheExecutionStatus===this.PROCESSING||ca.cacheExecutionStatus===this.SUBMITTED)this._wasProcessing=!0,setTimeout(this._getStatus.bind(this),this.TIME_TO_NEXT_UPDATE);
this._refreshUI()}},_refreshUI:function(){this._updateData();this._grid?this._updateGrid():this._createGrid();this._updateTotals();this._updateExtent();this._updateDescription();this._updateButtons();this._updateMessage();this._updateTabs()},_updateExtent:function(){if(this._defineExtent&&this._defineExtent._started&&!this._updatedExtent){var ca=[[],[]],la;4326!==this._serviceFullExtent.spatialReference.wkid&&(la=Z.webMercatorToGeographic(new S(this._serviceFullExtent)));ca[1][1]=parseFloat(la.ymax);
ca[0][0]=parseFloat(la.xmin);ca[1][0]=parseFloat(la.xmax);ca[0][1]=parseFloat(la.ymin);this._defineExtent.set("extent",ca)}},_updateTabs:function(){this._isProcessing?(this._canShowTabs&&(x.remove(this._extentTab,"is-active"),x.remove(this._extentSection,"is-active"),x.add(this._levelsTab,"is-active"),x.add(this._levelsSection,"is-active")),this._showTabs(!1)):this._showTabs(this._canShowTabs)},_updateButtons:function(){this._roleCanPublishTiles?this._isProcessing||this._allTilesComplete&&!this._refreshTilesEnabled?
(this._hideButtons(),this._isProcessing&&this._isPortal&&this._jobId?this._showCancel():this._hideCancel()):(this._showButtons(),this._hideCancel()):this._hideButtons()},_updateMessage:function(){this._isProcessing||this._allTilesComplete&&!this._refreshTilesEnabled||(this._noSourceData?r.set(this._messageDiv,"innerHTML",this.i18n._noSourceData):r.set(this._messageDiv,"innerHTML",this._isSourceTilePackage?this.i18n.selectTilesPublish:this.i18n.selectTiles+"\x3cbr\x3e"+this.i18n.adjustVisibleRange))},
_updateData:function(){var ca=this.i18n.totals,la=this._lastTileStatus;this._gridStore=new G(new E({data:this._getTileStatusData(),identifier:"id"}));this._gridStore.getTotals||(this._gridStore.getTotals=function(){var wa={},za=0,Fa=0,Ba=0;this.data.forEach(function(va){za+=parseInt(va.created,10);Fa+=parseInt(va.expected,10);Ba+=va.storageSize?parseInt(va.storageSize,10):0});var Ca=e.round(za/Fa*100,2)||0;Ca=100<Ca?100:Ca;wa.selected="";wa.scaleLevel=ca;wa.created=e.format(za);wa.expected=e.format(Fa);
wa.pctComplete=String(Ca);wa.storageSize=U.sizeInMB(la&&la.size||Ba);return wa});if(this._noSourceData)J.hideNode(this._scalesSelectedSpan);else{var oa=q.substitute(this.i18n.scalesSelected,{scales:0});r.set(this._scalesSelectedSpan,"innerHTML",oa)}},_getTileStatusData:function(){var ca=this,la=[],oa=0,wa=0,za,Fa,Ba,Ca;ca._serviceTileInfo.lods.forEach(function(va){Math.floor(va.scale)<=ca._lastTileStatus.minScale&&Math.ceil(va.scale)>=ca._lastTileStatus.maxScale&&(za=U.calculateExpectedTiles(ca._serviceTileInfo,
ca._serviceFullExtent,va),la.push({id:va.level,selected:!1,scaleLevel:"1:"+e.format(Math.round(va.scale),{pattern:"#,###,###,##0"}),scale:va.scale,created:0,expected:za,pctComplete:0,storageSize:0}))});ca._lastTileStatus&&ca._lastTileStatus.lodInfos&&0<ca._lastTileStatus.lodInfos.length&&ca._lastTileStatus.lodInfos.forEach(function(va){for(Ca=0;Ca<la.length;Ca++)if(la[Ca]&&la[Ca].id===va.levelID){Fa=Math.round(va.tileCount/va.expectedTileCount*100);100<Fa&&(Fa=100);ca._isPortal&&va.pct&&(Fa=va.pct);
Ba=la[Ca];Ba.created=va.tileCount;Ba.expected=va.expectedTileCount;Ba.pctComplete=Fa;Ba.storageSize=va.tilesSize?va.tilesSize:0;break}});la.forEach(function(va){oa+=va.created;wa+=va.expected});ca._allTilesComplete=oa===wa;ca._disableButtons();return la},_updateTotals:function(){var ca=this,la=ca._grid.on("dgrid-refresh-complete",function(){ca._scrollNode&&ca._currentScrollPos&&(ca._scrollNode.scrollTop=ca._currentScrollPos);la.remove()});ca._scrollPos&&(ca._currentScrollPos=ca._scrollPos);ca._grid.set("summary",
ca._gridStore.getTotals());ca._grid.resize();ca._grid.refresh()},_updateDescription:function(){r.set(this._dialogDescription,"innerHTML","\x3cstrong\x3e"+(this._isProcessing?this._isSourceTilePackage?this.i18n.jobStatusPublishing:this.i18n.jobStatus:this.i18n.noJobStatus)+"\x3c/strong\x3e\x3cbr/\x3e")},_hideButtons:function(){J.hideNodes(c("div.messageContainer"));J.hideNodes(c("div.selected-scales-container"));J.hideNode(this._buildButton)},_showButtons:function(){J.showNode(this._buildButton);J.showNodes(c("div.selected-scales-container"));
J.showNodes(c("div.messageContainer"))},_hideCancel:function(){J.hideNode(this._cancelButton)},_showCancel:function(){J.showNode(this._cancelButton)},_updateGrid:function(){this._grid.set("columns",this._getGridLayout());this._grid.set("store",this._gridStore)},_createGrid:function(){this._grid=new (n([F,O,L,ia]))({id:"scaleGrid",columns:this._getGridLayout(),showLoadingMessage:!1,showFooter:!0,noDataMessage:"",selectionMode:"none",gridScope:this,allowSelectAll:!0,store:this._gridStore,sort:[{attribute:"id",
descending:!1}]},this._gridContainer);this._grid.startup();this.own(this._grid.on(".dgrid-header-row .field-selected:click",function(ca){this._toggleAll("INPUT"===ca.target.tagName?ca.target:ca.target.childNodes[0])}.bind(this)));this.own(this._grid.on(".dgrid-row .field-selected:click",function(ca){ca="INPUT"===ca.target.tagName?ca.target:ca.target.childNodes[0];var la=ca.parentNode.parentNode.parentNode.parentNode.id;la=la.substring(la.indexOf("scaleGrid-row-")+14);this._toggleScale(ca,la)}.bind(this)));
this.own(this._grid.on("scroll",function(ca){this._scrollPos=(this._scrollNode=ca&&ca.scrollTarget||null)&&this._scrollNode.scrollTop||0}.bind(this)))},_getGridLayout:function(){var ca=[];this._isProcessing||this._allTilesComplete&&!this._refreshTilesEnabled||this._noSourceData||!this._roleCanPublishTiles||ca.push(D({field:"selected",sortable:!1,selectorType:"checkbox"}));ca.push({field:"scaleLevel",label:this.i18n.grid.scaleLevel,sortable:!1,formatter:this._contentFormatter});ca.push({field:"created",
label:this._isSourceTilePackage?this.i18n.grid.tilesPublished:this.i18n.grid.tilesCreated,sortable:!1,formatter:this._tilesFormatter});ca.push({field:"expected",label:this.i18n.grid.totalTiles,sortable:!1,formatter:this._tilesFormatter});ca.push({field:"pctComplete",label:this.i18n.grid.percentComplete,sortable:!1,formatter:this._contentFormatter});ca.push({field:"storageSize",label:this.i18n.grid.storageSize,sortable:!1,formatter:this._sizeFormatter});return ca},_levelsTabClick:function(){this._tab=
this.TABS.LEVELS;this._updateMessage();this._checkToggled()},_extentTabClick:function(){var ca=[[],[]],la;this._tab=this.TABS.EXTENT;this._defineExtent||(this._defineExtent=new K({id:"defineExtent"},this._extentContainer),this._defineExtent.startup(),4326!==this._serviceFullExtent.spatialReference.wkid&&(la=Z.webMercatorToGeographic(new S(this._serviceFullExtent))),ca[1][1]=parseFloat(la.ymax),ca[0][0]=parseFloat(la.xmin),ca[1][0]=parseFloat(la.xmax),ca[0][1]=parseFloat(la.ymin),this._defineExtent.set("extent",
ca),this.own(l.subscribe("define-extent/change",this._onExtentChange.bind(this))));r.set(this._messageDiv,"innerHTML",this.i18n.defineExtent);this._checkToggled()},_onExtentChange:function(ca){this._serviceFullExtent.spatialReference.wkid===ca.spatialReference.wkid?this._updatedExtent=ca:I(ca,this._serviceFullExtent.spatialReference,function(la){la&&la.length&&(la=la.shift());this._updatedExtent=N(la)}.bind(this),null,this._defineExtent.map);this._checkToggled()},_calculateIntersection:function(ca,
la){var oa=new S(ca),wa=new S(la);return(oa=oa.intersects(wa))?oa.toJson():null},_cancelClick:function(){var ca=this;J.disableNode(ca._cancelButton,!0);var la=function(oa){p.isDefined(oa.error)&&(U.createSpecifiedDialog(Q).show({title:ca.i18n.errorTitle,message:ca.i18n.cantCancelJob}),ca._cancelButton.set("disabled",!1))};f({url:ca._hostedServer.adminUrl+"/rest/services/System/CachingControllers/GPServer/Manage%20Map%20Cache%20Tiles/jobs/"+ca._jobId+"/cancel",content:{f:"json",token:ca._adminServerToken}},
{usePost:!0}).then(la,la)},_checkCredits:function(ca){var la=new w,oa=esriGeowConfig.restBaseUrl+"portals/self/cost";ca={generatedTileCount:ca};this._isPortal||this._isSourceTilePackage?la.resolve():Y.request({url:oa,content:ca}).then(function(wa){la.resolve(wa)},function(){la.resolve()});return la},_createClick:function(){var ca=this._getAvgTileSize(this._serviceTileInfo),la=0,oa=0,wa=0,za=[],Fa=[],Ba,Ca,va,Va,Sa=0,Ra=0,Ta;this._grid.store.query().forEach(function(ya){Ca=parseInt(ya.created,10);
va=parseInt(ya.expected,10);Va=parseInt(ya.storageSize,10);!0===ya.selected&&(Ba=parseInt(ya.expected,10)-parseInt(ya.created,10),0<Ba&&(this._isPortal?za.push(""+ya.scale):za.push(ya.id)),esriGeowConfig.tilesOnDemandEnabled&&!this._isPortal&&this._updatedExtent?Sa=(Ta=this._calculateIntersection(this._updatedExtent,this._serviceFullExtent))?Sa+U.calculateExpectedTiles(this._serviceTileInfo,Ta,this._serviceTileInfo.lods[ya.id]):Sa+0:Sa+=Ca<=va?Ca:va,Ra+=va);oa+=Ca;wa+=Va}.bind(this));Fa=this._grid.store.query().filter(function(ya){return!0===
ya.selected}.bind(this));var Wa=esriGeowConfig.tilesOnDemandEnabled&&!this._isPortal&&this._updatedExtent?k.stringify(this._updatedExtent):this._serviceFullExtent.xmin+","+this._serviceFullExtent.ymin+","+this._serviceFullExtent.xmax+","+this._serviceFullExtent.ymax;if(0<za.length){la=esriGeowConfig.tilesOnDemandEnabled&&!this._isPortal&&this._updatedExtent?Sa:Ra-Sa;var La=this._formatSizeWithUnits((0<wa&&0<oa?wa/oa:ca)*la),$a=this._isPortal?za.join(";"):za.join(",");this._checkCredits(la).then(function(ya){var Xa=
"\x3cp\x3e"+q.substitute(this._isSourceTilePackage?this.i18n.aboutToPublish:this.i18n.aboutToCreate,{tiles:la,storage:La})+"\x3c/p\x3e",bb=!1;!this._isPortal&&!this._isSourceTilePackage&&p.isDefined(ya.transactionCreditCost)&&p.isDefined(ya.availableCredits)&&(ya.transactionCreditCost>ya.availableCredits?bb=!0:Xa+="\x3cp\x3e"+q.substitute(this.i18n.aboutToCreateCost,{credits:e.format(ya.transactionCreditCost),creditsLeft:e.format(ya.availableCredits)})+"\x3c/p\x3e");Xa+="\x3cp\x3e"+(this._isSourceTilePackage?
this.i18n.reallyPublishTiles:this.i18n.reallyCreateTiles)+"\x3c/p\x3e";!this._isPortal&&bb?U.createSpecifiedDialog(Q).show({title:this.i18n.notice,message:this.i18n.notEnoughCredits}):(ya={title:this._isSourceTilePackage?this.i18n.publishTiles:this.i18n.createTiles,message:Xa,choiceOneTitle:this._isSourceTilePackage?this.i18n.yesPublishTiles:this.i18n.yesCreateTiles,choiceTwoTitle:this._isSourceTilePackage?this.i18n.noPublishTiles:this.i18n.noCreateTiles},ya.choiceOneHandler=function(){this._createClicked=
!0;var cb=Fa.length&&Fa[0]||aa.find(this._serviceTileInfo.lods,function(ja){return this.serviceMinScale===ja.scale}),ab=Fa.length&&Fa[Fa.length-1]||aa.find(this._serviceTileInfo.lods,function(ja){return this.serviceMaxScale===ja.scale}),Ua=p.isDefined(this.serviceMinLOD)||p.isDefined(this.serviceMaxLOD),db=Ua&&cb&&cb.id<this.serviceMinLOD;Ua=Ua&&ab&&ab.id>this.serviceMaxLOD;var C=this._isSourceServiceDefinition&&(db||Ua);if(this._isPortal){J.disableNode(this._cancelButton,!1);var H=this.item.url.indexOf("/services/")+
10,M=this.item.url.indexOf(this._lastTileStatus.serviceName);H=this.item.url.substring(H,M);var V=this._hostedServer.adminUrl+"/rest/services/System/CachingControllers/GPServer/Manage%20Map%20Cache%20Tiles/submitJob",P={f:"json",token:this._adminServerToken,service_url:H+this._lastTileStatus.serviceName+":"+this._lastTileStatus.type,constraining_extent:Wa,levels:$a,update_mode:"RECREATE_ALL_TILES",thread_count:-1},ba=function(ja){ja.code&&ja.message?U.createSpecifiedDialog(Q).show({title:this.i18n.errorTitle,
message:ja.message}):(this._jobId=ja.jobId,this._isProcessing=!0,this._isVisible&&(this._updatedExtent=void 0,this._refreshUI(),setTimeout(this._getStatus.bind(this),this.TIME_TO_NEXT_UPDATE)))}.bind(this);C?(C={},db&&(C.minLOD=cb.id),Ua&&(C.maxLOD=ab.id),Y.request({url:ea.replace("/updateTiles","/edit"),content:{serviceDefinition:JSON.stringify(C)}},{usePost:!0}).then(function(ja){f({url:V,content:P},{usePost:!0}).then(ba,ba)},function(ja){})):f({url:V,content:P},{usePost:!0}).then(ba,ba)}else{var ea=
this.item.url.replace("/rest/","/rest/admin/")+"/updateTiles";9>=h("ie")&&(H=ea.indexOf("admin/services/"),M=ea.indexOf("/MapServer"),ea=ea.substring(0,H+15)+encodeURIComponent(ea.substring(H+15,M))+ea.substring(M));var ha={levels:$a,extent:Wa},fa=function(ja){if(ja.code&&ja.message){var ma=ja.message;ja.message&&-1<ja.message.toLowerCase().indexOf("credit")?ma=this.i18n.notEnoughCredits:ja.message&&-1<ja.message.toLowerCase().indexOf("invalid extent")&&(ma=this.i18n.invalidExtent);U.createSpecifiedDialog(Q).show({title:this.i18n.errorTitle,
message:ma})}else this._isProcessing=!0,this._isVisible&&(this._updatedExtent=void 0,this._refreshUI(),setTimeout(this._getStatus.bind(this),this.TIME_TO_NEXT_UPDATE))}.bind(this);C?(C={},db&&(C.minLOD=cb.id),Ua&&(C.maxLOD=ab.id),Y.request({url:ea.replace("/updateTiles","/edit"),content:{serviceDefinition:JSON.stringify(C)}},{usePost:!0}).then(function(ja){Y.request({url:ea,content:ha},{usePost:!0}).then(fa,fa)},function(ja){})):Y.request({url:ea,content:ha},{usePost:!0}).then(fa,fa)}}.bind(this),
ya.choiceTwoHandler=function(){}.bind(this),this._createChoiceDlg().show(ya))}.bind(this))}},_createChoiceDlg:function(){if(u.byId("choice-dialog"))var ca=da.prototype.statics.getInstance();else ca=new da,a.once(ca._dialog,"hide",function(){ca._dialog.destroyRecursive();ca.destroyRecursive()});return ca},_contentFormatter:function(ca){return'\x3cspan class\x3d"esriContentTypeName"\x3e'+ca+"\x3c/span\x3e"},_tilesFormatter:function(ca){var la="esriContentTypeName";ca&&1E10<=ca&&(la="esriContentTypeNameSmall");
return'\x3cspan class\x3d"'+la+'"\x3e'+e.format(ca)+"\x3c/span\x3e"},_sizeFormatter:function(ca){return'\x3cspan class\x3d"esriContentTypeName"\x3e'+U.sizeInMB(ca)+"\x3c/span\x3e"},_getAvgTileSize:function(ca){return 1E3*(ca.rows?ca.rows/10:25.6)},_formatSizeWithUnits:function(ca){var la=ca,oa=" "+this.i18n.megabytes;1048567E3<ca?(la=ca/1048567E3,oa=" "+this.i18n.gigabytes):0<ca&&(la=ca/1048567);la=Math.round(100*la)/100;return e.format(la)+oa},_enableButtons:function(ca,la,oa){var wa=this._tab===
this.TABS.LEVELS?this.i18n.tilesToCreate:this.i18n.tilesToCreateInExtent,za=this.i18n.tilesToPublish,Fa=this.i18n.noTilesToCreate,Ba=this.i18n.noTilesToPublish,Ca="";ca!==la?(ca=la-ca,oa=this._formatSizeWithUnits(oa*ca),Ca=q.substitute(this._isSourceTilePackage?za:wa,{tiles:ca,storage:oa}),J.disableNode(this._buildButton,!1)):(Ca=q.substitute(this._isSourceTilePackage?Ba:Fa,{tiles:0}),J.disableNode(this._buildButton,!0));r.set(this._messageDiv,"innerHTML",Ca)},_disableButtons:function(){r.set(this._messageDiv,
"innerHTML",this._isSourceTilePackage?this.i18n.selectTilesPublish:this.i18n.selectTiles+"\x3cbr\x3e"+this.i18n.adjustVisibleRange);J.disableNode(this._buildButton,!0)},_setScalesSelected:function(ca){ca=q.substitute(this.i18n.scalesSelected,{scales:ca});this._scalesSelectedSpan&&r.set(this._scalesSelectedSpan,"innerHTML",ca)},_toggleAll:function(ca){if(ca){var la=r.get(ca,"checked");this._grid&&this._grid.store&&(this._grid.store.query().forEach(function(oa){oa.selected=la}),this._checkToggled())}},
_toggleScale:function(ca,la){if(this._grid.store){var oa=this._grid.store.query({id:la}).shift();oa&&(oa.selected=r.get(ca,"checked"));this._checkToggled()}},_checkToggled:function(){var ca=this,la=0,oa=0,wa=0,za=0,Fa=0,Ba;if(ca._grid.store)if(ca._grid.store.query().forEach(function(va){var Va=parseInt(va.created,10),Sa=parseInt(va.expected,10),Ra=parseInt(va.storageSize,10);va.selected&&(la++,esriGeowConfig.tilesOnDemandEnabled&&!ca._isPortal&&ca._updatedExtent?oa=(Ba=ca._calculateIntersection(ca._updatedExtent,
ca._serviceFullExtent))?oa+U.calculateExpectedTiles(ca._serviceTileInfo,Ba,ca._serviceTileInfo.lods[va.id]):oa+0:oa+=Va<=Sa?Va:Sa,wa+=Sa);za+=Va;Fa+=Ra}),la){var Ca=0<Fa?Fa/za:ca._getAvgTileSize(ca._serviceTileInfo);esriGeowConfig.tilesOnDemandEnabled&&!ca._isPortal&&ca._updatedExtent?ca._enableButtons(wa-oa,wa,Ca):ca._enableButtons(oa,wa,Ca)}else ca._disableButtons();else ca._disableButtons();ca._setScalesSelected(la)}});ka.prototype.statics={getInstance:function(){this._instance||(this._instance=
new ka);return this._instance}};return ka})},"calcite-web/js/calcite-web":function(){(function(m,n){"object"===typeof exports&&"undefined"!==typeof module?module.exports=n():"function"===typeof define&&define.amd?define(n):m.calcite=n()})(this,function(){function m(J,T){var Y;for(Y=T;Y;Y=Y.parentNode){var W=Y&&Y.getAttribute&&Y.getAttribute("class")||"";W=(new RegExp("(\\s|^)"+J+"(\\s|$)")).test(W);if(1===Y.nodeType&&W)break}return Y}function n(J){return Array.isArray(J)?J:Array.prototype.slice.call(J)}
function v(J,T){var Y=(T||document).querySelectorAll(J);return n(Y)}function b(J,T){return(new RegExp("(\\s|^)"+T+"(\\s|$)")).test(J.getAttribute("class"))}function p(J,T){T.split(" ").forEach(function(Y){if(!b(J,Y)){var W=J.getAttribute("class")||"";J.setAttribute("class",W+" "+Y)}})}function f(J,T){T.split(" ").forEach(function(Y){var W=(J.getAttribute("class")||"").replace(new RegExp("(\\s|^)"+Y+"(\\s|$)","g"),"$2");b(J,Y)&&J.setAttribute("class",W)})}function d(J){J=n(J);J.forEach(function(T){f(T,
"is-active")})}function a(J,T){d(J);p(T,"is-active")}function c(J,T,Y){if(J.addEventListener)return J.addEventListener(T,Y,!1);if(J.attachEvent)return J.attachEvent("on"+T,Y)}function h(J,T,Y){if(J.removeEventListener)return J.removeEventListener(T,Y,!1);if(J.detachEvent)return J.detachEvent("on"+T,Y)}function l(J){if(J.preventDefault)return J.preventDefault();J.returnValue&&(J.returnValue=!1)}function k(J){J=J||window.event;if(J.stopPropagation)return J.stopPropagation();J.cancelBubble&&(J.cancelBubble=
!0)}function g(){}function e(J){for(var T="",Y=0;Y<J;Y++)T+=(65536*(1+Math.random())|0).toString(16).substring(1);return T}function q(J){if(!J)throw new TypeError("Invalid argument `value` has no value.");this.value=q.EMPTY;J&&J instanceof q?this.value=J.toString():J&&"[object String]"===Object.prototype.toString.call(J)&&q.isGuid(J)&&(this.value=J);this.equals=function(T){return q.isGuid(T)&&this.value===T};this.isEmpty=function(){return this.value===q.EMPTY};this.toString=function(){return this.value};
this.toJSON=function(){return this.value}}function u(J){k(J);J=m("accordion-section",J.target||J.srcElement);Q.emit("accordion:toggle",{node:J})}function r(J){var T=J.node;b(T,"is-active")?f(T,"is-active"):p(T,"is-active");(J=J.node.querySelector(".accordion-title"))&&("true"===J.getAttribute("aria-expanded")?J.setAttribute("aria-expanded","false"):J.setAttribute("aria-expanded","true"))}function x(J){13!==J.keyCode&&32!==J.keyCode||!b(J.target||J.srcElement,"accordion-title")||(l(J),k(J),u(J))}function t(J){var T=
v(".js-accordion");J?w(J.node):T.forEach(function(Y){w(Y)})}function w(J){J.setAttribute("aria-live","polite");J.setAttribute("role","tablist");n(J.children).forEach(function(T){var Y=T.querySelector(".accordion-title"),W=T.querySelector(".accordion-content"),R=W.id||q.raw();W.id=R;Y.setAttribute("role","tab");Y.setAttribute("tabindex","0");Y.setAttribute("aria-controls",R);Y.setAttribute("aria-expanded",b(T,"is-active")?"true":"false");var X=!1;K.accordions.forEach(function(ia){ia.target===Y&&"click"===
ia.event&&ia.fn===u&&(X=!0)});X||(K.accordions.push({target:Y,event:"click",fn:u}),K.accordions.push({target:T,event:"keydown",fn:x}),c(Y,"click",u),c(T,"keydown",x))})}function z(){U||(Q.on("accordion:bind",t),Q.on("accordion:toggle",r),U=!0);Q.emit("accordion:bind")}function B(J){h(document.body,"click",B);v(".js-dropdown").forEach(function(T){f(T,"is-active")});v(".js-dropdown-toggle").forEach(function(T){T.setAttribute("aria-expanded","false")});h(document,"keydown",E);h(document.body,"focusin",
A)}function A(J){J.target&&!m("js-dropdown",J.target)&&Q.emit("dropdown:close")}function y(J){if(J){var T=b(J.node,"is-active");Q.emit("dropdown:close");T||(p(J.node,"is-active"),J.target&&J.target.setAttribute("aria-expanded","true"),c(document,"keydown",E));b(J.node,"is-active")&&(c(document.body,"click",B),c(document.body,"focusin",A))}}function E(J){40===J.keyCode|38===J.keyCode&&J.preventDefault()}function G(J){v(".js-dropdown-toggle").forEach(function(T){var Y=!1;K.dropdowns.forEach(function(W){W.target===
T&&"click"===W.event&&W.fn===S&&(Y=!0)});Y||(K.dropdowns.push({target:T,event:"click",fn:S}),c(T,"click",S))})}function F(){var J=document.querySelector(".js-dropdown.is-active");return J?J:!1}function D(J){var T=J.links.indexOf(document.activeElement);-1===T?T=J.forward?0:J.links.length-1:J.forward?(T+=1,T===J.links.length&&(T=0)):(--T,-1===T&&(T=J.links.length-1));J.links[T].focus()}function L(){var J=F();J&&(J=v(".dropdown-link",J).filter(function(T){return null!==T.offsetParent}),Q.emit("dropdown:focus",
{links:J,forward:!0}))}function O(){var J=F();J&&(J=v(".dropdown-link",J).filter(function(T){return null!==T.offsetParent}),Q.emit("dropdown:focus",{links:J,forward:!1}))}function S(J){l(J);k(J);var T=m("js-dropdown",J.target);Q.emit("dropdown:toggle",{node:T,target:J.target})}function Z(){aa||(Q.on("dropdown:toggle",y),Q.on("dropdown:close",B),Q.on("keyboard:escape",B),Q.on("keyboard:arrow:down",L),Q.on("keyboard:arrow:up",O),Q.on("dropdown:focus",D),aa=!0);G()}function I(){Q.on("scrolling:at",function(T){J.forEach(function(Y){var W=
Y.element;b(Y.element,"is-sticky")&&(W=Y.element.getAttribute("data-sticky-id"),W=document.querySelector('.js-shim[data-sticky-id\x3d"'+W+'"]'));if(W){var R=W.getAttribute("data-top")||0;Y.top=W.offsetTop-parseInt(R,0)}Y.top<T?Q.emit("sticky:stick",Y):Q.emit("sticky:unstick",Y)})});Q.on("sticky:stick",function(T){var Y=T.element.getAttribute("data-sticky-id"),W=document.querySelector('.js-shim[data-sticky-id\x3d"'+Y+'"]');Y&&W&&(p(T.element,"is-sticky"),W.style.display="")});Q.on("sticky:unstick",
function(T){var Y=T.element.getAttribute("data-sticky-id"),W=document.querySelector('.js-shim[data-sticky-id\x3d"'+Y+'"]');Y&&W&&(f(T.element,"is-sticky"),W.style.display="none")});var J=v(".js-sticky").map(function(T){var Y=T.offsetTop,W=T.getAttribute("data-top")||0;T.style.top=W+"px";if(!T.getAttribute("data-sticky-id")){var R=q.raw();T.setAttribute("data-sticky-id",R);var X=T.parentNode,ia=T.cloneNode("deep");p(ia,"js-shim");f(ia,"js-sticky");ia.setAttribute("data-sticky-id",R);ia.style.visibility=
"hidden";ia.style.display="none";X.insertBefore(ia,T)}return{top:Y-parseInt(W,0),element:T}})}function N(){function J(R){var X=R.getAttribute("data-tab");if(X)return X;X=q.raw();R.setAttribute("data-tab",X);return X}function T(R){var X=R.target;b(X,"js-tab")||(X=R.currentTarget);R=m("js-tab-group",X);var ia=J(R);return{parent:R,id:ia,active:X}}function Y(R){R.preventDefault();R=T(R);Q.emit("tabs:active",R)}function W(R){var X=T(R);if(13===R.keyCode||32===R.keyCode)R.preventDefault(),Q.emit("tabs:active",
X);if(39===R.keyCode||37===R.keyCode){var ia=n(X.parent.querySelectorAll(".js-tab")),ka=ia.indexOf(document.activeElement);-1<ka&&b(document.activeElement,"js-tab")&&(X=ia[ka+1]||ia[0],ia=ia[ka-1]||ia[ia.length-1],(39===R.keyCode?X:ia).focus())}}Q.on("tabs:bind",function(){var R=v(".js-tab"),X=v(".js-tab-group"),ia=v(".js-tab-section");X.forEach(function(ka){ka.setAttribute("aria-live","polite");J(ka);ka.children[0].setAttribute("role","tablist");ka=ka.querySelectorAll(".js-tab");for(var ca=100/ka.length,
la=0;la<ka.length;la++)ka[la].style.maxWidth=ca+"%"});R.forEach(function(ka){ka.setAttribute("aria-expanded","false");ka.setAttribute("role","tab");ka.setAttribute("tabindex","0");c(ka,"click",Y);c(ka,"keydown",W)});ia.forEach(function(ka){ka.setAttribute("role","tabpanel");b(ka,"is-active")?ka.setAttribute("aria-expanded",!0):ka.setAttribute("aria-expanded",!1)})});Q.on("tabs:active",function(R){var X=R.parent,ia=n(X.querySelectorAll(".js-tab"));R=R.active;X=n(X.querySelectorAll(".js-tab-section"));
var ka=ia.indexOf(R);ka=X[ka];ia.forEach(function(ca){ca.setAttribute("aria-expanded",!1)});R.setAttribute("aria-expanded",!0);a(ia,R);X.forEach(function(ca){ca.setAttribute("aria-expanded",!1)});ka.setAttribute("aria-expanded",!0);a(X,ka);R.focus()});Q.emit("tabs:bind")}var K={dropdowns:[],accordions:[],modals:[]};g.prototype={on:function(J,T,Y){var W=this.e||(this.e={});(W[J]||(W[J]=[])).push({fn:T,ctx:Y});return this},once:function(J,T,Y){function W(){R.off(J,W);T.apply(Y,arguments)}var R=this;
W._=T;return this.on(J,W,Y)},emit:function(J){var T=[].slice.call(arguments,1),Y=((this.e||(this.e={}))[J]||[]).slice(),W=0,R=Y.length;for(W;W<R;W++)Y[W].fn.apply(Y[W].ctx,T);return this},off:function(J,T){var Y=this.e||(this.e={}),W=Y[J],R=[];if(W&&T)for(var X=0,ia=W.length;X<ia;X++)W[X].fn!==T&&W[X].fn._!==T&&R.push(W[X]);R.length?Y[J]=R:delete Y[J];return this}};var Q=new g,da=/^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$/i;q.EMPTY="00000000-0000-0000-0000-000000000000";q.isGuid=
function(J){return J&&(J instanceof q||da.test(J.toString()))};q.create=function(){return new q([e(2),e(1),e(1),e(1),e(3)].join("-"))};q.raw=function(){return[e(2),e(1),e(1),e(1),e(3)].join("-")};var U=!1,aa=!1;c(document,"keyup",function(J){27===J.keyCode?Q.emit("keyboard:escape"):13===J.keyCode?Q.emit("keyboard:return"):32===J.keyCode?Q.emit("keyboard:space"):38===J.keyCode?Q.emit("keyboard:arrow:up"):40===J.keyCode?Q.emit("keyboard:arrow:down"):37===J.keyCode?Q.emit("keyboard:arrow:left"):39===
J.keyCode&&Q.emit("keyboard:arrow:right")});c(window,"scroll",function(J,T,Y){var W,R,X;var ia=function(){W=!1;R&&(X.apply(Y,R),R=!1)};return X=function(){W?R=arguments:(J.apply(Y,arguments),setTimeout(ia,T),W=!0)}}(function(){Q.emit("scrolling:at",window.pageYOffset)},100));return{bus:Q,accordion:z,dropdown:Z,sticky:I,tabs:N,init:function(){[z,Z,I,N].forEach(function(J){J()})}}})},"arcgisonline/sharing/dijit/dialog/MembershipRequestsDlg":function(){define("require esri/declare esri/Evented dojo/_base/lang dojo/_base/array dojo/on dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dojo/query dojo/string dojo/topic dojo/date/locale dojo/store/Memory dijit/a11yclick dijit/Dialog dijit/form/Button dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin ../../../esriGeowConfig ../../../pages/utils/icons ../../util ../Grid ./GeneralDlg dojo/i18n!arcgisonline/nls/arcgisonline dojo/text!arcgisonline/sharing/dijit/dialog/templates/MembershipRequestsDlg.html".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x,t,w,z,B,A,y,E,G,F,D){var L=n("arcgisonline.sharing.dijit.dialog.MembershipRequestsDlg",[t,w,z,v],{baseClass:"esriMembershipRequestsDlg",widgetsInTemplate:!0,templateString:D,groupId:null,postMixInProperties:function(){this.inherited(arguments);this.i18n=b.mixin({},F.common);b.mixin(this.i18n,F.membershipRequestsDlg);b.mixin(this.i18n,F.groupMembershipRequestsGrid);b.mixin(this.i18n,{error:F.inviteUsersDlg.error})},postCreate:function(){this.loadConnections()},
loadConnections:function(){this.own(l(".jevent").on("click",function(O){O.preventDefault()}),u(this._closeBtn,b.hitch(this,function(){this._dialog.hide()})),g.subscribe("onApplicationAccept",b.hitch(this,"onApplicationApprove")),g.subscribe("onApplicationDecline",b.hitch(this,"onApplicationDecline")))},show:function(O){this.groupId=O;this.clearStore();this.requestApplications();this._dialog.show()},approveApplication:function(O,S){var Z=y.getUser(),I=this._requestsGrid._grid.store;Z&&y.request({url:B.restBaseUrl+
"community/groups/"+this.groupId+"/applications/"+S+"/accept"},{usePost:!0}).then(b.hitch(this,function(){I.remove(O.id);g.publish("onApplicationAccept",{})}),b.hitch(this,function(){var N=new G;f.once(N._dialog,"hide",function(){N._dialog.destroyRecursive();N.destroyRecursive()});N.show({title:this.i18n.errorTitle,message:k.substitute(this.i18n.error.unableToAddPrivs,{user:S})});I.remove(O.id);g.publish("onApplicationAccept",{})}))},declineApplication:function(O,S){var Z=y.getUser(),I=this._requestsGrid._grid.store;
Z&&y.request({url:B.restBaseUrl+"community/groups/"+this.groupId+"/applications/"+S+"/decline"},{usePost:!0}).then(b.hitch(this,function(){I.remove(O.id);g.publish("onApplicationDecline",{})}))},onApplicationApprove:function(){0===this._requestsGrid._grid.store.query().length?this.hide():this.refresh()},onApplicationDecline:function(){0===this._requestsGrid._grid.store.query().length?this.hide():this.refresh()},requestApplications:function(){var O=this._requestsGrid._grid.store;return y.request({url:B.restBaseUrl+
"community/groups/"+this.groupId+"/applications"}).then(b.hitch(this,function(S){S.applications&&(p.forEach(S.applications,function(Z,I){Z.id=I;O.put(Z)}),this.refresh())}))},clearStore:function(){this._requestsGrid||this.createGrid();var O=this._requestsGrid&&this._requestsGrid._grid&&this._requestsGrid._grid.store||void 0;O&&p.forEach(b.clone(O.query()),function(S){O.remove(S.id)})},createGrid:function(){this._requestsGrid=new E({id:"requestsGrid",columns:this.getRequestGridColumns(),noDataMessage:this.i18n.noMembershipRequests,
showLoadingMessage:!1,showHeader:!1,showFooter:!1,selectionMode:"none",rowsPerPage:5,className:"requests-grid",store:new q({idProperty:"id",label:"fullname",data:[]}),sort:[{attribute:"received",descending:!1}]},this._requestsGridContainer);this._requestsGrid.startup();l(".dgrid-status").forEach(function(O){O.tabIndex=-1;a.add(O,"left")})},getRequestGridColumns:function(){return{fullname:{label:" ",sortable:!1,formatter:b.hitch(this,function(O){return O})},username:{label:" ",sortable:!1,formatter:b.hitch(this,
function(O){return O})},received:{label:" ",sortable:!1,formatter:b.hitch(this,function(O){O=new Date(parseFloat(O));return e.format(O,{selector:"date",formatLength:"long"})})},yourResponse:{label:" ",sortable:!1,renderCell:b.hitch(this,function(O){var S=O.username,Z=c.create("div",{className:"esriFloatTrailing"}),I=c.create("button",{innerHTML:"\x3cspan class\x3d'text-green'\x3e"+A.inline.check["16"]+"\x3c/span\x3e"+this.i18n.approve,className:"btn-link btn-link-off-black clickable margin-right-1"},
Z),N=c.create("button",{innerHTML:"\x3cspan class\x3d'text-red'\x3e"+A.inline["minus-circle"]["16"]+"\x3c/span\x3e"+this.i18n.decline,className:"btn-link btn-link-off-black clickable"},Z);this.own(u(I,b.hitch(this,"approveApplication",O,S)),u(N,b.hitch(this,"declineApplication",O,S)));return Z})}}},hide:function(){this._dialog.hide()},refresh:function(){if(this._requestsGrid._grid&&this._requestsGrid._grid._started){var O=this._requestsGrid._grid._currentPage||1,S=this._requestsGrid._grid.store?this._requestsGrid._grid.store.query().length:
0;f.once(this._requestsGrid._grid,"dgrid-refresh-complete",function(Z){Z.grid._currentPage!==O&&0<S&&Z.grid.gotoPage(O)});this._requestsGrid._grid.resize();this._requestsGrid._grid.refresh()}}});L.prototype.statics={getInstance:function(){this._instance||(this._instance=new L);return this._instance}};return L})},"arcgisonline/sharing/dijit/dialog/RendererDlg":function(){define(["dojo","dijit","dojox","dojo/require!dijit/_Widget,dijit/_Templated,dijit/Dialog,arcgisonline/sharing/dijit/dialog/SymbolDlg"],
function(m,n,v){m.provide("arcgisonline.sharing.dijit.dialog.RendererDlg");m.require("dijit._Widget");m.require("dijit._Templated");m.require("dijit.Dialog");m.require("arcgisonline.sharing.dijit.dialog.SymbolDlg");m.declare("arcgisonline.sharing.dijit.dialog.RendererDlg",[n._Widget,n._Templated],{util:arcgisonline.sharing.util,folder:arcgisonline.sharing.geow.Folder,widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContainer"\x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" id\x3d"renderer-dialog" title\x3d"${i18n.rendererDlgTitle}" execute\x3d""\x3e\r\n  \t\r\n    \x3cdiv\x3e\r\n      \x3ctable cellspacing\x3d"10" width\x3d"100%"\x3e\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\x3ctd\x3e\r\n        \x3clabel\x3e${i18n.labelLabel}\x3c/label\x3e\r\n      \x3c/td\x3e\x3ctd\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"rendererLabel" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" required\x3d"true" style\x3d"width:100%; padding:2px;"\x3e\x3c/div\x3e\r\n      \x3c/td\x3e\x3c/tr\x3e\r\n      \x3ctr\x3e\x3ctd\x3e\r\n        \x3clabel\x3e${i18n.valueLabel}\x3c/label\x3e\r\n      \x3c/td\x3e\x3ctd\x3e\r\n        \x3clabel id\x3d"renderer-value"\x3e\x3c/label\x3e\r\n      \x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\x3c/table\x3e\r\n      \x3cdiv\x3e\r\n        \x3cbutton dojotype\x3d"dijit.form.Button" type\x3d"button" dojoAttachPoint\x3d"_rendererSymbolUpdateButton" class\x3d"default esriFloatLeading" dojoAttachEvent\x3d"onClick:_onRendererSymbolUpdateButtonClick"\x3e\r\n          \x3cspan\x3e${i18n.changeSymbolBtn}\x3c/span\x3e\r\n        \x3c/button\x3e\r\n        \x3cbutton dojoAttachEvent\x3d"onClick:_onCancelClick" dojoAttachPoint\x3d"rendererCancelBtn" class\x3d"jevent cancel esriFloatTrailing" type\x3d"cancel" dojotype\x3d"dijit.form.Button"\x3e\r\n          ${i18n.cancel}\r\n        \x3c/button\x3e\r\n        \x3cbutton dojoAttachEvent\x3d"onClick:_onOkClick" dojoAttachPoint\x3d"rendererOkBtn" class\x3d"jevent primary esriFloatTrailing" dojotype\x3d"dijit.form.Button"\x3e\r\n          ${i18n.ok}\r\n        \x3c/button\x3e\r\n\t\t\t\x3c/div\x3e\r\n      \x3cdiv style\x3d"clear:both;"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\t\t\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
i18n:null,symbol:null,onRendererSymbolChangeHandler:null,onRendererSymbolChangeCancelHandler:null,applyRendererEditsHandler:null,statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.RendererDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=m.clone(m.i18n.getLocalization("arcgisonline","arcgisonline").common);m.mixin(this.i18n,m.i18n.getLocalization("arcgisonline","arcgisonline").rendererPanel);
m.mixin(this.i18n,m.i18n.getLocalization("arcgisonline","arcgisonline").rendererDlg)},postCreate:function(){this.loadConnections()},show:function(b){this.symbol=esri.symbol.fromJson(b.symbol.toJson());null===b.value?m.byId("renderer-value").innerHTML=this.i18n.other:m.byId("renderer-value").innerHTML=b.value;this.rendererLabel.set("value",b.label);this.applyRendererEditsHandler=m.subscribe("applyRendererEdits",m.hitch(this,"_onApplyEdits"));n.byId("renderer-dialog").show()},loadConnections:function(){m.query(".jevent").connect("onclick",
function(b){b.preventDefault()})},_onCancelClick:function(){m.publish("onRendererItemChange",[null,null]);n.byId("renderer-dialog").hide()},hide:function(){this.onRendererSymbolChangeHandler&&(m.unsubscribe(this.onRendererSymbolChangeHandler),m.unsubscribe(this.onRendererSymbolChangeCancelHandler));this.applyRendererEditsHandler&&m.unsubscribe(this.applyRendererEditsHandler);this.rendererCancelBtn.set("disabled",!1);this._rendererSymbolUpdateButton.set("disabled",!1);n.byId("renderer-dialog").hide()},
_onRendererSymbolUpdateButtonClick:function(b){this.onRendererSymbolChangeHandler&&(m.unsubscribe(this.onRendererSymbolChangeHandler),m.unsubscribe(this.onRendererSymbolChangeCancelHandler));this.onRendererSymbolChangeHandler=m.subscribe("onSymbolChange",m.hitch(this,"_onRendererSymbolChange"));this.onRendererSymbolChangeCancelHandler=m.subscribe("onSymbolChangeCancel",m.hitch(this,function(){this.onRendererSymbolChangeHandler&&(m.unsubscribe(this.onRendererSymbolChangeHandler),m.unsubscribe(this.onRendererSymbolChangeCancelHandler));
this.rendererCancelBtn.set("disabled",!1);this._rendererSymbolUpdateButton.set("disabled",!1)}));this.rendererCancelBtn.set("disabled",!0);this._rendererSymbolUpdateButton.set("disabled",!0);arcgisonline.sharing.dijit.dialog.SymbolDlg.prototype.statics.getInstance().showSymbol(this.symbol,{applyHandler:m.hitch(this,"_onApplyEdits"),okHandler:m.hitch(this,function(p){this._rendererSymbolUpdateButton.set("disabled",!1);this.symbol=p;m.publish("onRendererItemChange",[p,this.rendererLabel.get("value")]);
m.publish("saveRenderer",[])})})},_onRendererSymbolChange:function(b){this.rendererCancelBtn.set("disabled",!1);this._rendererSymbolUpdateButton.set("disabled",!1);var p=b.toJson();"esriPMS"!=b.type||0!=p.url.length&&"http://"!=p.url||(b=esri.symbol.fromJson(this.markerJson));this.symbol=b},_onOkClick:function(b){b.preventDefault();m.publish("onRendererItemChange",[esri.symbol.fromJson(this.symbol.toJson()),this.rendererLabel.get("value")]);this.hide()},_onApplyEdits:function(b){m.publish("onRendererItemChange",
[b,this.rendererLabel.get("value")]);m.publish("saveRenderer",[])},onKeyDown:function(b){if(window.event)var p=b.keyCode;else b.which&&(p=b.which);13==p&&this._onOkClick(b)}})})},"arcgisonline/sharing/dijit/dialog/SymbolDlg":function(){define(["dojo","dijit","dojox","dojo/require!dijit/Dialog,dijit/_Widget,dijit/_Templated,arcgisonline/sharing/dijit/SymbolOptions"],function(m,n,v){m.provide("arcgisonline.sharing.dijit.dialog.SymbolDlg");m.require("dijit.Dialog");m.require("dijit._Widget");m.require("dijit._Templated");
m.require("arcgisonline.sharing.dijit.SymbolOptions");m.declare("arcgisonline.sharing.dijit.dialog.SymbolDlg",[n._Widget,n._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContent" \x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" id\x3d"symbol-dialog" title\x3d"${i18n.symbolDlgTitle}" execute\x3d""\x3e\r\n\t  \x3cdiv id\x3d"symbol-dialog-symboloptions" dojotype\x3d"arcgisonline.sharing.dijit.SymbolOptions" dojoAttachPoint\x3d"symbolOptions"\x3e\x3c/div\x3e\r\n    \x3cdiv\x3e\r\n      \x3cbutton dojoAttachPoint\x3d"cancelButton" dojoAttachEvent\x3d"onClick:onCancelClick" class\x3d"jevent cancel esriFloatTrailing" dojoType\x3d"dijit.form.Button"\x3e${i18n.cancel}\x3c/button\x3e\r\n      \x3cbutton id\x3d"symbol-dialog-apply" dojoAttachPoint\x3d"applyButton" dojoAttachEvent\x3d"onClick:onApplyClick" class\x3d"jevent cancel esriFloatTrailing" dojoType\x3d"dijit.form.Button"\x3e${i18n.apply}\x3c/button\x3e\r\n  \t  \x3cbutton id\x3d"symbol-dialog-done" dojoAttachEvent\x3d"onClick:onDoneClick" class\x3d"jevent primary esriFloatTrailing" dojoType\x3d"dijit.form.Button"\x3e${i18n.done}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv style\x3d"clear:both;"\x3e\r\n    \x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
i18n:null,applyHandler:null,okHandler:null,statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.SymbolDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=m.clone(m.i18n.getLocalization("arcgisonline","arcgisonline").common);m.mixin(this.i18n,m.i18n.getLocalization("arcgisonline","arcgisonline").symbolDlg)},show:function(b,p){this.cancelButton.set("disabled",!1);var f=b.getLayer();if(b.symbol)this.symbolOptions.symbol=
esri.symbol.fromJson(b.symbol.toJson());else{var d=f.renderer.getSymbol(b);this.symbolOptions.symbol=esri.symbol.fromJson(d.toJson())}for(d=0;d<f.types.length;d++)if(f.types[d].id==b.attributes.TYPEID&&f.types[d].templates&&0<f.types[d].templates.length){this.symbolOptions.template=f.types[d].templates[0];break}p?(this.symbolOptions.endSize=p.endSize,this.symbolOptions.showEndSize=0<p.endSize?!0:!1,this.symbolOptions.showNoBgColor=p.showNoBgColor,this.applyHandler=p.applyHandler,this.okHandler=p.okHandler):
(this.symbolOptions.endSize=0,this.symbolOptions.showEndSize=!1,this.symbolOptions.showNoBgColor=!1,this.okHandler=this.applyHandler=null);this.symbolOptions.init(p?p.noPreDefSymbols:null);n.byId("symbol-dialog").show()},showSymbol:function(b,p){this.cancelButton.set("disabled",!1);this.symbolOptions.symbol=esri.symbol.fromJson(b.toJson());this.symbolOptions.symbol.color||(this.symbolOptions.symbol.color=new m.Color([255,255,255,0]));p?(this.symbolOptions.endSize=p.endSize,this.symbolOptions.showEndSize=
0<p.endSize?!0:!1,this.symbolOptions.showNoBgColor=p.showNoBgColor,this.applyHandler=p.applyHandler,this.okHandler=p.okHandler):(this.symbolOptions.endSize=0,this.symbolOptions.showEndSize=!1,this.symbolOptions.showNoBgColor=!1,this.okHandler=this.applyHandler=null);this.symbolOptions.init(p?p.noPreDefSymbols:null);n.byId("symbol-dialog").show()},hide:function(){this.symbolOptions.hide();n.byId("symbol-dialog").hide()},onDoneClick:function(b){"picturemarkersymbol"===this.symbolOptions.symbol.type&&
8>this.symbolOptions.symbol.url.length||setTimeout(m.hitch(this,function(){var p=0;this.symbolOptions.urlChangesNotApplied&&(p=6E3);setTimeout(m.hitch(this,function(){if(this.okHandler){var f=this.symbolOptions.symbol.toJson();"esriPMS"!=this.symbolOptions.symbol.type||0!=f.url.length&&"http://"!=f.url||(this.symbolOptions.symbol=this.getMarkerJson());this.okHandler(esri.symbol.fromJson(this.symbolOptions.symbol.toJson()))}else this.symbolOptions.showEndSize?m.publish("onSymbolChange",[esri.symbol.fromJson(this.symbolOptions.symbol.toJson()),
this.symbolOptions.endSize]):m.publish("onSymbolChange",[esri.symbol.fromJson(this.symbolOptions.symbol.toJson())]),setTimeout(m.hitch(this,function(){m.publish("applyRendererEdits",[])}),500);this.hide()}),p)}),100)},onApplyClick:function(b){"picturemarkersymbol"===this.symbolOptions.symbol.type&&8>this.symbolOptions.symbol.url.length||setTimeout(m.hitch(this,function(){var p=0;this.symbolOptions.urlChangesNotApplied&&(p=6E3);setTimeout(m.hitch(this,function(){if(this.applyHandler){var f=this.symbolOptions.symbol.toJson();
"esriPMS"!=this.symbolOptions.symbol.type&&"picturemarkersymbol"!=this.symbolOptions.symbol.type||0!=f.url.length&&"http://"!=f.url||(this.symbolOptions.symbol=this.getMarkerJson());this.applyHandler(esri.symbol.fromJson(this.symbolOptions.symbol.toJson()));this.cancelButton.set("disabled",!0)}else this.symbolOptions.showEndSize?m.publish("onSymbolChange",[esri.symbol.fromJson(this.symbolOptions.symbol.toJson()),this.symbolOptions.endSize]):m.publish("onSymbolChange",[esri.symbol.fromJson(this.symbolOptions.symbol.toJson())]),
setTimeout(m.hitch(this,function(){m.publish("applyRendererEdits",[]);this.cancelButton.set("disabled",!0)}),500)}),p)}),100)},onCancelClick:function(b){m.publish("onSymbolChangeCancel",[]);this.hide()}})})},"arcgisonline/sharing/dijit/SymbolOptions":function(){define(["dojo","dijit","dojox","dojo/require!dijit/_Widget,dijit/_Templated,dijit/ColorPalette,dijit/form/HorizontalSlider,arcgisonline/sharing/dijit/dialog/ImgDlg,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/sharing/util"],function(m,
n,v){m.provide("arcgisonline.sharing.dijit.SymbolOptions");m.require("dijit._Widget");m.require("dijit._Templated");m.require("dijit.ColorPalette");m.require("dijit.form.HorizontalSlider");m.require("arcgisonline.sharing.dijit.dialog.ImgDlg");m.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");m.require("arcgisonline.sharing.util");m.declare("arcgisonline.sharing.dijit.SymbolOptions",[n._Widget,n._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv\x3e\r\n  \x3ctable class\x3d"symbolDialogTable"\x3e\r\n   \x3ctbody\x3e\r\n    \x3ctr\x3e \r\n      \x3ctd valign\x3d"top"\x3e\r\n        \x3cdiv\x3e\x3clabel\x3e${i18n.previewLabel}\x3c/label\x3e\x3c/div\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd colspan\x3d"2" valign\x3d"middle" align\x3d"left"\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolImage" style\x3d"height:100%; vertical-align:middle;"\x3e\x3c/div\x3e\r\n      \x3c/td\x3e   \r\n    \x3c/tr\x3e\r\n    \x3ctr\x3e \r\n      \x3ctd colspan\x3d"3" valign\x3d"top"\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolSmallTemplatePicker" style\x3d"display:none;"\x3e\r\n          \x3cdiv dojoAttachPoint\x3d"symbolSimpleMarkerTemplatePickerDiv" class\x3d"symbolTemplatePicker" style\x3d"height:50px; width:350px;"\x3e\r\n            \x3cdiv id\x3d"${id}_symbolSimpleMarkerTemplatePicker"\x3e\x3c/div\x3e  \r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolFullTemplatePicker" style\x3d"display:none;"\x3e\r\n          \x3cdiv dojoAttachPoint\x3d"symbolClassesDiv" style\x3d"width:355px;line-height:normal;"\x3e\r\n            \x3cselect dojoAttachPoint\x3d"symbolColorClasses" style\x3d"width:355px;margin:0;" dojoType\x3d"arcgisonline.sharing.dijit.ComboBox"\x3e\r\n            \x3c/select\x3e       \r\n          \x3c/div\x3e\r\n          \x3cdiv dojoAttachPoint\x3d"symbolClassesTemplatePickerDiv" class\x3d"symbolTemplatePicker" style\x3d"height:130px; width:350px;"\x3e\r\n            \x3cdiv id\x3d"${id}_symbolClassesTemplatePicker" \x3e\x3c/div\x3e  \r\n          \x3c/div\x3e\r\n          \x3cdiv dojoAttachPoint\x3d"symbolAddImageDiv" class\x3d"esriItemLinks" style\x3d"line-height:20px;"\x3e\r\n            \x3cA dojoAttachPoint\x3d"symbolAddImage" href\x3d"JavaScript:void(0);"\x3e${i18n.addImage}\x3c/A\x3e  \r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/td\x3e   \r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolSizeRow"\x3e \r\n      \x3ctd nowrap\x3e\x3clabel dojoAttachPoint\x3d"symbolSizeLabel"\x3e${i18n.symbolSizeLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd\x3e\x3cdiv dojoAttachPoint\x3d"symbolSize" dojoType\x3d"dijit.form.HorizontalSlider" class\x3d"symbolSlider" showbuttons\x3d"false" intermediatechanges\x3d"false" minimum\x3d"1" maximum\x3d"120" value\x3d"1" discretevalues\x3d"1" \x3e\x3c/div\x3e\x3c/td\x3e\r\n      \x3ctd valign\x3d"top"\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolSizeInput" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" style\x3d"width:30px;margin-bottom:3px;"\x3e\x3c/div\x3e\r\n        \x3cdiv style\x3d"display:inline;"\x3e${i18n.shortForPixel}\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolEndSizeRow"\x3e \r\n      \x3ctd nowrap\x3e\x3clabel\x3e${i18n.symbolEndSizeLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd\x3e\x3cdiv dojoAttachPoint\x3d"symbolEndSize" dojoType\x3d"dijit.form.HorizontalSlider" class\x3d"symbolSlider" showbuttons\x3d"false" intermediatechanges\x3d"false" minimum\x3d"1" maximum\x3d"120" value\x3d"1" discretevalues\x3d"1" \x3e\x3c/div\x3e\x3c/td\x3e\r\n      \x3ctd valign\x3d"top"\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolEndSizeInput" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" style\x3d"width:30px;margin-bottom:3px;"\x3e\x3c/div\x3e\r\n        \x3cdiv style\x3d"display:inline;"\x3e${i18n.shortForPixel}\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolBackgroundColorRow"\x3e\r\n      \x3ctd\x3e\x3clabel\x3e${i18n.colorLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd colspan\x3d"2"\x3e\x3cdiv dojoAttachPoint\x3d"symbolBackgroundColor" class\x3d"symbolColorBox"\x3e\x3c/div\x3e\x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolLinePatternRow"\x3e\r\n      \x3ctd\x3e\x3clabel\x3e${i18n.patternLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd colspan\x3d"2"\x3e\r\n        \x3cdiv\x3e\r\n          \x3cselect dojoAttachPoint\x3d"symbolLinePatternSelect" id\x3d"symbolLinePatternSelect" dojoType\x3d"dijit.form.Select" class\x3d"symbolLinePatternSelect"\x3e\r\n          \x3c/select\x3e\r\n        \x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolTransparencyRow"\x3e\r\n      \x3ctd\x3e\x3clabel\x3e${i18n.transparencyLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd width\x3d"125" valign\x3d"top"\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolTransparency" dojoType\x3d"dijit.form.HorizontalSlider" class\x3d"symbolSlider" style\x3d"line-height:normal;margin-top:7px;" showbuttons\x3d"false" intermediatechanges\x3d"true" minimum\x3d"0" maximum\x3d"1" value\x3d"0" discretevalues\x3d"0.01" \x3e\r\n          \x3cdiv dojoType\x3d"dijit.form.HorizontalRule" container\x3d"bottomDecoration" count\x3d"2" style\x3d"height:5px;"\x3e\x3c/div\x3e\r\n          \x3col dojoType\x3d"dijit.form.HorizontalRuleLabels" container\x3d"bottomDecoration" style\x3d"font-size:0.8em;"\x3e\r\n            \x3cli\x3e0\x3c/li\x3e\x3cli\x3e100%\x3c/li\x3e\r\n          \x3c/ol\x3e\r\n        \x3c/div\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolTransparencyInput" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" style\x3d"width:30px;margin-bottom:3px;"\x3e\x3c/div\x3e\r\n        \x3cdiv style\x3d"display:inline;"\x3e%\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolOutlineColorRow"\x3e\r\n      \x3ctd\x3e\x3clabel\x3e${i18n.outlineColorLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd colspan\x3d"2"\x3e\x3cdiv dojoAttachPoint\x3d"symbolOutlineColor" class\x3d"symbolColorBox"\x3e\x3c/div\x3e\x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolWidthRow"\x3e \r\n      \x3ctd\x3e\x3clabel dojoAttachPoint\x3d"symbolWidthLabel" \x3e${i18n.outlineWidthLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd\x3e\x3cdiv dojoAttachPoint\x3d"symbolWidth" dojoType\x3d"dijit.form.HorizontalSlider" class\x3d"symbolSlider" showbuttons\x3d"false" intermediatechanges\x3d"true" minimum\x3d"0" maximum\x3d"18" value\x3d"1" discretevalues\x3d"1" \x3e\x3c/div\x3e\x3c/td\x3e\r\n      \x3ctd\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolWidthInput" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" style\x3d"width:30px;margin-bottom:3px;"\x3e\x3c/div\x3e\r\n        \x3cdiv style\x3d"display:inline;"\x3e${i18n.shortForPixel}\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr dojoAttachPoint\x3d"symbolEndWidthRow"\x3e \r\n      \x3ctd nowrap\x3e\x3clabel\x3e${i18n.symbolEndWidthLabel}\x3c/label\x3e\x3c/td\x3e\r\n      \x3ctd\x3e\x3cdiv dojoAttachPoint\x3d"symbolEndWidth" dojoType\x3d"dijit.form.HorizontalSlider" class\x3d"symbolSlider" showbuttons\x3d"false" intermediatechanges\x3d"false" minimum\x3d"1" maximum\x3d"18" value\x3d"1" discretevalues\x3d"1" \x3e\x3c/div\x3e\x3c/td\x3e\r\n      \x3ctd valign\x3d"top"\x3e\r\n        \x3cdiv dojoAttachPoint\x3d"symbolEndWidthInput" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" style\x3d"width:30px;margin-bottom:3px;"\x3e\x3c/div\x3e\r\n        \x3cdiv style\x3d"display:inline;"\x3e${i18n.shortForPixel}\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n   \x3c/tbody\x3e\r\n  \x3c/table\x3e                \r\n\r\n  \x3cimg id\x3d"${id}_testImage" style\x3d"position:absolute;top:0;left:-3000px"/\x3e\r\n\r\n  \x3cdiv dojoAttachPoint\x3d"symbolColorTooltip" dojotype\x3d"dijit.TooltipDialog" title\x3d"" style\x3d"display:none; width:265px;"\x3e\r\n    \x3cdiv class\x3d"esriFloatTrailing"\x3e\x3cA class\x3d"symbolColorPaletteClose" dojoAttachPoint\x3d"symbolColorTooltipClose" href\x3d"JavaScript:void(0);" title\x3d"${i18n.close}"\x3e\x3c/A\x3e\x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"symbolColorPalette" style\x3d"margin-top: 7px;" dojotype\x3d"dijit.ColorPalette" palette\x3d"7x10" dojoAttachEvent\x3d"onChange:onColorSelection"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \r\n\x3c/div\x3e\r\n',
i18n:null,symbol:null,template:null,colorPicker:"",savedSimpleMarkerSymbol:null,savedPictureMarkerSymbol:null,eventHandlers:null,testImageHandler:null,symbolListItems:null,symbolClassesTemplatePicker:null,simpleMarkerTemplatePicker:null,templatePickerOnSelectionChangeHandler:null,simpleMarkerTemplatePickerOnSelectionChangeHandler:null,templatePickerSymbolClass:null,symbolClassStore:null,urlChangesNotApplied:!1,cachedImages:[],onImageChangeHandler:null,showEndSize:!1,showNoBgColor:!1,endSize:0,simpleMarkerSymbols:[{name:"Circle",
type:"esriSMS",style:"esriSMSCircle",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Square",type:"esriSMS",style:"esriSMSSquare",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Diamond",type:"esriSMS",style:"esriSMSDiamond",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Cross",type:"esriSMS",style:"esriSMSCross",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"X",type:"esriSMS",style:"esriSMSX",
color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}}],markerJson:{type:"esriPMS",url:"/Symbols/Basic/RedSphere.png",imageData:"iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAGXRFWHRTb2Z0d2FyZQBQYWludC5ORVQgdjMuNS4xTuc4+QAAB3VJREFUeF7tmPlTlEcexnve94U5mANQbgQSbgiHXHINlxpRIBpRI6wHorLERUmIisKCQWM8cqigESVQS1Kx1piNi4mW2YpbcZONrilE140RCTcy3DDAcL/zbJP8CYPDL+9Ufau7uqb7eZ7P+/a8PS8hwkcgIBAQCAgEBAICAYGAQEAgIBAQCAgEBAICAYGAQEAgIBAQCDx/AoowKXFMUhD3lQrioZaQRVRS+fxl51eBTZUTdZ41U1Rox13/0JF9csGJ05Qv4jSz/YPWohtvLmSKN5iTGGqTm1+rc6weICOBRbZs1UVnrv87T1PUeovxyNsUP9P6n5cpHtCxu24cbrmwKLdj+osWiqrVKhI0xzbmZ7m1SpJ+1pFpvE2DPvGTomOxAoNLLKGLscZYvB10cbYYjrJCb7A5mrxleOBqim+cWJRakZY0JfnD/LieI9V1MrKtwokbrAtU4Vm0A3TJnphJD4B+RxD0u0LA7w7FTE4oprOCMbklEGNrfdGf4IqnQTb4wc0MFTYibZqM7JgjO8ZdJkpMln/sKu16pHZGb7IfptIWg389DPp9kcChWODoMuDdBOhL1JgpisbUvghM7AqFbtNiaFP80RLnhbuBdqi0N+1dbUpWGde9gWpuhFi95yL7sS7BA93JAb+Fn8mh4QujgPeTgb9kAZf3Apd2A+fXQ38yHjOHozB1IAJjOSEY2RSIwVUv4dd4X9wJccGHNrJ7CYQ4GGjLeNNfM+dyvgpzQstKf3pbB2A6m97uBRE0/Ergcxr8hyqg7hrwn0vAtRIKIRX6Y2pMl0RhIj8co9nBGFrvh55l3ngU7YObng7IVnFvGS+BYUpmHziY/Ls2zgP9SX50by/G9N5w6I+ogYvpwK1SoOlHQNsGfWcd9Peqof88B/rTyzF9hAIopAByQzC0JQB9ST5oVnvhnt+LOGsprvUhxNIwa0aY7cGR6Cp7tr8+whkjawIxkRWC6YJI6N+lAKq3Qf/Tx+B77oGfaQc/8hB8w2Xwtw9Bf3kzZspXY/JIDEbfpAB2BKLvVV90Jvjgoac9vpRxE8kciTVCBMMkNirJ7k/tRHyjtxwjKV4Yp3t/6s+R4E+/DH3N6+BrS8E314Dvvg2+/Sb4hxfBf5sP/up2TF3ZhonK1zD6dhwGdwail26DzqgX8MRKiq9ZBpkSkmeYOyPM3m9Jjl+1Z9D8AgNtlAq6bZ70qsZi+q+bwV/7I/hbB8D/dAr8Axq89iz474p/G5++koHJy1sx/lkGdBc2YjA3HF0rHNHuboomuQj/5DgclIvOGCGCYRKFFuTMV7YUAD3VDQaLMfyqBcZORGPy01QKYSNm/rYV/Nd/Av9NHvgbueBrsjDzRQamKKDxT9Kgq1iLkbIUDOSHoiNcgnYHgnYZi+9ZExSbiSoMc2eE2flKcuJLa4KGRQz6/U0wlGaP0feiMH4uFpMXEjBVlYjp6lWY+SSZtim0kulYMiYuJEJXuhTDJ9UYPByOvoIwdCxfgE4bAo0Jh39xLAoVpMwIEQyTyFCQvGpLon9sJ0K3J4OBDDcMH1dj9FQsxkrjMPFRPCbOx2GyfLal9VEcxstioTulxjAFNfROJPqLl6Bnfyg6V7ugz5yBhuHwrZjBdiU5YJg7I8wOpifAKoVIW7uQ3rpOBH2b3ekVjYT2WCRG3o+mIGKgO0OrlIaebU/HYOQDNbQnojB4NJyGD0NPfjA0bwTRE6Q7hsUcWhkWN8yZqSQlWWGECAZLmJfJmbrvVSI8taK37xpbdB/wQW8xPee/8xIGjvlj8IQ/hk4G0JbWcX8MHPVDX4kveoq8ocn3xLM33NCZRcPHOGJYZIKfpQyq7JjHS6yJjcHujLHADgkpuC7h8F8zEVqXSNC2awE69lqhs8AamkO26HrbDt2H7dBVQov2NcW26CiwQtu+BWjdY4n2nZboTbfCmKcCnRyDO/YmyLPnDlHvjDH8G6zhS9/wlEnYR7X00fWrFYuWdVI0ZpuhcbcczW/R2qdAcz6t/bRov4mONeaaoYl+p22rHF0bVNAmKtBvweIXGxNcfFH8eNlC4m6wMWMusEnKpn5hyo48pj9gLe4SNG9QoGGLAk8z5XiaJUd99u8122/IpBA2K9BGg2vWWKAvRYVeLzEa7E1R422m2+MsSTem97nSYnfKyN6/mzATv7AUgqcMrUnmaFlLX3ysM0fj+t/b5lQLtK22QEfyAmiSLKFZpUJ7kBRPXKW4HqCYynWVHKSG2LkyZex1uO1mZM9lKem9Tx9jjY5iNEYo0bKMhn7ZAu0r6H5PpLXCAq0rKJClSjSGynE/QIkrQYqBPe6S2X+AJsY2Ped6iWZk6RlL0c2r5szofRsO9R5S1IfQLRCpQL1aifoYFerpsbkuTImaUJXuXIDiH6/Ys8vm3Mg8L2i20YqsO7fItKLcSXyn0kXccclVqv3MS6at9JU/Ox+ouns+SF6Z4cSupz7l8+z1ucs7LF1AQjOdxfGZzmx8Iu1TRcfnrioICAQEAgIBgYBAQCAgEBAICAQEAgIBgYBAQCAgEBAICAQEAv8H44b/6ZiGvGAAAAAASUVORK5CYII\x3d",
contentType:"image/png",width:15,height:15},postMixInProperties:function(){this.inherited(arguments);this.i18n=m.clone(m.i18n.getLocalization("arcgisonline","arcgisonline").common);m.mixin(this.i18n,m.i18n.getLocalization("arcgisonline","arcgisonline").generalDlg);m.mixin(this.i18n,m.i18n.getLocalization("arcgisonline","arcgisonline").imgDlg);m.mixin(this.i18n,m.i18n.getLocalization("arcgisonline","arcgisonline").symbolDlg)},postCreate:function(){this.symbolLinePatternSelect._getMenuItemForOption=
function(b){if(b.value||b.label){var p=m.hitch(this,"_setValueAttr",b);b=new n.MenuItem({option:b,label:b.label||this.emptyLabel,onClick:p,ownerDocument:this.ownerDocument,dir:this.dir,disabled:b.disabled||!1,iconClass:b.iconClass});b.focusNode.setAttribute("role","option");return b}return new n.MenuSeparator({ownerDocument:this.ownerDocument})};this.symbolLinePatternSelect.addOption({value:"solid",iconClass:"symbolLinePatternSolid"});this.symbolLinePatternSelect.addOption({value:"dot",iconClass:"symbolLinePatternDot"});
this.symbolLinePatternSelect.addOption({value:"dash",iconClass:"symbolLinePatternDash"});this.symbolLinePatternSelect.addOption({value:"dashdot",iconClass:"symbolLinePatternDashDot"});this.symbolLinePatternSelect.addOption({value:"dashdotdot",iconClass:"symbolLinePatternDashDotDot"});this._symbolCloseIcon&&m.attr(this._symbolCloseIcon,"src",arcgisonline.sharing.util.relativeToExplicitUrl("images/close.gif"));m.connect(this.symbolLinePatternSelect,"onChange",m.hitch(this,"onPatternChange"));this.loadConnections()},
init:function(b){this.savedPictureMarkerSymbol=this.savedSimpleMarkerSymbol=null;if(this.symbol){if(!b||"picturemarkersymbol"!==this.symbol.type&&"simplemarkersymbol"!==this.symbol.type)if(b)m.style(this.symbolFullTemplatePicker,"display","none"),m.style(this.symbolSmallTemplatePicker,"display","none");else if(m.style(this.symbolSmallTemplatePicker,"display","none"),m.style(this.symbolFullTemplatePicker,"display","block"),this.symbolListItems)if(this.templatePickerSymbolClass!==this.symbol.type&&
("simplemarkersymbol"!==this.templatePickerSymbolClass&&"picturemarkersymbol"!==this.templatePickerSymbolClass||"picturemarkersymbol"!==this.symbol.type&&"simplemarkersymbol"!==this.symbol.type)){if("simplemarkersymbol"===this.symbol.type||"picturemarkersymbol"===this.symbol.type)for(b=0;b<this.symbolListItems.length;b++){var p=this.symbolListItems[b];if(-1<p.typeKeywordsString.indexOf("marker")&&-1<p.typeKeywordsString.indexOf("default")){this.symbolColorClasses.set("value",p.title);break}}this.getSymbolListData(!0)}else this.getSymbolListData();
else this.getSymbolListGroup();else m.style(this.symbolFullTemplatePicker,"display","none"),m.style(this.symbolSmallTemplatePicker,"display","block"),setTimeout(m.hitch(this,function(){this.createSimpleMarkerTemplatePicker()}),0);this.updateUI();this.enableEvents();this.symbolClassesTemplatePicker&&this.symbolClassesTemplatePicker.clearSelection();this.simpleMarkerTemplatePicker&&this.simpleMarkerTemplatePicker.clearSelection()}},hide:function(){this.disableEvents();n.popup.close(this.symbolColorTooltip);
this.destroySymbolClassesTemplatePicker();this.destroySimpleMarkerTemplatePicker()},loadConnections:function(){m.query(".jevent").connect("onclick",function(b){b.preventDefault()});m.connect(this.symbolColorTooltipClose,"onclick",m.hitch(this,function(b){b.preventDefault();n.popup.close(this.symbolColorTooltip)}));m.connect(this.symbolBackgroundColor,"onclick",this,"onBackgroundColorClick");m.connect(this.symbolOutlineColor,"onclick",this,"onOutlineColorClick");m.connect(this.symbolAddImage,"onclick",
this,"onAddImage")},updateUI:function(){this.symbolImage.innerHTML="";if("simplemarkersymbol"===this.symbol.type||"picturemarkersymbol"===this.symbol.type)m.style(this.symbolClassesDiv,"display","block"),m.style(this.symbolClassesTemplatePickerDiv,"display","block"),m.style(this.symbolSizeRow,"display",""),this.symbolSizeLabel.innerHTML=this.i18n.symbolSizeLabel,m.style(this.symbolEndSizeRow,"display","none"),m.style(this.symbolEndWidthRow,"display","none"),m.style(this.symbolAddImageDiv,"display",
""),"simplemarkersymbol"===this.symbol.type?(m.style(this.symbolBackgroundColorRow,"display",this.showNoBgColor?"none":""),m.style(this.symbolLinePatternRow,"display","none"),m.style(this.symbolOutlineColorRow,"display",""),m.style(this.symbolWidthRow,"display",""),this.symbolWidthLabel.innerHTML=this.i18n.outlineWidthLabel,m.style(this.symbolTransparencyRow,"display",""),this.symbolSize.set("value",this.symbol.size,!1),this.symbolSizeInput.set("value",Math.round(this.symbol.size),!1),this.showEndSize&&
(this.symbolSizeLabel.innerHTML=this.i18n.symbolStartSizeLabel,this.symbolEndSize.set("value",this.endSize,!1),this.symbolEndSizeInput.set("value",Math.round(this.endSize),!1),m.style(this.symbolEndSizeRow,"display","")),m.style(this.symbolBackgroundColor,"background",this.symbol.color.toHex()),this.symbolTransparency.set("value",1-this.symbol.color.toRgba()[3],!1),this.symbolTransparencyInput.set("value",Math.round(100*(1-this.symbol.color.toRgba()[3])),!1),m.style(this.symbolOutlineColor,"background",
this.symbol.outline.color.toHex()),this.symbolWidth.set("value",this.symbol.outline.width,!1),this.symbolWidthInput.set("value",Math.round(this.symbol.outline.width),!1)):"picturemarkersymbol"===this.symbol.type&&(m.style(this.symbolBackgroundColorRow,"display","none"),m.style(this.symbolLinePatternRow,"display","none"),m.style(this.symbolOutlineColorRow,"display","none"),m.style(this.symbolWidthRow,"display","none"),m.style(this.symbolTransparencyRow,"display","none"),this.symbolSize.set("value",
this.symbol.width,!1),this.symbolSizeInput.set("value",Math.round(this.symbol.width),!1),this.showEndSize&&(this.symbolSizeLabel.innerHTML=this.i18n.symbolStartSizeLabel,this.symbolEndSize.set("value",this.endSize,!1),this.symbolEndSizeInput.set("value",Math.round(this.endSize),!1),m.style(this.symbolEndSizeRow,"display","")));else if("simplelinesymbol"===this.symbol.type||"cartographiclinesymbol"===this.symbol.type)m.style(this.symbolBackgroundColorRow,"display",this.showNoBgColor?"none":""),m.style(this.symbolAddImageDiv,
"display","none"),m.style(this.symbolClassesDiv,"display","none"),m.style(this.symbolClassesTemplatePickerDiv,"display","block"),m.style(this.symbolSizeRow,"display","none"),m.style(this.symbolTransparencyRow,"display",""),m.style(this.symbolEndSizeRow,"display","none"),this.setLinePattern(),m.style(this.symbolLinePatternRow,"display",""),this.symbolTransparency.set("disabled",!1),this.symbolTransparencyInput.set("disabled",!1),m.style(this.symbolOutlineColorRow,"display","none"),m.style(this.symbolWidthRow,
"display",""),this.symbolWidthLabel.innerHTML=this.i18n.symbolWidthLabel,m.style(this.symbolEndWidthRow,"display","none"),m.style(this.symbolBackgroundColor,"background",this.symbol.color.toHex()),this.symbolTransparency.set("value",1-this.symbol.color.toRgba()[3],!1),this.symbolTransparencyInput.set("value",Math.round(100*(1-this.symbol.color.toRgba()[3])),!1),this.symbolWidth.set("value",this.symbol.width,!1),this.symbolWidthInput.set("value",Math.round(this.symbol.width),!1),this.showEndSize&&
(this.symbolWidthLabel.innerHTML=this.i18n.symbolStartWidthLabel,this.symbolEndWidth.set("value",this.endSize,!1),this.symbolEndWidthInput.set("value",Math.round(this.endSize),!1),m.style(this.symbolEndWidthRow,"display","")),this.onPatternChange();else if("simplefillsymbol"===this.symbol.type||"picturefillsymbol"===this.symbol.type)m.style(this.symbolBackgroundColorRow,"display",this.showNoBgColor?"none":""),m.style(this.symbolAddImageDiv,"display","none"),m.style(this.symbolClassesDiv,"display",
"none"),m.style(this.symbolClassesTemplatePickerDiv,"display","block"),m.style(this.symbolSizeRow,"display","none"),m.style(this.symbolTransparencyRow,"display",""),m.style(this.symbolEndSizeRow,"display","none"),m.style(this.symbolEndWidthRow,"display","none"),m.style(this.symbolLinePatternRow,"display","none"),m.style(this.symbolOutlineColorRow,"display",""),m.style(this.symbolWidthRow,"display",""),m.style(this.symbolEndWidthRow,"display","none"),this.symbolWidthLabel.innerHTML=this.i18n.outlineWidthLabel,
this.symbolTransparency.set("disabled",!1),this.symbolTransparencyInput.set("disabled",!1),m.style(this.symbolBackgroundColor,"backgroundColor",this.symbol.color.toHex()),this.symbolTransparency.set("value",1-this.symbol.color.toRgba()[3],!1),this.symbolTransparencyInput.set("value",Math.round(100*(1-this.symbol.color.toRgba()[3])),!1),m.style(this.symbolOutlineColor,"backgroundColor",this.symbol.outline.color.toHex()),this.symbolWidth.set("value",this.symbol.outline.width,!1),this.symbolWidthInput.set("value",
Math.round(this.symbol.outline.width),!1);this._drawSymbol()},enableEvents:function(){this.eventHandlers=[];this.eventHandlers.push(m.connect(this.symbolSize,"onChange",this,"onSizeChange"));this.eventHandlers.push(m.connect(this.symbolSize._movable,"onMoveStop",this,"onSizeChange"));this.eventHandlers.push(m.connect(this.symbolSizeInput,"onChange",this,"onSizeChangeByInput"));this.eventHandlers.push(m.connect(this.symbolEndSize,"onChange",this,"onEndSizeChange"));this.eventHandlers.push(m.connect(this.symbolEndSize._movable,
"onMoveStop",this,"onEndSizeChange"));this.eventHandlers.push(m.connect(this.symbolEndSizeInput,"onChange",this,"onEndSizeChangeByInput"));this.eventHandlers.push(m.connect(this.symbolTransparency,"onChange",this,"onTransparencyChange"));this.eventHandlers.push(m.connect(this.symbolTransparency._movable,"onMoveStop",this,"onTransparencyChange"));this.eventHandlers.push(m.connect(this.symbolTransparencyInput,"onChange",this,"onTransparencyChangeByInput"));this.eventHandlers.push(m.connect(this.symbolWidth,
"onChange",this,"onWidthChange"));this.eventHandlers.push(m.connect(this.symbolWidth._movable,"onMoveStop",this,"onWidthChange"));this.eventHandlers.push(m.connect(this.symbolWidthInput,"onChange",this,"onWidthChangeByInput"));this.eventHandlers.push(m.connect(this.symbolEndWidth,"onChange",this,"onEndWidthChange"));this.eventHandlers.push(m.connect(this.symbolEndWidth._movable,"onMoveStop",this,"onEndWidthChange"));this.eventHandlers.push(m.connect(this.symbolEndWidthInput,"onChange",this,"onEndWidthChangeByInput"));
this.eventHandlers.push(m.connect(this.symbolLinePatternSelect,"onChange",m.hitch(this,"onSymbolLinePatternChange")));this.eventHandlers.push(m.connect(this.symbolColorClasses,"onChange",this,"onSymbolListChange"))},disableEvents:function(){this.eventHandlers&&(m.forEach(this.eventHandlers,function(b){m.disconnect(b)}),this.eventHandlers=null)},onPatternChange:function(){m.removeClass(this.symbolLinePatternSelect.containerNode,"symbolLinePatternSolid symbolLinePatternDot symbolLinePatternDash symbolLinePatternDashDot symbolLinePatternDashDotDot");
"solid"==this.symbolLinePatternSelect.get("value")?m.addClass(this.symbolLinePatternSelect.containerNode,"symbolLinePatternSolid"):"dot"==this.symbolLinePatternSelect.get("value")?m.addClass(this.symbolLinePatternSelect.containerNode,"symbolLinePatternDot"):"dash"==this.symbolLinePatternSelect.get("value")?m.addClass(this.symbolLinePatternSelect.containerNode,"symbolLinePatternDash"):"dashdot"==this.symbolLinePatternSelect.get("value")?m.addClass(this.symbolLinePatternSelect.containerNode,"symbolLinePatternDashDot"):
"dashdotdot"==this.symbolLinePatternSelect.get("value")&&m.addClass(this.symbolLinePatternSelect.containerNode,"symbolLinePatternDashDotDot")},onBackgroundColorClick:function(b){this.colorPicker="background";n.popup.open({popup:this.symbolColorTooltip,around:b.target})},onOutlineColorClick:function(b){this.colorPicker="outline";n.popup.open({popup:this.symbolColorTooltip,around:b.target})},onColorSelection:function(b){n.popup.close(this.symbolColorTooltip);b=(new m.Color(b)).toRgba();"background"===
this.colorPicker||"simplelinesymbol"===this.symbol.type?(b[3]=this.symbol.color.toRgba()[3],this.symbol.color.setColor(b)):this.symbol.outline.color.setColor(b);this.updateUI()},onTransparencyChange:function(b){b=this.symbol.color.toRgba();var p=this.symbolTransparency.getValue();p=m.number.round(p,2);b[3]=1-p;this.symbol.color.setColor(b);this.updateUI()},onTransparencyChangeByInput:function(b){isNaN(b)?this.symbolTransparencyInput.set("value",Math.round(100*this.symbolTransparency.getValue()),!1):
(b=Math.round(b),0>b||100<b?this.symbolTransparencyInput.set("value",Math.round(100*this.symbolTransparency.getValue()),!1):this.symbolTransparency.set("value",b/100,!1))},onWidthChange:function(b){if(!isNaN(b)){var p=this.symbolWidth.getValue();p=Math.round(p);"simplefillsymbol"===this.symbol.type||"simplemarkersymbol"===this.symbol.type?this.symbol.outline.width!=b&&(this.symbol.outline.setWidth(p),this.symbol.outline.setStyle(esri.symbol.SimpleLineSymbol.STYLE_SOLID),b=this.symbol.outline.color.toRgba(),
b[3]=1,this.symbol.outline.color.setColor(b),this.updateUI()):this.symbol.width!=b&&(this.symbol.setWidth(p),this.updateUI())}},onWidthChangeByInput:function(b){isNaN(b)?this.symbolWidthInput.set("value",this.symbolWidth.getValue(),!1):(b=Math.round(b),0>b||18<b?this.symbolWidthInput.set("value",this.symbolWidth.getValue(),!1):this.symbolWidth.set("value",b,!0))},onEndWidthChange:function(b){isNaN(b)||(b=this.symbolEndWidth.getValue(),b=Math.round(b),b<this.symbolWidthInput.getValue()?this.symbolEndWidth.set("value",
this.symbolEndWidthInput.getValue(),!1):(this.symbolEndWidthInput.set("value",b,!1),this.endSize=b))},onEndWidthChangeByInput:function(b){isNaN(b)?this.symbolEndWidthInput.set("value",Math.round(this.symbolEndWidth.getValue()),!1):(b=Math.round(b),1>b||120<b||b<this.symbolWidth.getValue()?this.symbolEndWidthInput.set("value",Math.round(this.symbolEndWidth.getValue()),!1):(this.symbolEndWidth.set("value",b,!1),this.endSize=b))},onSizeChange:function(b){if(!isNaN(b)){b=this.symbol.width;var p=this.symbolSize.getValue();
p=Math.round(p);if(b!=p)if(this.showEndSize&&p>this.symbolEndSizeInput.getValue())this.symbolSize.set("value",this.symbolSizeInput.getValue(),!1);else{if("picturemarkersymbol"===this.symbol.type){this.symbol.setHeight(this.symbol.height/this.symbol.width*p);this.symbol.setWidth(p);if(!this.symbol.url||"http://"===this.symbol.url||-1==this.symbol.url.indexOf("http://")&&-1==this.symbol.url.indexOf("data:"))return;if(this.symbol.xoffset||this.symbol.yoffset)p=this.symbol.width,b=p/b,this.symbol.setOffset(Math.round(this.symbol.xoffset*
b),Math.round(this.symbol.yoffset*b))}else this.symbol.setSize(p);this.updateUI()}}},onSizeChangeByInput:function(b){isNaN(b)?this.symbolSizeInput.set("value",Math.round(this.symbolSize.getValue()),!1):(b=Math.round(b),1>b||120<b||this.showEndSize&&b>this.symbolEndSize.getValue()?this.symbolSizeInput.set("value",Math.round(this.symbolSize.getValue()),!1):this.symbolSize.set("value",b,!0))},onEndSizeChange:function(b){isNaN(b)||(b=this.symbolEndSize.getValue(),b=Math.round(b),b<this.symbolSizeInput.getValue()?
this.symbolEndSize.set("value",this.symbolEndSizeInput.getValue(),!1):(this.symbolEndSizeInput.set("value",b,!1),this.endSize=b))},onEndSizeChangeByInput:function(b){isNaN(b)?this.symbolEndSizeInput.set("value",Math.round(this.symbolEndSize.getValue()),!1):(b=Math.round(b),1>b||120<b||b<this.symbolSize.getValue()?this.symbolEndSizeInput.set("value",Math.round(this.symbolEndSize.getValue()),!1):(this.symbolEndSize.set("value",b,!1),this.endSize=b))},onUrlChange:function(b){if(b&&!(10>b.length)&&0===
b.indexOf("http")){this.urlChangesNotApplied=!0;for(var p=function(c){clearTimeout(a);a=null;var h=m.style(m.byId(this.id+"_testImage"),"width"),l=m.style(m.byId(this.id+"_testImage"),"height");c.w&&c.h&&(h=c.w,l=c.h);1==h&&1==l?(this.urlChangesNotApplied=!1,this.updateUI(),arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorDlgTitle,message:this.i18n.error.invalidUrl})):(0===h&&(h=40),0===l&&(l=h),c.w&&c.h||this.cachedImages.push({url:b,w:h,h:l}),
this.symbol=new esri.symbol.PictureMarkerSymbol,this.symbol.setWidth(Math.min(120,h)),this.symbolSize.set("value",this.symbol.width,!1),this.symbol.setHeight(l/h*this.symbol.width),this.symbol.setUrl(b),this.updateUI(),this.urlChangesNotApplied=!1)},f=0;f<this.cachedImages.length;f++){var d=this.cachedImages[f];if(d.url==b){m.hitch(this,p)(d);return}}this.testImageHandler&&m.disconnect(this.testImageHandler);this.testImageHandler=m.connect(m.byId(this.id+"_testImage"),"onload",this,p,{});var a=setTimeout(m.hitch(this,
function(){clearTimeout(a);a=null;this.urlChangesNotApplied=!1;arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorDlgTitle,message:this.i18n.error.invalidUrl})}),5E3);m.byId(this.id+"_testImage").src=b}},onAddImage:function(b){this.onImageChangeHandler&&m.unsubscribe(this.onImageChangeHandler);this.onImageChangeHandler=m.subscribe("onUrlChange",m.hitch(this,"onUrlChange"));arcgisonline.sharing.dijit.dialog.ImgDlg.prototype.statics.getInstance().show()},
onSymbolLinePatternChange:function(){if("simplelinesymbol"===this.symbol.type||"cartographiclinesymbol"===this.symbol.type){switch(this.symbolLinePatternSelect.getValue()){case "dot":this.symbol.setStyle(esri.symbol.SimpleLineSymbol.STYLE_DOT);break;case "dash":this.symbol.setStyle(esri.symbol.SimpleLineSymbol.STYLE_DASH);break;case "dashdot":this.symbol.setStyle(esri.symbol.SimpleLineSymbol.STYLE_DASHDOT);break;case "dashdotdot":this.symbol.setStyle(esri.symbol.SimpleLineSymbol.STYLE_DASHDOTDOT);
break;default:this.symbol.setStyle(esri.symbol.SimpleLineSymbol.STYLE_SOLID)}this.updateUI()}},getSymbolListGroup:function(){arcgisonline.sharing.geow.Community.searchGroups(esriGeowConfig.symbolSetsGroupQuery,m.hitch(this,function(b,p){b&&b.results&&0<b.results.length&&this.getSymbolListItems(b.results[0].id)}),m.hitch(this,function(b,p){}))},getSymbolListItems:function(b){b=esriGeowConfig.restBaseUrl+"search?num\x3d20\x26q\x3dgroup:"+b+' AND type:"Symbol Set"';b="vml"===v.gfx.renderer?b+' AND -typekeywords:"by value"':
b+' AND ((typekeywords:"by value" AND typekeywords:"marker") OR typekeywords:"fill" OR typekeywords:"line")';arcgisonline.sharing.util.getJson(b,m.hitch(this,function(p,f){p.results&&0<p.results.length&&(this.symbolListItems=p.results,this.symbolListItems.sort(function(d,a){return d.title==a.title?0:d.title<a.title?-1:1}),m.forEach(this.symbolListItems,function(d,a){d.typeKeywordsString=d.typeKeywords.toString();if(-1<d.typeKeywordsString.indexOf("default")&&-1<d.typeKeywordsString.indexOf("marker")){var c=
this.symbolListItems.splice(a,1);0<c.length&&(this.symbolListItems.splice(0,0,c[0]),this.symbolColorClasses.set("value",d.title))}},this),this.symbolClassStore=new m.data.ItemFileWriteStore({data:{identifier:"id",items:[]}}),m.forEach(this.symbolListItems,function(d){-1<d.typeKeywordsString.indexOf("marker")&&(this.symbolClassStore.newItem({name:d.title,id:d.id}),this.symbolColorClasses.set("store",this.symbolClassStore))},this),this.getSymbolListData(!0))}),m.hitch(this,function(p,f){}))},getSymbolListData:function(b){this.destroySymbolClassesTemplatePicker();
m.forEach(this.symbolListItems,function(p){if(("simplemarkersymbol"===this.symbol.type||"picturemarkersymbol"===this.symbol.type)&&-1<p.typeKeywordsString.indexOf("marker")||("simplelinesymbol"===this.symbol.type||"cartographiclinesymbol"===this.symbol.type)&&-1<p.typeKeywordsString.indexOf("line")||("simplefillsymbol"===this.symbol.type||"picturefillsymbol"===this.symbol.type)&&-1<p.typeKeywordsString.indexOf("fill"))p.data?"simplemarkersymbol"!==this.symbol.type&&"picturemarkersymbol"!==this.symbol.type?
this.processSymbolListData(p):this.symbolColorClasses.get("value")==p.title&&this.processSymbolListData(p):arcgisonline.sharing.util.getJson(esriGeowConfig.restBaseUrl+"/content/items/"+p.id+"/data",m.hitch(this,function(f,d,a){d&&0<d.length&&(f.data=d,"simplemarkersymbol"===this.symbol.type||"picturemarkersymbol"===this.symbol.type?(b&&-1<f.typeKeywordsString.indexOf("default")||!b)&&this.processSymbolListData(f):this.processSymbolListData(f))},p),m.hitch(this,function(f,d){}))},this)},processSymbolListData:function(b){setTimeout(m.hitch(this,
function(){this.createSymbolListTemplatePicker(b.data)}),0)},createSymbolListTemplatePicker:function(b){b=m.map(b,function(p){var f={};f.symbol=esri.symbol.fromJson(p);f.description=p.name;return f},this);this.symbolClassesTemplatePicker||(this.symbolClassesTemplatePicker=new esri.dijit.editing.TemplatePicker({items:b,rows:"auto",columns:"auto",_assumedCellWidth:40,grouping:!1,style:"position: relative; width: 100%; height: 120px;"},this.id+"_symbolClassesTemplatePicker"),this.symbolClassesTemplatePicker.startup(),
this.templatePickerSymbolClass=this.symbol.type,this.templatePickerOnSelectionChangeHandler=m.connect(this.symbolClassesTemplatePicker,"onSelectionChange",this,function(){var p=this.symbolClassesTemplatePicker.getSelected();if(p){var f=this.symbol;this.symbol=esri.symbol.fromJson(p.item.symbol.toJson());if("simplemarkersymbol"===this.symbol.type||"picturemarkersymbol"===this.symbol.type)"simplemarkersymbol"===this.symbol.type?this.symbol.size="simplemarkersymbol"===f.type?f.size:f.width:"simplemarkersymbol"===
f.type?(this.symbol.xoffset&&(this.symbol.xoffset=f.size/(this.symbol.width/this.symbol.xoffset)),this.symbol.yoffset&&(this.symbol.yoffset=this.symbol.height/this.symbol.width*f.size/(this.symbol.height/this.symbol.yoffset)),this.symbol.height=this.symbol.height/this.symbol.width*f.size,this.symbol.width=f.size):(this.symbol.xoffset&&(this.symbol.xoffset=f.width/(this.symbol.width/this.symbol.xoffset)),this.symbol.yoffset&&(this.symbol.yoffset=this.symbol.height/this.symbol.width*f.width/(this.symbol.height/
this.symbol.yoffset)),this.symbol.height=this.symbol.height/this.symbol.width*f.width,this.symbol.width=f.width);(this.symbol.width||this.symbol.size)>=this.endSize&&(this.endSize=(this.symbol.width?this.symbol.width:this.symbol.size)+("simplelinesymbol"==this.symbol.type?10:20),this.symbolEndSize.set("value",this.endSize,!1));this.updateUI()}}))},destroySymbolClassesTemplatePicker:function(){this.symbolClassesTemplatePicker&&(m.disconnect(this.templatePickerOnSelectionChangeHandler),this.symbolClassesTemplatePicker.destroy(),
this.symbolClassesTemplatePicker=null,m.byId("symbolClassesTemplatePicker")||m.create("div",{id:this.id+"_symbolClassesTemplatePicker"},this.symbolClassesTemplatePickerDiv))},onSymbolListChange:function(b){if(b){this.destroySymbolClassesTemplatePicker();for(var p=null,f=0;f<this.symbolListItems.length;f++)this.symbolListItems[f].title==b&&(p=this.symbolListItems[f]);p&&p.data&&setTimeout(m.hitch(this,function(){this.createSymbolListTemplatePicker(p.data)}),0)}},createSimpleMarkerTemplatePicker:function(){var b=
m.map(this.simpleMarkerSymbols,function(p){var f={};f.symbol=esri.symbol.fromJson(p);f.description=p.name;return f},this);this.simpleMarkerTemplatePicker||(this.simpleMarkerTemplatePicker=new esri.dijit.editing.TemplatePicker({items:b,rows:"auto",columns:"auto",_assumedCellWidth:40,grouping:!1,style:"position: relative; width: 100%; height: 45px;"},this.id+"_symbolSimpleMarkerTemplatePicker"),this.simpleMarkerTemplatePicker.startup(),this.simpleMarkerTemplatePickerOnSelectionChangeHandler=m.connect(this.simpleMarkerTemplatePicker,
"onSelectionChange",this,function(){var p=this.simpleMarkerTemplatePicker.getSelected();p&&(this.symbol=esri.symbol.fromJson(p.item.symbol.toJson()),this.updateUI())}))},destroySimpleMarkerTemplatePicker:function(){this.simpleMarkerTemplatePicker&&(m.disconnect(this.simpleMarkerTemplatePickerOnSelectionChangeHandler),this.simpleMarkerTemplatePicker.destroy(),this.simpleMarkerTemplatePicker=null,m.byId(this.id+"_symbolSimpleMarkerTemplatePicker")||m.create("div",{id:this.id+"_symbolSimpleMarkerTemplatePicker"},
this.symbolSimpleMarkerTemplatePickerDiv))},getSymbolUrl:function(){var b=this.symbol.url;0!==b.indexOf("http://")&&this.symbol.imageData&&0<this.symbol.imageData.length&&(b=this.symbol.imageData);return b},setLinePattern:function(){switch(this.symbol.style){case esri.symbol.SimpleLineSymbol.STYLE_DOT:this.symbolLinePatternSelect.set("value","dot",!1);break;case esri.symbol.SimpleLineSymbol.STYLE_DASH:this.symbolLinePatternSelect.set("value","dash",!1);break;case esri.symbol.SimpleLineSymbol.STYLE_DASHDOT:this.symbolLinePatternSelect.set("value",
"dashdot",!1);break;case esri.symbol.SimpleLineSymbol.STYLE_DASHDOTDOT:this.symbolLinePatternSelect.set("value","dashdotdot",!1);break;default:this.symbolLinePatternSelect.set("value","solid",!1)}},getMarkerJson:function(){var b=this.markerJson;b.url=arcgisonline.sharing.util.getRedSphereUrl();return b},_drawSymbol:function(){var b=this.symbolImage,p=this.symbol,f=this.template,d=80,a=30;if("simplemarkersymbol"===p.type)a=d=Math.min(p.size+12,125);else if("picturemarkersymbol"===p.type){if(!this.symbol.url||
"http://"===p.url||-1==p.url.indexOf("http://")&&-1==p.url.indexOf("https://")&&-1==p.url.indexOf("data:"))return;a=d=Math.min(Math.max(p.width,p.height),125)}else if("simplelinesymbol"===this.symbol.type||"cartographiclinesymbol"===this.symbol.type)d=190,a=20;b=v.gfx.createSurface(b,d,a);if("vml"===v.gfx.renderer){var c=b.getEventSource();m.style(c,"position","relative");m.style(c.parentNode,"position","relative")}p=this._getDrawingToolShape(p,f)||esri.symbol.getShapeDescriptors(p);try{var h=b.createShape(p.defaultShape).setFill(p.fill).setStroke(p.stroke)}catch(l){b.clear();
b.destroy();return}p=b.getDimensions();p={dx:p.width/2,dy:p.height/2};c=h.getBoundingBox();f=c.width;c=c.height;if(f>d||c>a)d=((d<a?d:a)-5)/(f>c?f:c),m.mixin(p,{xx:d,yy:d});h.applyTransform(p);return b},_getDrawingToolShape:function(b,p){if("simplelinesymbol"==b.type||"cartographiclinesymbol"==b.type){var f={type:"path",path:"M -90,0 L 90,0 E"};return{defaultShape:f,fill:null,stroke:b.getStroke()}}switch(p?p.drawingTool||null:null){case "esriFeatureEditToolArrow":f={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};
break;case "esriFeatureEditToolTriangle":f={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 E"};break;case "esriFeatureEditToolRectangle":f={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 E"};break;case "esriFeatureEditToolCircle":f={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":f={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:f,fill:b.getFill(),stroke:b.getStroke()}},_repaintItems:function(){m.forEach(this._surfaceItems,
function(b){this._repaint(b)},this)},_repaint:function(b){b.getStroke&&b.setStroke&&b.setStroke(b.getStroke());b.getFill&&b.setFill&&b.setFill(b.getFill());b.children&&m.isArray(b.children)&&m.forEach(b.children,this._repaint,this)}})})},"arcgisonline/sharing/dijit/dialog/ImgDlg":function(){define(["dojo","dijit","dojox","dojo/require!dijit/Dialog,dijit/_Widget,dijit/_Templated,arcgisonline/sharing/dijit/dialog/GeneralDlg"],function(m,n,v){m.provide("arcgisonline.sharing.dijit.dialog.ImgDlg");m.require("dijit.Dialog");
m.require("dijit._Widget");m.require("dijit._Templated");m.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");m.declare("arcgisonline.sharing.dijit.dialog.ImgDlg",[n._Widget,n._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContent" \x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" id\x3d"image-dialog" title\x3d"${i18n.imgDlgTitle}" execute\x3d""\x3e\r\n    \x3cdiv\x3e\r\n      \x3cdiv style\x3d"line-height:17px;padding-top:10px;padding-right:10px;"\x3e\x3cspan\x3e${i18n.specifyImage}\x3c/span\x3e\x3c/div\x3e\r\n      \x3cbr /\x3e\r\n      \x3clabel style\x3d"line-height:12px;"\x3e${i18n.urlLabel}\x3c/label\x3e\r\n      \x3cdiv dojoAttachPoint\x3d"urlInput" dojotype\x3d"dijit.form.TextBox" trim\x3d"true" value\x3d"http://" style\x3d"width:330px;" dir\x3d"ltr"\x3e\x3c/div\x3e\r\n\t\t\t\x3cdiv style\x3d"line-height:17px;padding-top:10px;padding-right:10px;"\x3e\x3cspan\x3e${i18n.imgDetailMessage}\x3c/span\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\t  \x3cbr /\x3e\x26nbsp;  \r\n\t  \x3cbutton dojoAttachEvent\x3d"onClick:onCancelClick" class\x3d"jevent cancel" style\x3d"float:right;" dojoType\x3d"dijit.form.Button"\x3e${i18n.cancel}\x3c/button\x3e\r\n\t  \x3cbutton dojoAttachEvent\x3d"onClick:onDoneClick" class\x3d"jevent primary" style\x3d"float:right;" dojoType\x3d"dijit.form.Button"\x3e${i18n.done}\x3c/button\x3e\r\n\t  \x3cbr /\x3e\x26nbsp; \r\n\t\t\x3cbr/\x3e \r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
i18n:null,statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.ImgDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=m.i18n.getLocalization("arcgisonline","arcgisonline").common;m.mixin(this.i18n,m.i18n.getLocalization("arcgisonline","arcgisonline").generalDlg);m.mixin(this.i18n,m.i18n.getLocalization("arcgisonline","arcgisonline").imgDlg)},postCreate:function(){this.loadConnections()},
show:function(b){n.byId("image-dialog").show()},hide:function(){this.urlInput.setValue("http://");n.byId("image-dialog").hide()},loadConnections:function(){m.query(".jevent").connect("onclick",function(b){b.preventDefault()})},onDoneClick:function(b){b=this.urlInput.getValue();10>b.length?arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorDlgTitle,message:this.i18n.error.invalidUrl}):(0!==b.indexOf("http")&&(b="http://"+b),m.publish("onUrlChange",
[b]),this.hide())},onCancelClick:function(b){m.publish("onUrlChange",[]);this.hide()}})})},"arcgisonline/sharing/dijit/dialog/SetIdentityProviderDlg":function(){define("require dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/dom-attr dojo/number dojo/promise/all dojo/sniff dojo/string dojo/topic dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/a11yclick dijit/Dialog dijit/form/Button dijit/form/CheckBox dijit/form/SimpleTextarea dijit/form/TextBox esri/lang ../../../pages/pageUtil ../../../pages/utils/arrays ../../../pages/utils/dom ../../../pages/utils/tooltips ../../util ../_LevelAwareMixin ./GeneralDlg ../../geow/Roles ../../geow/Licenses dojo/i18n!../../../nls/arcgisonline dojo/text!./templates/SetIdentityProviderDlg.html".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x,t,w,z,B,A,y,E,G,F,D,L,O,S){var Z=n([l,k,g,G["default"]],{declaredClass:"arcgisonline.sharing.dijit.dialog.SetIdentityProviderDlg",templateString:S,widgetsInTemplate:!0,basePath:m.toUrl("arcgisonline/sharing/dijit/dialog"),baseClass:"esriAGOSetIdentityProviderDlg orgDlg",SIGN_UP_MODE_AUTOMATIC:"Automatic",SIGN_UP_MODE_INVITE:"Invitation",BINDING_TYPE_REDIRECT:"HTTP_REDIRECT",BINDING_TYPE_POST:"HTTP_POST",orgAdminRole:"org_admin",orgPublisherRole:"org_publisher",
orgUserRole:"org_user",_currentIDP:null,_isEditing:!1,_roles:[],_tooltips:[],postMixInProperties:function(){this.inherited(arguments);this.i18n=v.mixin(O.common,O.myOrganization);v.mixin(this.i18n,O.setIdentityProviderDlg);v.mixin(this.i18n,{adminRoleName:O.organizationInvite.userRoles.admin})},postCreate:function(){this.inherited(arguments);this._loadConnections();this._setupTooltips();this._licensesAPI=new L;this._rolesAPI=new D},show:function(I,N){this._isFederation=w.isDefined(I)&&I.isFederation;
this._isPortal=E.isPortal();this._defaultUserType=N;this._setupRoleFlags();this.clear();d({rolesResult:this._canManageRoles?this.getRoles():null,userTypesResult:this._canAccessLicenses?this.getUserTypes():null,signedProviderResult:this.getSignedProviderMetadataInfo()}).then(function(){this._dialog.set("title",this._isFederation?this.i18n.setFederationOfIdentityProvidersTitle:this.i18n.setIdentityProviderTitle);this._configureFormForIdentityProviderType();var K=RegExp(":\\d*/","g");K=this._isPortal?
esriGeowConfig.self.portalHostname.replace(K,".").replace("/","."):esriGeowConfig.self.urlKey+"."+esriGeowConfig.self.customBaseUrl;this._entityIDInput&&this._entityIDInput.set("value",K);this._dialog.show()}.bind(this))},getSignedProviderMetadataInfo:function(){var I=new b,N=E.getSecureUrl(esriGeowConfig.restBaseUrl)+"portals/self/sp";E.request({url:N}).then(function(K){this._signedServiceProviderUrl=K&&K.signedServiceProviderUrl?K.signedServiceProviderUrl:"";I.resolve()}.bind(this),function(){this._signedServiceProviderUrl=
"";I.resolve("")}.bind(this));return I},getUserTypes:function(){var I=new b;this._licensesAPI.getLicenseTypes().then(function(N){this._userTypes=N.userLicenseTypes.filter(function(K){return 0<K.maxUsers});I.resolve()}.bind(this));return I},getRoles:function(){var I=new b;this._rolesAPI.getAllRoles(!0).then(function(N){this._roles=N;this._viewerRole=this._localizeViewerRole(this._roles);this._viewerEditRole=this._localizeViewerEditRole(this._roles);this._facilitatorRole=this._localizeCollaboratorRole(this._roles);
I.resolve()}.bind(this));return I},_localizeViewerRole:function(I){if(I)for(var N=0;N<I.length;N++)if(I[N]&&I[N].id===this.SYSTEM_ROLES.VIEWER)return I[N].name=this.i18n.viewerRoleName,I[N]},_localizeViewerEditRole:function(I){if(I)for(var N=0;N<I.length;N++)if(I[N]&&I[N].id===this.SYSTEM_ROLES.DATA_EDITOR)return I[N].name=this.i18n.viewerEditRoleName,I[N]},_localizeFacilitatorRole:function(I){if(I)for(var N=0;N<I.length;N++)if(I[N]&&I[N].id===this.SYSTEM_ROLES.FACILITATOR)return I[N].name=this.i18n.facilitatorRoleName,
I[N]},_coreRoleSelected:function(I){return B.includes([this.orgUserRole,this.orgPublisherRole,this.orgAdminRole],I)},_hasAdminPrivileges:function(I){if(I&&I.privileges)for(var N=0;N<I.privileges.length;N++){var K=I.privileges[N];if(-1<K.indexOf(":admin"))return!0}return!1},edit:function(I,N){this._setupRoleFlags();this.clear();this._isFederation=I.isFederation;this._currentIDP=I;this._isPortal=E.isPortal();this._isEditing=!0;this._defaultUserType=N;var K=RegExp(":\\d*/","g"),Q=this._isPortal?esriGeowConfig.self.portalHostname.replace(K,
".").replace("/","."):esriGeowConfig.self.urlKey+"."+esriGeowConfig.self.customBaseUrl,da=esriGeowConfig.self.creditAssignments&&"enabled"===esriGeowConfig.self.creditAssignments;d({rolesResult:this._canManageRoles?this.getRoles():null,userTypesResult:this._canAccessLicenses?this.getUserTypes():null,signedProviderResult:this.getSignedProviderMetadataInfo()}).then(function(){if(w.isDefined(I)){this._configureFormForIdentityProviderType();this._dialog.set("title",this._isFederation?this.i18n.editFederationOfIdentityProvidersTitle:
this.i18n.editIdentityProviderTitle);this._nameInput.set("value",w.isDefined(I.name)?I.name:"");this._encryptionSupported.set("value",w.isDefined(I.encryptionSupported)?I.encryptionSupported:!1);this._signedRequestSupported.set("value",w.isDefined(I.supportSignedRequest)?I.supportSignedRequest:!1);this._signUsingSHA256.set("value",w.isDefined(I.useSHA256)?I.useSHA256:!1);A.showHide(this._sha256Container,w.isDefined(I.supportSignedRequest)&&I.supportSignedRequest);this._loginUrlInput.set("value",w.isDefined(I.bindingUrl)?
I.bindingUrl:"");this._loginUrlPostInput.set("value",w.isDefined(I.bindingPostUrl)?I.bindingPostUrl:"");this._logoutUrlInput.set("value",w.isDefined(I.logoutUrl)?I.logoutUrl:"");this._certificateInput.set("value",w.isDefined(I.certificate)?I.certificate:"");this._logoutRequestSupported.set("value",w.isDefined(I.supportsLogoutRequest)?I.supportsLogoutRequest:!1);this._updateProfile.set("value",w.isDefined(I.updateProfileAtSignin)?I.updateProfileAtSignin:!1);this._updateGroups.set("checked",w.isDefined(I.updateGroupsAtSignin)?
I.updateGroupsAtSignin:!1);this._federationDiscoveryServiceUrl.set("value",w.isDefined(I.discoveryServiceUrl)?I.discoveryServiceUrl:"");this._metadataAggregateUrl.set("value",w.isDefined(I.metadataServiceUrl)?I.metadataServiceUrl:"");this._aggregatedMetadataCertificate.set("value",w.isDefined(I.certificate)?I.certificate:"");var U=!!(this._canAccessLicenses&&I.userLicenseType||this._canManageRoles&&I.roleId||this._canManageCredits&&da&&w.isDefined(I.userCreditAssignment)&&-1<I.userCreditAssignment||
I.groups&&0<I.groups.length||I.userType);Q=w.isDefined(I.entityId)&&""!==I.entityId?I.entityId:Q;this._entityIDInput.set("value",Q);w.isDefined(I.signUpMode)&&(I.signUpMode===this.SIGN_UP_MODE_AUTOMATIC?(this._automaticOption.set("checked",!0),A.showHide(this._levelOptions,!this._isPortal&&this._canAccessLicenses),this._canManageRoles&&A.showHide(this._roleOptions,!this._isPortal),this._canManageCredits&&A.showHide(this._creditOptions,!(this._isPortal||!da)),A.showHide(this._groupOptions,!this._isPortal),
A.showHide(this._esriAccessOptions,!this._isPortal),A.showNode(this._automaticDefaults),A.showNode(this._toConfigureDefaults)):I.signUpMode===this.SIGN_UP_MODE_INVITE&&(this._inviteOption.set("checked",!0),A.hideNodes([this._automaticDefaults,this._toConfigureDefaults])));if(this._canAccessLicenses)if(I.userLicenseType){var aa=B.find(this._userTypes,function(J){return J.id===I.userLicenseType},this);aa?p.set(this._userTypeDefault,"innerHTML",aa.name):p.set(this._userTypeDefault,"innerHTML",this.i18n.notSet)}else p.set(this._userTypeDefault,
"innerHTML",this.i18n.notSet);this._canManageRoles&&(I.roleId?(aa=B.find(this._roles,function(J){return J.id===I.roleId},this))?p.set(this._roleDefault,"innerHTML",aa.name):this._coreRoleSelected(I.roleId)?I.roleId===this.orgUserRole?p.set(this._roleDefault,"innerHTML",this.i18n.userRoleName):I.roleId===this.orgPublisherRole?p.set(this._roleDefault,"innerHTML",this.i18n.publisherRoleName):I.roleId===this.orgAdminRole&&p.set(this._roleDefault,"innerHTML",this.i18n.adminRoleName):p.set(this._roleDefault,
"innerHTML",this.i18n.notSet):p.set(this._roleDefault,"innerHTML",this.i18n.notSet));da?w.isDefined(I.userCreditAssignment)?-1<I.userCreditAssignment?p.set(this._creditsDefault,"innerHTML",f.format(parseInt(I.userCreditAssignment,10))):p.set(this._creditsDefault,"innerHTML",this.i18n.notSet):p.set(this._creditsDefault,"innerHTML",this.i18n.notSet):A.hideNode(this._creditOptions);w.isDefined(I.groups)&&0<I.groups.length?this._fetchSelectedGroups(I.groups):(this._selectedGroups=[],this._toggleGroups());
w.isDefined(I.userType)&&("both"===I.userType?p.set(this._esriAccessDefault,"innerHTML",this.i18n.esriAccessEnabled):p.set(this._esriAccessDefault,"innerHTML",this.i18n.esriAccessDisabled));A.showHide(this._automaticDefaults,U);this._parametersOption.set("checked",!0);this.showParametersInputs();w.isDefined(I.logoutUrl)&&0<I.logoutUrl.length||w.isDefined(I.userIdAttribute)&&0<I.userIdAttribute.length?this.showAdvancedSettings():this.hideAdvancedSettings()}else this._entityIDInput.set("value",Q),this._encryptionSupported.set("value",
!1),this._signedRequestSupported.set("value",!1),this._signUsingSHA256.set("value",!1),A.hideNode(this._sha256Container),this._logoutRequestSupported.set("value",!1),this._updateGroups.set("checked",!1),A.showHide(this._levelOptions,!this._isPortal&&this._canAccessLicenses);this._setBtn.set("label",this.i18n.updateIdentityProviderLabel);this._dialog.show()}.bind(this))},_configureFormForIdentityProviderType:function(){A.showHide(this._metadataSourceContainer,!this._isFederation);A.showHide(this._updateGroupsContainer,
!this._isFederation);A.showHide(this._logoutUrlContainer,!this._isFederation);this._certificateInput.set("disabled",this._isFederation?!0:!1);A.showHide(this._federationDiscoveryServiceContainer,this._isFederation);A.showHide(this._metadataAggregateUrlContainer,this._isFederation);A.showHide(this._aggregatedMetadataCertificateContainer,this._isFederation);this._aggregatedMetadataCertificate.set("disabled",this._isFederation?!1:!0);var I=!!this._signedServiceProviderUrl;p.set(this._signedProviderMetadataUrl,
"href",this._signedServiceProviderUrl);p.set(this._signedProviderMetadataUrl,"textContent",this._signedServiceProviderUrl);A.showHide(this._providerMetadataDownloadContainer,I)},_fetchSelectedGroups:function(I){var N=esriGeowConfig.restBaseUrl+"community/groups",K;I&&0<I.length?(I.forEach(function(Q){K=K?K+(" OR id:"+Q):"id:"+Q}),K?(I="orgid:"+esriGeowConfig.self.id+" AND ("+K+") AND -provider:enterprise",z.fetchAllResources(N,{q:I},"results").then(function(Q){this._selectedGroups=this._selectedGroups.concat(Q);
this._toggleGroups()}.bind(this),function(Q){this._selectedGroups=[];this._toggleGroups()}.bind(this))):(this._selectedGroups=[],this._toggleGroups())):(this._selectedGroups=[],this._toggleGroups())},_toggleGroups:function(){var I=v.clone(this._selectedGroups),N=this._selectedGroups&&0<this._selectedGroups.length,K=N?I.splice(0,3).map(function(da){return da.title}):[],Q=N?I.map(function(da){return da.title}):[];N?(A.showNode(this._hasGroupDefaults),A.hideNode(this._noGroupDefaults)):(A.hideNode(this._hasGroupDefaults),
A.showNode(this._noGroupDefaults));p.set(this._groupListContainer,"innerHTML",K.join(", "));A.showHide(this._groupListContainer,N);A.showHide(this._otherLinkContainer,0<I.length);0<I.length&&(this._otherLinkTooltip&&this._otherLinkTooltip.destroyRecursive(),this._otherLinkTooltip=y.createTooltip(this.id+"-other-link",Q.join(",\x3cbr\x3e"),200,400))},_setupTooltips:function(){this._tooltips&&0===this._tooltips.length&&this._tooltips.push(y.createTooltip(this.id+"-noLimitTooltip-"+this.baseClass,this.i18n.orgLimit,
200,300))},clear:function(){this._dialog.set("title",this.i18n.setIdentityProviderTitle);var I=E.isPortal()||!1===esriGeowConfig.isMultiTenant;I?(p.set(this._description,"innerHTML",this.i18n.setIdentityProviderDescPortal),this._logoutUrlInput.set("title",this.i18n.logoutUrlTooltipPortal),p.set(this._inviteOptionLabel,"innerHTML",this.i18n.onAddOption)):(p.set(this._description,"innerHTML",this.i18n.setIdentityProviderDesc),this._logoutUrlInput.set("title",this.i18n.logoutUrlTooltip),p.set(this._inviteOptionLabel,
"innerHTML",this.i18n.onInviteOption));this._nameInput.set("placeHolder",this._isFederation?this.i18n.federationNamePlaceholder:this.i18n.namePlaceHolder);this._bindingUrlInput.set("placeHolder",this.i18n.metadataUrlPlaceHolder);this._loginUrlInput.set("placeHolder",this.i18n.parametersUrlPlaceHolder);this._loginUrlPostInput.set("placeHolder",this.i18n.parametersUrlPostPlaceHolder);this._logoutUrlInput.set("placeHolder",this.i18n.logoutUrlPlaceHolder);this._entityIDInput.set("placeHolder","");this._federationDiscoveryServiceUrl.set("placeHolder",
this.i18n.federationDiscoveryServiceUrlPlaceholder);this._metadataAggregateUrl.set("placeHolder",this.i18n.metadataAggregateUrlPlaceholder);this._inviteOption.set("checked",!0);A.hideNodes([this._automaticDefaults,this._toConfigureDefaults]);p.set(this._userTypeDefault,"innerHTML",this.i18n.notSet);p.set(this._roleDefault,"innerHTML",this.i18n.notSet);p.set(this._creditsDefault,"innerHTML",this.i18n.notSet);p.set(this._esriAccessDefault,"innerHTML",this.i18n.notSet);p.set(this._groupListContainer,
"innerHTML",this.i18n.notSet);I||(this._selectedGroups=[],this._toggleGroups());this._metadataUrlOption.set("checked",!0);this.showMetadataUrlInputs();this.hideAdvancedSettings();this._nameInput.set("value","");this._bindingUrlInput.set("value","");p.set(this._metadataFileInput,"value","");this._encryptionSupported.set("value",!1);this._signedRequestSupported.set("value",!1);A.hideNode(this._sha256Container);this._signUsingSHA256.set("value",!1);this._logoutRequestSupported.set("value",!1);this._loginUrlInput.set("value",
"");this._loginUrlPostInput.set("value","");this._certificateInput.set("value","");p.set(this._certificateFileInput,"value","");this._logoutUrlInput.set("value","");this._updateProfile.set("value","");this._updateGroups.set("checked",!1);this._federationDiscoveryServiceUrl.set("value","");this._metadataAggregateUrl.set("value","");this._aggregatedMetadataCertificate.set("value","");p.set(this._signUpMode,"value","");p.set(this._bindingType,"value","");this._setBtn.set("disabled",!1);this._selectedUserType=
this._currentIDP=null;this._isEditing=!1;this._roles=[];this._userTypes=[];this._selectedGroups=[]},_setupRoleFlags:function(){var I=!!esriGeowConfig.userRole;this._canAccessLicenses=(this._isAdmin=I&&esriGeowConfig.userRole.isAdmin())||I&&(esriGeowConfig.userRole.canManageLicenses()||esriGeowConfig.userRole.canInviteUsers()||esriGeowConfig.userRole.canManageRoles());this._canManageCredits=this._isAdmin||I&&esriGeowConfig.userRole.canManageCredits();this._canManageRoles=this._isAdmin||I&&esriGeowConfig.userRole.canManageRoles()},
_loadConnections:function(){this.own(e(this._metadataUrlOption,this.onMetadataUrlOption.bind(this)),e(this._metadataFileOption,this.onMetadataFileOption.bind(this)),e(this._parametersOption,this.onParametersOption.bind(this)),e(this._setBtn,this.onSetProvider.bind(this)),e(this._cancelBtn,this.onCancel.bind(this)),e(this._signedRequestSupported,this.onSignedRequestSupported.bind(this)))},hide:function(){this._dialog.hide()},showMetadataUrlInputs:function(){A.hideNodes([this._metadataFileInputs,this._parametersInputs]);
A.showNode(this._metadataUrlInputs);p.set(this._bindingType,"value","")},showMetadataFileInputs:function(){A.hideNodes([this._metadataUrlInputs,this._parametersInputs]);A.showNode(this._metadataFileInputs);p.set(this._bindingType,"value","")},showParametersInputs:function(){A.hideNodes([this._metadataUrlInputs,this._metadataFileInputs]);A.showNode(this._parametersInputs)},showAdvancedSettings:function(){p.set(this._toggleAdvancedSettings,"innerHTML",this.i18n.hideAdvancedSettings);A.showNode(this._advancedSettings);
this._showingAdvancedSettings=!0},hideAdvancedSettings:function(){p.set(this._toggleAdvancedSettings,"innerHTML",this.i18n.showAdvancedSettings);A.hideNode(this._advancedSettings);this._showingAdvancedSettings=!1},validParameters:function(){var I=this.i18n.noticeLabel,N=this._nameInput.get("value");if(!w.isDefined(N)||0===N.length)return z.createSpecifiedDialog(F).show({title:I,message:this.i18n.errors.nameRequired}),!1;if(!this._isFederation){N=this._metadataUrlOption.get("checked");var K=this._bindingUrlInput.get("value");
if(N&&(!w.isDefined(K)||0===K.length))return z.createSpecifiedDialog(F).show({title:I,message:this.i18n.errors.metadataUrlMustBeSet}),!1;N=this._metadataFileOption.get("checked");K=p.get(this._metadataFileInput,"value");if(N&&(!w.isDefined(K)||0===K.length))return dlg.show({title:I,message:this.i18n.errors.metadataFileMustBeSet}),!1;if(this._parametersOption.get("checked")){N=this._loginUrlInput.get("value");if(!w.isDefined(N)||0===N.length)return z.createSpecifiedDialog(F).show({title:I,message:this.i18n.errors.loginUrlMustBeSet}),
!1;N=this._loginUrlPostInput.get("value");if(!w.isDefined(N)||0===N.length)return z.createSpecifiedDialog(F).show({title:I,message:this.i18n.errors.loginUrlPostMustBeSet}),!1;N=this._certificateInput.get("value");if(!w.isDefined(N)||0===N.length)return z.createSpecifiedDialog(F).show({title:I,message:this.i18n.errors.certificateMustBeSet}),!1}}return!0},onAutomaticClicked:function(){var I=esriGeowConfig.self.creditAssignments&&"enabled"===esriGeowConfig.self.creditAssignments,N=!(!this._currentIDP||
!(this._canAccessLicenses&&this._currentIDP.userLicenseType||this._canManageRoles&&this._currentIDP.roleId||this._canManageCredits&&I&&w.isDefined(this._currentIDP.userCreditAssignment)&&-1<this._currentIDP.userCreditAssignment||this._currentIDP.groups&&0<this._currentIDP.groups.length||this._currentIDP.userType));!this._isPortal||this._defaultUserType&&"none"!==this._defaultUserType?(A.showHide(this._automaticDefaults,N),A.showNode(this._toConfigureDefaults),this._canManageRoles&&A.showHide(this._roleOptions,
!this._isPortal),this._canManageCredits&&A.showHide(this._creditOptions,!(this._isPortal||!I)),A.showHide(this._groupOptions,!this._isPortal),A.showHide(this._hasGroupDefaults,this._selectedGroups&&0<this._selectedGroups.length),A.showHide(this._noGroupDefaults,!(this._selectedGroups&&0<this._selectedGroups.length)),A.showHide(this._esriAccessOptions,!this._isPortal),A.showHide(this._levelOptions,!this._isPortal&&this._canAccessLicenses)):(z.createSpecifiedDialog(F).show({title:this.i18n.errorLabel,
message:this.i18n.mustHaveDefaultUserType}),setTimeout(function(){this._automaticOption.setChecked(!1);this._inviteOption.setChecked(!0)}.bind(this)))},onInvitationClicked:function(){A.hideNodes([this._automaticDefaults,this._toConfigureDefaults])},onMetadataUrlOption:function(){this.showMetadataUrlInputs()},onMetadataFileOption:function(){this.showMetadataFileInputs()},onParametersOption:function(){this.showParametersInputs()},onToggleAdvancedSettings:function(){this._showingAdvancedSettings?this.hideAdvancedSettings():
this.showAdvancedSettings()},onSetProvider:function(I){I&&I.preventDefault();this._setBtn.set("disabled",!0);this.validParameters()?(9>a("ie")&&(this._form.encoding="multipart/form-data"),this._automaticOption.get("checked")?p.set(this._signUpMode,"value",this.SIGN_UP_MODE_AUTOMATIC):p.set(this._signUpMode,"value",this.SIGN_UP_MODE_INVITE),p.set(this._supportEncryption,"value",this._encryptionSupported.get("checked")),p.set(this._supportSignedRequest,"value",this._signedRequestSupported.get("checked")),
p.set(this._useSHA256,"value",this._signedRequestSupported.get("checked")&&this._signUsingSHA256.get("checked")),p.set(this._supportsLogoutRequest,"value",this._logoutRequestSupported.get("checked")),p.set(this._updateProfileAtSignIn,"value",this._updateProfile.get("checked")),p.set(this._updateGroupsAtSignIn,"value",this._updateGroups.get("checked")),this._metadataUrlOption.get("checked")?(p.set(this._metadataFileInput,"value",""),this._loginUrlInput.set("value",""),p.set(this._bindingType,"value",
""),this._certificateInput.set("value",""),p.set(this._certificateFileInput,"value","")):this._metadataFileOption.get("checked")?(this._bindingUrlInput.set("value",""),this._loginUrlInput.set("value",""),p.set(this._bindingType,"value",""),this._certificateInput.set("value",""),p.set(this._certificateFileInput,"value","")):(this._bindingUrlInput.set("value",""),p.set(this._metadataFileInput,"value",""),p.set(this._bindingType,"value",this.BINDING_TYPE_REDIRECT)),I=esriGeowConfig.restBaseUrl+"portals/self/idp/",
this._isEditing?(I+=(this._isFederation?"federation/":"")+this._currentIDP.id+"/update",p.set(this._clearEmptyFields,"value",!0)):(I+=(this._isFederation?"federation/":"")+"register",p.set(this._clearEmptyFields,"value",!1)),E.request({url:I,form:this._form},{usePost:!0}).then(function(N){w.isDefined(N)&&!w.isDefined(N.error)&&(this._setBtn.set("disabled",!1),h.publish("setIdentityProvider",[]),this.hide())}.bind(this),function(N){if(w.isDefined(N.messageCode)){var K=this.i18n.errors[N.messageCode];
w.isDefined(N.details)&&w.isDefined(N.details[0])&&(K=c.substitute(K,{details:N.details[0]}))}else K=this._isEditing?this.i18n.errors.unableToUpdateIdentityProvider:this.i18n.errors.unableToSetIdentityProvider;z.createSpecifiedDialog(F).show({title:this.i18n.errorLabel,message:K});this._setBtn.set("disabled",!1)}.bind(this))):this._setBtn.set("disabled",!1)},onSignedRequestSupported:function(){this._signedRequestSupported.get("checked")?A.showNode(this._sha256Container):(this._signUsingSHA256.set("checked",
!1),A.hideNode(this._sha256Container))},onSubmit:function(){return!1},onCancel:function(I){I&&I.preventDefault();this.hide()},onHide:function(){}});Z.prototype.statics={_instance:null,getInstance:function(){null===this._instance&&(this._instance=new Z);return this._instance}};return Z})},"arcgisonline/sharing/dijit/dialog/SharingDlg":function(){define(["dojo","dijit","dojox","dojo/require!dijit/Dialog,dijit/_Widget,dijit/_Templated,arcgisonline/sharing/dijit/ShareOptions"],function(m,n,v){m.provide("arcgisonline.sharing.dijit.dialog.SharingDlg");
m.require("dijit.Dialog");m.require("dijit._Widget");m.require("dijit._Templated");m.require("arcgisonline.sharing.dijit.ShareOptions");m.declare("arcgisonline.sharing.dijit.dialog.SharingDlg",[n._Widget,n._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContent"\x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" dojoAttachPoint\x3d"_shareDialog" id\x3d"share-dialog" title\x3d"${i18n.sharingDlgTitle}" execute\x3d""\x3e\r\n    \x3clabel class\x3d"trailer-half share-title"\x3e${i18n.shareItemsLabel}\x3c/label\x3e\r\n    \x3cdiv dojotype\x3d"arcgisonline.sharing.dijit.ShareOptions" dojoAttachPoint\x3d"_shareOptions"\x3e\x3c/div\x3e\r\n    \x3cdiv\x3e\r\n      \x3cp class\x3d"trailer-half font-size--1"\x3e\r\n        ${i18n.settingsMsg}\r\n      \x3c/p\x3e\r\n      \x3cdiv dojoAttachPoint\x3d"_shareNoGroupsDiv" style\x3d"display:none;" class\x3d"alert alert-yellow trailer-half is-active"\x3e\r\n        ${i18n.notAMemberMsg}\r\n      \x3c/div\x3e\r\n      \x3cdiv dojoAttachPoint\x3d"_shareOwnerNoneDiv" style\x3d"display:none;" class\x3d"alert alert-yellow trailer-half is-active"\x3e\r\n        ${i18n.notOwnerMsg}\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"_editableLayerMsg" class\x3d"label-yellow hide js-sharing-help"\x3e\r\n        ${i18n.layerIsEditable} \x3ca href\x3d"${_helpLink}" target\x3d"_blank"\x3e${i18n.learnHow}\x3c/a\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"_premiumContentMsg" class\x3d"label-yellow hide js-premium-help"\x3e\r\n      ${i18n.premiumLayerMsg} \x3ca href\x3d"${_helpLinkPremium}" target\x3d"_blank"\x3e${i18n.premiumLayerMsgLearnMore}\x3c/a\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriFloatTrailing right clearfix share-action-bar leader-half" style\x3d"padding-bottom:1em;"\x3e\r\n      \x3cspan class\x3d"disabled padding-right-1" style\x3d"display:none;"\x3e${i18n.sharingItems}\x3c/span\x3e\r\n      \x3cbutton id\x3d"button_share-cancel" class\x3d"jevent cancel" type\x3d"cancel" dojotype\x3d"dijit.form.Button" dojoAttachEvent\x3d"onClick:_handleCancelClick"\x3e\r\n        ${i18n.cancel}\r\n      \x3c/button\x3e\r\n      \x3cbutton class\x3d"jevent primary" dojotype\x3d"dijit.form.Button"  dojoAttachEvent\x3d"onClick:_handleOkResponse"\x3e\r\n        ${i18n.ok}\r\n      \x3c/button\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
i18n:null,_shareDialog:null,_shareOptions:null,_shareNoGroupsDiv:null,_shareOwnerNoneDiv:null,statics:{_instance:null,getInstance:function(){null===this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.SharingDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=m.i18n.getLocalization("arcgisonline","arcgisonline").common;m.mixin(this.i18n,m.i18n.getLocalization("arcgisonline","arcgisonline").sharingDlg);m.mixin(this.i18n,m.i18n.getLocalization("arcgisonline",
"arcgisonline").shareCheckDlg);m.mixin(this.i18n,m.i18n.getLocalization("arcgisonline","arcgisonline").shareMapDlg);this._helpLink=esriGeowConfig.helpBase+esriGeowConfig.helpMap["120001067"];this._helpLinkPremium=esriGeowConfig.helpBase+esriGeowConfig.helpMap["120001307"];this._handles=[]},postCreate:function(){this.loadConnections()},destroy:function(){m.forEach(this._handles,"item.remove();");this._shareDialog.destroyRecursive();this._shareDialog=null;this.inherited(arguments)},_setDisabledAttr:function(b){m.forEach(n.registry.findWidgets(this._shareDialog.domNode),
function(p){p.set("disabled",b)});m.query("input").forEach(function(p){m.attr(p,"disabled",b)});m.query(".disabled").forEach(function(p){m.style(p,"display",b?"":"none")})},loadConnections:function(){m.connect(this._shareDialog,"hide",m.hitch(this,function(b){(b=b&&b.target)&&m.hasClass(b,"dijitDialogCloseIcon")&&(this.isCancelled=!0);this.set("disabled",!1);this._shareOptions.clear()}));this._handles.push(m.subscribe("shareOptionsSetup",m.hitch(this,function(){this._shareDialog.show()})));this._handles.push(m.subscribe("onShareUpdate",
m.hitch(this,function(b){this.set("disabled",!1);b&&b.length&&"string"!==typeof b||this._shareDialog.hide()})));this._handles.push(m.subscribe("doesNotOwnGroups",m.hitch(this,function(){m.style(this._shareOwnerNoneDiv,"display","block")})));this._handles.push(m.subscribe("notMemberOfAnyGroups",m.hitch(this,function(){m.style(this._shareNoGroupsDiv,"display","block")})))},_handleOkResponse:function(b){b.preventDefault();this.set("disabled",!0);this._shareOptions.share(b)},_handleCancelClick:function(b){b.preventDefault();
this.isCancelled=!0;this._shareDialog.hide()},hide:function(){this._shareDialog.hide()},show:function(b,p,f,d){this._shareOptions.show(b,p,f,d)},showAdmin:function(b,p,f,d){this._shareOptions.showAdmin(b,p,f,d)},showGroups:function(b,p){this._shareOptions.showGroups(b,p)}})})},"arcgisonline/sharing/dijit/dialog/TagsDlg":function(){define(["dojo","dijit","dojox","dojo/require!dijit/_Widget,dijit/_Templated,dijit/Dialog,dijit/form/MultiSelect,dijit/form/SimpleTextarea,arcgisonline/sharing/geow/Content"],
function(m,n,v){m.provide("arcgisonline.sharing.dijit.dialog.TagsDlg");m.require("dijit._Widget");m.require("dijit._Templated");m.require("dijit.Dialog");m.require("dijit.form.MultiSelect");m.require("dijit.form.SimpleTextarea");m.require("arcgisonline.sharing.geow.Content");m.declare("arcgisonline.sharing.dijit.dialog.TagsDlg",[n._Widget,n._Templated],{widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContent" \x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" dojoAttachPoint\x3d"_tagsDialog" dojoAttachPoint\x3d"onHide:clear" title\x3d"${i18n.tagDlgTitle}" class\x3d"tagsForm"\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"_tagsErrorDiv"\x3e\x3c/div\x3e\r\n\t\x3cdiv dojoAttachPoint\x3d"_contentTagsDiv" style\x3d"display:block;"\x3e\r\n\t\t\x3clabel \x3e${i18n.selectTag}\x3c/label\x3e\r\n\t\t\x3cbr /\x3e\r\n\t\t\x3cbr /\x3e\r\n\t    \x3cselect dojoAttachPoint\x3d"_tagsSelect" dojoType\x3d"dijit.form.MultiSelect" style\x3d"width:100%;height:150px;"\x3e\x3c/select\x3e\r\n\t\t\x3cbr /\x3e\r\n\t\t\x3cdiv dojoAttachPoint\x3d"_cancelBtn" dojotype\x3d"dijit.form.Button" class\x3d"cancel" dojoAttachEvent\x3d"onClick:_handleCancelClick" style\x3d"float:right;"\x3e${i18n.cancel}\x3c/div\x3e\r\n\t\t\x3cdiv dojoAttachPoint\x3d"_submitBtn" dojotype\x3d"dijit.form.Button" class\x3d"primary" type\x3d"submit" dojoAttachEvent\x3d"onClick:getSelectedTags" style\x3d"float:right;"\x3e${i18n.useSelected}\x3c/div\x3e  \r\n\t\t\x3cbr /\x3e\r\n\t\t\x3cbr /\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv dojoAttachPoint\x3d"_contentNoTagsDiv" style\x3d"display:none;"\x3e\r\n\t\t\x3clabel\x3e${i18n.tagsNotAvailable}\x3c/label\x3e\r\n\t\t\x3cbr /\x3e\r\n\t\t\x3cbr /\x3e\r\n\t\t\x3cdiv id\x3d"button_tags-ok" dojoAttachPoint\x3d"_okBtn" dojotype\x3d"dijit.form.Button" class\x3d"primary" dojoAttachEvent\x3d"onClick:_handleCancelClick" style\x3d"float:right;"\x3e${i18n.ok}\x3c/div\x3e\r\n\t\t\x3cbr/\x3e\r\n\t\t\x3cbr/\x3e\r\n\t\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
_tagsDialog:null,_contentTagsDiv:null,_contentNoTagsDiv:null,_tagsSelect:null,i18n:null,statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.TagsDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=m.i18n.getLocalization("arcgisonline","arcgisonline").common;m.mixin(this.i18n,m.i18n.getLocalization("arcgisonline","arcgisonline").tagsDlg)},postCreate:function(){},_handleCancelClick:function(b){b.preventDefault();
this._tagsDialog.hide()},clear:function(){this._tagsSelect.reset();m.style(this._contentTagsDiv,"display","none");m.style(this._contentNoTagsDiv,"display","none")},hide:function(){this._tagsDialog.hide()},show:function(b){this.clear();var p=arcgisonline.sharing.util.getUser(),f=esriGeowConfig.restBaseUrl+"community/users/";f=b&&(b.username||b.email)?f+(b.username?b.username:b.email):f+p.username;arcgisonline.sharing.util.getJson(f+"/tags",m.hitch(this,this._handleTagResponse),m.hitch(this,this._handleError));
this._tagsDialog.show()},_handleTagResponse:function(b){0==b.tags.length?m.style(this._contentNoTagsDiv,"display",""):(m.style(this._contentTagsDiv,"display",""),m.empty(this._tagsSelect.domNode),m.forEach(b.tags,function(p){m.create("option",{innerHTML:p.tag,value:p.tag},this._tagsSelect.domNode)},this))},_handleError:function(b){},getSelectedTags:function(b){b.preventDefault();b=[];b=this._tagsSelect.get("value");m.publish("onSelectedTagsUpdate",[b.toString()])}})})},"arcgisonline/sharing/dijit/dialog/TermsOfUseDlg":function(){define(["dojo",
"dijit","dojox","dojo/require!dijit/_Widget,dijit/_Templated,arcgisonline/sharing/util,dijit/Dialog"],function(m,n,v){m.provide("arcgisonline.sharing.dijit.dialog.TermsOfUseDlg");m.require("dijit._Widget");m.require("dijit._Templated");m.require("arcgisonline.sharing.util");m.require("dijit.Dialog");m.declare("arcgisonline.sharing.dijit.dialog.TermsOfUseDlg",[n._Widget,n._Templated],{util:arcgisonline.sharing.util,widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContainer"\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/Dialog" id\x3d"terms-of-use-dialog" data-dojo-attach-point\x3d"_dialog" title\x3d"${i18n.title}" execute\x3d"" style\x3d"overflow-y:auto;"\x3e\r\n    \x3cform id\x3d"terms-of-use-form" method\x3d"POST" action\x3d"" style\x3d"height:100%;overflow-y:auto;padding-left:10px;"\x3e\r\n      \x3cdiv style\x3d"height:30px; text-align:center;"\x3e\r\n        \x3cspan style\x3d"font-size:1.1em; font-weight:bold"\x3e${i18n.termsOfUseTitle}\x3c/span\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" id\x3d"tos" style\x3d"background:#FFF;border:solid 1px #000;overflow-x:hidden;overflow-y:hidden;width:400px;height:250px;"\x3e\r\n        \x3ca href\x3d\'\'\x3e\x3c/a\x3e\r\n        \x3ciframe id\x3d"termsFrame" src\x3d"termsofuse.html" style\x3d"width:100%;height:250px;max-width:100%;max-height:250px;"\x3e\x3c/iframe\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv style\x3d"padding-top:10px;"\x3e\r\n        \x3cspan class\x3d"esriItemLinks"\x3e\x3ca href\x3d"http://www.esri.com/legal/licensing-translations" target\x3d"_blank"\x3e${i18n.otherLanguages}\x3c/a\x3e\x3c/span\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv style\x3d"height:40px; padding-top:10px;"\x3e\r\n        \x3cbutton id\x3d"button_accept" type\x3d"submit" class\x3d"primary" data-dojo-type\x3d"dijit/form/Button"\x3e\r\n            ${i18n.accept}\r\n        \x3c/button\x3e\r\n        \x3cbutton id\x3d"button_decline" class\x3d"jevent cancel" type\x3d"cancel" data-dojo-type\x3d"dijit/form/Button"\x3e\r\n            ${i18n.noaccept}\r\n        \x3c/button\x3e\r\n      \x3c/div\x3e\r\n    \x3c/form\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
_firstLoad:!0,statics:{_instance:null,getInstance:function(){null==this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.TermsOfUseDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=m.i18n.getLocalization("arcgisonline","arcgisonline").common;m.mixin(this.i18n,m.i18n.getLocalization("arcgisonline","arcgisonline").termsOfUseDlg)},postCreate:function(){this.loadConnections()},show:function(b){n.byId("terms-of-use-dialog").show();esri.isTouchEnabled?
(m.style(m.byId("terms-of-use-dialog"),"width","500px"),m.style(m.byId("tos"),"width","455px"),m.style(m.byId("tos"),"overflow-y","scroll")):this._firstLoad&&(m.style(m.byId("terms-of-use-dialog"),"width","455px"),m.isFF||10>m.isIE?(m.isFF&&m.style(m.byId("tos"),"height",parseInt(m.style(m.byId("terms-of-use-dialog"),"height"))-169+"px"),9>m.isIE&&m.style(m.byId("tos"),"height",parseInt(m.style(m.byId("terms-of-use-dialog"),"height"))-208+"px"),8>m.isIE&&m.style(m.byId("tos"),"height",parseInt(m.style(m.byId("terms-of-use-dialog"),
"height"))-133+"px")):m.style(m.byId("tos"),"height",parseInt(m.style(m.byId("terms-of-use-dialog"),"height"))-169+"px"),m.style(m.byId("terms-of-use-form"),"overflow-y","hidden"),this._firstLoad=!1)},loadConnections:function(){m.query(".jevent").connect("onclick",function(b){b.preventDefault()});m.connect(m.byId("button_decline"),"onclick",this,"declineTerms");m.connect(m.byId("terms-of-use-form"),"onsubmit",this,"registerUser")},hide:function(){n.byId("terms-of-use-dialog").hide()},registerUser:function(b){b.preventDefault();
this.hide();m.publish("registerUser",["true"])},declineTerms:function(b){b.preventDefault();this.hide();m.publish("declineTermsOfUse",["true"])}})})},"arcgisonline/sharing/dijit/dialog/UpdateItemDlg":function(){define(["dojo","dijit","dojox","dojo/require!dijit/form/SimpleTextarea,dijit/form/TextBox,dijit/form/CheckBox,dijit/form/Button,dijit/InlineEditBox,dijit/Dialog,dijit/_Widget,dijit/_Templated,arcgisonline/pages/pageUtil,arcgisonline/pages/utils/dom,arcgisonline/pages/dijit/UploadProgressBar,arcgisonline/sharing/util,arcgisonline/sharing/geow/Community,arcgisonline/sharing/geow/Content,arcgisonline/sharing/geow/Item,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/sharing/dijit/dialog/TagsDlg,dojo/promise/all,dojo/number"],
function(m,n,v){m.provide("arcgisonline.sharing.dijit.dialog.UpdateItemDlg");m.require("dijit.form.SimpleTextarea");m.require("dijit.form.TextBox");m.require("dijit.form.CheckBox");m.require("dijit.form.Button");m.require("dijit.InlineEditBox");m.require("dijit.Dialog");m.require("dijit._Widget");m.require("dijit._Templated");m.require("arcgisonline.pages.pageUtil");m.require("arcgisonline.pages.utils.dom");m.require("arcgisonline.pages.dijit.UploadProgressBar");m.require("arcgisonline.sharing.util");
m.require("arcgisonline.sharing.geow.Community");m.require("arcgisonline.sharing.geow.Content");m.require("arcgisonline.sharing.geow.Item");m.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");m.require("arcgisonline.sharing.dijit.dialog.TagsDlg");m.require("dojo.promise.all");m.require("dojo.number");m.declare("arcgisonline.sharing.dijit.dialog.UpdateItemDlg",[n._Widget,n._Templated],{util:arcgisonline.sharing.util,community:arcgisonline.sharing.geow.Community,content:arcgisonline.sharing.geow.Content,
itemAPI:arcgisonline.sharing.geow.Item,pageUtil:arcgisonline.pages.pageUtil,domUtil:arcgisonline.pages.utils.dom,widgetsInTemplate:!0,templateString:'\x3cdiv class\x3d"widgetContainer"\x3e\r\n  \x3cdiv dojotype\x3d"dijit.Dialog" dojoAttachPoint\x3d"_updateItemDialog" title\x3d"${i18n.updateItem}" dojoAttachEvent\x3d"hide:clear" execute\x3d"" class\x3d"update-item-dlg"\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"_errorDiv"\x3e\x3c/div\x3e\r\n    \x3cform dojoAttachPoint\x3d"_updateItemForm" enctype\x3d"multipart/form-data"\x3e\r\n      \x3cdiv dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemFolderInput" type\x3d"hidden" value\x3d"0"\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"id" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemIdInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"name" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemNameInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"title" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemTitleInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"tags" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemTagsInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"type" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemTypeInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"typeKeywords" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateItemKeywordsInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"description" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateDescriptionInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"snippet" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateSnippetInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"accessInformation" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateAccessInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"licenseInfo" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateLicenseInfoInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"extent" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateExtentInput" type\x3d"hidden" value\x3d""\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"overwrite" dojotype\x3d"dijit.form.TextBox" dojoAttachPoint\x3d"_updateOverwriteInput" type\x3d"hidden" value\x3d"true"\x3e\x3c/div\x3e\r\n      \x3cdiv name\x3d"async" dojotype\x3d"dijit.form.TextBox" type\x3d"hidden" dojoAttachPoint\x3d"_updateAsyncInput" value\x3d"true"\x3e\x3c/div\x3e\r\n\r\n      \x3cdiv\x3e\x3clabel class\x3d"font-size--1" dojoAttachPoint\x3d"_replaceUpdateVerLabel"\x3e${i18n.replaceUpdatedVersionMsg}\x3c/label\x3e\x3c/div\x3e\r\n\r\n      \x3cdiv style\x3d"padding-top:4px;margin-bottom:1.0em;"\x3e\r\n        \x3clabel class\x3d"esriFloatLeading esriTrailingMargin2" style\x3d"margin-top:6px;" for\x3d"update-item-file"\x3e${i18n.itemLabel}\x3c/label\x3e\r\n        \x3cinput type\x3d"file" dojoAttachPoint\x3d"_updateItemFile" id\x3d"update-item-file" name\x3d"file" size\x3d"40" class\x3d"esriFileInput"\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv id\x3d"overwrite_section" class\x3d"hide" style\x3d"padding-top:4px;margin-bottom:1.0em;"\x3e\r\n        \x3cinput id\x3d"overwriteService" type\x3d"checkbox" name\x3d"overwriteService" dojotype\x3d"dijit.form.CheckBox" checked\x3d"checked" dojoAttachPoint\x3d"_overwriteService"/\x3e\r\n        \x3clabel id\x3d"overwriteServiceLbl" for\x3d"overwriteService"\x3e${i18n.overwriteService} ${i18n.keepFieldsSame}\x3c/label\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv id\x3d"update-item-keepdescription" style\x3d"width:100%;display:none;"\x3e\r\n        \x3cdiv style\x3d"padding-bottom:5px; padding-top:2px;"\x3e\r\n          \x3clabel\x3e${i18n.updateItemDescription}\x3c/label\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv style\x3d"line-height:23px"\x3e\r\n          \x3cinput type\x3d"radio" name\x3d"useDescription" dojotype\x3d"dijit.form.RadioButton" checked\x3d"checked" dojoAttachPoint\x3d"_useDescKeepRadio" id\x3d"useDescription:keep"/\x3e\r\n          \x3clabel for\x3d"useDescription:keep"\x3e${i18n.keepExistingProperties}\x3c/label\x3e\r\n          \x3cinput type\x3d"radio" name\x3d"useDescription" dojotype\x3d"dijit.form.RadioButton" dojoAttachPoint\x3d"_useDescUpdateRadio" id\x3d"useDescription:update"/\x3e\r\n          \x3clabel for\x3d"useDescription:update"\x3e${i18n.useUploadedProperties}\x3c/label\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv class\x3d"leader-half trailer-half flex"\x3e\r\n        \x3cdiv class\x3d"flex flex-1"\x3e\r\n          \x3cspan data-dojo-attach-point\x3d"_waitingSpan" class\x3d"hide flex-column-justify-center"\x3e${i18n.uploadingItem}\x3c/span\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_uploadProgressBar"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cbutton dojotype\x3d"dijit.form.Button" dojoAttachEvent\x3d"onClick:_handleCancel" dojoAttachPoint\x3d"_cancelBtn" id\x3d"button_update-item-cancel" class\x3d"jevent cancel margin-right-half" type\x3d"cancel"\x3e${i18n.cancel}\x3c/button\x3e\r\n        \x3cbutton id\x3d"button_update-item" type\x3d"button" dojotype\x3d"dijit.form.Button" dojoAttachEvent\x3d"onClick:uploadItem" class\x3d"primary" dojoAttachPoint\x3d"_updateItemBtn"\x3e${i18n.updateItem}\x3c/button\x3e\r\n      \x3c/div\x3e\r\n    \x3c/form\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
item:null,admin:null,i18n:null,_replaceUpdateVerLabel:null,_updateItemDialog:null,_updateItemForm:null,_updateItemBtn:null,_cancelBtn:null,_waitingSpan:null,_useDescUpdateRadio:null,_useDescKeepRadio:null,_updateItemFile:null,_errorDiv:null,_updateItemFolderInput:null,_updateItemIdInput:null,_updateItemNameInput:null,_updateItemTitleInout:null,_updateItemTagsInput:null,_updateItemTypeInput:null,_updateItemKeywordsInput:null,_updateDescriptonInput:null,_updateSnippetInput:null,_updateAccessInput:null,
_updateLicenseInfoInput:null,_updateExtentInput:null,_updateOverwriteInput:null,_updateAsyncInput:null,statics:{_instance:null,getInstance:function(){null===this._instance&&(this._instance=new arcgisonline.sharing.dijit.dialog.UpdateItemDlg);return this._instance}},postMixInProperties:function(){this.inherited(arguments);this.i18n=m.i18n.getLocalization("arcgisonline","arcgisonline").common;m.mixin(this.i18n,m.i18n.getLocalization("arcgisonline","arcgisonline").updateItemDlg);m.mixin(this.i18n,{updating:m.i18n.getLocalization("arcgisonline",
"arcgisonline").addItemFrm.updating})},postCreate:function(){},show:function(b,p){var f={Shapefile:1,"File Geodatabase":1,GeoJson:1,CSV:1,"Microsoft Excel":1},d=b&&b.publishParameters&&"address"===b.publishParameters.locationType;this.item=b;p&&null!==this.adminUser&&(this.admin=p);"Layer Package"==b.type&&m.style(m.byId("update-item-keepdescription"),"display","block");"Vector Tile Service"===b.type?(m.attr(this._replaceUpdateVerLabel,"innerHTML",this.i18n.overwriteStyle),this._updateItemDialog.set("title",
this.i18n.updateStyle),this._updateItemBtn.set("label",this.i18n.updateStyle)):(this.itemName=this.item.sourceData&&this.item.sourceData.name||this.item.name,m.attr(this._replaceUpdateVerLabel,"innerHTML",m.string.substitute(this.i18n.replaceUpdatedVersionMsg,[this.itemName])));b&&b.type in f&&b.relatedService?this._overwriteService.set("checked",!1):b&&b.sourceData?(this._updateItemDialog.set("title",this.i18n.updateFeatures),this._updateItemBtn.set("label",this.i18n.updateFeatures),f=m.string.substitute(d?
this.i18n.overwriteServiceWithCreditsMsg:this.i18n.overwriteServiceMsg,[b.title,b.sourceData.name]),m.attr(this._replaceUpdateVerLabel,"innerHTML",f)):this._overwriteService.set("checked",!1);b&&b.sourceData&&(esri.hide(this._overwriteService.domNode),m.attr("overwriteServiceLbl","innerHTML",this.i18n.keepFieldsSame),m.removeClass("overwrite_section","hide"));this._updateItemDialog.show();this._uploadProgressBar=new arcgisonline.pages.dijit.UploadProgressBar({},this._uploadProgressBar);this._uploadProgressBar.startup();
this._uploadProgressBar.hide()},clear:function(){this._updateItemFile.value="";this._useDescKeepRadio.set("checked",!0);this._useDescUpdateRadio.set("checked",!1);this._overwriteService.set("checked",!0)},_handleCancel:function(b){b.preventDefault();this._updateItemDialog.hide()},hide:function(){this._disable(!1);this._updateItemDialog.hide()},uploadItem:function(b){b.preventDefault();if(0===this._updateItemFile.value.length)return arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.errorLabel,
message:this.i18n.error.providePath}),!1;b=this._fetchItem(this.item).then(m.hitch(this,"loadFile"));if(this.item.sourceData||this.item.relatedService&&this._overwriteService.get("checked"))m.attr(this._waitingSpan,"innerHTML",this.i18n.updating),b=b.then(m.hitch(this,"_updateServiceData",this.item.sourceData||this.item)).then(m.hitch(this,"_resetServiceTitle",this.item));return b.then(m.hitch(this,function(p){p&&!p.success&&p.error&&arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.updateItemErrorTitle,
message:p.error.message||this.i18n.error.errorWhileUpdate});p&&p.serviceItemId?(this._disable(!1),this._updateItemDialog.hide(),window.location="item.html?id\x3d"+p.serviceItemId+(p.jobId?"\x26jobid\x3d"+p.jobId:"")):m.publish("itemData/update",[""]);return!0}),m.hitch(this,function(p){m.isObject(p)&&arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.updateItemErrorTitle,message:p.message||this.i18n.error.errorWhileUpdate});this._disable(!1)}))},_updateServiceData:function(b){var p=
new m.Deferred;this._checkStatus(b,500,m.hitch(this,function(f){var d=esriGeowConfig.restBaseUrl+"content/users/"+f.owner+"/publish",a,c,h={itemid:f.id,filetype:{"file geodatabase":"filegeodatabase",shapefile:"shapefile",geojson:"geojson",csv:"CSV","microsoft excel":"excel"}[f.type.toLowerCase()],overwrite:!0,publishParameters:m.json.stringify({name:this.item.title?this.item.title.replace(/ /g,"_"):f.title.replace(/ /g,"_")})};m.attr(this._waitingSpan,"innerHTML",this.i18n.updating);m.promise.all([this._fetchPublishParameters(this.item),
this._fetchServiceInfo(this.item.relatedService||this.item)]).then(m.hitch(this,function(l){a=l[1];(c=l[0])&&"CSV"===f.type?(l=m.mixin(m.mixin({},a.layers&&a.layers[0]),{fields:c.layerInfo.fields}),h.publishParameters=m.mixin(c,{layerInfo:l,name:c.name||f.title.replace(/ /g,"_")})):c&&"Microsoft Excel"===f.type?(h.publishParameters=this._generateExcelOverwritePublishParameters(c,a),a=null):h.publishParameters={name:f.title?f.title.replace(/ /g,"_"):this.item.title.replace(/ /g,"_")};h.publishParameters=
a?m.json.stringify(m.mixin(h.publishParameters,a)):h.publishParameters;return this.util.request({url:d,content:h},{usePost:!0}).then(m.hitch(this,function(k){p.resolve(k&&k.services&&k.services[0]||{serviceItemId:f.id})}),m.hitch(this,function(k){p.reject(k)}))}))}));return p},_generateExcelOverwritePublishParameters:function(b,p){p.name=b.name;p.sourceSR=b.sourceSR;p.targetSR=b.targetSR;for(var f=0;f<p.tables.length;f++)"Review"!=p.tables[f].name&&(p.layers[p.layers.length]=p.tables[f]);for(f=0;f<
p.layers.length;f++)p.layers[f].excelSheetId=b.layers[f].excelSheetId,p.layers[f].locationType=b.layers[f].locationType,p.layers[f].latitudeFieldName=b.layers[f].latitudeFieldName,p.layers[f].longitudeFieldName=b.layers[f].longitudeFieldName,p.layers[f].geocodeServiceUrl=b.layers[f].geocodeServiceUrl,p.layers[f].sourceLocale=b.layers[f].sourceLocale,p.layers[f].sourceCountry=b.layers[f].sourceCountry,p.layers[f].standardizedFieldNames=b.layers[f].standardizedFieldNames,p.layers[f].addressFields=b.layers[f].addressFields;
return JSON.stringify(p)},_resetServiceTitle:function(b,p){var f=new m.Deferred,d=this.util.getUser(),a=b.title||"",c=b.folderId||b.ownerFolder;d=esriGeowConfig.restBaseUrl+"content/users/"+(b.owner||d.username)+"/"+(c?c+"/":"")+"items/"+b.id+"/update";a=-1!==b.typeKeywords.indexOf("Involved Lookup")?{title:a,typeKeywords:b.typeKeywords.toString()+",showUnmatchedAddresses"}:{title:a};this.util.request({url:d,content:a},{usePost:!0}).then(m.hitch(this,function(){f.resolve(p)}),m.hitch(this,function(){f.resolve(p)}));
return f},_fetchServiceInfo:function(b){b=b.url;var p={addToken:(this.util.isHostedService(b)||this.util.isAgolService(b))&&!1!==esriGeowConfig.isMultiTenant},f=new m.Deferred,d;m.promise.all([this.util.request({url:b},p),this.util.request({url:b+"/layers"},p)]).then(m.hitch(this,function(a){var c={},h=a&&1<a.length&&a[1],l=h&&h.layers;h=h&&h.tables;l&&l.length&&(m.forEach(l,function(k){delete k.fields}),c.layers=l);h&&h.length&&(c.tables=h);d=m.mixin(a[0],c);f.resolve(d)}));return f},_fetchPublishParameters:function(b){var p=
esriGeowConfig.restBaseUrl+"content/items/"+b.id+"/info/publishParameters.json";b.publishParameters?(p=new m.Deferred,p.resolve(b.publishParameters)):!b.sourceData||"CSV"!==b.sourceData.type&&"Microsoft Excel"!==b.sourceData.type?(p=new m.Deferred,p.resolve(!1)):p=this.util.request({url:p}).then(m.hitch(this,function(f){return f}));return p},_fetchItem:function(b){if(b.sourceData)var p=this.util.request({url:esriGeowConfig.restBaseUrl+"content/items/"+b.sourceData.id}).then(m.hitch(this,function(f){f.folderId=
f.ownerFolder;return f}));else p=new m.Deferred,p.resolve(b);return p},loadFile:function(b){var p=new m.Deferred,f=this._updateItemFile.value,d=f.lastIndexOf("\\"),a=b.type;-1<d&&(f=f.substring(d+1,f.length));f=f.replace(/ /g,"_");if("Vector Tile Service"!==b.type&&this.itemName!=f)return b=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),b.show({title:this.i18n.errorLabel,message:m.string.substitute(this.i18n.error.sameFileName,[this.itemName])}),this._updateItemFile.value=
"",p.reject(!0),p;if("Vector Tile Service"===b.type){d=/(?:\.([^.]+))?$/;var c=f.replace(/^.*(\\|\/|:)/,"");if("json"!==(f?d.exec(c)[1].toLowerCase():""))return b=arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance(),b.show({title:this.i18n.errorLabel,message:this.i18n.error.invalidStyleFileExtension}),this._updateItemFile.value="",p.reject(!0),p}this._disable(!0);f=!0;"Layer Package"==a&&(f=m.byId("useDescription:keep").checked);this._updateItemNameInput.set("value",this.itemName);
this._updateItemTitleInput.set("value",b.title);this._updateItemTagsInput.set("value",b.tags);this._updateItemTypeInput.set("value",a);this._updateItemKeywordsInput.set("value",b.typeKeywords);this._updateAccessInput.set("value",b.accessInformation);this._updateLicenseInfoInput.set("value",b.licenseInfo);this._updateItemFolderInput.set("value",b.folderId);f?(this._updateDescriptionInput.set("value",b.description),this._updateSnippetInput.set("value",b.snippet),this._updateExtentInput.set("value",
b.extent)):(this._updateDescriptionInput.set("value",""),this._updateSnippetInput.set("value",""),this._updateExtentInput.set("value",""));var h=function(l,k){if(!l.success||"completed"!==l.status&&l.status){var g=this.i18n.error.errorWhileUpdate;l&&l.error&&l.error.message&&(g=l.error.message);-1<g.indexOf("The request size is greater than the max allowed of 1024MB")&&(g=this.i18n.error.exceedFileSizeLimit);arcgisonline.sharing.dijit.dialog.GeneralDlg.prototype.statics.getInstance().show({title:this.i18n.updateItemErrorTitle,
message:g});p.reject(!0)}else p.resolve(!0)};a=function(l){this._disable(!1);p.reject(l)};b&&"Vector Tile Service"===b.type?this._updateItemResource(b,this._updateItemForm).then(m.hitch(this,h),m.hitch(this,a)):(this._uploadProgressBar.reset(),this._uploadProgressBar.show(),this.itemAPI.update.call(this.itemAPI,b,this._updateItemForm,this._updateItemFile.files[0]).then(function(l){this._uploadProgressBar.hide();h(l)}.bind(this),a.bind(this)));return p},_updateItemResource:function(b,p){var f=this.util.getUser(),
d=b.folderId||b.ownerFolder;f={url:esriGeowConfig.restBaseUrl+"content/users/"+(b.owner||f.username)+"/"+(d?d+"/":"")+"/items/"+b.id+"/updateResources",form:p,content:{resourcesPrefix:"styles",filename:"root.json"}};m.query("input",p).forEach(m.hitch(this,function(a){a&&"file"!==a.name&&m.attr(a,"name","")}));return this.util.request(f,{usePost:!0}).then(m.hitch(this,function(a){return a}),m.hitch(this,function(a){throw{message:this.i18n.error.invalidStyleFile};}))},_checkStatus:function(b,p,f){this.util.request({url:esriGeowConfig.restBaseUrl+
"content/users/"+b.owner+(b.ownerFolder&&"/"!==b.ownerFolder?"/"+b.ownerFolder:"")+"/items/"+b.id+"/status"}).then(m.hitch(this,function(d){d=d||{status:"failed"};"completed"===d.status?f(b):(p=(p||500)+250,setTimeout(m.hitch(this,function(){this._checkStatus(b,p,f)}),p))}))},_disable:function(b){this._updateItemBtn.set("disabled",b);this._cancelBtn.set("disabled",b);this.domUtil.showHide(this._waitingSpan,b);m.style(this._waitingSpan,"display",b?"inline-block":"none")}})})},"arcgisonline/pages/dijit/UploadProgressBar":function(){define("require exports tslib dojo/topic dojo/text!./UploadProgressBar/UploadProgressBar.html dojo/i18n!../../nls/arcgisonline dijit/_TemplatedMixin dijit/_WidgetBase ../utils/dom ../utils/culture ../../tsutils/declareDecorator".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l){b=v.__importDefault(b);p=v.__importDefault(p);f=v.__importDefault(f);d=v.__importDefault(d);a=v.__importDefault(a);c=v.__importDefault(c);h=v.__importDefault(h);l=v.__importDefault(l);return function(){function k(g,e){this.templateString=p["default"];this.i18n=f["default"]}k.prototype.startup=function(){this.inherited(arguments);this.own(b["default"].subscribe("item/upload-progress-update",this._onProgressUpdate.bind(this)))};k.prototype.hide=function(){c["default"].hideNode(this.domNode)};
k.prototype.show=function(){c["default"].showNode(this.domNode)};k.prototype.reset=function(){this._uploadPercentLabel.textContent=this._uploadProgressFill.style.width="0%";this._uploadPercentLabel.innerHTML=h["default"].getPercentString(0);this._uploadProgressFill.style.width="0%"};k.prototype._onProgressUpdate=function(g){this._uploadProgressFill.classList[100===g?"add":"remove"]("upload-progress-bar__fill--full");this._uploadPercentLabel.innerHTML=h["default"].getPercentString(g/100);this._uploadProgressFill.style.width=
g+"%"};return k=v.__decorate([l["default"](a["default"],d["default"])],k)}()})},"arcgisonline/sharing/geow/Item":function(){define("esri/request dojo/_base/lang dojo/Deferred dojo/dom-construct dojo/dom-form dojo/topic dojo/promise/all arcgisonline/esriGeowConfig arcgisonline/sharing/util".split(" "),function(m,n,v,b,p,f,d,a,c){return{addItem:function(h,l,k){return this._action(h,l,k,"addItem")},update:function(h,l,k){return this._action(h,l,k,"update")},_action:function(h,l,k,g){if(c.getUser())return g=
this._getActionItemUrl(h,g),h=5242880<k.size?this._multiPartAction(g,l,k,h):this._postForm(g,l)},_multiPartAction:function(h,l,k,g){function e(t){x.reject(t)}function q(t){t.isMultipart=!0;x.resolve(t)}function u(t){this._commitItem(g,l).then(q.bind(this),e.bind(this))}function r(t){this._cancelItem(g);e.call(this,t)}var x=new v;this._startMultipartRequest(h,g.fileName?g.fileName:k.name).then(function(t){t.success?(g.id=t.id,this._addItemParts(g,k).then(u.bind(this),r.bind(this))):e.call(this,t.error)}.bind(this),
e);return x},_postForm:function(h,l){return c.request({url:h,form:l,timeout:0},{usePost:!0})},_startMultipartRequest:function(h,l){return c.request({url:h,content:{multipart:!0,filename:l,async:!0}},{usePost:!0})},_addItemParts:function(h,l){function k(){if(0===w.length)r.resolve();else{var E=w.splice(0,z);d(E.map(function(G){var F=new v;return this._addPartWithRetries(h,G.partData,G.formData,1,g,t,F)}.bind(this))).then(k.bind(this),function(G){r.reject(G)})}}var g=l.size,e=5242880,q=0,u=Math.ceil(g/
e),r=new v,x=h.fileName?h.fileName:l.name,t={},w=[],z=a.multiPartBatchSize||10;1E4<u&&(e=Math.ceil(g/1E4),u=Math.ceil(g/e));for(;q<u;){var B=q*e;B=l.slice(B,B+e);var A={partNum:q+1},y=b.create("form",{enctype:"multipart/form-data"});y=new FormData(y);y.append("partNum",A.partNum);y.append("streamdata",!0);y.append("f","json");y.append("token",c.getToken());y.append("file",B,x);w.push({partData:A,formData:y});q++}this.pendingRequests=[];f.subscribe("cancel-item-upload",function(){this.pendingRequests.forEach(function(E){E&&
!E.isFulfilled()&&E.cancel()})}.bind(this));k.call(this);return r},_addPartWithRetries:function(h,l,k,g,e,q,u){var r=this._getActionItemUrl(h,"addPart");r=m({url:r,form:k,timeout:0},{returnProgress:!0,disableIdentityLookup:!0}).then(function(x){x.success?u.resolve(x):u.reject(x.error)},function(x){g++;"Request canceled"!==x.message&&7>=g?this._addPartWithRetries(h,l,k,g,e,q,u):u.reject(x)}.bind(this),function(x){x.loaded&&"upload"===x.transferType&&(q[l.partNum.toString()]=x.loaded,x=Object.keys(q).reduce(function(t,
w){return t+q[w]},0),f.publish("item/upload-progress-update",Math.floor(x/e*100)))});this.pendingRequests.push(r);return u},_commitItem:function(h,l){var k=this._getActionItemUrl(h,"commit");var g=l instanceof FormData?{title:h.fileName,type:h.fileType}:n.mixin({},p.toObject(l));return c.request({url:k,content:g},{usePost:!0})},_cancelItem:function(h){h=this._getActionItemUrl(h,"cancel");return c.request({url:h},{usePost:!0})},_getUserUrl:function(h){var l=c.getUser();l=l.username||l.email;return a.restBaseUrl+
"content/users/"+(h.owner||l)},_getActionItemUrl:function(h,l){var k=this._getUserUrl(h);h.folderId&&(k=k+"/"+h.folderId);return k="addItem"===l?k+"/addItem":k+"/items/"+h.id+"/"+l}}})},"arcgisonline/sharing/dijit/_GalleryFiltersMixin":function(){define(["dojo/_base/declare"],function(){return{rootNodes:{organization:{all:{},maps:{},layers:{},scenes:{},applications:{},tools:{},files:{}},maps:{all:{},imagery:{tags:["imagery"]},basemaps:{tags:["basemap"]},historical:{tags:["historical"]},demographics:{tags:"demographics"},
landscape:{tags:"landscape"},oceans:{tags:"oceans"},earth:{tags:["earth observations"]},urban:{tags:["urban"]},transportation:{tags:["transportation"]},boundariesplaces:{tags:["boundaries"]},storymaps:{tags:["story maps","story map"]}},apps:{configurable:{typekeywords:["Configurable"]},readytouse:{typekeywords:["Ready To Use"]},appbuilder:{typekeywords:["Web AppBuilder for ArcGIS"]}}},imagery:{basemapimagery:{parent:"imagery"},multiimagery:{parent:"imagery"},temporalimagery:{parent:"imagery"},eventimagery:{parent:"imagery"}},
basemaps:{esribasemaps:{parent:"basemaps"},partnerbasemaps:{parent:"basemaps"},userbasemaps:{parent:"basemaps"}},demographics:{income:{parent:"demographics"},spending:{parent:"demographics"},population:{parent:"demographics"},business:{parent:"demographics"},atrisk:{parent:"demographics"}},landscape:{agriculture:{parent:"landscape"},climate:{parent:"landscape"},ecology:{parent:"landscape"},biology:{parent:"landscape"},disturbance:{parent:"landscape"},elevation:{parent:"landscape"},landcover:{parent:"landscape"},
hazards:{parent:"landscape"},soils:{parent:"landscape"},subsurface:{parent:"landscape"},water:{parent:"landscape"}},urban:{threed:{parent:"urban"},movement:{parent:"urban"},parcels:{parent:"urban"},people:{parent:"urban"},planning:{parent:"urban"},publicFilter:{parent:"urban"},work:{parent:"urban"}},transportation:{accessibility:{parent:"transportation"},infrastructure:{parent:"transportation"},logistics:{parent:"transportation"},traffic:{parent:"transportation"},transit:{parent:"transportation"}},
boundariesplaces:{boundaries:{parent:"boundariesplaces"},places:{parent:"boundariesplaces"}},maps:{webmaps:{parent:"maps"},mapfiles:{parent:"maps"}},layers:{weblayers:{parent:"layers"},layerfiles:{parent:"layers"}},applications:{web:{parent:"applications"},mobile:{parent:"applications"},desktop:{parent:"applications"}},weblayers:{features:{parent:"weblayers"},tiles:{parent:"weblayers"},mapimage:{parent:"weblayers"},imagery:{parent:"weblayers"},scenelayers:{parent:"weblayers"},tables:{parent:"weblayers"}},
readytouse:{web:{parent:"readytouse"},ios:{parent:"readytouse"},android:{parent:"readytouse"},windows:{parent:"readytouse"},desktop:{parent:"readytouse"}},configurable:{narrate:{parent:"configurable"},collect:{parent:"configurable"},compare:{parent:"configurable"},"3dscene":{parent:"configurable"},analyze:{parent:"configurable"},present:{parent:"configurable"},social:{parent:"configurable"},local:{parent:"configurable"},route:{parent:"configurable"},showcase:{parent:"configurable"}},files:{document:{parent:"files"},
image:{parent:"files"},pdf:{parent:"files"}},tools:{locators:{parent:"tools"},geodatabase:{parent:"tools"},geometric:{parent:"tools"},geoprocessing:{parent:"tools"},network:{parent:"tools"}},"imagery-root":{tags:["imagery"]},"imagery-basemapimagery":{tags:["baseimagery"]},"imagery-multiimagery":{tags:["multispectral"]},"imagery-temporalimagery":{tags:["temporal"]},"imagery-eventimagery":{tags:["event_imagery"]},"basemaps-root":{tags:["basemap"]},"basemaps-esribasemaps":{tags:["esri_basemap"]},"basemaps-partnerbasemaps":{tags:["partner_basemap"]},
"basemaps-userbasemaps":{tags:["user_basemap"]},"historical-root":{tags:["historical"]},"demographics-root":{tags:["demographics"]},"demographics-income":{tags:["income"]},"demographics-spending":{tags:["spending","behaviors"]},"demographics-population":{tags:["population","housing"]},"demographics-segmentation":{tags:["segmentation"]},"demographics-business":{tags:["business","jobs"]},"demographics-atrisk":{tags:["at risk","poverty"]},"landscape-root":{tags:["landscape"]},"landscape-agriculture":{tags:["agriculture"]},
"landscape-climate":{tags:["climate","weather"]},"landscape-ecology":{tags:["ecology"]},"landscape-biology":{tags:["species"]},"landscape-disturbance":{tags:["disturbance"]},"landscape-elevation":{tags:["elevation"]},"landscape-landcover":{tags:["landcover"]},"landscape-hazards":{tags:["hazards"]},"landscape-soils":{tags:["soils","geology"]},"landscape-subsurface":{tags:["subsurface"]},"landscape-water":{tags:["water"]},"oceans-root":{tags:["oceans"]},"earth-root":{tags:["earth observations"]},"urban-root":{tags:["urban"]},
"urban-threed":{tags:["3D"]},"urban-movement":{tags:["movement"]},"urban-parcels":{tags:["parcels"]},"urban-people":{tags:["people"]},"urban-planning":{tags:["planning"]},"urban-publicFilter":{tags:["public"]},"urban-work":{tags:["work"]},"transportation-root":{tags:["transportation"]},"transportation-accessibility":{tags:["accessibility"]},"transportation-infrastructure":{tags:["infrastructure"]},"transportation-logistics":{tags:["logistics"]},"transportation-traffic":{tags:["traffic"]},"transportation-transit":{tags:["transit"]},
"boundariesplaces-root":{tags:["boundaries"]},"boundariesplaces-boundaries":{tags:["boundaries"]},"boundariesplaces-places":{tags:["places"]},"storymaps-root":{tags:["story maps","story map"]},"scenes-root":{tags:["scenes"]},"readytouse-root":{typekeywords:["Ready To Use"]},"configurable-root":{typekeywords:["Configurable"]},"appbuilder-root":{typekeywords:["Web AppBuilder for ArcGIS"]},"readytouse-web":{typekeywords:["Web Mapping Application"]},"readytouse-ios":{typekeywords:["ArcGIS for iPhone"]},
"readytouse-android":{typekeywords:["ArcGIS for Android"]},"readytouse-windows":{typekeywords:["ArcGIS for Windows Phone"]},"readytouse-desktop":{typekeywords:["Application","Desktop Application"]},"configurable-narrate":{typekeywords:["story"]},"configurable-collect":{typekeywords:["collect"]},"configurable-compare":{typekeywords:["compare"]},"configurable-3dscene":{typekeywords:["3Dscene"]},"configurable-analyze":{typekeywords:["summarize"]},"configurable-present":{typekeywords:["gallery"]},"configurable-social":{typekeywords:["social"]},
"configurable-local":{typekeywords:["local"]},"configurable-route":{typekeywords:["route"]},"configurable-showcase":{typekeywords:["showcase"]},mappings:{"demographics-behaviors":{mappedCategory:"demographics-spending"},"demographics-segmentation":{mappedCategory:"demographics"},"landscape-oceans":{mappedCategory:"oceans"}}}})},"arcgisonline/sharing/dijit/dialog/AdvancedOfflineOptionsDlg":function(){define("dojo/_base/declare dojo/on dojo/dom-attr dojo/query dojo/dom dojo/dom-style dojo/_base/lang dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/dom-construct dojo/string dojo/_base/window dojo/promise/all dojo/when dojo/Deferred dojo/_base/array dojo/cookie dojo/dom-class dojo/json dijit/registry dijit/form/Select dijit/form/CheckBox ./ConfirmDialog dijit/focus dojo/_base/event dojo/keys ./_CreateItemUtilMixin dojo/topic esri/Evented esri/arcgis/Portal ../../geow/Account ../../geow/Content ../../util dojo/i18n!arcgisonline/nls/arcgisonline".split(" "),
function(m,n,v,b,p,f,d,a,c,h,l,k,g,e,q,u,r,x,t,w,z,B,A,y,E,G,F,D,L,O,S,Z,I,N,K){return m("arcgisonline.sharing.dijit.dialog.AdvancedOfflineOptionsDlg",[a,c,h,O],{baseClass:"esriAdvancedOfflineOptionsDlg",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"main"\x3e\x3ch2\x3e${i18n.advancedOfflineOptionsDlg.editableLayersTitle}\x3c/h2\x3e\x3cp class\x3d"" data-dojo-attach-point\x3d"_editMessage"\x3e${i18n.advancedOfflineOptionsDlg.editMessage}\x3c/p\x3e\x3cdiv class\x3d"edit"\x3e\x3clabel class\x3d"esriLeadingMargin1 trailer-0 editFeatures"\x3e\x3cinput class\x3d"" data-dojo-attach-point\x3d"editFeatures" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d\'checked:true\'/\x3e\x26nbsp;${i18n.advancedOfflineOptionsDlg.editFeatures}\x26nbsp;\x3c/label\x3e\x3cbr /\x3e\x3clabel class\x3d"esriLeadingMargin26 editAttachments padding-left-2"\x3e\x3cinput class\x3d"editAttachments" data-dojo-attach-point\x3d"editAttachments" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d\'checked:true, disabled:false\'/\x3e\x26nbsp;${i18n.advancedOfflineOptionsDlg.editAttachments}\x26nbsp;\x3c/label\x3e\x3c/div\x3e\x3ch2\x3e${i18n.advancedOfflineOptionsDlg.readOnlyLayersTitle}\x3c/h2\x3e\x3cp class\x3d"" data-dojo-attach-point\x3d"_readOnlyMessage"\x3e${i18n.advancedOfflineOptionsDlg.readOnlyMessage}\x3c/p\x3e\x3cdiv class\x3d"readonly"\x3e\x3clabel class\x3d"esriLeadingMargin1 "\x3e\x3cinput class\x3d"" data-dojo-attach-point\x3d"downloadAttachments" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d\'checked:true\'/\x3e\x26nbsp;${i18n.advancedOfflineOptionsDlg.editAttachments}\x26nbsp;\x3c/label\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
onDone:function(){},postMixInProperties:function(){this.inherited(arguments);this.i18n=d.mixin({},K);this._portalUser=(this._portal=esriGeowConfig.portal||esriGeowConfig.self)&&(this._portal.user||this._portal.getPortalUser())},postCreate:function(){this.inherited(arguments);Z.getSelf(d.hitch(this,function(Q){this._loadConnections();this.set("item",this.data)}))},destroy:function(){this._errorDlg&&(this._errorDlg.destroyRecursive(),this._errorDlg=null);this.inherited(arguments);this._portalUser=this._portal=
null},showModal:function(){var Q=new u,da=new y({title:K.advancedOfflineOptionsDlg.title,buttonOk:K.common.ok,buttonCancel:K.common.cancel,style:{width:"475px",height:"auto"},className:"esriAdvancedOptions"}),U=b(".dijitDialogTitle",da.domNode).shift(),aa,J=this._portal.helpMap.m["120000899"];J=l.create("a",{className:"esriHelpIcon",title:K.common.help,href:this._portal.helpBase+(J?J:""),target:"_blank"});l.place(J,U,"last");da.setContent(this.domNode);da.show().then(d.hitch(this,function(T){"onOk"===
T&&this._supportsAdvancedSyncOptions&&(this.set("disabled",!0,K.advancedOfflineOptionsDlg.pleaseWait),aa=this.get("offlineProperties"),this._webMap=d.mixin(this._webMap,{applicationProperties:d.mixin(this._webMap.applicationProperties||{},aa)}));da.hide().then(d.hitch(this,function(){Q.resolve(this._webMap)}))}));return Q},_loadConnections:function(){this.own(n(this.editFeatures,"click",d.hitch(this,function(){this.editFeatures.get("checked")?(b(".editAttachments").removeClass("disabled"),this.editAttachments.set("disabled",
!1)):(b(".editAttachments").addClass("disabled"),this.editAttachments.set("checked",!1),this.editAttachments.set("disabled",!0))})))},_setItemAttr:function(Q){this._item=Q.portal?Q:new S.PortalItem(d.mixin({},Q,{portal:this._portal}));Q=this._item.itemData?d.clone(this._item.itemData):{};this._item.updatedOffline&&(Q.applicationProperties||(Q.applicationProperties={}),Q.applicationProperties.offline=d.clone(this._item.updatedOffline));this.set("webmap",Q)},_setWebmapAttr:function(Q){this._webMap=
Q||{};this._mapSupportsAdvancedSyncOptions(Q).then(d.hitch(this,function(da){(this._supportsAdvancedSyncOptions=da)?this.set("offlineProperties",this._webMap.applicationProperties&&this._webMap.applicationProperties.offline||{}):(b(".dijitCheckBox",this.domNode).map(z.byNode).forEach(function(U){U.set("disabled",!0)}),b("label").addClass("disabled"))}))},_setOfflinePropertiesAttr:function(Q){var da=Q||{},U=da.editableLayers,aa=da.readonlyLayers;da=!U||U.download&&("featuresAndAttachments"===U.download||
"features"===U.download);U=!U||U.sync&&"syncFeaturesAndAttachments"===U.sync;aa=!aa||aa.downloadAttachments;this._offlineProperties=Q||{};this.editFeatures.set("checked",da);this.editAttachments.set("disabled",!da);b(".editAttachments")[da?"removeClass":"addClass"]("disabled");this.editAttachments.set("checked",U);this.downloadAttachments.set("checked",aa)},_getOfflinePropertiesAttr:function(){var Q=this._offlineProperties||{},da=this.editFeatures.get("checked"),U=this.editAttachments.get("checked"),
aa=this.downloadAttachments.get("checked");da||U?da&&U?Q=d.mixin(Q,{editableLayers:{download:"featuresAndAttachments",sync:"syncFeaturesAndAttachments"}}):da&&!U&&(Q=d.mixin(Q,{editableLayers:{download:"features",sync:"syncFeaturesUploadAttachments"}})):Q=d.mixin(Q,{editableLayers:{download:"none",sync:"uploadFeaturesAndAttachments"}});Q=d.mixin(Q,{readonlyLayers:{downloadAttachments:aa}});return d.mixin({},{offline:Q})},_setDisabledAttr:function(Q,da){this.set("readOnly",Q,da)},_setReadOnlyAttr:function(Q,
da,U){b(".dijit",this.domNode).map(z.byNode).forEach(function(aa){aa.set("disabled",Q)});b("a",this.domNode)[Q?"addClass":"removeClass"]("disabledLink");b("label, p, span, h2, .hint",this.domNode)[Q?"addClass":"removeClass"]("disabled");Q&&da&&L.publish("/dlg/busyMessage",da);L.publish("/esri/disable",Q,da)},_mapSupportsAdvancedSyncOptions:function(Q){var da=new u,U=Q.operationalLayers||[],aa={},J=[];if(Q&&Q.applicationProperties&&Q.applicationProperties.offline)da.resolve(!0);else{r.forEach(U,function(Y){T=
Y.url&&Y.url.replace(/(\/\d+)+$/g,"");aa[T]=T});for(var T in aa)aa.hasOwnProperty(T)&&aa[T]&&J.push(N.request({url:aa[T]},{addToken:!1}).then(function(Y){return Y&&Y.syncCapabilities&&Y.syncCapabilities.supportsAttachmentsSyncDirection},function(Y){return!1}));e(J).then(function(Y){da.resolve(r.every(Y,"return item;"))})}return da},_showError:function(Q){Q=d.mixin(d.mixin({},K.publishWizard.errors.error),Q);this._errorDlg=this._errorDlg||new y({showCancel:!1,style:{width:"400px",height:"auto"}});
this._errorDlg.show(Q).then(d.hitch(this,function(){this.set("disabled",!1);this._errorDlg.hide()}));return!1}})})},"arcgisonline/sharing/dijit/dialog/getWFSConfig":function(){define(["dojo/_base/array","esri/renderers/SimpleRenderer","esri/symbols/jsonUtils","arcgisonline/map/popup/getDefaultPopupInfo"],function(m,n,v,b){function p(c){var h,l=c.fields,k=c.selectedLayer||{},g;l&&l.length&&(g=m.filter(l,function(e){return"esriFieldTypeGeometry"!==e.type}))&&g.length&&(h=b({name:k.title,fields:l},!1,
c));return h}var f={type:"esriSMS",style:"esriSMSCircle",color:[34,114,162,128],size:6,outline:{color:[34,114,162,255],width:1}},d={type:"esriSLS",style:"esriSLSSolid",color:[77,77,77,255],width:2},a={type:"esriSFS",style:"esriSFSSolid",color:[227,139,79,204],outline:{type:"esriSLS",style:"esriSLSSolid",color:[255,255,255,255],width:.75}};return function(c){var h=c.geometryType,l=c.toJson(),k=l.url,g=l.mode;l={version:l.version,name:l.name,wfsNamespace:c.layerNamespace,featureUrl:c.getFeatureUrl,
supportedSpatialReferences:c.spatialReferences};var e;"esriGeometryPoint"===h?e=new n(v.fromJson(f)):"esriGeometryPolyline"===h?e=new n(v.fromJson(d)):"esriGeometryPolygon"===h&&(e=new n(v.fromJson(a)));e=e.toJson();return{url:k,mode:g,wfsInfo:l,layerDefinition:{geometryType:h,drawingInfo:{renderer:e},spatialReference:{wkid:4326},fields:c.fields},popupInfo:p(c)}}})},"arcgisonline/map/popup/getDefaultPopupInfo":function(){define(["./isImageServiceLayer","./isTiledImageServiceLayer","dojo/_base/array",
"dojo/_base/lang"],function(m,n,v,b){return function(p,f,d){f=p.displayField;f=p.name+(f&&f.length?": {"+f+"}":"");var a=p.fields,c=!1,h=!1,l=!1;if(m(d)||n(d))a=d.getCustomRasterFields({rasterAttributeTableFieldPrefix:"Raster."}),l=0>v.indexOf(["F32","F64"],d.pixelType),d&&d.capabilities&&(h=(c=d.capabilities&&-1<d.capabilities.toLowerCase().indexOf("catalog")||d.fields&&0<d.fields.length)&&("esriImageServiceDataTypeVector-UV"===d.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===d.serviceDataType));
var k={esriFieldTypeDouble:1,esriFieldTypeSingle:1},g={esriFieldTypeInteger:1,esriFieldTypeSmallInteger:1},e={esriFieldTypeDate:1},q=",";p.editFieldsInfo&&(p.editFieldsInfo.creatorField&&(q+=p.editFieldsInfo.creatorField+","),p.editFieldsInfo.creationDateField&&(q+=p.editFieldsInfo.creationDateField+","),p.editFieldsInfo.editorField&&(q+=p.editFieldsInfo.editorField+","),p.editFieldsInfo.editDateField&&(q+=p.editFieldsInfo.editDateField+","),q=q.toLowerCase());a=v.map(a,b.hitch(this,function(u,r){var x=
"esriFieldTypeOID"!==u.type&&"esriFieldTypeGlobalID"!==u.type&&"esriFieldTypeGeometry"!==u.type,t=null,w=u.editable&&"esriFieldTypeOID"!==u.type&&"esriFieldTypeGlobalID"!==u.type;if(x){var z=u.name.toLowerCase(),B=q+"stretched value,fnode_,tnode_,lpoly_,rpoly_,poly_,subclass,subclass_,rings_ok,rings_nok,";c&&(B+="raster.itempixelvalue,",h&&(B+="raster.magnitude,raster.direction,"));if(-1<B.indexOf(","+z+",")||-1<z.indexOf("shape")||-1<z.indexOf("perimeter")||-1<z.indexOf("objectid")||-1<z.indexOf("raster.servicepixelvalue.")||
z.indexOf("_i")==z.length-2)x=!1;u.type in g?t={places:0,digitSeparator:!0}:u.type in k?t={places:l&&(-1<z.indexOf("raster.servicepixelvalue")||-1<z.indexOf("raster.itempixelvalue"))?0:2,digitSeparator:!0}:u.type in e&&(10<=p.currentVersion||d&&10<=d.version)&&(t={dateFormat:"longMonthDayYear"})}w=w?-1===q.indexOf(","+u.name.toLowerCase()+","):w;return b.mixin({},{fieldName:u.name,label:u.alias,isEditable:w,tooltip:"",visible:x,format:t,stringFieldOption:"textbox"})}));f={title:f,fieldInfos:a,description:null,
showAttachments:!0,mediaInfos:[]};m(d)?(f.layerOptions={},f.layerOptions.showNoDataRecords=!0,f.layerOptions.returnTopmostRaster=!0):n(d)&&(f.layerOptions={},f.layerOptions.showNoDataRecords=!0);return f}})},"arcgisonline/map/popup/isImageServiceLayer":function(){define(["esri/layers/ArcGISImageServiceLayer","esri/layers/ArcGISImageServiceVectorLayer"],function(m,n){return function(v){return v instanceof esri.layers.ArcGISImageServiceLayer||v instanceof esri.layers.ArcGISImageServiceVectorLayer}})},
"arcgisonline/map/popup/isTiledImageServiceLayer":function(){define(["esri/layers/RasterXLayer"],function(m){return function(n){return n instanceof esri.layers.RasterXLayer}})},"arcgisonline/sharing/dijit/dialog/getWMTSConfig":function(){define("dojo/Deferred dojo/json dojo/_base/array dojo/_base/lang esri/renderers/SimpleRenderer esri/symbols/jsonUtils esri/SpatialReference esri/geometry/Extent arcgisonline/map/core/sameSpatialReference arcgisonline/map/core/projectExtent".split(" "),function(m,
n,v,b,p,f,d,a,c,h){function l(g){var e=new m;k(g.selectedLayer.gcsExtent,g.selectedTileInfo.fullExtent).then(function(q){e.resolve(q&&q.toJson())});return e}function k(g,e){var q=new m,u=e.spatialReference||new d({wkid:4326});handler=b.hitch(this,function(r){q.resolve(r&&r.length&&r[0]&&r[0].type&&"extent"===r[0].type?r[0]:null)});h(g,u,handler,handler);return q}return function(g){var e=new m,q=g.selectedLayer||{},u=g.selectedTileInfo||{},r;l(g).then(b.hitch(this,function(x){var t=g.selectedLayer;
var w=g.selectedTileInfo,z=-1<dojo.indexOf(t.formats,"image/png")?"image/png":t.formats[0];g.resourceUrls=t.resourceUrls;t=g.getTileUrlTemplate({identifier:t.identifier,tileMatrixSet:w.tileMatrixSet,format:z});(w=g.copyright)&&"none"!==w.toLowerCase()?180<w.length&&(w=w.substring(0,180)+".."):w="";z=x||g.selectedTileInfo.fullExtent;var B=g.selectedTileInfo.tileInfo||{};if(96!==B.dpi){for(var A=0;A<B.lods.length;A++){var y=B.lods[A];y.scale=96*y.scale/B.dpi}B.dpi=96}B=B.toJson();r={templateUrl:t,copyright:w,
fullExtent:z,tileInfo:B,wmtsInfo:{url:g.wmtsUrl,layerIdentifier:q.identifier,tileMatrixSet:u.tileMatrixSet}};e.resolve({wmtsConfig:r,fullExtent:x})}));return e}})},"url:esri/dijit/editing/templates/Editor.html":'\x3cdiv class\x3d"esriEditor"\x3e\r\n    \x3cdiv class\x3d"esriTemplatePicker" dojoAttachPoint\x3d"templatePickerDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriDrawingToolbar" dojoAttachPoint\x3d"drawingToolbarDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"progressBar" dojoAttachPoint\x3d"progressBar" indeterminate\x3d"true" dojoType\x3d"dijit.ProgressBar" /\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/InfoWindow.html":'\x3cdiv id\x3d"${id}.infowindow" class\x3d"infowindow" dojoAttachPoint\x3d"_infowindow"\r\n  \x3e\x3cdiv style\x3d"position:relative;"\r\n    \x3e\x3cdiv class\x3d"window" dojoAttachPoint\x3d"_window"\r\n      \x3e\x3cdiv class\x3d"top"\r\n        \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_topleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n    \t\t\x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_topright"\r\n    \t\t\t\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\r\n    \t\t\t\x3e\x3cdiv class\x3d"user" dojoAttachPoint\x3d"_user"\r\n    \t\t\t  \x3e\x3cdiv class\x3d"titlebar" dojoAttachPoint\x3d"_titlebar"\r\n    \t\t\t    \x3e\x3ca class\x3d"hide" dojoAttachPoint\x3d"_hide" dojoAttachEvent\x3d"onclick:hide"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/a\r\n              \x3e\x3cdiv class\x3d"title" dojoAttachPoint\x3d"_title"\x3e${title}\x3c/div\r\n    \t\t\t  \x3e\x3c/div\r\n            \x3e\x3cdiv class\x3d"border" dojoAttachPoint\x3d"_border"\x3e\x3c/div\r\n    \t\t\t  \x3e\x3cdiv class\x3d"layout content" dojoAttachPoint\x3d"_content, containerNode"\r\n    \t\t\t  \x3e\x3c/div\r\n    \t\t\t\x3e\x3c/div\r\n    \t\t\x3e\x3c/div\r\n        \x3e\x3cdiv class\x3d"bottom"\r\n          \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_bottomleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n\t\t      \x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_bottomright"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n        \x3e\x3c/div\r\n      \x3e\x3c/div\r\n    \x3e\x3c/div\r\n    \x3e\x3cdiv class\x3d"pointer" dojoAttachPoint\x3d"_pointer"\x3e\x3cdiv dojoAttachPoint\x3d"_sprite" class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n  \x3e\x3c/div\r\n\x3e\x3c/div\x3e',
"url:esri/dijit/templates/OverviewMap.html":'\x3cdiv class\x3d"esriOverviewMap"\x3e\r\n  \x3cdiv class\x3d"ovwContainer" dojoattachpoint\x3d"_body" style\x3d"width: ${width}px; height: ${height}px;"\x3e\r\n    \x3cdiv id\x3d"${id}-map" style\x3d"width: 100%; height: 100%;"\x3e\r\n      \x3cdiv class\x3d"ovwHighlight" dojoattachpoint\x3d"_focusDiv" title\x3d"${NLS_drag}" style\x3d"border: 1px solid ${color}; background-color: ${color};"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"ovwButton ovwController" title\x3d"${NLS_show}" dojoattachpoint\x3d"_controllerDiv" dojoattachevent\x3d"onclick: _visibilityHandler"\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"ovwButton ovwMaximizer" title\x3d"${NLS_maximize}" dojoattachpoint\x3d"_maximizerDiv" dojoattachevent\x3d"onclick: _maximizeHandler"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/templates/TimeSlider.html":'   \x3cdiv class\x3d"esriTimeSlider"\x3e\r\n   \x3ctable width\x3d"100%" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0"\x3e\r\n   \x3ctr\x3e\r\n   \x3ctd align\x3d"right" valign\x3d"middle"\x3e\x3cbutton dojoType\x3d"dijit.form.Button" showLabel\x3d"false" iconClass\x3d"tsButton tsPlayButton" dojoAttachEvent\x3d"onClick:_onPlay" dojoAttachPoint\x3d"playPauseBtn" type\x3d"button"\x3e${NLS_play}\x3c/button\x3e\x3c/td\x3e\r\n   \x3ctd align\x3d"center" valign\x3d"middle" width\x3d"80%" class\x3d"tsTmp"\x3e\x3c/td\x3e\r\n   \x3ctd align\x3d"left" valign\x3d"middle" width\x3d"30"\x3e\x3cbutton dojoType\x3d"dijit.form.Button" showLabel\x3d"false" iconClass\x3d"tsButton tsPrevButton" dojoAttachEvent\x3d"onClick:_onPrev" dojoAttachPoint\x3d"previousBtn" type\x3d"button"\x3e${NLS_previous}\x3c/button\x3e\x3c/td\x3e\r\n   \x3ctd align\x3d"left" valign\x3d"middle"\x3e\x3cbutton dojoType\x3d"dijit.form.Button" showLabel\x3d"false" iconClass\x3d"tsButton tsNextButton" dojoAttachEvent\x3d"onClick:_onNext" dojoAttachPoint\x3d"nextBtn" type\x3d"button"\x3e${NLS_next}\x3c/button\x3e\x3c/td\x3e\r\n   \x3c/tr\x3e    \r\n   \x3c/table\x3e\r\n   \x3c/div\x3e',
"url:esri/dijit/templates/MultidimensionalSlider_vertical.html":'\x3cdiv class\x3d"esriMdSliderVertical esriMdSliderPassive"\x3e\r\n  \x3ctable class\x3d"esriMdSliderTableVertical" data-dojo-attach-point\x3d"mdSliderTable"\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd colspan\x3d"3" class\x3d"esriMdSliderInfoCellVertical"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"dimensionInfo" class\x3d"esriMdSliderInfo"\x3e\r\n          \x3cbr/\x3e\x3cbr/\x3e\r\n        \x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd colspan\x3d"3" class\x3d"esriMdSliderCellVertical" data-dojo-attach-point\x3d"mdSliderCell"\x3e\x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr  class\x3d"esriMdSliderPlayButtonRow"  data-dojo-attach-point\x3d"playPauseBtnRow"\x3e\r\n      \x3ctd class\x3d"esriMdSliderPrevButtonCell"\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsPrevButton\'" data-dojo-attach-event\x3d"onClick:decrement" data-dojo-attach-point\x3d"prevBtn" type\x3d"button"\r\n                title\x3d"${_i18n.widgets.mdSlider.NLS_previous}"\x3e\r\n        \x3c/button\x3e\x3c/td\x3e\r\n      \x3ctd class\x3d"esriMdSliderPlayButtonCell"\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsPlayButton\'" data-dojo-attach-event\x3d"onClick:_onPlay" data-dojo-attach-point\x3d"playPauseBtn" type\x3d"button"\r\n                title\x3d"${_i18n.widgets.mdSlider.NLS_play}"\x3e\r\n        \x3c/button\x3e\x3c/td\x3e\r\n      \x3ctd class\x3d"esriMdSliderNextButtonCell"\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsNextButton\'" data-dojo-attach-event\x3d"onClick:increment" data-dojo-attach-point\x3d"nextBtn" type\x3d"button"\r\n                title\x3d"${_i18n.widgets.mdSlider.NLS_next}"\x3e\r\n        \x3c/button\x3e\x3c/td\x3e\r\n    \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/MultidimensionalSlider_horizontal.html":'\x3cdiv class\x3d"esriMdSliderHorizontal"\x3e\r\n  \x3ctable class\x3d"esriMdSliderTableHorizontal"\x3e\r\n    \x3ccolgroup\x3e\r\n      \x3ccol class\x3d"esriMdSliderHorizontalCol1"\x3e\r\n      \x3ccol\x3e\r\n    \x3c/colgroup\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd class\x3d"esriMdSliderDimensionInfoCellHorizontal" colspan\x3d"2"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"dimensionInfo"\x3e\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd align\x3d"right" valign\x3d"middle"\x3e\x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsPlayButton\'" data-dojo-attach-event\x3d"onClick:_onPlay" \r\n                                               data-dojo-attach-point\x3d"playPauseBtn" type\x3d"button" title\x3d"${_i18n.widgets.mdSlider.NLS_play}"\x3e\x3c/button\x3e\x3c/td\x3e\r\n      \x3ctd class\x3d"esriMdSliderCellHorizontal" data-dojo-attach-point\x3d"mdSliderCell"\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/templates/BasemapGallery.html":'\x3cdiv class\x3d"esriBasemapGallery"\x3e\r\n  \x3cdiv dojoAttachPoint\x3d"flowContainer"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:esri/dijit/templates/HomeButton.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv class\x3d"${_css.container}"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_homeNode" title\x3d"${_i18n.widgets.homeButton.home.title}" role\x3d"button" class\x3d"${_css.home}" tabindex\x3d"0"\x3e\x3cspan\x3e${_i18n.widgets.homeButton.home.button}\x3c/span\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/LocateButton.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv class\x3d"${_css.container}"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_locateNode" role\x3d"button" class\x3d"${_css.locate}" tabindex\x3d"0"\x3e\x3cspan\x3e${_i18n.widgets.locateButton.locate.button}\x3c/span\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',"url:esri/dijit/templates/Geocoder.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv class\x3d"${_css.GeocoderContainerClass}" role\x3d"presentation"\x3e\r\n    \t\x3cdiv class\x3d"${_css.GeocoderClass}" data-dojo-attach-point\x3d"containerNode" role\x3d"presentation"\x3e\r\n    \t\t\x3cdiv title\x3d"${_i18n.widgets.Geocoder.main.searchButtonTitle}" tabindex\x3d"0" class\x3d"${_css.searchButtonClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"submitNode" role\x3d"button"\x3e\x3c/div\x3e\r\n    \t\t\x3cdiv aria-haspopup\x3d"true" id\x3d"${id}_menu_button" title\x3d"${_i18n.widgets.Geocoder.main.geocoderMenuButtonTitle}" tabindex\x3d"0" class\x3d"${_css.geocoderMenuArrowClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"geocoderMenuArrowNode" role\x3d"button" aria-expanded\x3d"false"\x3e\x3c/div\x3e\r\n    \t\t\x3cinput aria-haspopup\x3d"true" id\x3d"${id}_input" tabindex\x3d"0" placeholder\x3d"" value\x3d"${value}" autocomplete\x3d"off" type\x3d"text" data-dojo-attach-point\x3d"inputNode" role\x3d"textbox"\x3e\r\n    \t\t\x3cdiv tabindex\x3d"0" class\x3d"${_css.clearButtonClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"clearNode" role\x3d"button"\x3e\x3c/div\x3e\r\n    \t\t\x3cdiv class\x3d"${_css.GeocoderClearClass}" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.resultsContainerClass}" data-dojo-attach-point\x3d"resultsNode" aria-labelledby\x3d"${id}_input" role\x3d"menu" aria-hidden\x3d"true"\x3e\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.geocoderMenuClass}" data-dojo-attach-point\x3d"geocoderMenuNode" role\x3d"presentation"\x3e\r\n    \t\t\x3cdiv class\x3d"${_css.geocoderMenuHeaderClass}"\x3e\r\n    \t\t\t${_i18n.widgets.Geocoder.main.geocoderMenuHeader}\r\n    \t\t\t\x3cdiv role\x3d"button" data-dojo-attach-point\x3d"geocoderMenuCloseNode" title\x3d"${_i18n.widgets.Geocoder.main.geocoderMenuCloseTitle}" tabindex\x3d"0" class\x3d"${_css.geocoderMenuCloseClass}"\x3e\x3c/div\x3e\r\n    \t\t\t\x3cdiv class\x3d"${_css.GeocoderClearClass}" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\t\x3c/div\x3e\r\n    \t\t\x3cdiv data-dojo-attach-point\x3d"geocoderMenuInsertNode" aria-labelledby\x3d"${id}_menu_button" role\x3d"menu" aria-hidden\x3d"true"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/Directions.html":'\x3cdiv class\x3d"${options.theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_widgetContainer" class\x3d"${_css.widgetContainerClass}" role\x3d"presentation"\x3e\r\n        \x3cdiv class\x3d"${_css.stopsContainerClass}" role\x3d"presentation"\x3e\r\n            \x3cdiv id\x3d"search-source-container" class\x3d"${_css.searchSourceContainerClass}" data-dojo-attach-point\x3d"_searchSourceContainerNode"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_searchSourceSelectorContainer"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsTableContainerClass}"\x3e\r\n                \x3ctable class\x3d"${_css.stopsClass}" data-dojo-attach-point\x3d"_dndNode"\x3e\x3c/table\x3e\r\n                \x3cdiv class\x3d"${_css.stopsTableCoverClass}" data-dojo-attach-point\x3d"_stopsTableCover"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsButtonContainerClass}"\x3e\r\n                \x3cdiv class\x3d"${_css.stopsAddDestinationClass}"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" data-dojo-attach-point\x3d"_activateButtonNode" title\x3d"${_i18n.widgets.directions.activate}" class\x3d"${_css.activateButtonClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass} ${_css.stopsPressedButtonClass}" data-blur-on-click\x3d"true"\x3e\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" data-dojo-attach-point\x3d"_lineBarrierButtonNode" title\x3d"${_i18n.widgets.directions.lineBarrier}" class\x3d"${_css.lineBarrierButtonClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true"\x3e\x3c/div\x3e\r\n                    \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"${_css.linkButtonClass} ${_css.stopsAddDestinationBtnClass}" data-dojo-attach-point\x3d"_addDestinationNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.addDestination}\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.travelModesContainerClass}" data-dojo-attach-point\x3d"_travelModeContainerNode"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"_travelModeSelectorContainer"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} startTimeMenuButton" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_startTimeButtonNodeContainer"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"_startTimeButtonNode"\x3e\r\n                        \x3cspan data-dojo-attach-point\x3d"_startTimeButtonLabel"\x3e${_i18n.widgets.directions.leaveNow}\x3c/span\x3e\r\n                        \x3cdiv data-dojo-attach-point\x3d"_startTimeDDLArrow" class\x3d"esriDirectionsDDLArrow"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"startTimeMenu" data-dojo-attach-point\x3d"_startTimeMenu"\x3e\r\n                        \x3cul role\x3d"menu"\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuLeaveNow" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio" aria-checked\x3d"true"\x3e${_i18n.widgets.directions.leaveNow}\x3c/li\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuDepartAt" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio"\x3e${_i18n.widgets.directions.departAt}\x3c/li\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuNone" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio"\x3e${_i18n.widgets.directions.noStartTime}\x3c/li\x3e\r\n                        \x3c/ul\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsOptionsButtonClass}" data-dojo-attach-point\x3d"_optionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.showOptions}\x3c/div\x3e\r\n            \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                \x3cdiv class\x3d"departAtContainer" data-dojo-attach-point\x3d"_departAtContainer"\x3e\r\n                    \x3cdiv id\x3d"${id}_directionsDepartAtTime" data-dojo-attach-point\x3d"_departAtTimeContainer"\x3e\x3c/div\x3e\r\n                    \x3cdiv id\x3d"${id}_directionsDepartAtDate" data-dojo-attach-point\x3d"_departAtDateContainer"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv role\x3d"presentation" class\x3d"${_css.stopsOptionsMenuClass}" data-dojo-attach-point\x3d"_optionsMenuNode"\x3e\r\n                \x3cdiv class\x3d"${_css.stopsOptionsCheckboxesClass}"\x3e\r\n                    \x3cul\x3e\r\n                        \x3cli class\x3d"${_css.stopsFindOptimalOrderClass}" data-dojo-attach-point\x3d"_findOptimalOrderItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_findOptimalOrderNode" type\x3d"checkbox" id\x3d"${id}_find_optimal_order" /\x3e\x3clabel for\x3d"${id}_find_optimal_order"\x3e${_i18n.widgets.directions.findOptimalOrder}\x3c/label\x3e\x3c/li\x3e\r\n                        \x3cli class\x3d"${_css.stopsReturnToStartClass}" data-dojo-attach-point\x3d"_returnToStartItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_returnToStartNode" type\x3d"checkbox" id\x3d"${id}_stopsReturnToStart" /\x3e\x3clabel for\x3d"${id}_stopsReturnToStart"\x3e${_i18n.widgets.directions.returnToStart}\x3c/label\x3e\x3c/li\x3e\r\n                        \x3cli class\x3d"${_css.stopsUseTrafficClass}" data-dojo-attach-point\x3d"_useTrafficItemNode" title\x3d"${_i18n.widgets.directions.trafficLabelLive}"\x3e\r\n                            \x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_useTrafficNode" type\x3d"checkbox" id\x3d"${id}_stopsUseTraffic" /\x3e\x3clabel for\x3d"${id}_stopsUseTraffic"\x3e${_i18n.widgets.directions.useTraffic}\x3c/label\x3e\r\n                            \x3ca data-dojo-attach-point\x3d"_trafficAvailabilityButton" style\x3d"display: none;" href\x3d"http://www.arcgis.com/home/item.html?id\x3db7a893e8e1e04311bd925ea25cb8d7c7" target\x3d"_blank"\x3e\x3cdiv class\x3d"esriTrafficAvailabilityButton" title\x3d"${_i18n.widgets.directions.seeTrafficAvailability}"\x3e\x3c/div\x3e\x3c/a\x3e\r\n                        \x3c/li\x3e\r\n                    \x3c/ul\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.stopsOptionsToggleContainerClass}"\x3e\r\n                    \x3cdiv class\x3d"${_css.stopsOptionsUnitsContainerClass}"  data-dojo-attach-point\x3d"_agolDistanceUnitsNode"\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsMiClass} ${_css.stopsButtonClass}" data-dojo-attach-point\x3d"_useMilesNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.units.esriMiles.abbr}\x3c/div\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsKmClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabLastClass} ${_css.stopsPressedButtonClass}" data-dojo-attach-point\x3d"_useKilometersNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.units.esriKilometers.abbr}\x3c/div\x3e\r\n                        \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsGetDirectionsContainerClass}"\x3e\r\n                \x3cdiv class\x3d"getDirectionsBtnContainer"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsButtonClass} ${_css.stopsGetDirectionsClass} esriDisabledDirectionsButton" data-dojo-attach-point\x3d"_getDirectionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.getDirections}\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsClearDirectionsClass}" data-dojo-attach-point\x3d"_clearDirectionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.clearDirections}\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"savePrintBtnContainer" data-dojo-attach-point\x3d"_savePrintBtnContainer"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.resultsSaveClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_saveMenuButton" title\x3d"${_i18n.widgets.directions.saveTitle}" \x3e\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.resultsPrintClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_printButton" title\x3d"${_i18n.widgets.directions.print}" \x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv role\x3d"presentation" class\x3d"${_css.stopsOptionsMenuClass} esriSaveContainer" data-dojo-attach-point\x3d"_saveMenuNode"\x3e\r\n                \x3cdiv class\x3d"esriLayerNameLabel"\x3e${_i18n.widgets.directions.layerName}\x3c/div\x3e\r\n                \x3cinput type\x3d"text" data-dojo-attach-point\x3d"_outputLayerContainer"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_folderSelectorContainer"\x3e\x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsButtonClass} esriSaveButton esriDisabledDirectionsButton" data-dojo-attach-point\x3d"_saveButton" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.save}\x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"esriLinkButton esriSaveAsButton" data-dojo-attach-point\x3d"_saveAsButton" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.saveAs}\x3c/div\x3e\r\n            \x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n    \t\x3cdiv data-dojo-attach-point\x3d"_msgNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.resultsContainerClass}" role\x3d"presentation"\x3e\r\n        \t\x3cdiv class\x3d"${_css.routesContainerClass}" data-dojo-attach-point\x3d"_resultsNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:arcgisonline/sharing/dijit/templates/OrganizationSetup.html":'\x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-attach-point\x3d"containerNode"\x3e\r\n  \x3cdiv  class\x3d"esriFloatLeading" style\x3d"width:780px; clear:both; padding-left:10px;"\x3e${i18n.thankYou}\x3c/div\x3e\r\n\r\n  \x3cdiv style\x3d"width:780px; clear:both; margin-top:2em; padding-left:10px;" class\x3d"esriFloatLeading"\x3e\r\n\r\n    \x3ctable\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.orgName}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"titleColumn"\x3e\r\n            \x3cimg data-dojo-attach-point\x3d"_orgNameImg" src\x3d"" alt\x3d"${i18n.orgName}"\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"valignTop"\x3e\r\n            ${i18n.orgNameDesc}\r\n            \x3cbr\x3e\x3cbr\x3e\r\n            \x3clabel\x3e\r\n              \x3cinput class\x3d"orgTextBox" data-dojo-attach-point\x3d"_nameTextBox" data-dojo-type\x3d"dijit/form/TextBox" type\x3d"text" data-dojo-props\x3d"trim:true"\x3e\r\n            \x3c/label\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr\x3e\r\n            \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.orgAbbr}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"titleColumn"\x3e\r\n            \x3cimg data-dojo-attach-point\x3d"_orgAbbrImg" src\x3d"" alt\x3d"${i18n.orgAbbr}"\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"valignTop"\x3e\r\n            ${!i18n.orgAbbrDesc}\r\n            \x3cbr\x3e\x3cbr\x3e\r\n            \x3cinput class\x3d"orgTextBox" id\x3d"urlKeyTextBox" data-dojo-attach-point\x3d"_urlKeyTextBox" data-dojo-type\x3d"dijit/form/TextBox" type\x3d"text" data-dojo-props\x3d"trim:true"\x3e\r\n            \x3clabel for\x3d"urlKeyTextBox" data-dojo-attach-point\x3d"_urlKeyStatusLabel" style\x3d"vertical-align:middle; width:125px;"\x3e\x3c/label\x3e\r\n            \x3cbr\x3e\x3cbr\x3e\r\n            ${i18n.sampleOrgUrl}\r\n            \x3cbr\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_sampleUrlTextBox"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.languageSetting}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"titleColumn"\x3e\r\n            \x3cimg data-dojo-attach-point\x3d"_languageImg" src\x3d"" alt\x3d"${i18n.languageSetting}"\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"valignTop"\x3e\r\n            ${i18n.languageDesc} ${i18n.browserDefaultAGOL}\r\n            \x3cbr\x3e\x3cbr\x3e\r\n            \x3clabel\x3e${i18n.languageLabel} \x3cselect class\x3d"orgComboBox" data-dojo-attach-point\x3d"_languageSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d"type:\'select\'"\x3e\x3c/select\x3e\x3c/label\x3e\r\n\r\n            \x3cdiv class\x3d"hide" data-dojo-attach-point\x3d"_languageFormatContainer"\x3e\r\n              \x3cbr\x3e\r\n              \x3clabel\x3e\r\n                \x3cstrong\x3e${i18n.numDateFormat}\x3c/strong\x3e \x3cspan id\x3d"languageFormatTooltip"\x3e\x3ca data-dojo-attach-point\x3d"_languageFormatHelpLink" href\x3d"" target\x3d"_blank"\x3e\x3cimg class\x3d"help-icon" data-dojo-attach-point\x3d"_languageFormatImg" src\x3d"" alt\x3d"${i18n.learnNumDateFormat}"\x3e\x3c/a\x3e\x3c/span\x3e\r\n                \x3cbr\x3e\r\n                \x3cselect class\x3d"orgComboBox leader-half" data-dojo-attach-point\x3d"_languageFormatSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d"type:\'select\',required:false"\x3e\x3c/select\x3e\r\n              \x3c/label\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.regionSetting}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"titleColumn"\x3e\r\n            \x3cimg data-dojo-attach-point\x3d"_regionImg" src\x3d"" alt\x3d"${i18n.regionSetting}"\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"valignTop"\x3e\r\n            ${!i18n.regionDesc}\r\n            \x3cbr\x3e\x3cbr\x3e\r\n            \x3clabel for\x3d"regionSelect"\x3e${i18n.regionLabel}\x3c/label\x3e \x3cselect id\x3d"regionSelect" name\x3d"regionSelect" class\x3d"orgComboBox" data-dojo-attach-point\x3d"_regionSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d"type:\'select\'"\x3e\x3c/select\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr class\x3d"hide"\x3e\r\n          \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.security}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr class\x3d"hide"\x3e\r\n          \x3ctd class\x3d"titleColumn"\x3e\r\n            \x3cimg data-dojo-attach-point\x3d"_securityImg" src\x3d"" alt\x3d"${i18n.security}"\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"valignTop"\x3e\r\n            \x3cinput id\x3d"sslCheckBox" name\x3d"sslCheckBox" data-dojo-attach-point\x3d"_sslCheckBox" data-dojo-type\x3d"dijit/form/CheckBox" type\x3d"checkBox"\x3e\r\n            \x3clabel for\x3d"sslCheckBox" data-dojo-attach-point\x3d"_sslCheckBoxLabel"\x3e\x3c/label\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr\x3e\r\n            \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.link}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n            \x3ctd class\x3d"titleColumn"\x3e\r\n                \x3cimg data-dojo-attach-point\x3d"_linkImg" src\x3d"" alt\x3d"${i18n.link}"\x3e\r\n            \x3c/td\x3e\r\n            \x3ctd class\x3d"valignTop"\x3e\r\n              \x3clabel\x3e${i18n.linkDesc}\x3c/label\x3e\x3cbr\x3e\x3cbr\x3e\r\n              \x3ctable\x3e\r\n                \x3ctbody\x3e\r\n                  \x3ctr\x3e\r\n                    \x3ctd class\x3d"valignTop" style\x3d"width:15em;"\x3e\r\n                      \x3cinput data-dojo-attach-point\x3d"_linkCheckBox" id\x3d"linkCheckBox" data-dojo-type\x3d"dijit/form/CheckBox" type\x3d"checkbox"\x3e\r\n                      \x3clabel data-dojo-attach-point\x3d"_linkTooltip" id\x3d"linkTooltip" for\x3d"linkCheckBox"\x3e\x3c/label\x3e\r\n                    \x3c/td\x3e\r\n                    \x3ctd class\x3d"valignTop"\x3e\r\n                      \x3clabel\x3e\r\n                        \x3cinput class\x3d"orgTextBox" data-dojo-attach-point\x3d"_link" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true" type\x3d"text" style\x3d"width:25em;"\x3e\x3c/div\x3e\r\n                      \x3c/label\x3e\r\n                    \x3c/td\x3e\r\n                  \x3c/tr\x3e\r\n                \x3c/tbody\x3e\r\n              \x3c/table\x3e\r\n            \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr\x3e\r\n            \x3ctd colspan\x3d"2" class\x3d"valignTop"\x3e\x3cstrong\x3e${i18n.usageTrackingSetting}\x3c/strong\x3e\x3cbr\x3e\x3cbr\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n            \x3ctd class\x3d"titleColumn"\x3e\r\n                \x3cimg data-dojo-attach-point\x3d"_usageTrackingImg" src\x3d"" alt\x3d"${i18n.usageTrackingSetting}"\x3e\r\n            \x3c/td\x3e\r\n            \x3ctd class\x3d"valignTop"\x3e\r\n              \x3clabel\x3e${i18n.usageTrackingDesc}\x3c/label\x3e\x3cbr\x3e\x3cbr\x3e\r\n              \x3ctable\x3e\r\n                \x3ctbody\x3e\r\n                  \x3ctr\x3e\r\n                    \x3ctd class\x3d"valignTop white-space-no-wrap" style\x3d"width:15em;"\x3e\r\n                      \x3clabel\x3e\r\n                        \x3cinput data-dojo-attach-point\x3d"_usageTrackingCheckBox" data-dojo-type\x3d"dijit/form/CheckBox" type\x3d"checkbox"\x3e\r\n                        ${i18n.allowArcgisOnlineToCollectInfo}\r\n                      \x3c/label\x3e\r\n                    \x3c/td\x3e\r\n                  \x3c/tr\x3e\r\n                \x3c/tbody\x3e\r\n              \x3c/table\x3e\r\n            \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cdiv class\x3d"spacerRow"\x3e\x26nbsp;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3cdiv class\x3d"esriFloatLeading"\x3e\r\n              \x3cbutton data-dojo-attach-point\x3d"_saveBtn" data-dojo-type\x3d"dijit/form/Button" type\x3d"button" class\x3d"calcite blue" data-dojo-props\x3d"iconClass:\'esriSaveIcon\'"\x3e${i18n.saveContinue}\x3c/button\x3e\r\n              \x3cbutton data-dojo-attach-point\x3d"_signOutBtn" data-dojo-type\x3d"dijit/form/Button" type\x3d"button" class\x3d"calcite transparent" data-dojo-props\x3d"iconClass:\'esriOpenIcon\'"\x3e${i18n.signOut}\x3c/button\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n\r\n\x3c/div\x3e\r\n',
"url:arcgisonline/sharing/dijit/templates/SaveItem.html":'\x3cdiv class\x3d"${baseClass}" data-dojo-attach-point\x3d"containerNode"\x3e\r\n\r\n  \x3clabel class\x3d"calcite-web-label trailer-half calcite-web-label-textbox"\x3e\r\n    ${i18n.titleLabel}\r\n    \x3cdiv data-dojo-attach-point\x3d"saveItemTitle"\r\n         data-dojo-type\x3d"dijit/form/TextBox"\r\n         placeHolder\x3d"${i18n.defaultTextTitle}" trim\x3d"true"\x3e\x3c/div\x3e\r\n\r\n  \x3c/label\x3e\r\n  \x3clabel class\x3d"calcite-web-label trailer-half clearfix"\x3e\r\n    ${i18n.tagsLabel}\r\n    \x3cdiv data-dojo-attach-point\x3d"saveItemTagsContainer"\x3e\x3c/div\x3e\r\n  \x3c/label\x3e\r\n  \x3cdiv class\x3d"categories-container"\x3e\r\n    \x3clabel class\x3d"calcite-web-label trailer-0 clearfix categories-container"\r\n      data-dojo-attach-point\x3d"saveItemCategoriesContainer"\r\n      for\x3d"saveItemCategoryPicker"\x3e\r\n      ${i18n.categoriesLabel}\r\n    \x3c/label\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"saveItemCategories" id\x3d"saveItemCategoryPicker"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3clabel class\x3d"calcite-web-label trailer-half calcite-web-label-textbox"\x3e\r\n    ${i18n.summaryLabel}\r\n    \x3cdiv data-dojo-attach-point\x3d"saveItemSummary"\r\n         data-dojo-type\x3d"dijit/form/TextBox"\r\n         placeHolder\x3d"${i18n.defaultTextSummary}" maxlength\x3d"250" trim\x3d"true"\x3e\x3c/div\x3e\r\n\r\n  \x3c/label\x3e\r\n  \x3clabel class\x3d"calcite-web-label trailer-half calcite-web-label-select" for\x3d"itemFolderComboBox"\x3e\r\n    ${i18n.saveInFolderLabel}\r\n    \x3cdiv data-dojo-attach-point\x3d"saveItemFolder"\r\n         data-dojo-type\x3d"arcgisonline/sharing/dijit/ComboBox"\r\n         id\x3d"itemFolderComboBox"\x3e\x3c/div\x3e\r\n  \x3c/label\x3e\r\n\r\n\x3c/div\x3e',
"url:arcgisonline/sharing/dijit/dialog/templates/ExportDlg.html":'\x3cdiv class\x3d"widgetContent"\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/Dialog" data-dojo-attach-point\x3d"exportDialog" id\x3d"export-dialog" title\x3d"${i18n.exportDialogTitle}" execute\x3d""\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"saveItemForm"\x3e\x3c/div\x3e\r\n    \x3cfieldset data-dojo-attach-point\x3d"featureCollectionDiv" class\x3d"featureCollectionOnly hide"\x3e\r\n      \x3clabel\x3e\x3cinput type\x3d"radio" data-dojo-attach-point\x3d"generalizeChk" name\x3d"generalize"\x3e${i18n.generalize}\x3c/label\x3e\r\n      \x3clabel\x3e\x3cinput type\x3d"radio" name\x3d"generalize" checked\x3e${i18n.keepOrig}\x3c/label\x3e\r\n    \x3c/fieldset\x3e\r\n\r\n    \x3cdiv class\x3d"esriFloatTrailing right"\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"exportingLabel" style\x3d"visibility:hidden;"\x3e${i18n.exportingLabel}\x3c/span\x3e\r\n      \x3cbutton class\x3d"btn btn-clear" type\x3d"button" data-dojo-attach-point\x3d"cancelBtn"\x3e${i18n.cancel}\x3c/button\x3e\r\n      \x3cbutton class\x3d"btn" type\x3d"button" data-dojo-attach-point\x3d"exportBtn"\x3e${i18n.exportLabel}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:arcgisonline/sharing/dijit/dialog/templates/InvitationsDlg.html":'\x3cdiv\x3e\r\n  \t\x3cdiv data-dojo-type\x3d"dijit/Dialog" class\x3d"${baseClass} invitations-dialog" data-dojo-attach-point\x3d"_dialog" title\x3d"${i18n.invitationsDlgTitle}"\x3e\r\n      \x3cdiv class\x3d"trailer-half"\x3e${i18n.invitationMsg}\x3c/div\x3e\r\n      \x3cdiv class\x3d"${baseClass} invitations-container padding-leader-quarter"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_invitationsGridContainer"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"clearfix"\x3e\r\n        \x3cdiv class\x3d"esriFloatTrailing right" style\x3d"padding-top:1rem; padding-bottom:5px;"\x3e\r\n          \x3cbutton data-dojo-attach-point\x3d"_closeBtn" class\x3d"jevent primary" data-dojo-type\x3d"dijit/form/Button" tabIndex\x3d"1"\x3e${i18n.close}\x3c/button\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n  \t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:arcgisonline/sharing/dijit/dialog/templates/InvitationsDlgGroup.html":'\x3cdiv class\x3d"avenir-regular"\x3e\r\n  \x3cdiv class\x3d"panel panel-white panel-no-padding padding-leader-half padding-trailer-quarter padding-left-1 padding-right-1 border-bottom-clear"\x3e\r\n    \x3cdiv class\x3d"left"\x3e\r\n      \x3cdiv class\x3d"inline-block  ${isPrivate:show}"\x3e\r\n        \x3ca href\x3d"group.html?id\x3d${id}" class\x3d"card-image-small display-block margin-right-1 margin-left-0 group-card-thumbnail" title\x3d"${i18n.GroupsWidget.viewGroupDetails}"\x3e\r\n          \x3cimg src\x3d"${thumbnailUrl}" alt\x3d"${title}" class\x3d"${thumbnail:hide}"\x3e\r\n          \x3csvg xmlns\x3d"http://www.w3.org/2000/svg" width\x3d"65" height\x3d"65" viewBox\x3d"0 0 65 65" class\x3d"${thumbnail:show}"\x3e\r\n            \x3cpath fill\x3d"${fillColor}" d\x3d"M0 0h65v65H0z"/\x3e\r\n            \x3cpath fill\x3d"#ccc" d\x3d"M0 0h65v65H0z" fill-opacity\x3d"0.8"/\x3e\r\n            \x3cpath class\x3d"${useLetter:show}" fill\x3d"#FFF" d\x3d"M24.25 15.625a6.875 6.875 0 1 0-.008 13.75 6.875 6.875 0 0 0 .008-13.75zm0 11c-2.272 0-4.125-1.851-4.125-4.125s1.848-4.125 4.125-4.125c2.279 0 4.125 1.846 4.125 4.125s-1.846 4.125-4.125 4.125zm3.118 16.5H14.774c.596-4.641 4.647-8.25 9.473-8.25 2.855 0 5.426 1.283 7.188 3.316a15.168 15.168 0 0 1 2.311-1.518 12.22 12.22 0 0 0-9.496-4.549c-6.369 0-11.551 4.82-12.238 11l-.137 2.75h14.424a15.49 15.49 0 0 1 1.066-2.75h.003zm25.62 5.5c-.693-6.18-5.873-11-12.238-11s-11.545 4.82-12.238 11l-.137 2.75h24.75l-.137-2.75zm-21.711 0c.596-4.641 4.647-8.25 9.473-8.25a9.578 9.578 0 0 1 9.464 8.25H31.277zm9.473-27.5a6.875 6.875 0 1 0-.008 13.75c3.797.003 6.877-3.072 6.88-6.87s-3.072-6.877-6.869-6.88h-.003zm0 11c-2.271 0-4.125-1.851-4.125-4.125s1.848-4.125 4.125-4.125a4.125 4.125 0 0 1 0 8.25z"/\x3e\r\n            \x3ctext class\x3d"${useLetter:hide} font-size-4" x\x3d"50%" y\x3d"50%" fill\x3d"white" dominant-baseline\x3d"central" text-anchor\x3d"middle"\x3e\r\n              \x3ctspan class\x3d"group-thumbnail-default-text" dominant-baseline\x3d"central" text-anchor\x3d"middle"\x3e${title:firstChar}\x3c/tspan\x3e\r\n              \x3ctspan class\x3d"group-thumbnail-ie-text" y\x3d"70%" x\x3d"55%" dominant-baseline\x3d"central" text-anchor\x3d"middle"\x3e${title:firstChar}\x3c/tspan\x3e\r\n            \x3c/text\x3e\r\n          \x3c/svg\x3e\r\n        \x3c/a\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"inline-block  ${isPrivate:hide}"\x3e\r\n        \x3cdiv class\x3d"card-image-small display-block margin-right-1 margin-left-0 group-card-thumbnail"\x3e\r\n          \x3csvg xmlns\x3d"http://www.w3.org/2000/svg" width\x3d"65" height\x3d"65" viewBox\x3d"0 0 65 65" class\x3d"${thumbnail:show}"\x3e\r\n            \x3cpath fill\x3d"#AAA" d\x3d"M0 0h65v65H0z"/\x3e\r\n            \x3cpath fill\x3d"#ccc" d\x3d"M0 0h65v65H0z" fill-opacity\x3d"0.8"/\x3e\r\n            \x3cpath fill\x3d"#FFF" d\x3d"M42.5 30.5h-20c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2v-14c0-1.1-.9-2-2-2zm0 16h-20v-14h20v14zm-14-20c0-2.205 1.794-4 4-4s4 1.795 4 4v4h2v-4c0-3.309-2.691-6-6-6s-6 2.691-6 6v4h2v-4zm-4 0c0-4.4 3.6-8 8-8s8 3.6 8 8v4h2v-4c0-5.514-4.486-10-10-10s-10 4.486-10 10v4h2v-4zm10 12v-2h-2v-2h-2v10h2v-2h2v-2h-2v-2h2z"/\x3e\r\n          \x3c/svg\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"group-card-content border-box right"\x3e\r\n      \x3ch4 class\x3d"trailer-0 leader-quarter font-size-1 full-width text-ellipsis margin-right-1 text-left"\x3e\r\n        \x3ca href\x3d"group.html?id\x3d${id}" title\x3d"${title}" class\x3d"text-ellipsis ${isPrivate:show}"\x3e${title:stripHTML}\x3c/a\x3e\r\n        \x3cspan class\x3d"text-ellipsis ${isPrivate:hide}" title\x3d"${title}"\x3e${title:stripHTML}\x3c/span\x3e\r\n      \x3c/h4\x3e\r\n      \x3cp class\x3d"trailer-0 text-left"\x3e${notificationSummary}\x3c/p\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"panel panel-no-padding padding-leader-quarter padding-trailer-quarter padding-left-quarter padding-right-quarter clearfix"\x3e\r\n    \x3cdiv class\x3d"right"\x3e\r\n      \x3cbutton class\x3d"js-accept-invitation btn btn-link btn-link-off-black margin-right-1 margin-left-0 inline-block"\x3e\x3cspan class\x3d"text-green"\x3e${icons.inline.check.16}\x3c/span\x3e${i18n.invitationsGrid.joinThisGroup}\x3c/button\x3e\r\n      \x3cbutton class\x3d"js-decline-invitation btn btn-link btn-link-off-black margin-right-1 margin-left-0 inline-block"\x3e\x3cspan class\x3d"text-red"\x3e${icons.inline.minus-circle.16}\x3c/span\x3e${i18n.invitationsGrid.decline}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:arcgisonline/sharing/dijit/dialog/templates/JoinGroupDlg.html":'\x3cdiv class\x3d"widgetContent"\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/Dialog" data-dojo-attach-point\x3d"_dialog" id\x3d"join_group-dialog" class\x3d"join-group-dialog" title\x3d"${i18n.joinGroupTitle}"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_joinGroupContent"\x3e\r\n      ${i18n.yourRequestForReview}\r\n      \x3cbr\x3e\r\n      ${i18n.youCanCheckStatus}\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"hide leader-half" data-dojo-attach-point\x3d"_administrativeGroup"\x3e\r\n      ${i18n.leavingDisabled}\r\n    \x3c/div\x3e\r\n    \x3cbr\x3e\r\n      \x3cdiv class\x3d"esriFloatTrailing right leader-1"\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_okBtn" class\x3d"btn btn-blue"\x3e${i18n.submitRequest}\x3c/button\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_cancelBtn" class\x3d"btn btn-clear"\x3e${i18n.cancel}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:arcgisonline/sharing/dijit/dialog/templates/ManageTilesDlg.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"${baseClass} manage-tiles-dialog js-tab-group" data-dojo-type\x3d"dijit/Dialog"\r\n       data-dojo-attach-point\x3d"dialog" title\x3d"${i18n.dialogTitle}"\x3e\r\n    \x3cnav class\x3d"tab-nav" data-dojo-attach-point\x3d"_tabNav"\x3e\r\n      \x3ca class\x3d"tab-title js-tab is-active" data-dojo-attach-point\x3d"_levelsTab"\x3e${i18n.levelsTab}\x3c/a\x3e\r\n      \x3ca class\x3d"tab-title js-tab" data-dojo-attach-point\x3d"_extentTab"\x3e${i18n.extentTab}\x3c/a\x3e\r\n    \x3c/nav\x3e\r\n\r\n    \x3csection class\x3d"tab-contents"\x3e\r\n      \x3carticle class\x3d"tab-section js-tab-section is-active" data-dojo-attach-point\x3d"_levelsSection"\x3e\r\n        \x3cspan data-dojo-attach-point\x3d"_dialogDescription"\x3e\x3c/span\x3e\r\n        \x3cbr\x3e\r\n        \x3cdiv class\x3d"selected-scales-container"\x3e\x3cspan data-dojo-attach-point\x3d"_scalesSelectedSpan"\x3e\x3c/span\x3e\x3cbr\x3e\x3c/div\x3e\r\n\r\n        \x3cdiv class\x3d"scaleContainer" data-dojo-attach-point\x3d"_gridContainer"\x3e\x3c/div\x3e\r\n      \x3c/article\x3e\r\n      \x3carticle class\x3d"tab-section js-tab-section" data-dojo-attach-point\x3d"_extentSection"\x3e\r\n        \x3c!-- Add Extent UI here --\x3e\r\n        \x3cdiv class\x3d"extentContainer hide" data-dojo-attach-point\x3d"_extentContainer"\x3e\x3c/div\x3e\r\n      \x3c/article\x3e\r\n    \x3c/section\x3e\r\n\r\n    \x3cdiv class\x3d"controlDiv clearfix" data-dojo-attach-point\x3d"_controlDiv"\x3e\r\n      \x3cdiv class\x3d"left messageContainer"\x3e\r\n        \x3cdiv class\x3d"message" data-dojo-attach-point\x3d"_messageDiv"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"right buildContainer"\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_buildButton" class\x3d"calcite secondary btn btn-blue"\x3e${i18n.buildButton}\x3c/button\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_cancelButton" class\x3d"calcite secondary btn btn-blue hide"\x3e${i18n.cancelButton}\x3c/button\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_closeButton" class\x3d"calcite transparent btn btn-clear"\x3e${i18n.close}\x3c/button\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:arcgisonline/sharing/dijit/dialog/templates/MembershipRequestsDlg.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/Dialog" class\x3d"${baseClass} membership-requests-dialog" data-dojo-attach-point\x3d"_dialog" title\x3d"${i18n.membershipRequests}"\x3e\r\n    \x3cdiv class\x3d"membership-requests-label"\x3e${i18n.requestedMemberShip}\x3c/div\x3e\r\n    \x3cdiv class\x3d"${baseClass} requests-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_requestsGridContainer"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cbr style\x3d"clear:both;"\x3e\r\n    \x3cdiv class\x3d"esriFloatTrailing right" style\x3d"padding-top:1rem;padding-bottom:5px;"\x3e\r\n      \x3cbutton data-dojo-attach-point\x3d"_closeBtn" class\x3d"jevent primary" data-dojo-type\x3d"dijit/form/Button"\x3e${i18n.close}\x3c/button\x3e\r\n    \x3c/div\x3e\r\n    \x3cbr/\x3e\x26nbsp;\x3cbr/\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:arcgisonline/sharing/dijit/dialog/templates/SetIdentityProviderDlg.html":'\x3cdiv class\x3d"widgetContent" \x3e\r\n  \x3cdiv class\x3d"${baseClass}" data-dojo-type\x3d"dijit/Dialog" data-dojo-attach-point\x3d"_dialog" id\x3d"set-identity-provider-dialog" title\x3d"${i18n.setIdentityProviderTitle}" execute\x3d""\x3e\r\n    \x3cform data-dojo-attach-point\x3d"_form" enctype\x3d"multipart/form-data" method\x3d"post" onsubmit\x3d"return false;"\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_signUpMode" name\x3d"signUpMode" type\x3d"hidden" value\x3d""\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_bindingType" name\x3d"bindingType" type\x3d"hidden" value\x3d""\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_supportEncryption" name\x3d"encryptionSupported" type\x3d"hidden" value\x3d""\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_supportSignedRequest" name\x3d"supportSignedRequest" type\x3d"hidden" value\x3d""\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_useSHA256" name\x3d"useSHA256" type\x3d"hidden" value\x3d""\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_supportsLogoutRequest" name\x3d"supportsLogoutRequest" type\x3d"hidden" value\x3d""\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_updateProfileAtSignIn" name\x3d"updateProfileAtSignin" type\x3d"hidden" value\x3d""\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_updateGroupsAtSignIn" name\x3d"updateGroupsAtSignin" type\x3d"hidden" value\x3d""\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"_clearEmptyFields" name\x3d"clearEmptyFields" type\x3d"hidden" value\x3d"false"\x3e\r\n\r\n      \x3cdiv data-dojo-attach-point\x3d"_description"\x3e\x3c/div\x3e\r\n      \x3cbr\x3e\r\n      \x3cspan\x3e${i18n.nameLabel}\x3c/span\x3e\x3cbr\x3e\r\n      \x3cdiv name\x3d"name" data-dojo-attach-point\x3d"_nameInput" type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n      \x3cbr\x3e\x3cbr\x3e\r\n\r\n      \x3cspan\x3e${i18n.signUpLabel}\x3c/span\x3e\x3cbr\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_signUpModeOptions"\x3e\r\n        \x3cdiv id\x3d"automatic-option" name\x3d"signUpModeOption" type\x3d"radio"\r\n             data-dojo-attach-point\x3d"_automaticOption" data-dojo-type\x3d"dijit/form/RadioButton"\r\n             data-dojo-attach-event\x3d"onClick:onAutomaticClicked"\x3e\x3c/div\x3e \x3clabel data-dojo-attach-point\x3d"_automaticOptionLabel" for\x3d"automatic-option"\x3e${i18n.automaticOption}\x3c/label\x3e\r\n        \x3cdiv id\x3d"invite-option" name\x3d"signUpModeOption" type\x3d"radio"\r\n             data-dojo-attach-point\x3d"_inviteOption" data-dojo-type\x3d"dijit/form/RadioButton"\r\n             data-dojo-attach-event\x3d"onClick:onInvitationClicked" data-dojo-props\x3d"checked:true"\x3e\x3c/div\x3e \x3clabel data-dojo-attach-point\x3d"_inviteOptionLabel" for\x3d"invite-option"\x3e${i18n.onInviteOption}\x3c/label\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"leader-half" data-dojo-attach-point\x3d"_automaticDefaults"\x3e\r\n        ${i18n.membersGetValues}\r\n        \x3cdiv class\x3d"margin-left-1"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_levelOptions"\x3e${i18n.defaultLevel} \x3cspan data-dojo-attach-point\x3d"_userTypeDefault"\x3e\x3c/span\x3e\x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_roleOptions"\x3e${i18n.roleAssigned} \x3cspan data-dojo-attach-point\x3d"_roleDefault"\x3e\x3c/span\x3e\x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_creditOptions"\x3e${i18n.defaultCredits} \x3cspan data-dojo-attach-point\x3d"_creditsDefault"\x3e\x3c/span\x3e\x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_esriAccessOptions"\x3e${i18n.defaultEsriAccess} \x3cspan data-dojo-attach-point\x3d"_esriAccessDefault"\x3e\x3c/span\x3e\x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_groupOptions"\x3e\r\n            \x3cspan data-dojo-attach-point\x3d"_hasGroupDefaults"\x3e${i18n.groupsSelected}\r\n                \x3cdiv class\x3d"inline-block specified-group-list hide" data-dojo-attach-point\x3d"_groupListContainer"\x3e\x3c/div\x3e\r\n                \x3cspan class\x3d"esriItemLinks hide" data-dojo-attach-point\x3d"_otherLinkContainer"\x3e\x3ca id\x3d"${id}-other-link" data-dojo-attach-point\x3d"_otherLink"\x3e${i18n.otherLink}\x3c/a\x3e\x3c/span\x3e\r\n            \x3c/span\x3e\r\n            \x3cspan data-dojo-attach-point\x3d"_noGroupDefaults"\x3e${i18n.noGroupsSelected}\x3c/span\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"leader-half" data-dojo-attach-point\x3d"_toConfigureDefaults"\x3e${i18n.toConfigureDefaults}\x3c/div\x3e\r\n      \x3cbr\x3e\r\n      \x3c!-- start federation of identity provider fields --\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_federationDiscoveryServiceContainer"\x3e\r\n        \x3cspan\x3e${i18n.federationDiscoveryServiceUrlLabel}\x3c/span\x3e\r\n        \x3cbr\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_federationDiscoveryServiceUrl" name\x3d"discoveryServiceUrl" type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n        \x3cbr\x3e\r\n        \x3cbr\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_metadataAggregateUrlContainer"\x3e\r\n        \x3cspan\x3e${i18n.metadataAggregateUrlLabel}\x3c/span\x3e\r\n        \x3cbr\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_metadataAggregateUrl" name\x3d"metadataServiceUrl" type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n        \x3cbr\x3e\r\n        \x3cbr\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_aggregatedMetadataCertificateContainer"\x3e\r\n        \x3cspan\x3e${i18n.aggregatedMetadataCertificateLabel}\x3c/span\x3e\r\n        \x3cbr\x3e\r\n        \x3ctextarea data-dojo-attach-point\x3d"_aggregatedMetadataCertificate" name\x3d"certificate" data-dojo-type\x3d"dijit/form/SimpleTextarea" data-dojo-props\x3d"rows:3"\r\n          title\x3d"${i18n.aggregatedMetadataCertificatePlaceholder}"\x3e\x3c/textarea\x3e\r\n        \x3cbr\x3e\r\n        \x3cbr\x3e\r\n      \x3c/div\x3e\r\n      \x3c!-- end federation of identity provider fields --\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_metadataSourceContainer"\x3e\r\n        \x3cspan\x3e${i18n.sourceLabel}\x3c/span\x3e\r\n        \x3cbr\x3e\r\n        \x3cspan data-dojo-attach-point\x3d"_sourceOptions"\x3e\r\n          \x3cdiv id\x3d"metadata-url-option" name\x3d"providerOptions" type\x3d"radio" data-dojo-attach-point\x3d"_metadataUrlOption" data-dojo-type\x3d"dijit/form/RadioButton"\r\n            checked\x3d"true"\x3e\x3c/div\x3e\r\n          \x3clabel for\x3d"metadata-url-option"\x3e${i18n.metadataUrlOption}\x3c/label\x3e\r\n          \x3cdiv id\x3d"metadata-file-option" name\x3d"providerOptions" type\x3d"radio" data-dojo-attach-point\x3d"_metadataFileOption" data-dojo-type\x3d"dijit/form/RadioButton"\x3e\x3c/div\x3e\r\n          \x3clabel for\x3d"metadata-file-option"\x3e${i18n.metadataFileOption}\x3c/label\x3e\r\n          \x3cdiv id\x3d"parameters-option" name\x3d"providerOptions" type\x3d"radio" data-dojo-attach-point\x3d"_parametersOption" data-dojo-type\x3d"dijit/form/RadioButton"\x3e\x3c/div\x3e\r\n          \x3clabel for\x3d"parameters-option"\x3e${i18n.parametersOption}\x3c/label\x3e\r\n        \x3c/span\x3e\r\n        \x3cbr\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_sourceInputs"\x3e\r\n          \x3cbr\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_metadataUrlInputs"\x3e\r\n            \x3cspan\x3e${i18n.metadataUrlLabel}\x3c/span\x3e\r\n            \x3cbr\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_bindingUrlInput" name\x3d"idpMetadataUrl" type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_metadataFileInputs"\x3e\r\n            \x3cspan\x3e${i18n.metadataFileLabel}\x3c/span\x3e\r\n            \x3cbr\x3e\r\n            \x3cinput data-dojo-attach-point\x3d"_metadataFileInput" name\x3d"idpMetadataFile" type\x3d"file" title\x3d"${i18n.metadataFilePlaceHolder}"\r\n            /\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_parametersInputs"\x3e\r\n            \x3cspan\x3e${i18n.parametersUrlLabel}\x3c/span\x3e\r\n            \x3cbr\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_loginUrlInput" name\x3d"bindingUrl" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n            \x3cbr\x3e\r\n            \x3cbr\x3e\r\n            \x3cspan\x3e${i18n.parametersPostUrlLabel}\x3c/span\x3e\r\n            \x3cbr\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"_loginUrlPostInput" name\x3d"postBindingUrl" type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n            \x3cbr\x3e\r\n            \x3cbr\x3e\r\n            \x3c!--\x3cspan"\x3e${i18n.parametersBindingTypeLabel}\x3c/span\x3e--\x3e\r\n            \x3c!--\x3cdiv id\x3d"binding-type-redirect-option" name\x3d"bindingTypeOptions" data-dojo-attach-point\x3d"_bindingTypeRedirect" type\x3d"radio" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-attach-point\x3d"_bindingTypeRedirectOption" checked\x3d"true"\x3e\x3c/div\x3e \x3clabel\x3e${i18n.parametersBindingTypeRedirect}\x3c/label\x3e--\x3e\r\n            \x3c!--\x3cdiv id\x3d"binding-type-post-option" name\x3d"bindingTypeOptions" data-dojo-attach-point\x3d"_bindingTypePost" type\x3d"radio" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-attach-point\x3d"_bindingTypePostOption"\x3e\x3c/div\x3e \x3clabel\x3e${i18n.parametersBindingTypePost}\x3c/label\x3e--\x3e\r\n            \x3c!--\x3cbr\x3e\x3cbr\x3e--\x3e\r\n            \x3cspan\x3e${i18n.parametersCertificateLabel}\x3c/span\x3e\r\n            \x3cbr\x3e\r\n            \x3ctextarea data-dojo-attach-point\x3d"_certificateInput" name\x3d"certificate" data-dojo-type\x3d"dijit/form/SimpleTextarea" data-dojo-props\x3d"rows:3"\r\n              title\x3d"${i18n.parametersCertificatePlaceHolder}"\x3e\x3c/textarea\x3e\r\n            \x3cdiv style\x3d"display:none;"\x3e\r\n              \x3cbr\x3e\r\n              \x3cspan\x3e${i18n.orLabel}\x3c/span\x3e\r\n              \x3cbr\x3e\r\n              \x3cbr\x3e\r\n              \x3cspan\x3e${i18n.parametersCertificateFileLabel}\x3c/span\x3e\r\n              \x3cbr\x3e\r\n              \x3cinput type\x3d"file" data-dojo-attach-point\x3d"_certificateFileInput" name\x3d"certificateFile" title\x3d"${i18n.parametersCertificateFilePlaceHolder}"\r\n              /\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cbr\x3e\r\n      \x3c/div\x3e\r\n      \x3c!--\x3cdiv\x3e--\x3e\r\n        \x3c!--\x3cbr\x3e--\x3e\r\n        \x3c!--\x3cspan\x3e--\x3e\r\n          \x3c!--\x3cinput type\x3d"checkbox" id\x3d"encryptionSupported" data-dojo-attach-point\x3d"_encryptionSupported" data-dojo-type\x3d"dijit/form/CheckBox"\x3e--\x3e\r\n          \x3c!--\x3clabel for\x3d"encryptionSupported"\x3e${i18n.encryptionSupported}\x3c/label\x3e--\x3e\r\n        \x3c!--\x3c/span\x3e--\x3e\r\n        \x3c!--\x3cbr\x3e--\x3e\r\n        \x3c!--\x3cspan\x3e--\x3e\r\n          \x3c!--\x3cinput type\x3d"checkbox" id\x3d"supportSignedRequest" data-dojo-attach-point\x3d"_signedRequestSupported" data-dojo-type\x3d"dijit/form/CheckBox"\x3e--\x3e\r\n          \x3c!--\x3clabel for\x3d"supportSignedRequest"\x3e${i18n.supportSignedRequest}\x3c/label\x3e--\x3e\r\n        \x3c!--\x3c/span\x3e--\x3e\r\n        \x3c!--\x3cbr\x3e--\x3e\r\n      \x3c!--\x3c/div\x3e\x3cbr\x3e--\x3e\r\n\r\n      \x3cspan class\x3d"esriItemLinks"\x3e\x3ca data-dojo-attach-point\x3d"_toggleAdvancedSettings" data-dojo-attach-event\x3d"onclick:onToggleAdvancedSettings"\x3e${i18n.showAdvancedSettings}\x3c/a\x3e\x3c/span\x3e\x3cbr\x3e\r\n      \x3cdiv id\x3d"advancedSettings" data-dojo-attach-point\x3d"_advancedSettings"\x3e\r\n        \x3cbr\x3e\r\n        \x3cspan\x3e\r\n          \x3cinput type\x3d"checkbox" id\x3d"encryptionSupported" data-dojo-attach-point\x3d"_encryptionSupported" data-dojo-type\x3d"dijit/form/CheckBox"\x3e\r\n          \x3clabel for\x3d"encryptionSupported"\x3e${i18n.encryptionSupported}\x3c/label\x3e\r\n        \x3c/span\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cspan\x3e\r\n          \x3cinput type\x3d"checkbox" id\x3d"supportSignedRequest" data-dojo-attach-point\x3d"_signedRequestSupported" data-dojo-type\x3d"dijit/form/CheckBox"\x3e\r\n          \x3clabel for\x3d"supportSignedRequest"\x3e${i18n.supportSignedRequest}\x3c/label\x3e\x3cbr\x3e\r\n          \x3cspan class\x3d"esriLeadingMargin15" data-dojo-attach-point\x3d"_sha256Container"\x3e\r\n            \x3cinput type\x3d"checkbox" id\x3d"signUsingSHA256" data-dojo-attach-point\x3d"_signUsingSHA256" data-dojo-type\x3d"dijit/form/CheckBox"\x3e\r\n            \x3clabel for\x3d"signUsingSHA256"\x3e${i18n.signUsingSHA256}\x3c/label\x3e\x3cbr\x3e\r\n          \x3c/span\x3e\r\n        \x3c/span\x3e\r\n        \x3cbr\x3e\r\n        \x3cspan\x3e\r\n          \x3cinput type\x3d"checkbox" id\x3d"supportsLogoutRequest" data-dojo-attach-point\x3d"_logoutRequestSupported" data-dojo-type\x3d"dijit/form/CheckBox"\x3e\r\n          \x3clabel for\x3d"supportsLogoutRequest"\x3e${i18n.propagateLogout}\x3c/label\x3e\r\n        \x3c/span\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cspan\x3e\r\n          \x3clabel\x3e\r\n            \x3cinput type\x3d"checkbox" data-dojo-attach-point\x3d"_updateProfile" data-dojo-type\x3d"dijit/form/CheckBox"\x3e\r\n            ${i18n.updateProfileAtSignIn}\r\n          \x3c/label\x3e\r\n        \x3c/span\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_updateGroupsContainer"\x3e\r\n          \x3cspan\x3e\r\n            \x3clabel\x3e\r\n              \x3cinput type\x3d"checkbox" data-dojo-attach-point\x3d"_updateGroups" data-dojo-type\x3d"dijit/form/CheckBox"\x3e\r\n              ${i18n.updateGroupsAtSignIn}\r\n            \x3c/label\x3e\r\n          \x3c/span\x3e\r\n          \x3cbr\x3e\x3cbr\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_logoutUrlContainer"\x3e\r\n          \x3cspan\x3e${i18n.logoutUrlLabel}\x3c/span\x3e\r\n          \x3cbr\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_logoutUrlInput" name\x3d"logoutUrl" type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n          \x3clabel\x3e${i18n.optionalLabel}\x3c/label\x3e\r\n          \x3cbr\x3e\r\n          \x3cbr\x3e\r\n        \x3c/div\x3e\r\n        \x3cspan\x3e${i18n.entityIDLabel}\x3c/span\x3e\x3cbr\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_entityIDInput" name\x3d"entityId" type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true"\x3e\x3c/div\x3e\r\n        \x3c!--\x3cspan\x3e${i18n.userIdAttrLabel}\x3c/span\x3e\x3cbr\x3e--\x3e\r\n        \x3c!--\x3cdiv data-dojo-attach-point\x3d"_userIdAttrInput" name\x3d"userIdAttribute" type\x3d"text" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-props\x3d"trim:true" title\x3d"${i18n.userIdAttrTooltip}"\x3e\x3c/div\x3e \x3clabel\x3e${i18n.optionalLabel}\x3c/label\x3e--\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv data-dojo-attach-point\x3d"_providerMetadataDownloadContainer"\x3e\r\n        \x3cbr\x3e\r\n        \x3cspan\x3e${i18n.downloadProviderMetadata}\x3c/span\x3e\r\n        \x3cbr\x3e\r\n        \x3cdiv class\x3d"esriItemLinks signedMetadataUrl"\x3e\x3ca href\x3d"#" data-dojo-attach-point\x3d"_signedProviderMetadataUrl" target\x3d"_blank"\x3e\x3c/a\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cbr\x3e\x3cbr\x3e\r\n      \x3cdiv class\x3d"esriAlignTrailing" data-dojo-attach-point\x3d"_buttons"\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_setBtn" class\x3d"primary" data-dojo-type\x3d"dijit/form/Button"\x3e${i18n.setIdentityProviderLabel}\x3c/button\x3e\r\n        \x3cbutton data-dojo-attach-point\x3d"_cancelBtn" class\x3d"cancel" data-dojo-type\x3d"dijit/form/Button"\x3e${i18n.cancel}\x3c/button\x3e\r\n      \x3c/div\x3e\r\n    \x3c/form\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:arcgisonline/pages/dijit/UploadProgressBar/UploadProgressBar.html":'\x3cdiv class\x3d"upload-progress-bar flex-1 flex-column-justify-center margin-right-1 margin-left-half position-relative"\x3e\r\n  \x3cdiv class\x3d"progress-bar"\x3e\r\n    \x3cdiv class\x3d"progress-bar-fill" data-dojo-attach-point\x3d"_uploadProgressFill"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"font-size--3 upload-percent-label" data-dojo-attach-point\x3d"_uploadPercentLabel"\x3e0%\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"*now":function(m){m(['dojo/i18n!*preload*arcgisonline/nls/arcgisonline*["ar","bs","ca","cs","da","de","de-ch","el","en-au","en-ca","en-gb","en-us","es","es-mx","et","fi","fr","fr-ch","he","hr","hu","id","it","it-ch","ja","ko","lt","lv","nl","nb","pl","pt","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-cn","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("arcgisonline/arcgisonline",["dojo","dijit","dojox","dojo/require!esri/main,dijit/_base,dijit/form/DropDownButton,dijit/form/ComboButton,dijit/form/ToggleButton,dijit/form/HorizontalSlider,dijit/form/VerticalSlider,dijit/form/HorizontalRule,dijit/form/VerticalRule,dijit/form/HorizontalRuleLabels,dijit/form/VerticalRuleLabels,esri/map,esri/dijit/editing/Editor,esri/dijit/editing/TemplatePicker,esri/dijit/InfoWindow,esri/dijit/OverviewMap,esri/dijit/Attribution,esri/dijit/Scalebar,esri/dijit/Legend,esri/dijit/TimeSlider,esri/dijit/MultidimensionalSlider,esri/dijit/BasemapGallery,esri/dijit/HomeButton,esri/dijit/LocateButton,esri/dijit/Popup,esri/layers/graphics,esri/layers/agstiled,esri/layers/agsdynamic,esri/layers/agsimageservice,esri/layers/CSVLayer,esri/layers/StreamLayer,esri/layers/KMLLayer,esri/layers/FeatureLayer,esri/layers/VectorTileLayer,esri/layers/osm,esri/SnappingManager,esri/tasks/geometry,esri/tasks/identify,esri/tasks/locator,esri/toolbars/draw,esri/virtualearth/VETiledLayer,esri/virtualearth/VEGeocoder,esri/dijit/Geocoder,dojo/dnd/Moveable,dojo/parser,arcgisonline/map/classBreaks,arcgisonline/map/dynLayer,arcgisonline/map/edit,arcgisonline/map/featColl,arcgisonline/map/fileImport,arcgisonline/map/geocode,arcgisonline/map/geocodeReview,arcgisonline/map/geoRSS,arcgisonline/map/itemData,arcgisonline/map/layer,arcgisonline/map/kml,arcgisonline/map/mapNotes,arcgisonline/map/mapUtil,arcgisonline/map/role,arcgisonline/map/print,arcgisonline/map/popup,arcgisonline/map/save_open,arcgisonline/map/symbol,arcgisonline/map/table,arcgisonline/map/thumbnail,arcgisonline/map/time,arcgisonline/map/multiDimensions,arcgisonline/map/vectorTile,arcgisonline/map/webTile,arcgisonline/map/wms,arcgisonline/map/dijit/About,arcgisonline/map/dijit/AddContent,arcgisonline/map/dijit/Directions,arcgisonline/map/dijit/Edit,arcgisonline/map/dijit/Geocode,arcgisonline/map/dijit/LeftPanel,arcgisonline/map/dijit/Legend,arcgisonline/map/dijit/ManageTemplates,arcgisonline/map/dijit/MosaicRule,arcgisonline/map/dijit/PopupBuilder,arcgisonline/map/dijit/RendererLabels,arcgisonline/map/dijit/DefineAOI,arcgisonline/map/dijit/RenderingRule,arcgisonline/map/dijit/StructuredPopupWidget,arcgisonline/map/dijit/TOC,arcgisonline/map/dijit/MultidimensionalFilter,arcgisonline/map/dijit/renderer/AttributeTransparency,arcgisonline/map/dijit/renderer/AttributeTransparencyDlg,arcgisonline/map/dijit/renderer/Color,arcgisonline/map/dijit/renderer/ColorGrid,arcgisonline/map/dijit/renderer/Gallery,arcgisonline/map/dijit/renderer/HeatMap,arcgisonline/map/dijit/renderer/MultiAttributes,arcgisonline/map/dijit/renderer/Simple,arcgisonline/map/dijit/renderer/Size,arcgisonline/map/dijit/renderer/SizeGrid,arcgisonline/map/dijit/renderer/SymbolStylerDlg,arcgisonline/map/dijit/renderer/UniqueValues,arcgisonline/map/dijit/renderer/UniqueValuesGrid,esri/tasks/RelationshipQuery,esri/tasks/StatisticDefinition,esri/tasks/PrintParameters,esri/tasks/LegendLayer,esri/tasks/GenerateRendererParameters,esri/tasks/ClassificationDefinition,esri/tasks/ClassBreaksDefinition,esri/tasks/UniqueValueDefinition,esri/tasks/ColorRamp,esri/tasks/AlgorithmicColorRamp,esri/tasks/MultipartColorRamp,esri/tasks/RouteTask,esri/tasks/RouteParameters,esri/tasks/RouteResult,esri/tasks/NAMessage,esri/tasks/NATypes,esri/tasks/DirectionsFeatureSet,esri/layers/wmts,esri/layers/WMTSLayer,esri/layers/WMTSLayerInfo,esri/dijit/Directions,dijit/layout/AccordionPane,dojox/data/QueryReadStore,arcgisonline/sharing/util,arcgisonline/sharing/utilShare,arcgisonline/sharing/geow/Account,arcgisonline/sharing/geow/Community,arcgisonline/sharing/geow/Geow,arcgisonline/sharing/geow/MemberReadStore,arcgisonline/sharing/geow/QueryReadStore,arcgisonline/sharing/geow/TooltipQueryReadStore,dijit/Dialog,dijit/form/ComboBox,dijit/layout/TabContainer,arcgisonline/sharing/dijit/ArcGISOnlineServicesGrid,arcgisonline/sharing/dijit/ArcGISServerServicesGrid,arcgisonline/sharing/dijit/BasemapGallery,arcgisonline/sharing/dijit/BasemapGalleryGrid,arcgisonline/sharing/dijit/Button,arcgisonline/sharing/dijit/ComboBox,arcgisonline/sharing/dijit/DataGrid,arcgisonline/sharing/dijit/DropDownButton,arcgisonline/sharing/dijit/FeatureLayerQueryResult,arcgisonline/sharing/dijit/FeatureLayerQueryStore,arcgisonline/sharing/dijit/GoogleServicesGrid,arcgisonline/sharing/dijit/HelpManager,arcgisonline/sharing/dijit/OrganizationSetup,arcgisonline/sharing/dijit/Troubleshoot,arcgisonline/sharing/dijit/SingleFilter,arcgisonline/sharing/dijit/SingleInteractiveFilter,arcgisonline/sharing/dijit/dialog/AddLayerFromFileDlg,arcgisonline/sharing/dijit/dialog/AddLayerFromUrlDlg,arcgisonline/sharing/dijit/dialog/BrowseLayersDlg,arcgisonline/sharing/dijit/dialog/CsvLocationDlg,arcgisonline/sharing/dijit/dialog/DeleteWarningDlg,arcgisonline/sharing/dijit/dialog/ExportDlg,arcgisonline/sharing/dijit/dialog/ExtentDlg,arcgisonline/sharing/dijit/dialog/FeatureTemplateDlg,arcgisonline/sharing/dijit/dialog/FieldsDlg,arcgisonline/sharing/dijit/dialog/FilterDlg,arcgisonline/sharing/dijit/dialog/FeatureTypeDlg,arcgisonline/sharing/dijit/dialog/GeneralDlg,arcgisonline/sharing/dijit/dialog/InvitationsDlg,arcgisonline/sharing/dijit/dialog/JoinGroupDlg,arcgisonline/sharing/dijit/dialog/ManageSubscriptionDlg,arcgisonline/sharing/dijit/dialog/ManageTilesDlg,arcgisonline/sharing/dijit/dialog/MapSettingsDlg,arcgisonline/sharing/dijit/dialog/MapNotesDlg,arcgisonline/sharing/dijit/dialog/MembershipRequestsDlg,arcgisonline/sharing/dijit/dialog/MdSliderSettingsDlg,arcgisonline/sharing/dijit/dialog/OpenMapDlg,arcgisonline/sharing/dijit/dialog/OpenPresentationDlg,arcgisonline/sharing/dijit/dialog/QueryLayerDlg,arcgisonline/sharing/dijit/dialog/RenameDlg,arcgisonline/sharing/dijit/dialog/RendererDlg,arcgisonline/sharing/dijit/dialog/SaveWebMapDlg,arcgisonline/sharing/dijit/dialog/SetIdentityProviderDlg,arcgisonline/sharing/dijit/dialog/ShareCheckDlg,arcgisonline/sharing/dijit/dialog/SharingDlg,arcgisonline/sharing/dijit/dialog/ShareMapDlg,arcgisonline/sharing/dijit/dialog/SubscriptionStatusDlg,arcgisonline/sharing/dijit/dialog/SymbolDlg,arcgisonline/sharing/dijit/dialog/TagsDlg,arcgisonline/sharing/dijit/dialog/TermsOfUseDlg,arcgisonline/sharing/dijit/dialog/TimeSettingsDlg,arcgisonline/sharing/dijit/dialog/UpdateItemDlg,arcgisonline/sharing/dijit/dialog/WaitingDlg,arcgisonline/sharing/dijit/_GalleryFiltersMixin,arcgisonline/sharing/dijit/Grid,arcgisonline/sharing/dijit/dialog/ItemPropertiesDlg,arcgisonline/sharing/dijit/dialog/BrowseItemsDlg,arcgisonline/sharing/dijit/dialog/_CreateItemUtilMixin,arcgisonline/sharing/dijit/dialog/ConfirmDialog,arcgisonline/sharing/dijit/dialog/AdvancedOfflineOptionsDlg,arcgisonline/sharing/dijit/dialog/getWFSConfig,arcgisonline/sharing/dijit/dialog/getWMTSConfig"],function(m,
n,v){m.provide("arcgisonline.main");m.require("esri.main");m.require("dijit._base");m.require("dijit.form.DropDownButton");m.require("dijit.form.ComboButton");m.require("dijit.form.ToggleButton");m.require("dijit.form.HorizontalSlider");m.require("dijit.form.VerticalSlider");m.require("dijit.form.HorizontalRule");m.require("dijit.form.VerticalRule");m.require("dijit.form.HorizontalRuleLabels");m.require("dijit.form.VerticalRuleLabels");m.require("esri.map");m.require("esri.dijit.editing.Editor");
m.require("esri.dijit.editing.TemplatePicker");m.require("esri.dijit.InfoWindow");m.require("esri.dijit.OverviewMap");m.require("esri.dijit.Attribution");m.require("esri.dijit.Scalebar");m.require("esri.dijit.Legend");m.require("esri.dijit.TimeSlider");m.require("esri.dijit.MultidimensionalSlider");m.require("esri.dijit.BasemapGallery");m.require("esri.dijit.HomeButton");m.require("esri.dijit.LocateButton");m.require("esri.dijit.Popup");m.require("esri.layers.graphics");m.require("esri.layers.agstiled");
m.require("esri.layers.agsdynamic");m.require("esri.layers.agsimageservice");m.require("esri.layers.CSVLayer");m.require("esri.layers.StreamLayer");m.require("esri.layers.KMLLayer");m.require("esri.layers.FeatureLayer");m.require("esri.layers.VectorTileLayer");m.require("esri.layers.osm");m.require("esri.SnappingManager");m.require("esri.tasks.geometry");m.require("esri.tasks.identify");m.require("esri.tasks.locator");m.require("esri.toolbars.draw");m.require("esri.virtualearth.VETiledLayer");m.require("esri.virtualearth.VEGeocoder");
m.require("esri.dijit.Geocoder");m.require("dojo.dnd.Moveable");m.require("dojo.parser");m.require("arcgisonline.map.classBreaks");m.require("arcgisonline.map.dynLayer");m.require("arcgisonline.map.edit");m.require("arcgisonline.map.featColl");m.require("arcgisonline.map.fileImport");m.require("arcgisonline.map.geocode");m.require("arcgisonline.map.geocodeReview");m.require("arcgisonline.map.geoRSS");m.require("arcgisonline.map.itemData");m.require("arcgisonline.map.layer");m.require("arcgisonline.map.kml");
m.require("arcgisonline.map.mapNotes");m.require("arcgisonline.map.mapUtil");m.require("arcgisonline.map.role");m.require("arcgisonline.map.print");m.require("arcgisonline.map.popup");m.require("arcgisonline.map.save_open");m.require("arcgisonline.map.symbol");m.require("arcgisonline.map.table");m.require("arcgisonline.map.thumbnail");m.require("arcgisonline.map.time");m.require("arcgisonline.map.multiDimensions");m.require("arcgisonline.map.vectorTile");m.require("arcgisonline.map.webTile");m.require("arcgisonline.map.wms");
m.require("arcgisonline.map.dijit.About");m.require("arcgisonline.map.dijit.AddContent");m.require("arcgisonline.map.dijit.Directions");m.require("arcgisonline.map.dijit.Edit");m.require("arcgisonline.map.dijit.Geocode");m.require("arcgisonline.map.dijit.LeftPanel");m.require("arcgisonline.map.dijit.Legend");m.require("arcgisonline.map.dijit.ManageTemplates");m.require("arcgisonline.map.dijit.MosaicRule");m.require("arcgisonline.map.dijit.PopupBuilder");m.require("arcgisonline.map.dijit.RendererLabels");
m.require("arcgisonline.map.dijit.DefineAOI");m.require("arcgisonline.map.dijit.RenderingRule");m.require("arcgisonline.map.dijit.StructuredPopupWidget");m.require("arcgisonline.map.dijit.TOC");m.require("arcgisonline.map.dijit.MultidimensionalFilter");m.require("arcgisonline.map.dijit.renderer.AttributeTransparency");m.require("arcgisonline.map.dijit.renderer.AttributeTransparencyDlg");m.require("arcgisonline.map.dijit.renderer.Color");m.require("arcgisonline.map.dijit.renderer.ColorGrid");m.require("arcgisonline.map.dijit.renderer.Gallery");
m.require("arcgisonline.map.dijit.renderer.HeatMap");m.require("arcgisonline.map.dijit.renderer.MultiAttributes");m.require("arcgisonline.map.dijit.renderer.Simple");m.require("arcgisonline.map.dijit.renderer.Size");m.require("arcgisonline.map.dijit.renderer.SizeGrid");m.require("arcgisonline.map.dijit.renderer.SymbolStylerDlg");m.require("arcgisonline.map.dijit.renderer.UniqueValues");m.require("arcgisonline.map.dijit.renderer.UniqueValuesGrid");m.require("esri.tasks.RelationshipQuery");m.require("esri.tasks.StatisticDefinition");
m.require("esri.tasks.PrintParameters");m.require("esri.tasks.LegendLayer");m.require("esri.tasks.GenerateRendererParameters");m.require("esri.tasks.ClassificationDefinition");m.require("esri.tasks.ClassBreaksDefinition");m.require("esri.tasks.UniqueValueDefinition");m.require("esri.tasks.ColorRamp");m.require("esri.tasks.AlgorithmicColorRamp");m.require("esri.tasks.MultipartColorRamp");m.require("esri.tasks.RouteTask");m.require("esri.tasks.RouteParameters");m.require("esri.tasks.RouteResult");m.require("esri.tasks.NAMessage");
m.require("esri.tasks.NATypes");m.require("esri.tasks.DirectionsFeatureSet");m.require("esri.layers.wmts");m.require("esri.layers.WMTSLayer");m.require("esri.layers.WMTSLayerInfo");m.require("esri.dijit.Directions");m.require("dijit.layout.AccordionPane");m.require("dojox.data.QueryReadStore");m.require("arcgisonline.sharing.util");m.require("arcgisonline.sharing.utilShare");m.require("arcgisonline.sharing.geow.Account");m.require("arcgisonline.sharing.geow.Community");m.require("arcgisonline.sharing.geow.Geow");
m.require("arcgisonline.sharing.geow.MemberReadStore");m.require("arcgisonline.sharing.geow.QueryReadStore");m.require("arcgisonline.sharing.geow.TooltipQueryReadStore");m.require("dijit.Dialog");m.require("dijit.form.ComboBox");m.require("dijit.layout.TabContainer");m.require("arcgisonline.sharing.dijit.ArcGISOnlineServicesGrid");m.require("arcgisonline.sharing.dijit.ArcGISServerServicesGrid");m.require("arcgisonline.sharing.dijit.BasemapGallery");m.require("arcgisonline.sharing.dijit.BasemapGalleryGrid");
m.require("arcgisonline.sharing.dijit.Button");m.require("arcgisonline.sharing.dijit.ComboBox");m.require("arcgisonline.sharing.dijit.DataGrid");m.require("arcgisonline.sharing.dijit.DropDownButton");m.require("arcgisonline.sharing.dijit.FeatureLayerQueryResult");m.require("arcgisonline.sharing.dijit.FeatureLayerQueryStore");m.require("arcgisonline.sharing.dijit.GoogleServicesGrid");m.require("arcgisonline.sharing.dijit.HelpManager");m.require("arcgisonline.sharing.dijit.OrganizationSetup");m.require("arcgisonline.sharing.dijit.Troubleshoot");
m.require("arcgisonline.sharing.dijit.SingleFilter");m.require("arcgisonline.sharing.dijit.SingleInteractiveFilter");m.require("arcgisonline.sharing.dijit.dialog.AddLayerFromFileDlg");m.require("arcgisonline.sharing.dijit.dialog.AddLayerFromUrlDlg");m.require("arcgisonline.sharing.dijit.dialog.BrowseLayersDlg");m.require("arcgisonline.sharing.dijit.dialog.CsvLocationDlg");m.require("arcgisonline.sharing.dijit.dialog.DeleteWarningDlg");m.require("arcgisonline.sharing.dijit.dialog.ExportDlg");m.require("arcgisonline.sharing.dijit.dialog.ExtentDlg");
m.require("arcgisonline.sharing.dijit.dialog.FeatureTemplateDlg");m.require("arcgisonline.sharing.dijit.dialog.FieldsDlg");m.require("arcgisonline.sharing.dijit.dialog.FilterDlg");m.require("arcgisonline.sharing.dijit.dialog.FeatureTypeDlg");m.require("arcgisonline.sharing.dijit.dialog.GeneralDlg");m.require("arcgisonline.sharing.dijit.dialog.InvitationsDlg");m.require("arcgisonline.sharing.dijit.dialog.JoinGroupDlg");m.require("arcgisonline.sharing.dijit.dialog.ManageSubscriptionDlg");m.require("arcgisonline.sharing.dijit.dialog.ManageTilesDlg");
m.require("arcgisonline.sharing.dijit.dialog.MapSettingsDlg");m.require("arcgisonline.sharing.dijit.dialog.MapNotesDlg");m.require("arcgisonline.sharing.dijit.dialog.MembershipRequestsDlg");m.require("arcgisonline.sharing.dijit.dialog.MdSliderSettingsDlg");m.require("arcgisonline.sharing.dijit.dialog.OpenMapDlg");m.require("arcgisonline.sharing.dijit.dialog.OpenPresentationDlg");m.require("arcgisonline.sharing.dijit.dialog.QueryLayerDlg");m.require("arcgisonline.sharing.dijit.dialog.RenameDlg");m.require("arcgisonline.sharing.dijit.dialog.RendererDlg");
m.require("arcgisonline.sharing.dijit.dialog.SaveWebMapDlg");m.require("arcgisonline.sharing.dijit.dialog.SetIdentityProviderDlg");m.require("arcgisonline.sharing.dijit.dialog.ShareCheckDlg");m.require("arcgisonline.sharing.dijit.dialog.SharingDlg");m.require("arcgisonline.sharing.dijit.dialog.ShareMapDlg");m.require("arcgisonline.sharing.dijit.dialog.SubscriptionStatusDlg");m.require("arcgisonline.sharing.dijit.dialog.SymbolDlg");m.require("arcgisonline.sharing.dijit.dialog.TagsDlg");m.require("arcgisonline.sharing.dijit.dialog.TermsOfUseDlg");
m.require("arcgisonline.sharing.dijit.dialog.TimeSettingsDlg");m.require("arcgisonline.sharing.dijit.dialog.UpdateItemDlg");m.require("arcgisonline.sharing.dijit.dialog.WaitingDlg");m.require("arcgisonline.sharing.dijit._GalleryFiltersMixin");m.require("arcgisonline.sharing.dijit.Grid");m.require("arcgisonline.sharing.dijit.dialog.ItemPropertiesDlg");m.require("arcgisonline.sharing.dijit.dialog.BrowseItemsDlg");m.require("arcgisonline.sharing.dijit.dialog._CreateItemUtilMixin");m.require("arcgisonline.sharing.dijit.dialog.ConfirmDialog");
m.require("arcgisonline.sharing.dijit.dialog.AdvancedOfflineOptionsDlg");m.require("arcgisonline.sharing.dijit.dialog.getWFSConfig");m.require("arcgisonline.sharing.dijit.dialog.getWMTSConfig")});